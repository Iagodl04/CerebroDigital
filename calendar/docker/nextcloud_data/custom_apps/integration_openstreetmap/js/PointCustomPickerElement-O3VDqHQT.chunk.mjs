(function(){"use strict";try{if(typeof document<"u"){var e=document.createElement("style");e.appendChild(document.createTextNode(".material-design-icon[data-v-b101d636]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}.empty-content[data-v-b101d636]{display:flex;align-items:center;flex-direction:column;justify-content:center;flex-grow:1;padding:var(--default-grid-baseline)}.modal-wrapper .empty-content[data-v-b101d636]{margin-top:5vh;margin-bottom:5vh}.empty-content__icon[data-v-b101d636]{display:flex;align-items:center;justify-content:center;width:64px;height:64px;margin:0 auto 15px;opacity:.4;background-repeat:no-repeat;background-position:center;background-size:64px}.empty-content__icon[data-v-b101d636] svg{width:64px!important;height:64px!important;max-width:64px!important;max-height:64px!important}.empty-content__name[data-v-b101d636]{margin-bottom:10px;text-align:center;font-weight:700;font-size:20px;line-height:30px}.empty-content__description[data-v-b101d636]{color:var(--color-text-maxcontrast);text-align:center;text-wrap-style:balance}.empty-content__action[data-v-b101d636]{margin-top:8px}.modal-wrapper .empty-content__action[data-v-b101d636]{margin-top:20px;display:flex}.material-design-icon[data-v-e408867a],.material-design-icon[data-v-90c6aa3b]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}.provider-list[data-v-90c6aa3b]{width:100%;min-height:400px;padding:0 16px 16px;display:flex;flex-direction:column}.provider-list--select[data-v-90c6aa3b]{width:100%}.provider-list--select .provider[data-v-90c6aa3b]{display:flex;align-items:center;height:28px;overflow:hidden}.provider-list--select .provider .link-icon[data-v-90c6aa3b]{margin-inline-end:8px}.provider-list--select .provider .provider-icon[data-v-90c6aa3b]{width:20px;height:20px;object-fit:contain;margin-inline-end:8px;filter:var(--background-invert-if-dark)}.provider-list--select .provider .option-text[data-v-90c6aa3b]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.material-design-icon[data-v-8ce33442]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}.widget-custom[data-v-8ce33442]{width:100%;margin:auto;margin-bottom:calc(var(--default-grid-baseline, 4px) * 3);margin-top:calc(var(--default-grid-baseline, 4px) * 3);overflow:hidden;border:2px solid var(--color-border);border-radius:var(--border-radius-container);background-color:transparent;display:flex}.widget-custom.full-width[data-v-8ce33442]{width:var(--widget-full-width, 100%)!important;inset-inline-start:calc((var(--widget-full-width, 100%) - 100%) / 2 * -1);position:relative}.widget-access[data-v-8ce33442]{width:100%;margin:auto;margin-bottom:calc(var(--default-grid-baseline, 4px) * 3);margin-top:calc(var(--default-grid-baseline, 4px) * 3);overflow:hidden;border:2px solid var(--color-border);border-radius:var(--border-radius-container);background-color:transparent;display:flex;padding:calc(var(--default-grid-baseline, 4px) * 3)}.widget-default[data-v-8ce33442]{width:100%;margin:auto;margin-bottom:calc(var(--default-grid-baseline, 4px) * 3);margin-top:calc(var(--default-grid-baseline, 4px) * 3);overflow:hidden;border:2px solid var(--color-border);border-radius:var(--border-radius-container);background-color:transparent;display:flex}.widget-default--compact[data-v-8ce33442]{flex-direction:column}.widget-default--compact .widget-default--image[data-v-8ce33442]{width:100%;height:150px}.widget-default--compact .widget-default--details[data-v-8ce33442]{width:100%;padding-top:calc(var(--default-grid-baseline, 4px) * 2);padding-bottom:calc(var(--default-grid-baseline, 4px) * 2)}.widget-default--compact .widget-default--description[data-v-8ce33442]{display:none}.widget-default--image[data-v-8ce33442]{width:40%;background-position:center;background-size:cover;background-repeat:no-repeat}.widget-default--name[data-v-8ce33442]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:700}.widget-default--details[data-v-8ce33442]{padding:calc(var(--default-grid-baseline, 4px) * 3);width:60%}.widget-default--details p[data-v-8ce33442]{margin:0;padding:0}.widget-default--description[data-v-8ce33442]{overflow:hidden;text-overflow:ellipsis;display:-webkit-box;-webkit-line-clamp:3;line-clamp:3;-webkit-box-orient:vertical}.widget-default--link[data-v-8ce33442]{color:var(--color-text-maxcontrast);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.toggle-interactive[data-v-8ce33442]{position:relative}.toggle-interactive .toggle-interactive--button[data-v-8ce33442]{position:absolute;bottom:var(--default-grid-baseline);inset-inline-end:var(--default-grid-baseline);z-index:10000}.material-design-icon[data-v-a0658f2a]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}.raw-link[data-v-a0658f2a]{width:100%;min-height:350px;display:flex;flex-direction:column;overflow-y:auto;padding:0 16px 16px}.raw-link .input-wrapper[data-v-a0658f2a]{width:100%}.raw-link .reference-widget[data-v-a0658f2a]{display:flex}.raw-link--empty-content .provider-icon[data-v-a0658f2a]{width:150px;height:150px;object-fit:contain;filter:var(--background-invert-if-dark)}.raw-link--input[data-v-a0658f2a]{width:99%}.material-design-icon[data-v-059edcfb]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}.result[data-v-059edcfb]{display:flex;align-items:center;height:var(--default-clickable-area);overflow:hidden}.result--icon-class[data-v-059edcfb],.result--image[data-v-059edcfb]{width:40px;min-width:40px;height:40px;object-fit:contain}.result--icon-class.rounded[data-v-059edcfb],.result--image.rounded[data-v-059edcfb]{border-radius:50%}.result--content[data-v-059edcfb]{display:flex;flex-direction:column;padding-inline-start:10px;overflow:hidden}.result--content--name[data-v-059edcfb],.result--content--subline[data-v-059edcfb]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.material-design-icon[data-v-e8abf1d4]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}.smart-picker-search[data-v-e8abf1d4]{width:100%;display:flex;flex-direction:column;padding:0 16px 16px}.smart-picker-search.with-empty-content[data-v-e8abf1d4]{min-height:400px}.smart-picker-search .provider-icon[data-v-e8abf1d4]{width:150px;height:150px;object-fit:contain;filter:var(--background-invert-if-dark)}.smart-picker-search--select[data-v-e8abf1d4],.smart-picker-search--select .search-result[data-v-e8abf1d4]{width:100%}.smart-picker-search--select .group-name-icon[data-v-e8abf1d4],.smart-picker-search--select .option-simple-icon[data-v-e8abf1d4]{width:20px;height:20px;margin:0 20px 0 10px}.smart-picker-search--select .custom-option[data-v-e8abf1d4]{height:var(--default-clickable-area);display:flex;align-items:center;overflow:hidden}.smart-picker-search--select .option-text[data-v-e8abf1d4]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.material-design-icon[data-v-b193005a]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}.reference-picker[data-v-b193005a],.reference-picker .custom-element-wrapper[data-v-b193005a],.reference-picker .custom-element-wrapper .custom-element[data-v-b193005a]{display:flex;overflow-y:auto;width:100%}.material-design-icon[data-v-15018516]{display:flex;align-self:center;justify-self:center;align-items:center;justify-content:center}.reference-picker-modal[data-v-15018516] .modal-container{display:flex!important}.reference-picker-modal--content[data-v-15018516]{width:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;overflow-y:auto}.reference-picker-modal--content .close-button[data-v-15018516],.reference-picker-modal--content .back-button[data-v-15018516]{position:absolute;top:4px}.reference-picker-modal--content .back-button[data-v-15018516]{inset-inline-start:4px}.reference-picker-modal--content .close-button[data-v-15018516]{inset-inline-end:4px}.reference-picker-modal--content>h2[data-v-15018516]{display:flex;margin:12px 0 20px}.reference-picker-modal--content>h2 .icon[data-v-15018516]{margin-inline-end:8px}.modal-container__content .reference-picker-modal--content{height:100%}.point-picker-content[data-v-a37805b3]{width:100%;display:flex;flex-direction:column;align-items:center;padding:12px 16px}.point-picker-content h2[data-v-a37805b3]{display:flex;align-items:center;margin-top:0}.point-picker-content .generic-search[data-v-a37805b3]{margin-bottom:12px;padding:0!important;width:100%}.point-picker-content .point-map[data-v-a37805b3]{width:100%;height:2000px}.point-picker-content .point-map[data-v-a37805b3] .maplibregl-map{border-radius:var(--border-radius-large)}.point-picker-content .preview-link[data-v-a37805b3]{margin-bottom:8px}.point-picker-content .spacer[data-v-a37805b3]{flex-grow:1}.point-picker-content .footer[data-v-a37805b3]{width:100%;display:flex;margin-top:8px;align-items:center;gap:8px}.point-picker-content .footer .marker-checkbox[data-v-a37805b3]{margin-left:16px}.point-picker-content .footer .type-select[data-v-a37805b3]{margin:0}")),document.head.appendChild(e)}}catch(t){console.error("vite-plugin-css-injected-by-js",t)}})();
import{A as z,s as B,g}from"./lastMapStateHelper-CF_pc0C2.chunk.mjs";import{N as A}from"./NcCheckboxRadioSwitch-Da3UT5om-py9-5E9m.chunk.mjs";import{N as Q}from"./Close-D6ngJ4t9-B_k1rgzA.chunk.mjs";import{N as q,_ as j}from"./NcSelect-BUPzYWtk-DxeaHCy0.chunk.mjs";import{M as G}from"./MaplibreMap-YzUp5Hnt.chunk.mjs";import{_ as F}from"./VMarker-CWNB22yj.chunk.mjs";import{_ as P,c as Z,t as C,r as k,a as H,b as D,d as U,e as J,f as K,h as W,j as X,k as Y}from"./legacy-DcjXBL_t-_k54Q3Kp.chunk.mjs";import{i as ee}from"./integration_openstreetmap-referenceLocation.mjs";import{h as te,v as x,c as re,_ as se}from"./index-B-L25m6y.chunk.mjs";import{loadState as N}from"./index-DZI6LgVG.chunk.mjs";import{l as ne}from"./logger-D3RVzcfQ-D-WVvsyi.chunk.mjs";import{q as ie,c,o as a,b as d,h as I,u as E,p as _,t as m,r as p,d as y,e as b,w as S,a as u,n as T,m as ae}from"./runtime-core.esm-bundler-CsAAUxo4.chunk.mjs";import{I as oe,d as ce}from"./NcActions-C-E6BGfZ-xBwqSzFG.chunk.mjs";import"./vue.runtime.esm-bundler-XT-a1Su5.chunk.mjs";import"./mapUtils-m7e-c8Iy.chunk.mjs";import"./index-BH5XFfaS.chunk.mjs";const le=["aria-labelledby"],pe={key:0,class:"empty-content__icon","aria-hidden":"true"},he=["id"],ue={key:2,class:"empty-content__description"},de={key:3,class:"empty-content__action"},me=ie({__name:"NcEmptyContent",props:{description:{default:""},name:{default:""}},setup(e){const s=Z();return(r,o)=>(a(),c("div",{"aria-labelledby":E(s),class:"empty-content",role:"note"},[r.$slots.icon?(a(),c("div",pe,[I(r.$slots,"icon",{},void 0,!0)])):d("",!0),r.name!==""||r.$slots.name?(a(),c("div",{key:1,id:E(s),class:"empty-content__name"},[I(r.$slots,"name",{},()=>[_(m(r.name),1)],!0)],8,he)):d("",!0),r.description!==""||r.$slots.description?(a(),c("p",ue,[I(r.$slots,"description",{},()=>[_(m(r.description),1)],!0)])):d("",!0),r.$slots.action?(a(),c("div",de,[I(r.$slots,"action",{},void 0,!0)])):d("",!0)],8,le))}}),ye=P(me,[["__scopeId","data-v-b101d636"]]),ge={name:"LinkVariantIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},ve=["aria-hidden","aria-label"],Se=["fill","width","height"],be={d:"M10.59,13.41C11,13.8 11,14.44 10.59,14.83C10.2,15.22 9.56,15.22 9.17,14.83C7.22,12.88 7.22,9.71 9.17,7.76V7.76L12.71,4.22C14.66,2.27 17.83,2.27 19.78,4.22C21.73,6.17 21.73,9.34 19.78,11.29L18.29,12.78C18.3,11.96 18.17,11.14 17.89,10.36L18.36,9.88C19.54,8.71 19.54,6.81 18.36,5.64C17.19,4.46 15.29,4.46 14.12,5.64L10.59,9.17C9.41,10.34 9.41,12.24 10.59,13.41M13.41,9.17C13.8,8.78 14.44,8.78 14.83,9.17C16.78,11.12 16.78,14.29 14.83,16.24V16.24L11.29,19.78C9.34,21.73 6.17,21.73 4.22,19.78C2.27,17.83 2.27,14.66 4.22,12.71L5.71,11.22C5.7,12.04 5.83,12.86 6.11,13.65L5.64,14.12C4.46,15.29 4.46,17.19 5.64,18.36C6.81,19.54 8.71,19.54 9.88,18.36L13.41,14.83C14.59,13.66 14.59,11.76 13.41,10.59C13,10.2 13,9.56 13.41,9.17Z"},ke={key:0};function fe(e,s,r,o,n,i){return a(),c("span",ae(e.$attrs,{"aria-hidden":r.title?null:"true","aria-label":r.title,class:"material-design-icon link-variant-icon",role:"img",onClick:s[0]||(s[0]=h=>e.$emit("click",h))}),[(a(),c("svg",{fill:r.fillColor,class:"material-design-icon__svg",width:r.size,height:r.size,viewBox:"0 0 24 24"},[u("path",be,[r.title?(a(),c("title",ke,m(r.title),1)):d("",!0)])],8,Se))],16,ve)}const Me=P(ge,[["render",fe]]);k(H);const $="any-link",Ce={id:$,title:C("Any link"),order:0,icon_url:te("core","filetypes/link.svg")};window._vue_richtext_reference_providers??=N("core","reference-provider-list",[]),window._vue_richtext_reference_provider_timestamps??=N("core","reference-provider-timestamps",{});function _e(e){return e===$?Ce:Ie().find(s=>s.id===e)}function Ie(){return window._vue_richtext_reference_providers.filter(e=>{const s=!!e.search_providers_ids&&e.search_providers_ids.length>0||ee(e.id);return s||ne.debug(`[smart picker] ${e.id} reference provider is discoverable but does not have any related search provider or custom picker component registered`),s})}k(U,D);function Pe(e){try{return!!new URL(e)}catch{return!1}}k(),k(J);const Le={name:"NcSearchResult",components:{NcHighlight:j},props:{entry:{type:Object,required:!0},query:{type:String,required:!0}}},we={class:"result"},Re=["src"],Te={class:"result--content"},Be={class:"result--content--name"},xe={class:"result--content--subline"};function Ne(e,s,r,o,n,i){const h=p("NcHighlight");return a(),c("div",we,[r.entry.icon?(a(),c("div",{key:0,class:T([{[r.entry.icon]:!0,rounded:r.entry.rounded},"result--icon-class"])},null,2)):(a(),c("img",{key:1,class:T(["result--image",{rounded:r.entry.rounded}]),src:r.entry.thumbnailUrl},null,10,Re)),u("div",Te,[u("span",Be,[y(h,{search:r.query,text:r.entry.title},null,8,["search","text"])]),u("span",xe,[y(h,{search:r.query,text:r.entry.subline},null,8,["search","text"])])])])}const Ee=P(Le,[["render",Ne],["__scopeId","data-v-059edcfb"]]);k(W,U,K);const O=5,Oe={name:"NcSearch",components:{LinkVariantIcon:Me,DotsHorizontalIcon:oe,NcEmptyContent:ye,NcSelect:q,NcSearchResult:Ee},props:{provider:{type:Object,required:!0},showEmptyContent:{type:Boolean,default:!0},searchPlaceholder:{type:String,default:null}},emits:["submit"],data(){return{searchQuery:"",selectedResult:null,resultsBySearchProvider:{},searching:!1,searchingMoreOf:null,abortController:null,noOptionsText:C("Start typing to search"),providerIconAlt:C("Provider icon")}},computed:{mySearchPlaceholder(){return this.searchPlaceholder||C("Search")},searchProviderIds(){return this.provider.search_providers_ids},options(){if(this.searchQuery==="")return[];const e=[];return Pe(this.searchQuery)&&e.push(this.rawLinkEntry),e.push(...this.formattedSearchResults),e},rawLinkEntry(){return{id:"rawLinkEntry",resourceUrl:this.searchQuery,isRawLink:!0}},formattedSearchResults(){const e=[];return this.searchProviderIds.forEach(s=>{if(this.resultsBySearchProvider[s].entries.length>0){(this.searchProviderIds.length>1||this.resultsBySearchProvider[s].entries.length>1)&&e.push({id:"groupTitle-"+s,name:this.resultsBySearchProvider[s].name,isCustomGroupTitle:!0,providerId:s});const r=this.resultsBySearchProvider[s].entries.map((o,n)=>({id:"provider-"+s+"-entry-"+n,...o}));e.push(...r),this.resultsBySearchProvider[s].isPaginated&&e.push({id:"moreOf-"+s,name:this.resultsBySearchProvider[s].name,isMore:!0,providerId:s,isLoading:this.searchingMoreOf===s})}}),e},debouncedUpdateSearch(){return ce(this.updateSearch,500)}},mounted(){this.resetResults()},beforeUnmount(){this.cancelSearchRequests()},methods:{t:C,resetResults(){const e={};this.searchProviderIds.forEach(s=>{e[s]={entries:[]}}),this.resultsBySearchProvider=e},focus(){setTimeout(()=>{this.$refs["search-select"]?.$el?.querySelector("#search-select-input")?.focus()},300)},cancelSearchRequests(){this.abortController&&this.abortController.abort()},onSearchInput(e){this.searchQuery=e,this.debouncedUpdateSearch()},onSelectResultSelected(e){e!==null&&(e.resourceUrl?(this.cancelSearchRequests(),this.$emit("submit",e.resourceUrl)):e.isMore&&this.searchMoreOf(e.providerId).then(()=>{this.selectedResult=null}))},searchMoreOf(e){return this.searchingMoreOf=e,this.cancelSearchRequests(),this.searchProviders(e)},updateSearch(){if(this.cancelSearchRequests(),this.resetResults(),this.searchQuery===""){this.searching=!1;return}return this.searchProviders()},searchProviders(e=null){this.abortController=new AbortController,this.searching=!0;const s=e===null?[...this.searchProviderIds].map(r=>this.searchOneProvider(r)):[this.searchOneProvider(e,this.resultsBySearchProvider[e]?.cursor??null)];return Promise.allSettled(s).then(r=>{r.find(o=>o.status==="rejected"&&(o.reason.name==="CanceledError"||o.reason.code==="ERR_CANCELED"))||(this.searching=!1,this.searchingMoreOf=null)})},searchOneProvider(e,s=null){const r=s===null?x("search/providers/{providerId}/search?term={term}&limit={limit}",{providerId:e,term:this.searchQuery,limit:O}):x("search/providers/{providerId}/search?term={term}&limit={limit}&cursor={cursor}",{providerId:e,term:this.searchQuery,limit:O,cursor:s});return re.get(r,{signal:this.abortController.signal}).then(o=>{const n=o.data.ocs.data;this.resultsBySearchProvider[e].name=n.name,this.resultsBySearchProvider[e].cursor=n.cursor,this.resultsBySearchProvider[e].isPaginated=n.isPaginated,this.resultsBySearchProvider[e].entries.push(...n.entries)})}}},qe={key:0,class:"custom-option"},Ue={class:"option-text"},$e={key:2,class:"custom-option group-name"},Ve=["src"],ze={class:"option-text"},Ae={key:3,class:"custom-option"},Qe={key:0,class:"option-simple-icon icon-loading-small"},je={class:"option-text"},Ge=["alt","src"];function Fe(e,s,r,o,n,i){const h=p("LinkVariantIcon"),f=p("NcSearchResult"),M=p("DotsHorizontalIcon"),L=p("NcSelect"),w=p("NcEmptyContent");return a(),c("div",{class:T(["smart-picker-search",{"with-empty-content":r.showEmptyContent}])},[y(L,{ref:"search-select",modelValue:n.selectedResult,"onUpdate:modelValue":[s[0]||(s[0]=l=>n.selectedResult=l),i.onSelectResultSelected],class:"smart-picker-search--select","input-id":"search-select-input",label:"name",placeholder:i.mySearchPlaceholder,options:i.options,"append-to-body":!1,"close-on-select":!1,"clear-search-on-select":!1,"clear-search-on-blur":()=>!1,"reset-focus-on-options-change":!1,filterable:!1,autoscroll:!0,"reset-on-options-change":!1,loading:n.searching,onSearch:i.onSearchInput},{option:S(l=>[l.isRawLink?(a(),c("div",qe,[y(h,{class:"option-simple-icon",size:20}),u("span",Ue,m(i.t("Raw link {options}",{options:l.resourceUrl})),1)])):l.resourceUrl?(a(),b(f,{key:1,class:"search-result",entry:l,query:n.searchQuery},null,8,["entry","query"])):l.isCustomGroupTitle?(a(),c("span",$e,[r.provider.icon_url?(a(),c("img",{key:0,class:"provider-icon group-name-icon",src:r.provider.icon_url},null,8,Ve)):d("",!0),u("span",ze,[u("strong",null,m(l.name),1)])])):l.isMore?(a(),c("span",Ae,[l.isLoading?(a(),c("span",Qe)):(a(),b(M,{key:1,class:"option-simple-icon",size:20})),u("span",je,m(i.t('Load more "{options}"',{options:l.name})),1)])):d("",!0)]),"no-options":S(()=>[_(m(n.noOptionsText),1)]),_:1},8,["modelValue","placeholder","options","loading","onSearch","onUpdate:modelValue"]),r.showEmptyContent?(a(),b(w,{key:0,class:"smart-picker-search--empty-content"},{icon:S(()=>[r.provider.icon_url?(a(),c("img",{key:0,class:"provider-icon",alt:n.providerIconAlt,src:r.provider.icon_url},null,8,Ge)):(a(),b(h,{key:1}))]),_:1})):d("",!0)],2)}const Ze=P(Oe,[["render",Fe],["__scopeId","data-v-e8abf1d4"]]);k(Y,X);const v={osm:{id:"osm",label:t("integration_openstreetmap","OpenStreetMap")},osmand:{id:"osmand",label:t("integration_openstreetmap","OsmAnd")},google:{id:"google",label:t("integration_openstreetmap","Google maps")}},He=Object.keys(v).map(e=>v[e]),De={name:"PointCustomPickerElement",components:{VMarker:F,MaplibreMap:G,NcButton:Q,NcSearch:Ze,NcSelect:q,NcCheckboxRadioSwitch:A,ArrowRightIcon:z},props:{providerId:{type:String,required:!0},accessible:{type:Boolean,default:!1}},data(){return{provider:_e(this.providerId),currentCenter:null,currentZoom:null,currentPitch:g()?.pitch??null,currentBearing:g()?.bearing??null,currentMapStyle:g()?.mapStyle??null,currentMapTerrain:!!g()?.terrain,currentMapGlobe:!!g()?.globe,selectedLinkTypeId:g()?.linkType?g().linkType:v.osm.id,showMap:!1,lastMapState:g(),searchPlaceholder:t("integration_openstreetmap","Search with Nominatim to get an OpenStreetMap link"),includeMarker:!0,linkTypesArray:He}},computed:{selectedLinkType(){return v[this.selectedLinkTypeId]??null},lastCenter(){return this.lastMapState?.lat&&this.lastMapState?.lon?{lat:this.lastMapState.lat,lon:this.lastMapState.lon}:null},currentMarker(){return this.includeMarker?this.currentCenter?this.currentCenter:this.lastCenter:void 0},currentLink(){if(this.currentCenter===null)return null;const e=this.currentCenter.lat,s=this.currentCenter.lon,r=this.currentZoom;let o;const n=[],i=[];return this.selectedLinkTypeId===null||this.selectedLinkTypeId===v.osm.id?(o="https://www.openstreetmap.org/",this.includeMarker&&(i.push("mlat="+e),i.push("mlon="+s)),n.push("map="+r+"/"+e+"/"+s)):this.selectedLinkTypeId===v.osmand.id?(o="https://osmand.net/map/",this.includeMarker&&i.push("pin="+e+","+s),n.push(r+"/"+e+"/"+s)):this.selectedLinkTypeId===v.google.id&&(o="https://maps.google.com/maps",this.includeMarker&&i.push("q="+e+","+s),i.push("ll="+e+","+s),i.push("z="+r)),parseInt(this.currentPitch)!==0&&n.push("pitch="+parseInt(this.currentPitch)),parseInt(this.currentBearing)!==0&&n.push("bearing="+parseInt(this.currentBearing)),this.currentMapStyle!=="streets"&&n.push("style="+encodeURIComponent(this.currentMapStyle)),this.currentMapTerrain&&n.push("terrain"),this.currentMapGlobe&&n.push("globe"),i.length>0&&(o+="?"+i.join("&")),n.length>0&&(o+="#"+n.join("&")),o}},watch:{},mounted(){this.$nextTick(()=>{this.showMap=!0})},methods:{onLinkTypeSelect(e){this.selectedLinkTypeId=e?.id??null},onMapSubmit(){const e=this.currentCenter.lat,s=this.currentCenter.lon,r=this.currentZoom,o=this.currentPitch,n=this.currentBearing?parseFloat(this.currentBearing.toFixed(2)):this.currentBearing,i=this.currentMapStyle,h=this.currentMapTerrain?"1":"",f=this.currentMapGlobe?"1":"",M=this.selectedLinkTypeId;B({lat:e,lon:s,zoom:r,pitch:o,bearing:n,mapStyle:i,terrain:h,globe:f,linkType:M}),this.$el.dispatchEvent(new CustomEvent("submit",{detail:this.currentLink,bubbles:!0}))},onSearchSubmit(e){B({mapStyle:this.currentMapStyle});const s=[];s.push("style="+encodeURIComponent(this.currentMapStyle));const r=e+"#"+s.join("&");this.$el.dispatchEvent(new CustomEvent("submit",{detail:r,bubbles:!0}))},onMapStateChange(e){e.centerLat!==void 0&&e.centerLng!==void 0&&(this.currentCenter={lat:parseFloat(e.centerLat.toFixed(6)),lon:parseFloat(e.centerLng.toFixed(6))}),e.zoom!==void 0&&(this.currentZoom=Math.floor(e.zoom)),e.pitch!==void 0&&(this.currentPitch=e.pitch),e.bearing!==void 0&&(this.currentBearing=e.bearing),e.mapStyle!==void 0&&(this.currentMapStyle=e.mapStyle),[!0,!1].includes(e.terrain)&&(this.currentMapTerrain=e.terrain),[!0,!1].includes(e.globe)&&(this.currentMapGlobe=e.globe)}}},Je={class:"point-picker-content"},Ke={class:"footer"};function We(e,s,r,o,n,i){const h=p("NcSearch"),f=p("VMarker"),M=p("MaplibreMap"),L=p("NcSelect"),w=p("NcCheckboxRadioSwitch"),l=p("ArrowRightIcon"),V=p("NcButton");return a(),c("div",Je,[u("h2",null,m(e.t("integration_openstreetmap","Map location (by OpenStreetMap)")),1),y(h,{ref:"url-input",class:"generic-search",provider:n.provider,"show-empty-content":!1,"search-placeholder":n.searchPlaceholder,onSubmit:i.onSearchSubmit},null,8,["provider","search-placeholder","onSubmit"]),n.showMap?(a(),b(M,{key:0,class:"point-map",center:i.lastCenter,zoom:n.lastMapState?.zoom,pitch:n.lastMapState?.pitch,bearing:n.lastMapState?.bearing,"map-style":n.lastMapState?.mapStyle,"use-terrain":!!n.lastMapState?.terrain,"use-globe":!!n.lastMapState?.globe,"all-move-events":!0,onMapStateChange:i.onMapStateChange},{default:S(({map:R})=>[i.currentMarker?(a(),b(f,{key:0,map:R,"lng-lat":i.currentMarker},null,8,["map","lng-lat"])):d("",!0)]),_:1},8,["center","zoom","pitch","bearing","map-style","use-terrain","use-globe","onMapStateChange"])):d("",!0),u("div",Ke,[y(L,{class:"type-select","model-value":i.selectedLinkType,options:n.linkTypesArray,"aria-label-combobox":e.t("integration_openstreetmap","Link type"),placeholder:e.t("integration_openstreetmap","Link type"),"input-id":"extension-select","onUpdate:modelValue":i.onLinkTypeSelect},null,8,["model-value","options","aria-label-combobox","placeholder","onUpdate:modelValue"]),y(w,{modelValue:n.includeMarker,"onUpdate:modelValue":s[0]||(s[0]=R=>n.includeMarker=R),class:"marker-checkbox"},{default:S(()=>[_(m(e.t("integration_openstreetmap","Include marker")),1)]),_:1},8,["modelValue"]),s[1]||(s[1]=u("div",{class:"spacer"},null,-1)),y(V,{class:"submit-button",variant:"primary",disabled:n.currentCenter===null,onClick:i.onMapSubmit},{icon:S(()=>[y(l)]),default:S(()=>[_(m(e.t("integration_openstreetmap","Generate location link"))+" ",1)]),_:1},8,["disabled","onClick"])])])}const mt=se(De,[["render",We],["__scopeId","data-v-a37805b3"]]);export{mt as default};
//# sourceMappingURL=PointCustomPickerElement-O3VDqHQT.chunk.mjs.map
