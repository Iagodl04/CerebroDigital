import{_ as Jh,a as Of,c as jf}from"./index-B-L25m6y.chunk.mjs";import{c as Co,o as Ao,a as tu,b as eu,t as iu,m as ru}from"./runtime-core.esm-bundler-CsAAUxo4.chunk.mjs";import{a as Vf}from"./index-BH5XFfaS.chunk.mjs";var Qh={exports:{}},Nf=Qh.exports,Bd;function Uf(){return Bd||(Bd=1,(function(se,Mi){(function(te,Ii){se.exports=Ii()})(Nf,(function(){var te={},Ii={};function Ei(z,h,It){if(Ii[z]=It,z==="index"){var pe="var sharedModule = {}; ("+Ii.shared+")(sharedModule); ("+Ii.worker+")(sharedModule);",he={};return Ii.shared(he),Ii.index(te,he),typeof window<"u"&&te.setWorkerUrl(window.URL.createObjectURL(new Blob([pe],{type:"text/javascript"}))),te}}Ei("shared",["exports"],(function(z){function h(o,i,r,s){return new(r||(r=Promise))((function(l,p){function f(v){try{g(s.next(v))}catch(b){p(b)}}function _(v){try{g(s.throw(v))}catch(b){p(b)}}function g(v){var b;v.done?l(v.value):(b=v.value,b instanceof r?b:new r((function(S){S(b)}))).then(f,_)}g((s=s.apply(o,i||[])).next())}))}function It(o,i){this.x=o,this.y=i}function pe(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var he,ki;typeof SuppressedError=="function"&&SuppressedError,It.prototype={clone(){return new It(this.x,this.y)},add(o){return this.clone()._add(o)},sub(o){return this.clone()._sub(o)},multByPoint(o){return this.clone()._multByPoint(o)},divByPoint(o){return this.clone()._divByPoint(o)},mult(o){return this.clone()._mult(o)},div(o){return this.clone()._div(o)},rotate(o){return this.clone()._rotate(o)},rotateAround(o,i){return this.clone()._rotateAround(o,i)},matMult(o){return this.clone()._matMult(o)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(o){return this.x===o.x&&this.y===o.y},dist(o){return Math.sqrt(this.distSqr(o))},distSqr(o){const i=o.x-this.x,r=o.y-this.y;return i*i+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith(o){return this.angleWithSep(o.x,o.y)},angleWithSep(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult(o){const i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add(o){return this.x+=o.x,this.y+=o.y,this},_sub(o){return this.x-=o.x,this.y-=o.y,this},_mult(o){return this.x*=o,this.y*=o,this},_div(o){return this.x/=o,this.y/=o,this},_multByPoint(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint(o){return this.x/=o.x,this.y/=o.y,this},_unit(){return this._div(this.mag()),this},_perp(){const o=this.y;return this.y=this.x,this.x=-o,this},_rotate(o){const i=Math.cos(o),r=Math.sin(o),s=r*this.x+i*this.y;return this.x=i*this.x-r*this.y,this.y=s,this},_rotateAround(o,i){const r=Math.cos(o),s=Math.sin(o),l=i.y+s*(this.x-i.x)+r*(this.y-i.y);return this.x=i.x+r*(this.x-i.x)-s*(this.y-i.y),this.y=l,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:It},It.convert=function(o){if(o instanceof It)return o;if(Array.isArray(o))return new It(+o[0],+o[1]);if(o.x!==void 0&&o.y!==void 0)return new It(+o.x,+o.y);throw new Error("Expected [x, y] or {x, y} point format")};var We=(function(){if(ki)return he;function o(i,r,s,l){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(l-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=r,this.p2x=s,this.p2y=l}return ki=1,he=o,o.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,r){if(r===void 0&&(r=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,l=0;l<8;l++){var p=this.sampleCurveX(s)-i;if(Math.abs(p)<r)return s;var f=this.sampleCurveDerivativeX(s);if(Math.abs(f)<1e-6)break;s-=p/f}var _=0,g=1;for(s=i,l=0;l<20&&(p=this.sampleCurveX(s),!(Math.abs(p-i)<r));l++)i>p?_=s:g=s,s=.5*(g-_)+_;return s},solve:function(i,r){return this.sampleCurveY(this.solveCurveX(i,r))}},he})(),mr=pe(We);let Zt,ht;function zo(){return Zt==null&&(Zt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Zt}function Dr(){if(ht==null&&(ht=!1,zo())){const o=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(o){for(let r=0;r<25;r++){const s=4*r;o.fillStyle=`rgb(${s},${s+1},${s+2})`,o.fillRect(r%5,Math.floor(r/5),1,1)}const i=o.getImageData(0,0,5,5).data;for(let r=0;r<100;r++)if(r%4!=3&&i[r]!==r){ht=!0;break}}}return ht||!1}var be=1e-6,Re=typeof Float32Array<"u"?Float32Array:Array;function ga(){var o=new Re(9);return Re!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function Ro(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function gi(){var o=new Re(3);return Re!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function ya(o){var i=o[0],r=o[1],s=o[2];return Math.sqrt(i*i+r*r+s*s)}function Qr(o,i,r){var s=new Re(3);return s[0]=o,s[1]=i,s[2]=r,s}function Eo(o,i,r){return o[0]=i[0]+r[0],o[1]=i[1]+r[1],o[2]=i[2]+r[2],o}function Jr(o,i,r){return o[0]=i[0]*r,o[1]=i[1]*r,o[2]=i[2]*r,o}function to(o,i,r){var s=i[0],l=i[1],p=i[2],f=r[0],_=r[1],g=r[2];return o[0]=l*g-p*_,o[1]=p*f-s*g,o[2]=s*_-l*f,o}var Di,Ja=ya;function ko(o,i,r){var s=i[0],l=i[1],p=i[2],f=i[3];return o[0]=r[0]*s+r[4]*l+r[8]*p+r[12]*f,o[1]=r[1]*s+r[5]*l+r[9]*p+r[13]*f,o[2]=r[2]*s+r[6]*l+r[10]*p+r[14]*f,o[3]=r[3]*s+r[7]*l+r[11]*p+r[15]*f,o}function or(){var o=new Re(4);return Re!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function eo(o,i,r,s){var l=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"zyx",p=Math.PI/360;i*=p,s*=p,r*=p;var f=Math.sin(i),_=Math.cos(i),g=Math.sin(r),v=Math.cos(r),b=Math.sin(s),S=Math.cos(s);switch(l){case"xyz":o[0]=f*v*S+_*g*b,o[1]=_*g*S-f*v*b,o[2]=_*v*b+f*g*S,o[3]=_*v*S-f*g*b;break;case"xzy":o[0]=f*v*S-_*g*b,o[1]=_*g*S-f*v*b,o[2]=_*v*b+f*g*S,o[3]=_*v*S+f*g*b;break;case"yxz":o[0]=f*v*S+_*g*b,o[1]=_*g*S-f*v*b,o[2]=_*v*b-f*g*S,o[3]=_*v*S+f*g*b;break;case"yzx":o[0]=f*v*S+_*g*b,o[1]=_*g*S+f*v*b,o[2]=_*v*b-f*g*S,o[3]=_*v*S-f*g*b;break;case"zxy":o[0]=f*v*S-_*g*b,o[1]=_*g*S+f*v*b,o[2]=_*v*b+f*g*S,o[3]=_*v*S-f*g*b;break;case"zyx":o[0]=f*v*S-_*g*b,o[1]=_*g*S+f*v*b,o[2]=_*v*b-f*g*S,o[3]=_*v*S+f*g*b;break;default:throw new Error("Unknown angle order "+l)}return o}function _r(){var o=new Re(2);return Re!=Float32Array&&(o[0]=0,o[1]=0),o}function ts(o,i){var r=new Re(2);return r[0]=o,r[1]=i,r}gi(),Di=new Re(4),Re!=Float32Array&&(Di[0]=0,Di[1]=0,Di[2]=0,Di[3]=0),gi(),Qr(1,0,0),Qr(0,1,0),or(),or(),ga(),_r();const ne=8192;function xa(o,i,r){return i*(ne/(o.tileSize*Math.pow(2,r-o.tileID.overscaledZ)))}function Wi(o,i){return(o%i+i)%i}function gr(o,i,r){return o*(1-r)+i*r}function Hi(o){if(o<=0)return 0;if(o>=1)return 1;const i=o*o,r=i*o;return 4*(o<.5?r:3*(o-i)+r-.75)}function va(o,i,r,s){const l=new mr(o,i,r,s);return p=>l.solve(p)}const yr=va(.25,.1,.25,1);function ui(o,i,r){return Math.min(r,Math.max(i,o))}function io(o,i,r){const s=r-i,l=((o-i)%s+s)%s+i;return l===i?r:l}function Li(o,...i){for(const r of i)for(const s in r)o[s]=r[s];return o}let Ni=1;function ba(o,i,r){const s={};for(const l in o)s[l]=i.call(this,o[l],l,o);return s}function wa(o,i,r){const s={};for(const l in o)i.call(this,o[l],l,o)&&(s[l]=o[l]);return s}function Fi(o){return Array.isArray(o)?o.map(Fi):typeof o=="object"&&o?ba(o,Fi):o}const ro={};function Ee(o){ro[o]||(typeof console<"u"&&console.warn(o),ro[o]=!0)}function fe(o,i,r){return(r.y-o.y)*(i.x-o.x)>(i.y-o.y)*(r.x-o.x)}function xr(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let oo=null;function Lr(o){if(oo==null){const i=o.navigator?o.navigator.userAgent:null;oo=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return oo}function vr(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const Do="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function br(o,i,r,s,l){return h(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const p=new VideoFrame(o,{timestamp:0});try{const f=p?.format;if(!f||!f.startsWith("BGR")&&!f.startsWith("RGB"))throw new Error(`Unrecognized format ${f}`);const _=f.startsWith("BGR"),g=new Uint8ClampedArray(s*l*4);if(yield p.copyTo(g,(function(v,b,S,I,C){const R=4*Math.max(-b,0),L=(Math.max(0,S)-S)*I*4+R,B=4*I,N=Math.max(0,b),it=Math.max(0,S);return{rect:{x:N,y:it,width:Math.min(v.width,b+I)-N,height:Math.min(v.height,S+C)-it},layout:[{offset:L,stride:B}]}})(o,i,r,s,l)),_)for(let v=0;v<g.length;v+=4){const b=g[v];g[v]=g[v+2],g[v+2]=b}return g}finally{p.close()}}))}let Fr,ar;function Lo(o,i,r,s){return o.addEventListener(i,r,s),{unsubscribe:()=>{o.removeEventListener(i,r,s)}}}function Fo(o){return o*Math.PI/180}function Ui(o){return o/Math.PI*180}const es={touchstart:!0,touchmove:!0,touchmoveWindow:!0,touchend:!0,touchcancel:!0},Bo={dblclick:!0,click:!0,mouseover:!0,mouseout:!0,mousedown:!0,mousemove:!0,mousemoveWindow:!0,mouseup:!0,mouseupWindow:!0,contextmenu:!0,wheel:!0},wr="AbortError";function Q(){return new Error(wr)}const E={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function k(o){return E.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const F="global-dispatcher";class q extends Error{constructor(i,r,s,l){super(`AJAXError: ${r} (${i}): ${s}`),this.status=i,this.statusText=r,this.url=s,this.body=l}}const X=()=>xr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,et=function(o,i){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const s=k(o.url);if(s)return s(o,i);if(xr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,targetMapId:F},i)}if(!(/^file:/.test(r=o.url)||/^file:/.test(X())&&!/^\w+:/.test(r))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(s,l){return h(this,void 0,void 0,(function*(){const p=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,cache:s.cache,referrer:X(),signal:l.signal});let f,_;s.type!=="json"||p.headers.has("Accept")||p.headers.set("Accept","application/json");try{f=yield fetch(p)}catch(v){throw new q(0,v.message,s.url,new Blob)}if(!f.ok){const v=yield f.blob();throw new q(f.status,f.statusText,s.url,v)}_=s.type==="arrayBuffer"||s.type==="image"?f.arrayBuffer():s.type==="json"?f.json():f.text();const g=yield _;if(l.signal.aborted)throw Q();return{data:g,cacheControl:f.headers.get("Cache-Control"),expires:f.headers.get("Expires")}}))})(o,i);if(xr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:o,mustQueue:!0,targetMapId:F},i)}var r;return(function(s,l){return new Promise(((p,f)=>{var _;const g=new XMLHttpRequest;g.open(s.method||"GET",s.url,!0),s.type!=="arrayBuffer"&&s.type!=="image"||(g.responseType="arraybuffer");for(const v in s.headers)g.setRequestHeader(v,s.headers[v]);s.type==="json"&&(g.responseType="text",!((_=s.headers)===null||_===void 0)&&_.Accept||g.setRequestHeader("Accept","application/json")),g.withCredentials=s.credentials==="include",g.onerror=()=>{f(new Error(g.statusText))},g.onload=()=>{if(!l.signal.aborted)if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let v=g.response;if(s.type==="json")try{v=JSON.parse(g.response)}catch(b){return void f(b)}p({data:v,cacheControl:g.getResponseHeader("Cache-Control"),expires:g.getResponseHeader("Expires")})}else{const v=new Blob([g.response],{type:g.getResponseHeader("Content-Type")});f(new q(g.status,g.statusText,s.url,v))}},l.signal.addEventListener("abort",(()=>{g.abort(),f(Q())})),g.send(s.body)}))})(o,i)};function nt(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const i=new URL(o),r=window.location;return i.protocol===r.protocol&&i.host===r.host}function tt(o,i,r){r[o]&&r[o].indexOf(i)!==-1||(r[o]=r[o]||[],r[o].push(i))}function ut(o,i,r){if(r&&r[o]){const s=r[o].indexOf(i);s!==-1&&r[o].splice(s,1)}}class yt{constructor(i,r={}){Li(this,r),this.type=i}}class pt extends yt{constructor(i,r={}){super("error",Li({error:i},r))}}class Et{on(i,r){return this._listeners=this._listeners||{},tt(i,r,this._listeners),{unsubscribe:()=>{this.off(i,r)}}}off(i,r){return ut(i,r,this._listeners),ut(i,r,this._oneTimeListeners),this}once(i,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},tt(i,r,this._oneTimeListeners),this):new Promise((s=>this.once(i,s)))}fire(i,r){typeof i=="string"&&(i=new yt(i,r||{}));const s=i.type;if(this.listens(s)){i.target=this;const l=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const _ of l)_.call(this,i);const p=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const _ of p)ut(s,_,this._oneTimeListeners),_.call(this,i);const f=this._eventedParent;f&&(Li(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),f.fire(i))}else i instanceof pt&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,r){return this._eventedParent=i,this._eventedParentData=r,this}}var rt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},state:{type:"state",default:{}},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},"font-faces":{type:"array",value:"fontFaces"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},encoding:{type:"enum",values:{mvt:{},mlt:{}},default:"mvt"},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},"color-relief":{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_color-relief","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_color-relief":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_color-relief","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"numberArray",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-altitude":{type:"numberArray",default:45,minimum:0,maximum:90,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"colorArray",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"colorArray",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-method":{type:"enum",values:{standard:{},basic:{},combined:{},igor:{},multidirectional:{}},default:"standard",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},"paint_color-relief":{"color-relief-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"color-relief-color":{type:"color",transition:!1,expression:{interpolated:!0,parameters:["elevation"]},"property-type":"color-ramp"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Xt=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function ye(o,i){const r={};for(const s in o)s!=="ref"&&(r[s]=o[s]);return Xt.forEach((s=>{s in i&&(r[s]=i[s])})),r}function Dt(o,i){if(Array.isArray(o)){if(!Array.isArray(i)||o.length!==i.length)return!1;for(let r=0;r<o.length;r++)if(!Dt(o[r],i[r]))return!1;return!0}if(typeof o=="object"&&o!==null&&i!==null){if(typeof i!="object"||Object.keys(o).length!==Object.keys(i).length)return!1;for(const r in o)if(!Dt(o[r],i[r]))return!1;return!0}return o===i}function Ht(o,i){o.push(i)}function oe(o,i,r){Ht(r,{command:"addSource",args:[o,i[o]]})}function je(o,i,r){Ht(i,{command:"removeSource",args:[o]}),r[o]=!0}function Ve(o,i,r,s){je(o,r,s),oe(o,i,r)}function ri(o,i,r){let s;for(s in o[r])if(Object.prototype.hasOwnProperty.call(o[r],s)&&s!=="data"&&!Dt(o[r][s],i[r][s]))return!1;for(s in i[r])if(Object.prototype.hasOwnProperty.call(i[r],s)&&s!=="data"&&!Dt(o[r][s],i[r][s]))return!1;return!0}function Ae(o,i,r,s,l,p){o=o||{},i=i||{};for(const f in o)Object.prototype.hasOwnProperty.call(o,f)&&(Dt(o[f],i[f])||r.push({command:p,args:[s,f,i[f],l]}));for(const f in i)Object.prototype.hasOwnProperty.call(i,f)&&!Object.prototype.hasOwnProperty.call(o,f)&&(Dt(o[f],i[f])||r.push({command:p,args:[s,f,i[f],l]}))}function xe(o){return o.id}function ke(o,i){return o[i.id]=i,o}class _t{constructor(i,r,s,l){this.message=(i?`${i}: `:"")+s,l&&(this.identifier=l),r!=null&&r.__line__&&(this.line=r.__line__)}}function Me(o,...i){for(const r of i)for(const s in r)o[s]=r[s];return o}class yi extends Error{constructor(i,r){super(r),this.message=r,this.key=i}}class ao{constructor(i,r=[]){this.parent=i,this.bindings={};for(const[s,l]of r)this.bindings[s]=l}concat(i){return new ao(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const xi={kind:"null"},wt={kind:"number"},$t={kind:"string"},qt={kind:"boolean"},$i={kind:"color"},Ta={kind:"projectionDefinition"},Tr={kind:"object"},Nt={kind:"value"},so={kind:"collator"},Oo={kind:"formatted"},jo={kind:"padding"},Sa={kind:"colorArray"},no={kind:"numberArray"},Pa={kind:"resolvedImage"},Sr={kind:"variableAnchorOffsetCollection"};function vi(o,i){return{kind:"array",itemType:o,N:i}}function Kt(o){if(o.kind==="array"){const i=Kt(o.itemType);return typeof o.N=="number"?`array<${i}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${i}>`}return o.kind}const $c=[xi,wt,$t,qt,$i,Ta,Oo,Tr,vi(Nt),jo,no,Sa,Pa,Sr];function Vo(o,i){if(i.kind==="error")return null;if(o.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!Vo(o.itemType,i.itemType))&&(typeof o.N!="number"||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if(o.kind==="value"){for(const r of $c)if(!Vo(r,i))return null}}return`Expected ${Kt(o)} but found ${Kt(i)} instead.`}function lo(o,i){return i.some((r=>r.kind===o.kind))}function Br(o,i){return i.some((r=>r==="null"?o===null:r==="array"?Array.isArray(o):r==="object"?o&&!Array.isArray(o)&&typeof o=="object":r===typeof o))}function Or(o,i){return o.kind==="array"&&i.kind==="array"?o.itemType.kind===i.itemType.kind&&typeof o.N=="number":o.kind===i.kind}const _l=.96422,cn=.82521,gl=4/29,co=6/29,yl=3*co*co,Zc=co*co*co,Gc=Math.PI/180,qc=180/Math.PI;function xl(o){return(o%=360)<0&&(o+=360),o}function vl([o,i,r,s]){let l,p;const f=is((.2225045*(o=hn(o))+.7168786*(i=hn(i))+.0606169*(r=hn(r)))/1);o===i&&i===r?l=p=f:(l=is((.4360747*o+.3850649*i+.1430804*r)/_l),p=is((.0139322*o+.0971045*i+.7141733*r)/cn));const _=116*f-16;return[_<0?0:_,500*(l-f),200*(f-p),s]}function hn(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function is(o){return o>Zc?Math.pow(o,1/3):o/yl+gl}function No([o,i,r,s]){let l=(o+16)/116,p=isNaN(i)?l:l+i/500,f=isNaN(r)?l:l-r/200;return l=1*dn(l),p=_l*dn(p),f=cn*dn(f),[un(3.1338561*p-1.6168667*l-.4906146*f),un(-.9787684*p+1.9161415*l+.033454*f),un(.0719453*p-.2289914*l+1.4052427*f),s]}function un(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function dn(o){return o>co?o*o*o:yl*(o-gl)}const Ma=Object.hasOwn||function(o,i){return Object.prototype.hasOwnProperty.call(o,i)};function Ia(o,i){return Ma(o,i)?o[i]:void 0}function rs(o){return parseInt(o.padEnd(2,o),16)/255}function bl(o,i){return ho(i?o/100:o,0,1)}function ho(o,i,r){return Math.min(Math.max(i,o),r)}function pn(o){return!o.some(Number.isNaN)}const sr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function Gt(o,i,r){return o+r*(i-o)}function Xi(o,i,r){return o.map(((s,l)=>Gt(s,i[l],r)))}class Ut{constructor(i,r,s,l=1,p=!0){this.r=i,this.g=r,this.b=s,this.a=l,p||(this.r*=l,this.g*=l,this.b*=l,l||this.overwriteGetter("rgb",[i,r,s,l]))}static parse(i){if(i instanceof Ut)return i;if(typeof i!="string")return;const r=(function(s){if((s=s.toLowerCase().trim())==="transparent")return[0,0,0,0];const l=Ia(sr,s);if(l){const[f,_,g]=l;return[f/255,_/255,g/255,1]}if(s.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(s)){const f=s.length<6?1:2;let _=1;return[rs(s.slice(_,_+=f)),rs(s.slice(_,_+=f)),rs(s.slice(_,_+=f)),rs(s.slice(_,_+f)||"ff")]}if(s.startsWith("rgb")){const f=s.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(f){const[_,g,v,b,S,I,C,R,L,B,N,it]=f,G=[b||" ",C||" ",B].join("");if(G==="  "||G==="  /"||G===",,"||G===",,,"){const K=[v,I,L].join(""),at=K==="%%%"?100:K===""?255:0;if(at){const dt=[ho(+g/at,0,1),ho(+S/at,0,1),ho(+R/at,0,1),N?bl(+N,it):1];if(pn(dt))return dt}}return}}const p=s.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(p){const[f,_,g,v,b,S,I,C,R]=p,L=[g||" ",b||" ",I].join("");if(L==="  "||L==="  /"||L===",,"||L===",,,"){const B=[+_,ho(+v,0,100),ho(+S,0,100),C?bl(+C,R):1];if(pn(B))return(function([N,it,G,K]){function at(dt){const gt=(dt+N/30)%12,Mt=it*Math.min(G,1-G);return G-Mt*Math.max(-1,Math.min(gt-3,9-gt,1))}return N=xl(N),it/=100,G/=100,[at(0),at(8),at(4),K]})(B)}}})(i);return r?new Ut(...r,!1):void 0}get rgb(){const{r:i,g:r,b:s,a:l}=this,p=l||1/0;return this.overwriteGetter("rgb",[i/p,r/p,s/p,l])}get hcl(){return this.overwriteGetter("hcl",(function(i){const[r,s,l,p]=vl(i),f=Math.sqrt(s*s+l*l);return[Math.round(1e4*f)?xl(Math.atan2(l,s)*qc):NaN,f,r,p]})(this.rgb))}get lab(){return this.overwriteGetter("lab",vl(this.rgb))}overwriteGetter(i,r){return Object.defineProperty(this,i,{value:r}),r}toString(){const[i,r,s,l]=this.rgb;return`rgba(${[i,r,s].map((p=>Math.round(255*p))).join(",")},${l})`}static interpolate(i,r,s,l="rgb"){switch(l){case"rgb":{const[p,f,_,g]=Xi(i.rgb,r.rgb,s);return new Ut(p,f,_,g,!1)}case"hcl":{const[p,f,_,g]=i.hcl,[v,b,S,I]=r.hcl;let C,R;if(isNaN(p)||isNaN(v))isNaN(p)?isNaN(v)?C=NaN:(C=v,_!==1&&_!==0||(R=b)):(C=p,S!==1&&S!==0||(R=f));else{let G=v-p;v>p&&G>180?G-=360:v<p&&p-v>180&&(G+=360),C=p+s*G}const[L,B,N,it]=(function([G,K,at,dt]){return G=isNaN(G)?0:G*Gc,No([at,Math.cos(G)*K,Math.sin(G)*K,dt])})([C,R??Gt(f,b,s),Gt(_,S,s),Gt(g,I,s)]);return new Ut(L,B,N,it,!1)}case"lab":{const[p,f,_,g]=No(Xi(i.lab,r.lab,s));return new Ut(p,f,_,g,!1)}}}}Ut.black=new Ut(0,0,0,1),Ut.white=new Ut(1,1,1,1),Ut.transparent=new Ut(0,0,0,0),Ut.red=new Ut(1,0,0,1);class os{constructor(i,r,s){this.sensitivity=i?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,r){return this.collator.compare(i,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const wl=["bottom","center","top"];class Ca{constructor(i,r,s,l,p,f){this.text=i,this.image=r,this.scale=s,this.fontStack=l,this.textColor=p,this.verticalAlign=f}}class oi{constructor(i){this.sections=i}static fromString(i){return new oi([new Ca(i,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((i=>i.text.length!==0||i.image&&i.image.name.length!==0))}static factory(i){return i instanceof oi?i:oi.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map((i=>i.text)).join("")}}class He{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof He)return i;if(typeof i=="number")return new He([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const r of i)if(typeof r!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new He(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,r,s){return new He(Xi(i.values,r.values,s))}}class di{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof di)return i;if(typeof i=="number")return new di([i]);if(Array.isArray(i)){for(const r of i)if(typeof r!="number")return;return new di(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,r,s){return new di(Xi(i.values,r.values,s))}}class Ne{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Ne)return i;if(typeof i=="string"){const s=Ut.parse(i);return s?new Ne([s]):void 0}if(!Array.isArray(i))return;const r=[];for(const s of i){if(typeof s!="string")return;const l=Ut.parse(s);if(!l)return;r.push(l)}return new Ne(r)}toString(){return JSON.stringify(this.values)}static interpolate(i,r,s,l="rgb"){const p=[];if(i.values.length!=r.values.length)throw new Error(`colorArray: Arrays have mismatched length (${i.values.length} vs. ${r.values.length}), cannot interpolate.`);for(let f=0;f<i.values.length;f++)p.push(Ut.interpolate(i.values[f],r.values[f],s,l));return new Ne(p)}}class me extends Error{constructor(i){super(i),this.name="RuntimeError"}toJSON(){return this.message}}const Wc=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class ai{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof ai)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let r=0;r<i.length;r+=2){const s=i[r],l=i[r+1];if(typeof s!="string"||!Wc.has(s)||!Array.isArray(l)||l.length!==2||typeof l[0]!="number"||typeof l[1]!="number")return}return new ai(i)}}toString(){return JSON.stringify(this.values)}static interpolate(i,r,s){const l=i.values,p=r.values;if(l.length!==p.length)throw new me(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${r.toString()}`);const f=[];for(let _=0;_<l.length;_+=2){if(l[_]!==p[_])throw new me(`Cannot interpolate values containing mismatched anchors. from[${_}]: ${l[_]}, to[${_}]: ${p[_]}`);f.push(l[_]);const[g,v]=l[_+1],[b,S]=p[_+1];f.push([Gt(g,b,s),Gt(v,S,s)])}return new ai(f)}}class si{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new si({name:i,available:!1}):null}}class Ci{constructor(i,r,s){this.from=i,this.to=r,this.transition=s}static interpolate(i,r,s){return new Ci(i,r,s)}static parse(i){return i instanceof Ci?i:Array.isArray(i)&&i.length===3&&typeof i[0]=="string"&&typeof i[1]=="string"&&typeof i[2]=="number"?new Ci(i[0],i[1],i[2]):typeof i=="object"&&typeof i.from=="string"&&typeof i.to=="string"&&typeof i.transition=="number"?new Ci(i.from,i.to,i.transition):typeof i=="string"?new Ci(i,i,1):void 0}}function fn(o,i,r,s){return typeof o=="number"&&o>=0&&o<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof r=="number"&&r>=0&&r<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[o,i,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[o,i,r,s]:[o,i,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Uo(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Ci||o instanceof Ut||o instanceof os||o instanceof oi||o instanceof He||o instanceof di||o instanceof Ne||o instanceof ai||o instanceof si)return!0;if(Array.isArray(o)){for(const i of o)if(!Uo(i))return!1;return!0}if(typeof o=="object"){for(const i in o)if(!Uo(o[i]))return!1;return!0}return!1}function we(o){if(o===null)return xi;if(typeof o=="string")return $t;if(typeof o=="boolean")return qt;if(typeof o=="number")return wt;if(o instanceof Ut)return $i;if(o instanceof Ci)return Ta;if(o instanceof os)return so;if(o instanceof oi)return Oo;if(o instanceof He)return jo;if(o instanceof di)return no;if(o instanceof Ne)return Sa;if(o instanceof ai)return Sr;if(o instanceof si)return Pa;if(Array.isArray(o)){const i=o.length;let r;for(const s of o){const l=we(s);if(r){if(r===l)continue;r=Nt;break}r=l}return vi(r||Nt,i)}return Tr}function le(o){const i=typeof o;return o===null?"":i==="string"||i==="number"||i==="boolean"?String(o):o instanceof Ut||o instanceof Ci||o instanceof oi||o instanceof He||o instanceof di||o instanceof Ne||o instanceof ai||o instanceof si?o.toString():JSON.stringify(o)}class Pr{constructor(i,r){this.type=i,this.value=r}static parse(i,r){if(i.length!==2)return r.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Uo(i[1]))return r.error("invalid value");const s=i[1];let l=we(s);const p=r.expectedType;return l.kind!=="array"||l.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(l=p),new Pr(l,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const ie={string:$t,number:wt,boolean:qt,object:Tr};class Ot{constructor(i,r){this.type=i,this.args=r}static parse(i,r){if(i.length<2)return r.error("Expected at least one argument.");let s,l=1;const p=i[0];if(p==="array"){let _,g;if(i.length>2){const v=i[1];if(typeof v!="string"||!(v in ie)||v==="object")return r.error('The item type argument of "array" must be one of string, number, boolean',1);_=ie[v],l++}else _=Nt;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return r.error('The length argument to "array" must be a positive integer literal',2);g=i[2],l++}s=vi(_,g)}else{if(!ie[p])throw new Error(`Types doesn't contain name = ${p}`);s=ie[p]}const f=[];for(;l<i.length;l++){const _=r.parse(i[l],l,Nt);if(!_)return null;f.push(_)}return new Ot(s,f)}evaluate(i){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(i);if(!Vo(this.type,we(s)))return s;if(r===this.args.length-1)throw new me(`Expected value to be of type ${Kt(this.type)}, but found ${Kt(we(s))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every((i=>i.outputDefined()))}}const as={"to-boolean":qt,"to-color":$i,"to-number":wt,"to-string":$t};class Yt{constructor(i,r){this.type=i,this.args=r}static parse(i,r){if(i.length<2)return r.error("Expected at least one argument.");const s=i[0];if(!as[s])throw new Error(`Can't parse ${s} as it is not part of the known types`);if((s==="to-boolean"||s==="to-string")&&i.length!==2)return r.error("Expected one argument.");const l=as[s],p=[];for(let f=1;f<i.length;f++){const _=r.parse(i[f],f,Nt);if(!_)return null;p.push(_)}return new Yt(l,p)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let r,s;for(const l of this.args){if(r=l.evaluate(i),s=null,r instanceof Ut)return r;if(typeof r=="string"){const p=i.parseColor(r);if(p)return p}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rgba value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:fn(r[0],r[1],r[2],r[3]),!s))return new Ut(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new me(s||`Could not parse color from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"padding":{let r;for(const s of this.args){r=s.evaluate(i);const l=He.parse(r);if(l)return l}throw new me(`Could not parse padding from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"numberArray":{let r;for(const s of this.args){r=s.evaluate(i);const l=di.parse(r);if(l)return l}throw new me(`Could not parse numberArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"colorArray":{let r;for(const s of this.args){r=s.evaluate(i);const l=Ne.parse(r);if(l)return l}throw new me(`Could not parse colorArray from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"variableAnchorOffsetCollection":{let r;for(const s of this.args){r=s.evaluate(i);const l=ai.parse(r);if(l)return l}throw new me(`Could not parse variableAnchorOffsetCollection from value '${typeof r=="string"?r:JSON.stringify(r)}'`)}case"number":{let r=null;for(const s of this.args){if(r=s.evaluate(i),r===null)return 0;const l=Number(r);if(!isNaN(l))return l}throw new me(`Could not convert ${JSON.stringify(r)} to number.`)}case"formatted":return oi.fromString(le(this.args[0].evaluate(i)));case"resolvedImage":return si.fromString(le(this.args[0].evaluate(i)));case"projectionDefinition":return this.args[0].evaluate(i);default:return le(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every((i=>i.outputDefined()))}}const mn=["Unknown","Point","LineString","Polygon"];class nr{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache=new Map,this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?mn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let r=this._parseColorCache.get(i);return r||(r=Ut.parse(i),this._parseColorCache.set(i,r)),r}}class $o{constructor(i,r,s=[],l,p=new ao,f=[]){this.registry=i,this.path=s,this.key=s.map((_=>`[${_}]`)).join(""),this.scope=p,this.errors=f,this.expectedType=l,this._isConstant=r}parse(i,r,s,l,p={}){return r?this.concat(r,s,l)._parse(i,p):this._parse(i,p)}_parse(i,r){function s(l,p,f){return f==="assert"?new Ot(p,[l]):f==="coerce"?new Yt(p,[l]):l}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const l=i[0];if(typeof l!="string")return this.error(`Expression name must be a string, but found ${typeof l} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const p=this.registry[l];if(p){let f=p.parse(i,this);if(!f)return null;if(this.expectedType){const _=this.expectedType,g=f.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||g.kind!=="value"){if(_.kind==="projectionDefinition"&&["string","array"].includes(g.kind)||["color","formatted","resolvedImage"].includes(_.kind)&&["value","string"].includes(g.kind)||["padding","numberArray"].includes(_.kind)&&["value","number","array"].includes(g.kind)||_.kind==="colorArray"&&["value","string","array"].includes(g.kind)||_.kind==="variableAnchorOffsetCollection"&&["value","array"].includes(g.kind))f=s(f,_,r.typeAnnotation||"coerce");else if(this.checkSubtype(_,g))return null}else f=s(f,_,r.typeAnnotation||"assert")}if(!(f instanceof Pr)&&f.type.kind!=="resolvedImage"&&this._isConstant(f)){const _=new nr;try{f=new Pr(f.type,f.evaluate(_))}catch(g){return this.error(g.message),null}}return f}return this.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,r,s){const l=typeof i=="number"?this.path.concat(i):this.path,p=s?this.scope.concat(s):this.scope;return new $o(this.registry,this._isConstant,l,r||null,p,this.errors)}error(i,...r){const s=`${this.key}${r.map((l=>`[${l}]`)).join("")}`;this.errors.push(new yi(s,i))}checkSubtype(i,r){const s=Vo(i,r);return s&&this.error(s),s}}class uo{constructor(i,r){this.type=r.type,this.bindings=[].concat(i),this.result=r}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const r of this.bindings)i(r[1]);i(this.result)}static parse(i,r){if(i.length<4)return r.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const s=[];for(let p=1;p<i.length-1;p+=2){const f=i[p];if(typeof f!="string")return r.error(`Expected string, but found ${typeof f} instead.`,p);if(/[^a-zA-Z0-9_]/.test(f))return r.error("Variable names must contain only alphanumeric characters or '_'.",p);const _=r.parse(i[p+1],p+1);if(!_)return null;s.push([f,_])}const l=r.parse(i[i.length-1],i.length-1,r.expectedType,s);return l?new uo(s,l):null}outputDefined(){return this.result.outputDefined()}}class Aa{constructor(i,r){this.type=r.type,this.name=i,this.boundExpression=r}static parse(i,r){if(i.length!==2||typeof i[1]!="string")return r.error("'var' expression requires exactly one string literal argument.");const s=i[1];return r.scope.has(s)?new Aa(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class za{constructor(i,r,s){this.type=i,this.index=r,this.input=s}static parse(i,r){if(i.length!==3)return r.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const s=r.parse(i[1],1,wt),l=r.parse(i[2],2,vi(r.expectedType||Nt));return s&&l?new za(l.type.itemType,s,l):null}evaluate(i){const r=this.index.evaluate(i),s=this.input.evaluate(i);if(r<0)throw new me(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new me(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new me(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class ss{constructor(i,r){this.type=qt,this.needle=i,this.haystack=r}static parse(i,r){if(i.length!==3)return r.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const s=r.parse(i[1],1,Nt),l=r.parse(i[2],2,Nt);return s&&l?lo(s.type,[qt,$t,wt,xi,Nt])?new ss(s,l):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(s.type)} instead`):null}evaluate(i){const r=this.needle.evaluate(i),s=this.haystack.evaluate(i);if(!s)return!1;if(!Br(r,["boolean","string","number","null"]))throw new me(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(we(r))} instead.`);if(!Br(s,["string","array"]))throw new me(`Expected second argument to be of type array or string, but found ${Kt(we(s))} instead.`);return s.indexOf(r)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class ns{constructor(i,r,s){this.type=wt,this.needle=i,this.haystack=r,this.fromIndex=s}static parse(i,r){if(i.length<=2||i.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${i.length-1} instead.`);const s=r.parse(i[1],1,Nt),l=r.parse(i[2],2,Nt);if(!s||!l)return null;if(!lo(s.type,[qt,$t,wt,xi,Nt]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(s.type)} instead`);if(i.length===4){const p=r.parse(i[3],3,wt);return p?new ns(s,l,p):null}return new ns(s,l)}evaluate(i){const r=this.needle.evaluate(i),s=this.haystack.evaluate(i);if(!Br(r,["boolean","string","number","null"]))throw new me(`Expected first argument to be of type boolean, string, number or null, but found ${Kt(we(r))} instead.`);let l;if(this.fromIndex&&(l=this.fromIndex.evaluate(i)),Br(s,["string"])){const p=s.indexOf(r,l);return p===-1?-1:[...s.slice(0,p)].length}if(Br(s,["array"]))return s.indexOf(r,l);throw new me(`Expected second argument to be of type array or string, but found ${Kt(we(s))} instead.`)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class ls{constructor(i,r,s,l,p,f){this.inputType=i,this.type=r,this.input=s,this.cases=l,this.outputs=p,this.otherwise=f}static parse(i,r){if(i.length<5)return r.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return r.error("Expected an even number of arguments.");let s,l;r.expectedType&&r.expectedType.kind!=="value"&&(l=r.expectedType);const p={},f=[];for(let v=2;v<i.length-1;v+=2){let b=i[v];const S=i[v+1];Array.isArray(b)||(b=[b]);const I=r.concat(v);if(b.length===0)return I.error("Expected at least one branch label.");for(const R of b){if(typeof R!="number"&&typeof R!="string")return I.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return I.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return I.error("Numeric branch labels must be integer values.");if(s){if(I.checkSubtype(s,we(R)))return null}else s=we(R);if(p[String(R)]!==void 0)return I.error("Branch labels must be unique.");p[String(R)]=f.length}const C=r.parse(S,v,l);if(!C)return null;l=l||C.type,f.push(C)}const _=r.parse(i[1],1,Nt);if(!_)return null;const g=r.parse(i[i.length-1],i.length-1,l);return g?_.type.kind!=="value"&&r.concat(1).checkSubtype(s,_.type)?null:new ls(s,l,_,p,f,g):null}evaluate(i){const r=this.input.evaluate(i);return(we(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every((i=>i.outputDefined()))&&this.otherwise.outputDefined()}}class cs{constructor(i,r,s){this.type=i,this.branches=r,this.otherwise=s}static parse(i,r){if(i.length<4)return r.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&r.expectedType.kind!=="value"&&(s=r.expectedType);const l=[];for(let f=1;f<i.length-1;f+=2){const _=r.parse(i[f],f,qt);if(!_)return null;const g=r.parse(i[f+1],f+1,s);if(!g)return null;l.push([_,g]),s=s||g.type}const p=r.parse(i[i.length-1],i.length-1,s);if(!p)return null;if(!s)throw new Error("Can't infer output type");return new cs(s,l,p)}evaluate(i){for(const[r,s]of this.branches)if(r.evaluate(i))return s.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[r,s]of this.branches)i(r),i(s);i(this.otherwise)}outputDefined(){return this.branches.every((([i,r])=>r.outputDefined()))&&this.otherwise.outputDefined()}}class Ki{constructor(i,r,s,l){this.type=i,this.input=r,this.beginIndex=s,this.endIndex=l}static parse(i,r){if(i.length<=2||i.length>=5)return r.error(`Expected 2 or 3 arguments, but found ${i.length-1} instead.`);const s=r.parse(i[1],1,Nt),l=r.parse(i[2],2,wt);if(!s||!l)return null;if(!lo(s.type,[vi(Nt),$t,Nt]))return r.error(`Expected first argument to be of type array or string, but found ${Kt(s.type)} instead`);if(i.length===4){const p=r.parse(i[3],3,wt);return p?new Ki(s.type,s,l,p):null}return new Ki(s.type,s,l)}evaluate(i){const r=this.input.evaluate(i),s=this.beginIndex.evaluate(i);let l;if(this.endIndex&&(l=this.endIndex.evaluate(i)),Br(r,["string"]))return[...r].slice(s,l).join("");if(Br(r,["array"]))return r.slice(s,l);throw new me(`Expected first argument to be of type array or string, but found ${Kt(we(r))} instead.`)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function Ue(o,i){const r=o.length-1;let s,l,p=0,f=r,_=0;for(;p<=f;)if(_=Math.floor((p+f)/2),s=o[_],l=o[_+1],s<=i){if(_===r||i<l)return _;p=_+1}else{if(!(s>i))throw new me("Input is not a number.");f=_-1}return 0}class jr{constructor(i,r,s){this.type=i,this.input=r,this.labels=[],this.outputs=[];for(const[l,p]of s)this.labels.push(l),this.outputs.push(p)}static parse(i,r){if(i.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(i[1],1,wt);if(!s)return null;const l=[];let p=null;r.expectedType&&r.expectedType.kind!=="value"&&(p=r.expectedType);for(let f=1;f<i.length;f+=2){const _=f===1?-1/0:i[f],g=i[f+1],v=f,b=f+1;if(typeof _!="number")return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(l.length&&l[l.length-1][0]>=_)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const S=r.parse(g,b,p);if(!S)return null;p=p||S.type,l.push([_,S])}return new jr(p,s,l)}evaluate(i){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(i);const l=this.input.evaluate(i);if(l<=r[0])return s[0].evaluate(i);const p=r.length;return l>=r[p-1]?s[p-1].evaluate(i):s[Ue(r,l)].evaluate(i)}eachChild(i){i(this.input);for(const r of this.outputs)i(r)}outputDefined(){return this.outputs.every((i=>i.outputDefined()))}}function Tl(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var Zo,$e,Sl=(function(){if($e)return Zo;function o(i,r,s,l){this.cx=3*i,this.bx=3*(s-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(l-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=r,this.p2x=s,this.p2y=l}return $e=1,Zo=o,o.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,r){if(r===void 0&&(r=1e-6),i<0)return 0;if(i>1)return 1;for(var s=i,l=0;l<8;l++){var p=this.sampleCurveX(s)-i;if(Math.abs(p)<r)return s;var f=this.sampleCurveDerivativeX(s);if(Math.abs(f)<1e-6)break;s-=p/f}var _=0,g=1;for(s=i,l=0;l<20&&(p=this.sampleCurveX(s),!(Math.abs(p-i)<r));l++)i>p?_=s:g=s,s=.5*(g-_)+_;return s},solve:function(i,r){return this.sampleCurveY(this.solveCurveX(i,r))}},Zo})(),_n=Tl(Sl);class bi{constructor(i,r,s,l,p){this.type=i,this.operator=r,this.interpolation=s,this.input=l,this.labels=[],this.outputs=[];for(const[f,_]of p)this.labels.push(f),this.outputs.push(_)}static interpolationFactor(i,r,s,l){let p=0;if(i.name==="exponential")p=gn(r,i.base,s,l);else if(i.name==="linear")p=gn(r,1,s,l);else if(i.name==="cubic-bezier"){const f=i.controlPoints;p=new _n(f[0],f[1],f[2],f[3]).solve(gn(r,1,s,l))}return p}static parse(i,r){let[s,l,p,...f]=i;if(!Array.isArray(l)||l.length===0)return r.error("Expected an interpolation type expression.",1);if(l[0]==="linear")l={name:"linear"};else if(l[0]==="exponential"){const v=l[1];if(typeof v!="number")return r.error("Exponential interpolation requires a numeric base.",1,1);l={name:"exponential",base:v}}else{if(l[0]!=="cubic-bezier")return r.error(`Unknown interpolation type ${String(l[0])}`,1,0);{const v=l.slice(1);if(v.length!==4||v.some((b=>typeof b!="number"||b<0||b>1)))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);l={name:"cubic-bezier",controlPoints:v}}}if(i.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(p=r.parse(p,2,wt),!p)return null;const _=[];let g=null;s!=="interpolate-hcl"&&s!=="interpolate-lab"||r.expectedType==Sa?r.expectedType&&r.expectedType.kind!=="value"&&(g=r.expectedType):g=$i;for(let v=0;v<f.length;v+=2){const b=f[v],S=f[v+1],I=v+3,C=v+4;if(typeof b!="number")return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(_.length&&_[_.length-1][0]>=b)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',I);const R=r.parse(S,C,g);if(!R)return null;g=g||R.type,_.push([b,R])}return Or(g,wt)||Or(g,Ta)||Or(g,$i)||Or(g,jo)||Or(g,no)||Or(g,Sa)||Or(g,Sr)||Or(g,vi(wt))?new bi(g,s,l,p,_):r.error(`Type ${Kt(g)} is not interpolatable.`)}evaluate(i){const r=this.labels,s=this.outputs;if(r.length===1)return s[0].evaluate(i);const l=this.input.evaluate(i);if(l<=r[0])return s[0].evaluate(i);const p=r.length;if(l>=r[p-1])return s[p-1].evaluate(i);const f=Ue(r,l),_=bi.interpolationFactor(this.interpolation,l,r[f],r[f+1]),g=s[f].evaluate(i),v=s[f+1].evaluate(i);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return Gt(g,v,_);case"color":return Ut.interpolate(g,v,_);case"padding":return He.interpolate(g,v,_);case"colorArray":return Ne.interpolate(g,v,_);case"numberArray":return di.interpolate(g,v,_);case"variableAnchorOffsetCollection":return ai.interpolate(g,v,_);case"array":return Xi(g,v,_);case"projectionDefinition":return Ci.interpolate(g,v,_)}case"interpolate-hcl":switch(this.type.kind){case"color":return Ut.interpolate(g,v,_,"hcl");case"colorArray":return Ne.interpolate(g,v,_,"hcl")}case"interpolate-lab":switch(this.type.kind){case"color":return Ut.interpolate(g,v,_,"lab");case"colorArray":return Ne.interpolate(g,v,_,"lab")}}}eachChild(i){i(this.input);for(const r of this.outputs)i(r)}outputDefined(){return this.outputs.every((i=>i.outputDefined()))}}function gn(o,i,r,s){const l=s-r,p=o-r;return l===0?0:i===1?p/l:(Math.pow(i,p)-1)/(Math.pow(i,l)-1)}const wi={color:Ut.interpolate,number:Gt,padding:He.interpolate,numberArray:di.interpolate,colorArray:Ne.interpolate,variableAnchorOffsetCollection:ai.interpolate,array:Xi};class po{constructor(i,r){this.type=i,this.args=r}static parse(i,r){if(i.length<2)return r.error("Expected at least one argument.");let s=null;const l=r.expectedType;l&&l.kind!=="value"&&(s=l);const p=[];for(const _ of i.slice(1)){const g=r.parse(_,1+p.length,s,void 0,{typeAnnotation:"omit"});if(!g)return null;s=s||g.type,p.push(g)}if(!s)throw new Error("No output type");const f=l&&p.some((_=>Vo(l,_.type)));return new po(f?Nt:s,p)}evaluate(i){let r,s=null,l=0;for(const p of this.args)if(l++,s=p.evaluate(i),s&&s instanceof si&&!s.available&&(r||(r=s.name),s=null,l===this.args.length&&(s=r)),s!==null)break;return s}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every((i=>i.outputDefined()))}}function hs(o,i){return o==="=="||o==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Pl(o,i,r,s){return s.compare(i,r)===0}function fo(o,i,r){const s=o!=="=="&&o!=="!=";return class jd{constructor(p,f,_){this.type=qt,this.lhs=p,this.rhs=f,this.collator=_,this.hasUntypedArgument=p.type.kind==="value"||f.type.kind==="value"}static parse(p,f){if(p.length!==3&&p.length!==4)return f.error("Expected two or three arguments.");const _=p[0];let g=f.parse(p[1],1,Nt);if(!g)return null;if(!hs(_,g.type))return f.concat(1).error(`"${_}" comparisons are not supported for type '${Kt(g.type)}'.`);let v=f.parse(p[2],2,Nt);if(!v)return null;if(!hs(_,v.type))return f.concat(2).error(`"${_}" comparisons are not supported for type '${Kt(v.type)}'.`);if(g.type.kind!==v.type.kind&&g.type.kind!=="value"&&v.type.kind!=="value")return f.error(`Cannot compare types '${Kt(g.type)}' and '${Kt(v.type)}'.`);s&&(g.type.kind==="value"&&v.type.kind!=="value"?g=new Ot(v.type,[g]):g.type.kind!=="value"&&v.type.kind==="value"&&(v=new Ot(g.type,[v])));let b=null;if(p.length===4){if(g.type.kind!=="string"&&v.type.kind!=="string"&&g.type.kind!=="value"&&v.type.kind!=="value")return f.error("Cannot use collator to compare non-string types.");if(b=f.parse(p[3],3,so),!b)return null}return new jd(g,v,b)}evaluate(p){const f=this.lhs.evaluate(p),_=this.rhs.evaluate(p);if(s&&this.hasUntypedArgument){const g=we(f),v=we(_);if(g.kind!==v.kind||g.kind!=="string"&&g.kind!=="number")throw new me(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${g.kind}, ${v.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const g=we(f),v=we(_);if(g.kind!=="string"||v.kind!=="string")return i(p,f,_)}return this.collator?r(p,f,_,this.collator.evaluate(p)):i(p,f,_)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}}}const us=fo("==",(function(o,i,r){return i===r}),Pl),ds=fo("!=",(function(o,i,r){return i!==r}),(function(o,i,r,s){return!Pl(0,i,r,s)})),Yi=fo("<",(function(o,i,r){return i<r}),(function(o,i,r,s){return s.compare(i,r)<0})),Ml=fo(">",(function(o,i,r){return i>r}),(function(o,i,r,s){return s.compare(i,r)>0})),ps=fo("<=",(function(o,i,r){return i<=r}),(function(o,i,r,s){return s.compare(i,r)<=0})),Hc=fo(">=",(function(o,i,r){return i>=r}),(function(o,i,r,s){return s.compare(i,r)>=0}));class Go{constructor(i,r,s){this.type=so,this.locale=s,this.caseSensitive=i,this.diacriticSensitive=r}static parse(i,r){if(i.length!==2)return r.error("Expected one argument.");const s=i[1];if(typeof s!="object"||Array.isArray(s))return r.error("Collator options argument must be an object.");const l=r.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,qt);if(!l)return null;const p=r.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,qt);if(!p)return null;let f=null;return s.locale&&(f=r.parse(s.locale,1,$t),!f)?null:new Go(l,p,f)}evaluate(i){return new os(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}class yn{constructor(i,r,s,l,p){this.type=$t,this.number=i,this.locale=r,this.currency=s,this.minFractionDigits=l,this.maxFractionDigits=p}static parse(i,r){if(i.length!==3)return r.error("Expected two arguments.");const s=r.parse(i[1],1,wt);if(!s)return null;const l=i[2];if(typeof l!="object"||Array.isArray(l))return r.error("NumberFormat options argument must be an object.");let p=null;if(l.locale&&(p=r.parse(l.locale,1,$t),!p))return null;let f=null;if(l.currency&&(f=r.parse(l.currency,1,$t),!f))return null;let _=null;if(l["min-fraction-digits"]&&(_=r.parse(l["min-fraction-digits"],1,wt),!_))return null;let g=null;return l["max-fraction-digits"]&&(g=r.parse(l["max-fraction-digits"],1,wt),!g)?null:new yn(s,p,f,_,g)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class fs{constructor(i){this.type=Oo,this.sections=i}static parse(i,r){if(i.length<2)return r.error("Expected at least one argument.");const s=i[1];if(!Array.isArray(s)&&typeof s=="object")return r.error("First argument must be an image or text section.");const l=[];let p=!1;for(let f=1;f<=i.length-1;++f){const _=i[f];if(p&&typeof _=="object"&&!Array.isArray(_)){p=!1;let g=null;if(_["font-scale"]&&(g=r.parse(_["font-scale"],1,wt),!g))return null;let v=null;if(_["text-font"]&&(v=r.parse(_["text-font"],1,vi($t)),!v))return null;let b=null;if(_["text-color"]&&(b=r.parse(_["text-color"],1,$i),!b))return null;let S=null;if(_["vertical-align"]){if(typeof _["vertical-align"]=="string"&&!wl.includes(_["vertical-align"]))return r.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${_["vertical-align"]}' instead.`);if(S=r.parse(_["vertical-align"],1,$t),!S)return null}const I=l[l.length-1];I.scale=g,I.font=v,I.textColor=b,I.verticalAlign=S}else{const g=r.parse(i[f],1,Nt);if(!g)return null;const v=g.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,l.push({content:g,scale:null,font:null,textColor:null,verticalAlign:null})}}return new fs(l)}evaluate(i){return new oi(this.sections.map((r=>{const s=r.content.evaluate(i);return we(s)===Pa?new Ca("",s,null,null,null,r.verticalAlign?r.verticalAlign.evaluate(i):null):new Ca(le(s),null,r.scale?r.scale.evaluate(i):null,r.font?r.font.evaluate(i).join(","):null,r.textColor?r.textColor.evaluate(i):null,r.verticalAlign?r.verticalAlign.evaluate(i):null)})))}eachChild(i){for(const r of this.sections)i(r.content),r.scale&&i(r.scale),r.font&&i(r.font),r.textColor&&i(r.textColor),r.verticalAlign&&i(r.verticalAlign)}outputDefined(){return!1}}class xn{constructor(i){this.type=Pa,this.input=i}static parse(i,r){if(i.length!==2)return r.error("Expected two arguments.");const s=r.parse(i[1],1,$t);return s?new xn(s):r.error("No image name provided.")}evaluate(i){const r=this.input.evaluate(i),s=si.fromString(r);return s&&i.availableImages&&(s.available=i.availableImages.indexOf(r)>-1),s}eachChild(i){i(this.input)}outputDefined(){return!1}}class vn{constructor(i){this.type=wt,this.input=i}static parse(i,r){if(i.length!==2)return r.error(`Expected 1 argument, but found ${i.length-1} instead.`);const s=r.parse(i[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?r.error(`Expected argument of type string or array, but found ${Kt(s.type)} instead.`):new vn(s):null}evaluate(i){const r=this.input.evaluate(i);if(typeof r=="string")return[...r].length;if(Array.isArray(r))return r.length;throw new me(`Expected value to be of type string or array, but found ${Kt(we(r))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const Bi=8192;function Xc(o,i){const r=(180+o[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,l=Math.pow(2,i.z);return[Math.round(r*l*Bi),Math.round(s*l*Bi)]}function ms(o,i){const r=Math.pow(2,i.z);return[(l=(o[0]/Bi+i.x)/r,360*l-180),(s=(o[1]/Bi+i.y)/r,360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90)];var s,l}function qo(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function Ra(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function Il(o,i,r){const s=o[0]-i[0],l=o[1]-i[1],p=o[0]-r[0],f=o[1]-r[1];return s*f-p*l==0&&s*p<=0&&l*f<=0}function _s(o,i,r,s){return(l=[s[0]-r[0],s[1]-r[1]])[0]*(p=[i[0]-o[0],i[1]-o[1]])[1]-l[1]*p[0]!=0&&!(!bn(o,i,r,s)||!bn(r,s,o,i));var l,p}function Kc(o,i,r){for(const s of r)for(let l=0;l<s.length-1;++l)if(_s(o,i,s[l],s[l+1]))return!0;return!1}function Wo(o,i,r=!1){let s=!1;for(const _ of i)for(let g=0;g<_.length-1;g++){if(Il(o,_[g],_[g+1]))return r;(p=_[g])[1]>(l=o)[1]!=(f=_[g+1])[1]>l[1]&&l[0]<(f[0]-p[0])*(l[1]-p[1])/(f[1]-p[1])+p[0]&&(s=!s)}var l,p,f;return s}function Yc(o,i){for(const r of i)if(Wo(o,r))return!0;return!1}function Cl(o,i){for(const r of o)if(!Wo(r,i))return!1;for(let r=0;r<o.length-1;++r)if(Kc(o[r],o[r+1],i))return!1;return!0}function Al(o,i){for(const r of i)if(Cl(o,r))return!0;return!1}function bn(o,i,r,s){const l=s[0]-r[0],p=s[1]-r[1],f=(o[0]-r[0])*p-l*(o[1]-r[1]),_=(i[0]-r[0])*p-l*(i[1]-r[1]);return f>0&&_<0||f<0&&_>0}function gs(o,i,r){const s=[];for(let l=0;l<o.length;l++){const p=[];for(let f=0;f<o[l].length;f++){const _=Xc(o[l][f],r);qo(i,_),p.push(_)}s.push(p)}return s}function zl(o,i,r){const s=[];for(let l=0;l<o.length;l++){const p=gs(o[l],i,r);s.push(p)}return s}function Rl(o,i,r,s){if(o[0]<r[0]||o[0]>r[2]){const l=.5*s;let p=o[0]-r[0]>l?-s:r[0]-o[0]>l?s:0;p===0&&(p=o[0]-r[2]>l?-s:r[2]-o[0]>l?s:0),o[0]+=p}qo(i,o)}function El(o,i,r,s){const l=Math.pow(2,s.z)*Bi,p=[s.x*Bi,s.y*Bi],f=[];for(const _ of o)for(const g of _){const v=[g.x+p[0],g.y+p[1]];Rl(v,i,r,l),f.push(v)}return f}function kl(o,i,r,s){const l=Math.pow(2,s.z)*Bi,p=[s.x*Bi,s.y*Bi],f=[];for(const g of o){const v=[];for(const b of g){const S=[b.x+p[0],b.y+p[1]];qo(i,S),v.push(S)}f.push(v)}if(i[2]-i[0]<=l/2){(_=i)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const g of f)for(const v of g)Rl(v,i,r,l)}var _;return f}class lr{constructor(i,r){this.type=qt,this.geojson=i,this.geometries=r}static parse(i,r){if(i.length!==2)return r.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Uo(i[1])){const s=i[1];if(s.type==="FeatureCollection"){const l=[];for(const p of s.features){const{type:f,coordinates:_}=p.geometry;f==="Polygon"&&l.push(_),f==="MultiPolygon"&&l.push(..._)}if(l.length)return new lr(s,{type:"MultiPolygon",coordinates:l})}else if(s.type==="Feature"){const l=s.geometry.type;if(l==="Polygon"||l==="MultiPolygon")return new lr(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new lr(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return(function(r,s){const l=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const _=gs(s.coordinates,p,f),g=El(r.geometry(),l,p,f);if(!Ra(l,p))return!1;for(const v of g)if(!Wo(v,_))return!1}if(s.type==="MultiPolygon"){const _=zl(s.coordinates,p,f),g=El(r.geometry(),l,p,f);if(!Ra(l,p))return!1;for(const v of g)if(!Yc(v,_))return!1}return!0})(i,this.geometries);if(i.geometryType()==="LineString")return(function(r,s){const l=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],f=r.canonicalID();if(s.type==="Polygon"){const _=gs(s.coordinates,p,f),g=kl(r.geometry(),l,p,f);if(!Ra(l,p))return!1;for(const v of g)if(!Cl(v,_))return!1}if(s.type==="MultiPolygon"){const _=zl(s.coordinates,p,f),g=kl(r.geometry(),l,p,f);if(!Ra(l,p))return!1;for(const v of g)if(!Al(v,_))return!1}return!0})(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Dl=class{constructor(o=[],i=(r,s)=>r<s?-1:r>s?1:0){if(this.data=o,this.length=this.data.length,this.compare=i,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:i,compare:r}=this,s=i[o];for(;o>0;){const l=o-1>>1,p=i[l];if(r(s,p)>=0)break;i[o]=p,o=l}i[o]=s}_down(o){const{data:i,compare:r}=this,s=this.length>>1,l=i[o];for(;o<s;){let p=1+(o<<1);const f=p+1;if(f<this.length&&r(i[f],i[p])<0&&(p=f),r(i[p],l)>=0)break;i[o]=i[p],o=p}i[o]=l}};function Ll(o,i,r=0,s=o.length-1,l=Qc){for(;s>r;){if(s-r>600){const g=s-r+1,v=i-r+1,b=Math.log(g),S=.5*Math.exp(2*b/3),I=.5*Math.sqrt(b*S*(g-S)/g)*(v-g/2<0?-1:1);Ll(o,i,Math.max(r,Math.floor(i-v*S/g+I)),Math.min(s,Math.floor(i+(g-v)*S/g+I)),l)}const p=o[i];let f=r,_=s;for(Ea(o,r,i),l(o[s],p)>0&&Ea(o,r,s);f<_;){for(Ea(o,f,_),f++,_--;l(o[f],p)<0;)f++;for(;l(o[_],p)>0;)_--}l(o[r],p)===0?Ea(o,r,_):(_++,Ea(o,_,s)),_<=i&&(r=_+1),i<=_&&(s=_-1)}}function Ea(o,i,r){const s=o[i];o[i]=o[r],o[r]=s}function Qc(o,i){return o<i?-1:o>i?1:0}function Ho(o,i){if(o.length<=1)return[o];const r=[];let s,l;for(const p of o){const f=Jc(p);f!==0&&(p.area=Math.abs(f),l===void 0&&(l=f<0),l===f<0?(s&&r.push(s),s=[p]):s.push(p))}if(s&&r.push(s),i>1)for(let p=0;p<r.length;p++)r[p].length<=i||(Ll(r[p],i,1,r[p].length-1,Fl),r[p]=r[p].slice(0,i));return r}function Fl(o,i){return i.area-o.area}function Jc(o){let i=0;for(let r,s,l=0,p=o.length,f=p-1;l<p;f=l++)r=o[l],s=o[f],i+=(s.x-r.x)*(r.y+s.y);return i}const Bl=1/298.257223563,wn=Bl*(2-Bl),Tn=Math.PI/180;class Sn{constructor(i){const r=6378.137*Tn*1e3,s=Math.cos(i*Tn),l=1/(1-wn*(1-s*s)),p=Math.sqrt(l);this.kx=r*p*s,this.ky=r*p*l*(1-wn)}distance(i,r){const s=this.wrap(i[0]-r[0])*this.kx,l=(i[1]-r[1])*this.ky;return Math.sqrt(s*s+l*l)}pointOnLine(i,r){let s,l,p,f,_=1/0;for(let g=0;g<i.length-1;g++){let v=i[g][0],b=i[g][1],S=this.wrap(i[g+1][0]-v)*this.kx,I=(i[g+1][1]-b)*this.ky,C=0;S===0&&I===0||(C=(this.wrap(r[0]-v)*this.kx*S+(r[1]-b)*this.ky*I)/(S*S+I*I),C>1?(v=i[g+1][0],b=i[g+1][1]):C>0&&(v+=S/this.kx*C,b+=I/this.ky*C)),S=this.wrap(r[0]-v)*this.kx,I=(r[1]-b)*this.ky;const R=S*S+I*I;R<_&&(_=R,s=v,l=b,p=g,f=C)}return{point:[s,l],index:p,t:Math.max(0,Math.min(1,f))}}wrap(i){for(;i<-180;)i+=360;for(;i>180;)i-=360;return i}}function Ol(o,i){return i[0]-o[0]}function ys(o){return o[1]-o[0]+1}function cr(o,i){return o[1]>=o[0]&&o[1]<i}function Pn(o,i){if(o[0]>o[1])return[null,null];const r=ys(o);if(i){if(r===2)return[o,null];const l=Math.floor(r/2);return[[o[0],o[0]+l],[o[0]+l,o[1]]]}if(r===1)return[o,null];const s=Math.floor(r/2)-1;return[[o[0],o[0]+s],[o[0]+s+1,o[1]]]}function Mn(o,i){if(!cr(i,o.length))return[1/0,1/0,-1/0,-1/0];const r=[1/0,1/0,-1/0,-1/0];for(let s=i[0];s<=i[1];++s)qo(r,o[s]);return r}function In(o){const i=[1/0,1/0,-1/0,-1/0];for(const r of o)for(const s of r)qo(i,s);return i}function jl(o){return o[0]!==-1/0&&o[1]!==-1/0&&o[2]!==1/0&&o[3]!==1/0}function re(o,i,r){if(!jl(o)||!jl(i))return NaN;let s=0,l=0;return o[2]<i[0]&&(s=i[0]-o[2]),o[0]>i[2]&&(s=o[0]-i[2]),o[1]>i[3]&&(l=o[1]-i[3]),o[3]<i[1]&&(l=i[1]-o[3]),r.distance([0,0],[s,l])}function mo(o,i,r){const s=r.pointOnLine(i,o);return r.distance(o,s.point)}function Cn(o,i,r,s,l){const p=Math.min(mo(o,[r,s],l),mo(i,[r,s],l)),f=Math.min(mo(r,[o,i],l),mo(s,[o,i],l));return Math.min(p,f)}function th(o,i,r,s,l){if(!cr(i,o.length)||!cr(s,r.length))return 1/0;let p=1/0;for(let f=i[0];f<i[1];++f){const _=o[f],g=o[f+1];for(let v=s[0];v<s[1];++v){const b=r[v],S=r[v+1];if(_s(_,g,b,S))return 0;p=Math.min(p,Cn(_,g,b,S,l))}}return p}function eh(o,i,r,s,l){if(!cr(i,o.length)||!cr(s,r.length))return NaN;let p=1/0;for(let f=i[0];f<=i[1];++f)for(let _=s[0];_<=s[1];++_)if(p=Math.min(p,l.distance(o[f],r[_])),p===0)return p;return p}function ih(o,i,r){if(Wo(o,i,!0))return 0;let s=1/0;for(const l of i){const p=l[0],f=l[l.length-1];if(p!==f&&(s=Math.min(s,mo(o,[f,p],r)),s===0))return s;const _=r.pointOnLine(l,o);if(s=Math.min(s,r.distance(o,_.point)),s===0)return s}return s}function rh(o,i,r,s){if(!cr(i,o.length))return NaN;for(let p=i[0];p<=i[1];++p)if(Wo(o[p],r,!0))return 0;let l=1/0;for(let p=i[0];p<i[1];++p){const f=o[p],_=o[p+1];for(const g of r)for(let v=0,b=g.length,S=b-1;v<b;S=v++){const I=g[S],C=g[v];if(_s(f,_,I,C))return 0;l=Math.min(l,Cn(f,_,I,C,s))}}return l}function Vl(o,i){for(const r of o)for(const s of r)if(Wo(s,i,!0))return!0;return!1}function oh(o,i,r,s=1/0){const l=In(o),p=In(i);if(s!==1/0&&re(l,p,r)>=s)return s;if(Ra(l,p)){if(Vl(o,i))return 0}else if(Vl(i,o))return 0;let f=1/0;for(const _ of o)for(let g=0,v=_.length,b=v-1;g<v;b=g++){const S=_[b],I=_[g];for(const C of i)for(let R=0,L=C.length,B=L-1;R<L;B=R++){const N=C[B],it=C[R];if(_s(S,I,N,it))return 0;f=Math.min(f,Cn(S,I,N,it,r))}}return f}function Nl(o,i,r,s,l,p){if(!p)return;const f=re(Mn(s,p),l,r);f<i&&o.push([f,p,[0,0]])}function xs(o,i,r,s,l,p,f){if(!p||!f)return;const _=re(Mn(s,p),Mn(l,f),r);_<i&&o.push([_,p,f])}function vs(o,i,r,s,l=1/0){let p=Math.min(s.distance(o[0],r[0][0]),l);if(p===0)return p;const f=new Dl([[0,[0,o.length-1],[0,0]]],Ol),_=In(r);for(;f.length>0;){const g=f.pop();if(g[0]>=p)continue;const v=g[1],b=i?50:100;if(ys(v)<=b){if(!cr(v,o.length))return NaN;if(i){const S=rh(o,v,r,s);if(isNaN(S)||S===0)return S;p=Math.min(p,S)}else for(let S=v[0];S<=v[1];++S){const I=ih(o[S],r,s);if(p=Math.min(p,I),p===0)return 0}}else{const S=Pn(v,i);Nl(f,p,s,o,_,S[0]),Nl(f,p,s,o,_,S[1])}}return p}function bs(o,i,r,s,l,p=1/0){let f=Math.min(p,l.distance(o[0],r[0]));if(f===0)return f;const _=new Dl([[0,[0,o.length-1],[0,r.length-1]]],Ol);for(;_.length>0;){const g=_.pop();if(g[0]>=f)continue;const v=g[1],b=g[2],S=i?50:100,I=s?50:100;if(ys(v)<=S&&ys(b)<=I){if(!cr(v,o.length)&&cr(b,r.length))return NaN;let C;if(i&&s)C=th(o,v,r,b,l),f=Math.min(f,C);else if(i&&!s){const R=o.slice(v[0],v[1]+1);for(let L=b[0];L<=b[1];++L)if(C=mo(r[L],R,l),f=Math.min(f,C),f===0)return f}else if(!i&&s){const R=r.slice(b[0],b[1]+1);for(let L=v[0];L<=v[1];++L)if(C=mo(o[L],R,l),f=Math.min(f,C),f===0)return f}else C=eh(o,v,r,b,l),f=Math.min(f,C)}else{const C=Pn(v,i),R=Pn(b,s);xs(_,f,l,o,r,C[0],R[0]),xs(_,f,l,o,r,C[0],R[1]),xs(_,f,l,o,r,C[1],R[0]),xs(_,f,l,o,r,C[1],R[1])}}return f}function An(o){return o.type==="MultiPolygon"?o.coordinates.map((i=>({type:"Polygon",coordinates:i}))):o.type==="MultiLineString"?o.coordinates.map((i=>({type:"LineString",coordinates:i}))):o.type==="MultiPoint"?o.coordinates.map((i=>({type:"Point",coordinates:i}))):[o]}class _o{constructor(i,r){this.type=wt,this.geojson=i,this.geometries=r}static parse(i,r){if(i.length!==2)return r.error(`'distance' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Uo(i[1])){const s=i[1];if(s.type==="FeatureCollection")return new _o(s,s.features.map((l=>An(l.geometry))).flat());if(s.type==="Feature")return new _o(s,An(s.geometry));if("type"in s&&"coordinates"in s)return new _o(s,An(s))}return r.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return(function(r,s){const l=r.geometry(),p=l.flat().map((g=>ms([g.x,g.y],r.canonical)));if(l.length===0)return NaN;const f=new Sn(p[0][1]);let _=1/0;for(const g of s){switch(g.type){case"Point":_=Math.min(_,bs(p,!1,[g.coordinates],!1,f,_));break;case"LineString":_=Math.min(_,bs(p,!1,g.coordinates,!0,f,_));break;case"Polygon":_=Math.min(_,vs(p,!1,g.coordinates,f,_))}if(_===0)return _}return _})(i,this.geometries);if(i.geometryType()==="LineString")return(function(r,s){const l=r.geometry(),p=l.flat().map((g=>ms([g.x,g.y],r.canonical)));if(l.length===0)return NaN;const f=new Sn(p[0][1]);let _=1/0;for(const g of s){switch(g.type){case"Point":_=Math.min(_,bs(p,!0,[g.coordinates],!1,f,_));break;case"LineString":_=Math.min(_,bs(p,!0,g.coordinates,!0,f,_));break;case"Polygon":_=Math.min(_,vs(p,!0,g.coordinates,f,_))}if(_===0)return _}return _})(i,this.geometries);if(i.geometryType()==="Polygon")return(function(r,s){const l=r.geometry();if(l.length===0||l[0].length===0)return NaN;const p=Ho(l,0).map((g=>g.map((v=>v.map((b=>ms([b.x,b.y],r.canonical))))))),f=new Sn(p[0][0][0][1]);let _=1/0;for(const g of s)for(const v of p){switch(g.type){case"Point":_=Math.min(_,vs([g.coordinates],!1,v,f,_));break;case"LineString":_=Math.min(_,vs(g.coordinates,!0,v,f,_));break;case"Polygon":_=Math.min(_,oh(v,g.coordinates,f,_))}if(_===0)return _}return _})(i,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}class ka{constructor(i){this.type=Nt,this.key=i}static parse(i,r){if(i.length!==2)return r.error(`Expected 1 argument, but found ${i.length-1} instead.`);const s=i[1];return s==null?r.error("Global state property must be defined."):typeof s!="string"?r.error(`Global state property must be string, but found ${typeof i[1]} instead.`):new ka(s)}evaluate(i){var r;const s=(r=i.globals)===null||r===void 0?void 0:r.globalState;return s&&Object.keys(s).length!==0?Ia(s,this.key):null}eachChild(){}outputDefined(){return!1}}const Xo={"==":us,"!=":ds,">":Ml,"<":Yi,">=":Hc,"<=":ps,array:Ot,at:za,boolean:Ot,case:cs,coalesce:po,collator:Go,format:fs,image:xn,in:ss,"index-of":ns,interpolate:bi,"interpolate-hcl":bi,"interpolate-lab":bi,length:vn,let:uo,literal:Pr,match:ls,number:Ot,"number-format":yn,object:Ot,slice:Ki,step:jr,string:Ot,"to-boolean":Yt,"to-color":Yt,"to-number":Yt,"to-string":Yt,var:Aa,within:lr,distance:_o,"global-state":ka};class Zi{constructor(i,r,s,l){this.name=i,this.type=r,this._evaluate=s,this.args=l}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,r){const s=i[0],l=Zi.definitions[s];if(!l)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(l)?l[0]:l.type,f=Array.isArray(l)?[[l[1],l[2]]]:l.overloads,_=f.filter((([v])=>!Array.isArray(v)||v.length===i.length-1));let g=null;for(const[v,b]of _){g=new $o(r.registry,ws,r.path,null,r.scope);const S=[];let I=!1;for(let C=1;C<i.length;C++){const R=i[C],L=Array.isArray(v)?v[C-1]:v.type,B=g.parse(R,1+S.length,L);if(!B){I=!0;break}S.push(B)}if(!I)if(Array.isArray(v)&&v.length!==S.length)g.error(`Expected ${v.length} arguments, but found ${S.length} instead.`);else{for(let C=0;C<S.length;C++){const R=Array.isArray(v)?v[C]:v.type,L=S[C];g.concat(C+1).checkSubtype(R,L.type)}if(g.errors.length===0)return new Zi(s,p,b,S)}}if(_.length===1)r.errors.push(...g.errors);else{const v=(_.length?_:f).map((([S])=>{return I=S,Array.isArray(I)?`(${I.map(Kt).join(", ")})`:`(${Kt(I.type)}...)`;var I})).join(" | "),b=[];for(let S=1;S<i.length;S++){const I=r.parse(i[S],1+b.length);if(!I)return null;b.push(Kt(I.type))}r.error(`Expected arguments of type ${v}, but found (${b.join(", ")}) instead.`)}return null}static register(i,r){Zi.definitions=r;for(const s in r)i[s]=Zi}}function Ul(o,[i,r,s,l]){i=i.evaluate(o),r=r.evaluate(o),s=s.evaluate(o);const p=l?l.evaluate(o):1,f=fn(i,r,s,p);if(f)throw new me(f);return new Ut(i/255,r/255,s/255,p,!1)}function $l(o,i){return o in i}function zn(o,i){const r=i[o];return r===void 0?null:r}function go(o){return{type:o}}function ws(o){if(o instanceof Aa)return ws(o.boundExpression);if(o instanceof Zi&&o.name==="error"||o instanceof Go||o instanceof lr||o instanceof _o||o instanceof ka)return!1;const i=o instanceof Yt||o instanceof Ot;let r=!0;return o.eachChild((s=>{r=i?r&&ws(s):r&&s instanceof Pr})),!!r&&Ts(o)&&Ss(o,["zoom","heatmap-density","elevation","line-progress","accumulated","is-supported-script"])}function Ts(o){if(o instanceof Zi&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof lr||o instanceof _o)return!1;let i=!0;return o.eachChild((r=>{i&&!Ts(r)&&(i=!1)})),i}function Da(o){if(o instanceof Zi&&o.name==="feature-state")return!1;let i=!0;return o.eachChild((r=>{i&&!Da(r)&&(i=!1)})),i}function Ss(o,i){if(o instanceof Zi&&i.indexOf(o.name)>=0)return!1;let r=!0;return o.eachChild((s=>{r&&!Ss(s,i)&&(r=!1)})),r}function Zl(o){return{result:"success",value:o}}function Ko(o){return{result:"error",value:o}}function Yo(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function Gl(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function Rn(o){return!!o.expression&&o.expression.interpolated}function Jt(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Qo(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)&&we(o)===Tr}function ah(o){return o}function ql(o,i){const r=o.stops&&typeof o.stops[0][0]=="object",s=r||!(r||o.property!==void 0),l=o.type||(Rn(i)?"exponential":"interval"),p=(function(b){switch(b.type){case"color":return Ut.parse;case"padding":return He.parse;case"numberArray":return di.parse;case"colorArray":return Ne.parse;default:return null}})(i);if(p&&((o=Me({},o)).stops&&(o.stops=o.stops.map((b=>[b[0],p(b[1])]))),o.default=p(o.default?o.default:i.default)),o.colorSpace&&(f=o.colorSpace)!=="rgb"&&f!=="hcl"&&f!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var f;const _=(function(b){switch(b){case"exponential":return Hl;case"interval":return sh;case"categorical":return Wl;case"identity":return Ps;default:throw new Error(`Unknown function type "${b}"`)}})(l);let g,v;if(l==="categorical"){g=Object.create(null);for(const b of o.stops)g[b[0]]=b[1];v=typeof o.stops[0][0]}if(r){const b={},S=[];for(let R=0;R<o.stops.length;R++){const L=o.stops[R],B=L[0].zoom;b[B]===void 0&&(b[B]={zoom:B,type:o.type,property:o.property,default:o.default,stops:[]},S.push(B)),b[B].stops.push([L[0].value,L[1]])}const I=[];for(const R of S)I.push([b[R].zoom,ql(b[R],i)]);const C={name:"linear"};return{kind:"composite",interpolationType:C,interpolationFactor:bi.interpolationFactor.bind(void 0,C),zoomStops:I.map((R=>R[0])),evaluate:({zoom:R},L)=>Hl({stops:I,base:o.base},i,R).evaluate(R,L)}}if(s){const b=l==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:b,interpolationFactor:bi.interpolationFactor.bind(void 0,b),zoomStops:o.stops.map((S=>S[0])),evaluate:({zoom:S})=>_(o,i,S,g,v)}}return{kind:"source",evaluate(b,S){const I=S&&S.properties?S.properties[o.property]:void 0;return I===void 0?La(o.default,i.default):_(o,i,I,g,v)}}}function La(o,i,r){return o!==void 0?o:i!==void 0?i:r!==void 0?r:void 0}function Wl(o,i,r,s,l){return La(typeof r===l?s[r]:void 0,o.default,i.default)}function sh(o,i,r){if(Jt(r)!=="number")return La(o.default,i.default);const s=o.stops.length;if(s===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[s-1][0])return o.stops[s-1][1];const l=Ue(o.stops.map((p=>p[0])),r);return o.stops[l][1]}function Hl(o,i,r){const s=o.base!==void 0?o.base:1;if(Jt(r)!=="number")return La(o.default,i.default);const l=o.stops.length;if(l===1||r<=o.stops[0][0])return o.stops[0][1];if(r>=o.stops[l-1][0])return o.stops[l-1][1];const p=Ue(o.stops.map((b=>b[0])),r),f=(function(b,S,I,C){const R=C-I,L=b-I;return R===0?0:S===1?L/R:(Math.pow(S,L)-1)/(Math.pow(S,R)-1)})(r,s,o.stops[p][0],o.stops[p+1][0]),_=o.stops[p][1],g=o.stops[p+1][1],v=wi[i.type]||ah;return typeof _.evaluate=="function"?{evaluate(...b){const S=_.evaluate.apply(void 0,b),I=g.evaluate.apply(void 0,b);if(S!==void 0&&I!==void 0)return v(S,I,f,o.colorSpace)}}:v(_,g,f,o.colorSpace)}function Ps(o,i,r){switch(i.type){case"color":r=Ut.parse(r);break;case"formatted":r=oi.fromString(r.toString());break;case"resolvedImage":r=si.fromString(r.toString());break;case"padding":r=He.parse(r);break;case"colorArray":r=Ne.parse(r);break;case"numberArray":r=di.parse(r);break;default:Jt(r)===i.type||i.type==="enum"&&i.values[r]||(r=void 0)}return La(r,o.default,i.default)}Zi.register(Xo,{error:[{kind:"error"},[$t],(o,[i])=>{throw new me(i.evaluate(o))}],typeof:[$t,[Nt],(o,[i])=>Kt(we(i.evaluate(o)))],"to-rgba":[vi(wt,4),[$i],(o,[i])=>{const[r,s,l,p]=i.evaluate(o).rgb;return[255*r,255*s,255*l,p]}],rgb:[$i,[wt,wt,wt],Ul],rgba:[$i,[wt,wt,wt,wt],Ul],has:{type:qt,overloads:[[[$t],(o,[i])=>$l(i.evaluate(o),o.properties())],[[$t,Tr],(o,[i,r])=>$l(i.evaluate(o),r.evaluate(o))]]},get:{type:Nt,overloads:[[[$t],(o,[i])=>zn(i.evaluate(o),o.properties())],[[$t,Tr],(o,[i,r])=>zn(i.evaluate(o),r.evaluate(o))]]},"feature-state":[Nt,[$t],(o,[i])=>zn(i.evaluate(o),o.featureState||{})],properties:[Tr,[],o=>o.properties()],"geometry-type":[$t,[],o=>o.geometryType()],id:[Nt,[],o=>o.id()],zoom:[wt,[],o=>o.globals.zoom],"heatmap-density":[wt,[],o=>o.globals.heatmapDensity||0],elevation:[wt,[],o=>o.globals.elevation||0],"line-progress":[wt,[],o=>o.globals.lineProgress||0],accumulated:[Nt,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[wt,go(wt),(o,i)=>{let r=0;for(const s of i)r+=s.evaluate(o);return r}],"*":[wt,go(wt),(o,i)=>{let r=1;for(const s of i)r*=s.evaluate(o);return r}],"-":{type:wt,overloads:[[[wt,wt],(o,[i,r])=>i.evaluate(o)-r.evaluate(o)],[[wt],(o,[i])=>-i.evaluate(o)]]},"/":[wt,[wt,wt],(o,[i,r])=>i.evaluate(o)/r.evaluate(o)],"%":[wt,[wt,wt],(o,[i,r])=>i.evaluate(o)%r.evaluate(o)],ln2:[wt,[],()=>Math.LN2],pi:[wt,[],()=>Math.PI],e:[wt,[],()=>Math.E],"^":[wt,[wt,wt],(o,[i,r])=>Math.pow(i.evaluate(o),r.evaluate(o))],sqrt:[wt,[wt],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[wt,[wt],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[wt,[wt],(o,[i])=>Math.log(i.evaluate(o))],log2:[wt,[wt],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[wt,[wt],(o,[i])=>Math.sin(i.evaluate(o))],cos:[wt,[wt],(o,[i])=>Math.cos(i.evaluate(o))],tan:[wt,[wt],(o,[i])=>Math.tan(i.evaluate(o))],asin:[wt,[wt],(o,[i])=>Math.asin(i.evaluate(o))],acos:[wt,[wt],(o,[i])=>Math.acos(i.evaluate(o))],atan:[wt,[wt],(o,[i])=>Math.atan(i.evaluate(o))],min:[wt,go(wt),(o,i)=>Math.min(...i.map((r=>r.evaluate(o))))],max:[wt,go(wt),(o,i)=>Math.max(...i.map((r=>r.evaluate(o))))],abs:[wt,[wt],(o,[i])=>Math.abs(i.evaluate(o))],round:[wt,[wt],(o,[i])=>{const r=i.evaluate(o);return r<0?-Math.round(-r):Math.round(r)}],floor:[wt,[wt],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[wt,[wt],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[qt,[$t,Nt],(o,[i,r])=>o.properties()[i.value]===r.value],"filter-id-==":[qt,[Nt],(o,[i])=>o.id()===i.value],"filter-type-==":[qt,[$t],(o,[i])=>o.geometryType()===i.value],"filter-<":[qt,[$t,Nt],(o,[i,r])=>{const s=o.properties()[i.value],l=r.value;return typeof s==typeof l&&s<l}],"filter-id-<":[qt,[Nt],(o,[i])=>{const r=o.id(),s=i.value;return typeof r==typeof s&&r<s}],"filter->":[qt,[$t,Nt],(o,[i,r])=>{const s=o.properties()[i.value],l=r.value;return typeof s==typeof l&&s>l}],"filter-id->":[qt,[Nt],(o,[i])=>{const r=o.id(),s=i.value;return typeof r==typeof s&&r>s}],"filter-<=":[qt,[$t,Nt],(o,[i,r])=>{const s=o.properties()[i.value],l=r.value;return typeof s==typeof l&&s<=l}],"filter-id-<=":[qt,[Nt],(o,[i])=>{const r=o.id(),s=i.value;return typeof r==typeof s&&r<=s}],"filter->=":[qt,[$t,Nt],(o,[i,r])=>{const s=o.properties()[i.value],l=r.value;return typeof s==typeof l&&s>=l}],"filter-id->=":[qt,[Nt],(o,[i])=>{const r=o.id(),s=i.value;return typeof r==typeof s&&r>=s}],"filter-has":[qt,[Nt],(o,[i])=>i.value in o.properties()],"filter-has-id":[qt,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[qt,[vi($t)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[qt,[vi(Nt)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[qt,[$t,vi(Nt)],(o,[i,r])=>r.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[qt,[$t,vi(Nt)],(o,[i,r])=>(function(s,l,p,f){for(;p<=f;){const _=p+f>>1;if(l[_]===s)return!0;l[_]>s?f=_-1:p=_+1}return!1})(o.properties()[i.value],r.value,0,r.value.length-1)],all:{type:qt,overloads:[[[qt,qt],(o,[i,r])=>i.evaluate(o)&&r.evaluate(o)],[go(qt),(o,i)=>{for(const r of i)if(!r.evaluate(o))return!1;return!0}]]},any:{type:qt,overloads:[[[qt,qt],(o,[i,r])=>i.evaluate(o)||r.evaluate(o)],[go(qt),(o,i)=>{for(const r of i)if(r.evaluate(o))return!0;return!1}]]},"!":[qt,[qt],(o,[i])=>!i.evaluate(o)],"is-supported-script":[qt,[$t],(o,[i])=>{const r=o.globals&&o.globals.isSupportedScript;return!r||r(i.evaluate(o))}],upcase:[$t,[$t],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[$t,[$t],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[$t,go(Nt),(o,i)=>i.map((r=>le(r.evaluate(o)))).join("")],"resolved-locale":[$t,[so],(o,[i])=>i.evaluate(o).resolvedLocale()]});class Ms{constructor(i,r,s){this.expression=i,this._warningHistory={},this._evaluator=new nr,this._defaultValue=r?(function(l){if(l.type==="color"&&Qo(l.default))return new Ut(0,0,0,0);switch(l.type){case"color":return Ut.parse(l.default)||null;case"padding":return He.parse(l.default)||null;case"numberArray":return di.parse(l.default)||null;case"colorArray":return Ne.parse(l.default)||null;case"variableAnchorOffsetCollection":return ai.parse(l.default)||null;case"projectionDefinition":return Ci.parse(l.default)||null;default:return l.default===void 0?null:l.default}})(r):null,this._enumValues=r&&r.type==="enum"?r.values:null,this._globalState=s}evaluateWithoutErrorHandling(i,r,s,l,p,f){return this._globalState&&(i=Jo(i,this._globalState)),this._evaluator.globals=i,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=l,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f,this.expression.evaluate(this._evaluator)}evaluate(i,r,s,l,p,f){this._globalState&&(i=Jo(i,this._globalState)),this._evaluator.globals=i,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=l,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=f||null;try{const _=this.expression.evaluate(this._evaluator);if(_==null||typeof _=="number"&&_!=_)return this._defaultValue;if(this._enumValues&&!(_ in this._enumValues))throw new me(`Expected value to be one of ${Object.keys(this._enumValues).map((g=>JSON.stringify(g))).join(", ")}, but found ${JSON.stringify(_)} instead.`);return _}catch(_){return this._warningHistory[_.message]||(this._warningHistory[_.message]=!0,typeof console<"u"&&console.warn(_.message)),this._defaultValue}}}function Is(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Xo}function Cs(o,i,r){const s=new $o(Xo,ws,[],i?(function(p){const f={color:$i,string:$t,number:wt,enum:$t,boolean:qt,formatted:Oo,padding:jo,numberArray:no,colorArray:Sa,projectionDefinition:Ta,resolvedImage:Pa,variableAnchorOffsetCollection:Sr};return p.type==="array"?vi(f[p.value]||Nt,p.length):f[p.type]})(i):void 0),l=s.parse(o,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Zl(new Ms(l,i,r)):Ko(s.errors)}class As{constructor(i,r,s){this.kind=i,this._styleExpression=r,this.isStateDependent=i!=="constant"&&!Da(r.expression),this.globalStateRefs=zs(r.expression),this._globalState=s}evaluateWithoutErrorHandling(i,r,s,l,p,f){return this._globalState&&(i=Jo(i,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(i,r,s,l,p,f)}evaluate(i,r,s,l,p,f){return this._globalState&&(i=Jo(i,this._globalState)),this._styleExpression.evaluate(i,r,s,l,p,f)}}class En{constructor(i,r,s,l,p){this.kind=i,this.zoomStops=s,this._styleExpression=r,this.isStateDependent=i!=="camera"&&!Da(r.expression),this.globalStateRefs=zs(r.expression),this.interpolationType=l,this._globalState=p}evaluateWithoutErrorHandling(i,r,s,l,p,f){return this._globalState&&(i=Jo(i,this._globalState)),this._styleExpression.evaluateWithoutErrorHandling(i,r,s,l,p,f)}evaluate(i,r,s,l,p,f){return this._globalState&&(i=Jo(i,this._globalState)),this._styleExpression.evaluate(i,r,s,l,p,f)}interpolationFactor(i,r,s){return this.interpolationType?bi.interpolationFactor(this.interpolationType,i,r,s):0}}function Xl(o,i,r){const s=Cs(o,i,r);if(s.result==="error")return s;const l=s.value.expression,p=Ts(l);if(!p&&!Yo(i))return Ko([new yi("","data expressions not supported")]);const f=Ss(l,["zoom"]);if(!f&&!Gl(i))return Ko([new yi("","zoom expressions not supported")]);const _=Ba(l);return _||f?_ instanceof yi?Ko([_]):_ instanceof bi&&!Rn(i)?Ko([new yi("",'"interpolate" expressions cannot be used with this property')]):Zl(_?new En(p?"camera":"composite",s.value,_.labels,_ instanceof bi?_.interpolation:void 0,r):new As(p?"constant":"source",s.value,r)):Ko([new yi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Fa{constructor(i,r){this._parameters=i,this._specification=r,Me(this,ql(this._parameters,this._specification))}static deserialize(i){return new Fa(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Ba(o){let i=null;if(o instanceof uo)i=Ba(o.result);else if(o instanceof po){for(const r of o.args)if(i=Ba(r),i)break}else(o instanceof jr||o instanceof bi)&&o.input instanceof Zi&&o.input.name==="zoom"&&(i=o);return i instanceof yi||o.eachChild((r=>{const s=Ba(r);s instanceof yi?i=s:!i&&s?i=new yi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&s&&i!==s&&(i=new yi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),i}function zs(o,i=new Set){return o instanceof ka&&i.add(o.key),o.eachChild((r=>{zs(r,i)})),i}function Jo(o,i){const{zoom:r,heatmapDensity:s,elevation:l,lineProgress:p,isSupportedScript:f,accumulated:_}=o??{};return{zoom:r,heatmapDensity:s,elevation:l,lineProgress:p,isSupportedScript:f,accumulated:_,globalState:i}}function Rs(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!Rs(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const Kl={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ta(o,i){if(o==null)return{filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set};Rs(o)||(o=Es(o));const r=Cs(o,Kl,i);if(r.result==="error")throw new Error(r.value.map((s=>`${s.key}: ${s.message}`)).join(", "));return{filter:(s,l,p)=>r.value.evaluate(s,l,{},p),needGeometry:Yl(o),getGlobalStateRefs:()=>zs(r.value.expression)}}function nh(o,i){return o<i?-1:o>i?1:0}function Yl(o){if(!Array.isArray(o))return!1;if(o[0]==="within"||o[0]==="distance")return!0;for(let i=1;i<o.length;i++)if(Yl(o[i]))return!0;return!1}function Es(o){if(!o)return!0;const i=o[0];return o.length<=1?i!=="any":i==="=="?kn(o[1],o[2],"=="):i==="!="?ea(kn(o[1],o[2],"==")):i==="<"||i===">"||i==="<="||i===">="?kn(o[1],o[2],i):i==="any"?(r=o.slice(1),["any"].concat(r.map(Es))):i==="all"?["all"].concat(o.slice(1).map(Es)):i==="none"?["all"].concat(o.slice(1).map(Es).map(ea)):i==="in"?Dn(o[1],o.slice(2)):i==="!in"?ea(Dn(o[1],o.slice(2))):i==="has"?Ln(o[1]):i!=="!has"||ea(Ln(o[1]));var r}function kn(o,i,r){switch(o){case"$type":return[`filter-type-${r}`,i];case"$id":return[`filter-id-${r}`,i];default:return[`filter-${r}`,o,i]}}function Dn(o,i){if(i.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some((r=>typeof r!=typeof i[0]))?["filter-in-large",o,["literal",i.sort(nh)]]:["filter-in-small",o,["literal",i]]}}function Ln(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function ea(o){return["!",o]}function Oa(o){const i=typeof o;if(i==="number"||i==="boolean"||i==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let l="[";for(const p of o)l+=`${Oa(p)},`;return`${l}]`}const r=Object.keys(o).sort();let s="{";for(let l=0;l<r.length;l++)s+=`${JSON.stringify(r[l])}:${Oa(o[r[l]])},`;return`${s}}`}function Fn(o){let i="";for(const r of Xt)i+=`/${Oa(o[r])}`;return i}function ks(o){const i=o.value;return i?[new _t(o.key,i,"constants have been deprecated as of v8")]:[]}function ve(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function yo(o){if(Array.isArray(o))return o.map(yo);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const r in o)i[r]=yo(o[r]);return i}return ve(o)}function Gi(o){const i=o.key,r=o.value,s=o.valueSpec||{},l=o.objectElementValidators||{},p=o.style,f=o.styleSpec,_=o.validateSpec;let g=[];const v=Jt(r);if(v!=="object")return[new _t(i,r,`object expected, ${v} found`)];for(const b in r){const S=b.split(".")[0],I=Ia(s,S)||s["*"];let C;if(Ia(l,S))C=l[S];else if(Ia(s,S))C=_;else if(l["*"])C=l["*"];else{if(!s["*"]){g.push(new _t(i,r[b],`unknown property "${b}"`));continue}C=_}g=g.concat(C({key:(i&&`${i}.`)+b,value:r[b],valueSpec:I,style:p,styleSpec:f,object:r,objectKey:b,validateSpec:_},r))}for(const b in s)l[b]||s[b].required&&s[b].default===void 0&&r[b]===void 0&&g.push(new _t(i,r,`missing required property "${b}"`));return g}function Bn(o){const i=o.value,r=o.valueSpec,s=o.style,l=o.styleSpec,p=o.key,f=o.arrayElementValidator||o.validateSpec;if(Jt(i)!=="array")return[new _t(p,i,`array expected, ${Jt(i)} found`)];if(r.length&&i.length!==r.length)return[new _t(p,i,`array length ${r.length} expected, length ${i.length} found`)];if(r["min-length"]&&i.length<r["min-length"])return[new _t(p,i,`array length at least ${r["min-length"]} expected, length ${i.length} found`)];let _={type:r.value,values:r.values};l.$version<7&&(_.function=r.function),Jt(r.value)==="object"&&(_=r.value);let g=[];for(let v=0;v<i.length;v++)g=g.concat(f({array:i,arrayIndex:v,value:i[v],valueSpec:_,validateSpec:o.validateSpec,style:s,styleSpec:l,key:`${p}[${v}]`}));return g}function Ds(o){const i=o.key,r=o.value,s=o.valueSpec;let l=Jt(r);return l==="number"&&r!=r&&(l="NaN"),l!=="number"?[new _t(i,r,`number expected, ${l} found`)]:"minimum"in s&&r<s.minimum?[new _t(i,r,`${r} is less than the minimum value ${s.minimum}`)]:"maximum"in s&&r>s.maximum?[new _t(i,r,`${r} is greater than the maximum value ${s.maximum}`)]:[]}function Ql(o){const i=o.valueSpec,r=ve(o.value.type);let s,l,p,f={};const _=r!=="categorical"&&o.value.property===void 0,g=!_,v=Jt(o.value.stops)==="array"&&Jt(o.value.stops[0])==="array"&&Jt(o.value.stops[0][0])==="object",b=Gi({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(C){if(r==="identity")return[new _t(C.key,C.value,'identity function may not have a "stops" property')];let R=[];const L=C.value;return R=R.concat(Bn({key:C.key,value:L,valueSpec:C.valueSpec,validateSpec:C.validateSpec,style:C.style,styleSpec:C.styleSpec,arrayElementValidator:S})),Jt(L)==="array"&&L.length===0&&R.push(new _t(C.key,L,"array must have at least one stop")),R},default:function(C){return C.validateSpec({key:C.key,value:C.value,valueSpec:i,validateSpec:C.validateSpec,style:C.style,styleSpec:C.styleSpec})}}});return r==="identity"&&_&&b.push(new _t(o.key,o.value,'missing required property "property"')),r==="identity"||o.value.stops||b.push(new _t(o.key,o.value,'missing required property "stops"')),r==="exponential"&&o.valueSpec.expression&&!Rn(o.valueSpec)&&b.push(new _t(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(g&&!Yo(o.valueSpec)?b.push(new _t(o.key,o.value,"property functions not supported")):_&&!Gl(o.valueSpec)&&b.push(new _t(o.key,o.value,"zoom functions not supported"))),r!=="categorical"&&!v||o.value.property!==void 0||b.push(new _t(o.key,o.value,'"property" property is required')),b;function S(C){let R=[];const L=C.value,B=C.key;if(Jt(L)!=="array")return[new _t(B,L,`array expected, ${Jt(L)} found`)];if(L.length!==2)return[new _t(B,L,`array length 2 expected, length ${L.length} found`)];if(v){if(Jt(L[0])!=="object")return[new _t(B,L,`object expected, ${Jt(L[0])} found`)];if(L[0].zoom===void 0)return[new _t(B,L,"object stop key must have zoom")];if(L[0].value===void 0)return[new _t(B,L,"object stop key must have value")];if(p&&p>ve(L[0].zoom))return[new _t(B,L[0].zoom,"stop zoom values must appear in ascending order")];ve(L[0].zoom)!==p&&(p=ve(L[0].zoom),l=void 0,f={}),R=R.concat(Gi({key:`${B}[0]`,value:L[0],valueSpec:{zoom:{}},validateSpec:C.validateSpec,style:C.style,styleSpec:C.styleSpec,objectElementValidators:{zoom:Ds,value:I}}))}else R=R.concat(I({key:`${B}[0]`,value:L[0]},L));return Is(yo(L[1]))?R.concat([new _t(`${B}[1]`,L[1],"expressions are not allowed in function stops.")]):R.concat(C.validateSpec({key:`${B}[1]`,value:L[1],valueSpec:i,validateSpec:C.validateSpec,style:C.style,styleSpec:C.styleSpec}))}function I(C,R){const L=Jt(C.value),B=ve(C.value),N=C.value!==null?C.value:R;if(s){if(L!==s)return[new _t(C.key,N,`${L} stop domain type must match previous stop domain type ${s}`)]}else s=L;if(L!=="number"&&L!=="string"&&L!=="boolean")return[new _t(C.key,N,"stop domain value must be a number, string, or boolean")];if(L!=="number"&&r!=="categorical"){let it=`number expected, ${L} found`;return Yo(i)&&r===void 0&&(it+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _t(C.key,N,it)]}return r!=="categorical"||L!=="number"||isFinite(B)&&Math.floor(B)===B?r!=="categorical"&&L==="number"&&l!==void 0&&B<l?[new _t(C.key,N,"stop domain values must appear in ascending order")]:(l=B,r==="categorical"&&B in f?[new _t(C.key,N,"stop domain values must be unique")]:(f[B]=!0,[])):[new _t(C.key,N,`integer expected, found ${B}`)]}}function ia(o){const i=(o.expressionContext==="property"?Xl:Cs)(yo(o.value),o.valueSpec);if(i.result==="error")return i.value.map((s=>new _t(`${o.key}${s.key}`,o.value,s.message)));const r=i.value.expression||i.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!r.outputDefined())return[new _t(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Da(r))return[new _t(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!Da(r))return[new _t(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Ss(r,["zoom","feature-state"]))return[new _t(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Ts(r))return[new _t(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ls(o){const i=o.key,r=o.value,s=Jt(r);return s!=="string"?[new _t(i,r,`color expected, ${s} found`)]:Ut.parse(String(r))?[]:[new _t(i,r,`color expected, "${r}" found`)]}function ra(o){const i=o.key,r=o.value,s=o.valueSpec,l=[];return Array.isArray(s.values)?s.values.indexOf(ve(r))===-1&&l.push(new _t(i,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):Object.keys(s.values).indexOf(ve(r))===-1&&l.push(new _t(i,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),l}function oa(o){return Rs(yo(o.value))?ia(Me({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Jl(o)}function Jl(o){const i=o.value,r=o.key;if(Jt(i)!=="array")return[new _t(r,i,`array expected, ${Jt(i)} found`)];const s=o.styleSpec;let l,p=[];if(i.length<1)return[new _t(r,i,"filter array must have at least 1 element")];switch(p=p.concat(ra({key:`${r}[0]`,value:i[0],valueSpec:s.filter_operator})),ve(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&ve(i[1])==="$type"&&p.push(new _t(r,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&p.push(new _t(r,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(l=Jt(i[1]),l!=="string"&&p.push(new _t(`${r}[1]`,i[1],`string expected, ${l} found`)));for(let f=2;f<i.length;f++)l=Jt(i[f]),ve(i[1])==="$type"?p=p.concat(ra({key:`${r}[${f}]`,value:i[f],valueSpec:s.geometry_type})):l!=="string"&&l!=="number"&&l!=="boolean"&&p.push(new _t(`${r}[${f}]`,i[f],`string, number, or boolean expected, ${l} found`));break;case"any":case"all":case"none":for(let f=1;f<i.length;f++)p=p.concat(Jl({key:`${r}[${f}]`,value:i[f],styleSpec:o.styleSpec}));break;case"has":case"!has":l=Jt(i[1]),i.length!==2?p.push(new _t(r,i,`filter array for "${i[0]}" operator must have 2 elements`)):l!=="string"&&p.push(new _t(`${r}[1]`,i[1],`string expected, ${l} found`))}return p}function On(o,i){const r=o.key,s=o.validateSpec,l=o.style,p=o.styleSpec,f=o.value,_=o.objectKey,g=p[`${i}_${o.layerType}`];if(!g)return[];const v=_.match(/^(.*)-transition$/);if(i==="paint"&&v&&g[v[1]]&&g[v[1]].transition)return s({key:r,value:f,valueSpec:p.transition,style:l,styleSpec:p});const b=o.valueSpec||g[_];if(!b)return[new _t(r,f,`unknown property "${_}"`)];let S;if(Jt(f)==="string"&&Yo(b)&&!b.tokens&&(S=/^{([^}]+)}$/.exec(f)))return[new _t(r,f,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(S[1])} }\`.`)];const I=[];return o.layerType==="symbol"&&(_==="text-field"&&l&&!l.glyphs&&I.push(new _t(r,f,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Qo(yo(f))&&ve(f.type)==="identity"&&I.push(new _t(r,f,'"text-font" does not support identity functions'))),I.concat(s({key:o.key,value:f,valueSpec:b,style:l,styleSpec:p,expressionContext:"property",propertyType:i,propertyKey:_}))}function jn(o){return On(o,"paint")}function tc(o){return On(o,"layout")}function Vn(o){let i=[];const r=o.value,s=o.key,l=o.style,p=o.styleSpec;if(Jt(r)!=="object")return[new _t(s,r,`object expected, ${Jt(r)} found`)];r.type||r.ref||i.push(new _t(s,r,'either "type" or "ref" is required'));let f=ve(r.type);const _=ve(r.ref);if(r.id){const g=ve(r.id);for(let v=0;v<o.arrayIndex;v++){const b=l.layers[v];ve(b.id)===g&&i.push(new _t(s,r.id,`duplicate layer id "${r.id}", previously used at line ${b.id.__line__}`))}}if("ref"in r){let g;["type","source","source-layer","filter","layout"].forEach((v=>{v in r&&i.push(new _t(s,r[v],`"${v}" is prohibited for ref layers`))})),l.layers.forEach((v=>{ve(v.id)===_&&(g=v)})),g?g.ref?i.push(new _t(s,r.ref,"ref cannot reference another ref layer")):f=ve(g.type):i.push(new _t(s,r.ref,`ref layer "${_}" not found`))}else if(f!=="background")if(r.source){const g=l.sources&&l.sources[r.source],v=g&&ve(g.type);g?v==="vector"&&f==="raster"?i.push(new _t(s,r.source,`layer "${r.id}" requires a raster source`)):v!=="raster-dem"&&f==="hillshade"||v!=="raster-dem"&&f==="color-relief"?i.push(new _t(s,r.source,`layer "${r.id}" requires a raster-dem source`)):v==="raster"&&f!=="raster"?i.push(new _t(s,r.source,`layer "${r.id}" requires a vector source`)):v!=="vector"||r["source-layer"]?v==="raster-dem"&&f!=="hillshade"&&f!=="color-relief"?i.push(new _t(s,r.source,"raster-dem source can only be used with layer type 'hillshade' or 'color-relief'.")):f!=="line"||!r.paint||!r.paint["line-gradient"]||v==="geojson"&&g.lineMetrics||i.push(new _t(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new _t(s,r,`layer "${r.id}" must specify a "source-layer"`)):i.push(new _t(s,r.source,`source "${r.source}" not found`))}else i.push(new _t(s,r,'missing required property "source"'));return i=i.concat(Gi({key:s,value:r,valueSpec:p.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${s}.type`,value:r.type,valueSpec:p.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:r,objectKey:"type"}),filter:oa,layout:g=>Gi({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":v=>tc(Me({layerType:f},v))}}),paint:g=>Gi({layer:r,key:g.key,value:g.value,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":v=>jn(Me({layerType:f},v))}})}})),i}function Vr(o){const i=o.value,r=o.key,s=Jt(i);return s!=="string"?[new _t(r,i,`string expected, ${s} found`)]:[]}const aa={promoteId:function({key:o,value:i}){if(Jt(i)==="string")return Vr({key:o,value:i});{const r=[];for(const s in i)r.push(...Vr({key:`${o}.${s}`,value:i[s]}));return r}}};function ec(o){const i=o.value,r=o.key,s=o.styleSpec,l=o.style,p=o.validateSpec;if(!i.type)return[new _t(r,i,'"type" is required')];const f=ve(i.type);let _;switch(f){case"vector":case"raster":return _=Gi({key:r,value:i,valueSpec:s[`source_${f.replace("-","_")}`],style:o.style,styleSpec:s,objectElementValidators:aa,validateSpec:p}),_;case"raster-dem":return _=(function(g){var v;const b=(v=g.sourceName)!==null&&v!==void 0?v:"",S=g.value,I=g.styleSpec,C=I.source_raster_dem,R=g.style;let L=[];const B=Jt(S);if(S===void 0)return L;if(B!=="object")return L.push(new _t("source_raster_dem",S,`object expected, ${B} found`)),L;const N=ve(S.encoding)==="custom",it=["redFactor","greenFactor","blueFactor","baseShift"],G=g.value.encoding?`"${g.value.encoding}"`:"Default";for(const K in S)!N&&it.includes(K)?L.push(new _t(K,S[K],`In "${b}": "${K}" is only valid when "encoding" is set to "custom". ${G} encoding found`)):C[K]?L=L.concat(g.validateSpec({key:K,value:S[K],valueSpec:C[K],validateSpec:g.validateSpec,style:R,styleSpec:I})):L.push(new _t(K,S[K],`unknown property "${K}"`));return L})({sourceName:r,value:i,style:o.style,styleSpec:s,validateSpec:p}),_;case"geojson":if(_=Gi({key:r,value:i,valueSpec:s.source_geojson,style:l,styleSpec:s,validateSpec:p,objectElementValidators:aa}),i.cluster)for(const g in i.clusterProperties){const[v,b]=i.clusterProperties[g],S=typeof v=="string"?[v,["accumulated"],["get",g]]:v;_.push(...ia({key:`${r}.${g}.map`,value:b,expressionContext:"cluster-map"})),_.push(...ia({key:`${r}.${g}.reduce`,value:S,expressionContext:"cluster-reduce"}))}return _;case"video":return Gi({key:r,value:i,valueSpec:s.source_video,style:l,validateSpec:p,styleSpec:s});case"image":return Gi({key:r,value:i,valueSpec:s.source_image,style:l,validateSpec:p,styleSpec:s});case"canvas":return[new _t(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ra({key:`${r}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function ic(o){const i=o.value,r=o.styleSpec,s=r.light,l=o.style;let p=[];const f=Jt(i);if(i===void 0)return p;if(f!=="object")return p=p.concat([new _t("light",i,`object expected, ${f} found`)]),p;for(const _ in i){const g=_.match(/^(.*)-transition$/);p=p.concat(g&&s[g[1]]&&s[g[1]].transition?o.validateSpec({key:_,value:i[_],valueSpec:r.transition,validateSpec:o.validateSpec,style:l,styleSpec:r}):s[_]?o.validateSpec({key:_,value:i[_],valueSpec:s[_],validateSpec:o.validateSpec,style:l,styleSpec:r}):[new _t(_,i[_],`unknown property "${_}"`)])}return p}function rc(o){const i=o.value,r=o.styleSpec,s=r.sky,l=o.style,p=Jt(i);if(i===void 0)return[];if(p!=="object")return[new _t("sky",i,`object expected, ${p} found`)];let f=[];for(const _ in i)f=f.concat(s[_]?o.validateSpec({key:_,value:i[_],valueSpec:s[_],style:l,styleSpec:r}):[new _t(_,i[_],`unknown property "${_}"`)]);return f}function oc(o){const i=o.value,r=o.styleSpec,s=r.terrain,l=o.style;let p=[];const f=Jt(i);if(i===void 0)return p;if(f!=="object")return p=p.concat([new _t("terrain",i,`object expected, ${f} found`)]),p;for(const _ in i)p=p.concat(s[_]?o.validateSpec({key:_,value:i[_],valueSpec:s[_],validateSpec:o.validateSpec,style:l,styleSpec:r}):[new _t(_,i[_],`unknown property "${_}"`)]);return p}function ac(o){let i=[];const r=o.value,s=o.key;if(Array.isArray(r)){const l=[],p=[];for(const f in r)r[f].id&&l.includes(r[f].id)&&i.push(new _t(s,r,`all the sprites' ids must be unique, but ${r[f].id} is duplicated`)),l.push(r[f].id),r[f].url&&p.includes(r[f].url)&&i.push(new _t(s,r,`all the sprites' URLs must be unique, but ${r[f].url} is duplicated`)),p.push(r[f].url),i=i.concat(Gi({key:`${s}[${f}]`,value:r[f],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return i}return Vr({key:s,value:r})}function sc(o){return i=o.value,i&&i.constructor===Object?[]:[new _t(o.key,o.value,`object expected, ${Jt(o.value)} found`)];var i}const sa={"*":()=>[],array:Bn,boolean:function(o){const i=o.value,r=o.key,s=Jt(i);return s!=="boolean"?[new _t(r,i,`boolean expected, ${s} found`)]:[]},number:Ds,color:Ls,constants:ks,enum:ra,filter:oa,function:Ql,layer:Vn,object:Gi,source:ec,light:ic,sky:rc,terrain:oc,projection:function(o){const i=o.value,r=o.styleSpec,s=r.projection,l=o.style,p=Jt(i);if(i===void 0)return[];if(p!=="object")return[new _t("projection",i,`object expected, ${p} found`)];let f=[];for(const _ in i)f=f.concat(s[_]?o.validateSpec({key:_,value:i[_],valueSpec:s[_],style:l,styleSpec:r}):[new _t(_,i[_],`unknown property "${_}"`)]);return f},projectionDefinition:function(o){const i=o.key;let r=o.value;r=r instanceof String?r.valueOf():r;const s=Jt(r);return s!=="array"||(function(l){return Array.isArray(l)&&l.length===3&&typeof l[0]=="string"&&typeof l[1]=="string"&&typeof l[2]=="number"})(r)||(function(l){return!!["interpolate","step","literal"].includes(l[0])})(r)?["array","string"].includes(s)?[]:[new _t(i,r,`projection expected, invalid type "${s}" found`)]:[new _t(i,r,`projection expected, invalid array ${JSON.stringify(r)} found`)]},string:Vr,formatted:function(o){return Vr(o).length===0?[]:ia(o)},resolvedImage:function(o){return Vr(o).length===0?[]:ia(o)},padding:function(o){const i=o.key,r=o.value;if(Jt(r)==="array"){if(r.length<1||r.length>4)return[new _t(i,r,`padding requires 1 to 4 values; ${r.length} values found`)];const s={type:"number"};let l=[];for(let p=0;p<r.length;p++)l=l.concat(o.validateSpec({key:`${i}[${p}]`,value:r[p],validateSpec:o.validateSpec,valueSpec:s}));return l}return Ds({key:i,value:r,valueSpec:{}})},numberArray:function(o){const i=o.key,r=o.value;if(Jt(r)==="array"){const s={type:"number"};if(r.length<1)return[new _t(i,r,"array length at least 1 expected, length 0 found")];let l=[];for(let p=0;p<r.length;p++)l=l.concat(o.validateSpec({key:`${i}[${p}]`,value:r[p],validateSpec:o.validateSpec,valueSpec:s}));return l}return Ds({key:i,value:r,valueSpec:{}})},colorArray:function(o){const i=o.key,r=o.value;if(Jt(r)==="array"){if(r.length<1)return[new _t(i,r,"array length at least 1 expected, length 0 found")];let s=[];for(let l=0;l<r.length;l++)s=s.concat(Ls({key:`${i}[${l}]`,value:r[l]}));return s}return Ls({key:i,value:r})},variableAnchorOffsetCollection:function(o){const i=o.key,r=o.value,s=Jt(r),l=o.styleSpec;if(s!=="array"||r.length<1||r.length%2!=0)return[new _t(i,r,"variableAnchorOffsetCollection requires a non-empty array of even length")];let p=[];for(let f=0;f<r.length;f+=2)p=p.concat(ra({key:`${i}[${f}]`,value:r[f],valueSpec:l.layout_symbol["text-anchor"]})),p=p.concat(Bn({key:`${i}[${f+1}]`,value:r[f+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:l}));return p},sprite:ac,state:sc};function Nr(o){const i=o.value,r=o.valueSpec,s=o.styleSpec;return o.validateSpec=Nr,r.expression&&Qo(ve(i))?Ql(o):r.expression&&Is(yo(i))?ia(o):r.type&&sa[r.type]?sa[r.type](o):Gi(Me({},o,{valueSpec:r.type?s[r.type]:r}))}function Ai(o){const i=o.value,r=o.key,s=Vr(o);return s.length||(i.indexOf("{fontstack}")===-1&&s.push(new _t(r,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&s.push(new _t(r,i,'"glyphs" url must include a "{range}" token'))),s}function pi(o,i=rt){let r=[];return r=r.concat(Nr({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,validateSpec:Nr,objectElementValidators:{glyphs:Ai,"*":()=>[]}})),o.constants&&(r=r.concat(ks({key:"constants",value:o.constants}))),nc(r)}function qi(o){return function(i){return o(Object.assign({},i,{validateSpec:Nr}))}}function nc(o){return[].concat(o).sort(((i,r)=>i.line-r.line))}function Qi(o){return function(...i){return nc(o.apply(this,i))}}pi.source=Qi(qi(ec)),pi.sprite=Qi(qi(ac)),pi.glyphs=Qi(qi(Ai)),pi.light=Qi(qi(ic)),pi.sky=Qi(qi(rc)),pi.terrain=Qi(qi(oc)),pi.state=Qi(qi(sc)),pi.layer=Qi(qi(Vn)),pi.filter=Qi(qi(oa)),pi.paintProperty=Qi(qi(jn)),pi.layoutProperty=Qi(qi(tc));const hr=pi,lc=hr.light,Nn=hr.sky,lh=hr.paintProperty,Un=hr.layoutProperty;function cc(o,i){let r=!1;if(i&&i.length)for(const s of i)o.fire(new pt(new Error(s.message))),r=!0;return r}class Mr{constructor(i,r,s){const l=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const f=new Int32Array(this.arrayBuffer);i=f[0],this.d=(r=f[1])+2*(s=f[2]);for(let g=0;g<this.d*this.d;g++){const v=f[3+g],b=f[3+g+1];l.push(v===b?null:f.subarray(v,b))}const _=f[3+l.length+1];this.keys=f.subarray(f[3+l.length],_),this.bboxes=f.subarray(_),this.insert=this._insertReadonly}else{this.d=r+2*s;for(let f=0;f<this.d*this.d;f++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=i,this.padding=s,this.scale=r/i,this.uid=0;const p=s/r*i;this.min=-p,this.max=i+p}insert(i,r,s,l,p){this._forEachCell(r,s,l,p,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(p)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,r,s,l,p,f){this.cells[p].push(f)}query(i,r,s,l,p){const f=this.min,_=this.max;if(i<=f&&r<=f&&_<=s&&_<=l&&!p)return Array.prototype.slice.call(this.keys);{const g=[];return this._forEachCell(i,r,s,l,this._queryCell,g,{},p),g}}_queryCell(i,r,s,l,p,f,_,g){const v=this.cells[p];if(v!==null){const b=this.keys,S=this.bboxes;for(let I=0;I<v.length;I++){const C=v[I];if(_[C]===void 0){const R=4*C;(g?g(S[R+0],S[R+1],S[R+2],S[R+3]):i<=S[R+2]&&r<=S[R+3]&&s>=S[R+0]&&l>=S[R+1])?(_[C]=!0,f.push(b[C])):_[C]=!1}}}}_forEachCell(i,r,s,l,p,f,_,g){const v=this._convertToCellCoord(i),b=this._convertToCellCoord(r),S=this._convertToCellCoord(s),I=this._convertToCellCoord(l);for(let C=v;C<=S;C++)for(let R=b;R<=I;R++){const L=this.d*R+C;if((!g||g(this._convertFromCellCoord(C),this._convertFromCellCoord(R),this._convertFromCellCoord(C+1),this._convertFromCellCoord(R+1)))&&p.call(this,i,r,s,l,L,f,_,g))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,r=3+this.cells.length+1+1;let s=0;for(let f=0;f<this.cells.length;f++)s+=this.cells[f].length;const l=new Int32Array(r+s+this.keys.length+this.bboxes.length);l[0]=this.extent,l[1]=this.n,l[2]=this.padding;let p=r;for(let f=0;f<i.length;f++){const _=i[f];l[3+f]=p,l.set(_,p),p+=_.length}return l[3+i.length]=p,l.set(this.keys,p),p+=this.keys.length,l[3+i.length+1]=p,l.set(this.bboxes,p),p+=this.bboxes.length,l.buffer}static serialize(i,r){const s=i.toArrayBuffer();return r&&r.push(s),{buffer:s}}static deserialize(i){return new Mr(i.buffer)}}const Ir={};function Ct(o,i,r={}){if(Ir[o])throw new Error(`${o} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:o,writeable:!1}),Ir[o]={klass:i,omit:r.omit||[],shallow:r.shallow||[]}}Ct("Object",Object),Ct("Set",Set),Ct("TransferableGridIndex",Mr),Ct("Color",Ut),Ct("Error",Error),Ct("AJAXError",q),Ct("ResolvedImage",si),Ct("StylePropertyFunction",Fa),Ct("StyleExpression",Ms,{omit:["_evaluator"]}),Ct("ZoomDependentExpression",En),Ct("ZoomConstantExpression",As),Ct("CompoundExpression",Zi,{omit:["_evaluate"]});for(const o in Xo)Xo[o]._classRegistryKey||Ct(`Expression_${o}`,Xo[o]);function hc(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function xo(o){return o.$name||o.constructor._classRegistryKey}function uc(o){return!(function(i){if(i===null||typeof i!="object")return!1;const r=xo(i);return!(!r||r==="Object")})(o)&&(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||hc(o)||vr(o)||ArrayBuffer.isView(o)||o instanceof ImageData)}function ja(o,i){if(uc(o))return(hc(o)||vr(o))&&i&&i.push(o),ArrayBuffer.isView(o)&&i&&i.push(o.buffer),o instanceof ImageData&&i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const p=[];for(const f of o)p.push(ja(f,i));return p}if(typeof o!="object")throw new Error("can't serialize object of type "+typeof o);const r=xo(o);if(!r)throw new Error(`can't serialize object of unregistered class ${o.constructor.name}`);if(!Ir[r])throw new Error(`${r} is not registered.`);const{klass:s}=Ir[r],l=s.serialize?s.serialize(o,i):{};if(s.serialize){if(i&&l===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const p in o){if(!o.hasOwnProperty(p)||Ir[r].omit.indexOf(p)>=0)continue;const f=o[p];l[p]=Ir[r].shallow.indexOf(p)>=0?f:ja(f,i)}o instanceof Error&&(l.message=o.message)}if(l.$name)throw new Error("$name property is reserved for worker serialization logic.");return r!=="Object"&&(l.$name=r),l}function Ur(o){if(uc(o))return o;if(Array.isArray(o))return o.map(Ur);if(typeof o!="object")throw new Error("can't deserialize object of type "+typeof o);const i=xo(o)||"Object";if(!Ir[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:r}=Ir[i];if(!r)throw new Error(`can't deserialize unregistered class ${i}`);if(r.deserialize)return r.deserialize(o);const s=Object.create(r.prototype);for(const l of Object.keys(o)){if(l==="$name")continue;const p=o[l];s[l]=Ir[i].shallow.indexOf(l)>=0?p:Ur(p)}return s}class $n{constructor(){this.first=!0}update(i,r){const s=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=s,!0))}}const Qt={"Latin-1 Supplement":o=>o>=128&&o<=255,"Hangul Jamo":o=>o>=4352&&o<=4607,Khmer:o=>o>=6016&&o<=6143,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Kanbun:o=>o>=12688&&o<=12703,"CJK Strokes":o=>o>=12736&&o<=12783,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Hangul Syllables":o=>o>=44032&&o<=55215,"Private Use Area":o=>o>=57344&&o<=63743,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function na(o){for(const i of o)if(Os(i.charCodeAt(0)))return!0;return!1}function dc(o){for(const i of o)if(!fc(i.charCodeAt(0)))return!1;return!0}function Fs(o){const i=o.map((r=>{try{return new RegExp(`\\p{sc=${r}}`,"u").source}catch{return null}})).filter((r=>r));return new RegExp(i.join("|"),"u")}const pc=Fs(["Arab","Dupl","Mong","Ougr","Syrc"]);function fc(o){return!pc.test(String.fromCodePoint(o))}const Bs=Fs(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function Os(o){return!(o!==746&&o!==747&&(o<4352||!(Qt["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||Qt["CJK Compatibility"](o)||Qt["CJK Strokes"](o)||!(!Qt["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||Qt["Enclosed CJK Letters and Months"](o)||Qt["Ideographic Description Characters"](o)||Qt.Kanbun(o)||Qt.Katakana(o)&&o!==12540||!(!Qt["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!Qt["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||Qt["Vertical Forms"](o)||Qt["Yijing Hexagram Symbols"](o)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(o))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(o))||Bs.test(String.fromCodePoint(o)))))}function mc(o){return!(Os(o)||(function(i){return!!(Qt["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||Qt["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||Qt["Letterlike Symbols"](i)||Qt["Number Forms"](i)||Qt["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||Qt["Control Pictures"](i)&&i!==9251||Qt["Optical Character Recognition"](i)||Qt["Enclosed Alphanumerics"](i)||Qt["Geometric Shapes"](i)||Qt["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||Qt["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Qt["CJK Symbols and Punctuation"](i)||Qt.Katakana(i)||Qt["Private Use Area"](i)||Qt["CJK Compatibility Forms"](i)||Qt["Small Form Variants"](i)||Qt["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)})(o))}const _c=Fs(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function gc(o){return _c.test(String.fromCodePoint(o))}function yc(o,i){return!(!i&&gc(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||Qt.Khmer(o))}function ch(o){for(const i of o)if(gc(i.charCodeAt(0)))return!0;return!1}const Cr=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){if(Cr.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(o,i){return h(this,void 0,void 0,(function*(){if(this.isParsed())return this.getState();if(o.pluginStatus!=="loading")return this.setState(o),o;const r=o.pluginURL,s=new Promise((p=>{this.loadScriptResolve=p}));i(r);const l=new Promise((p=>setTimeout((()=>p()),this.TIMEOUT)));if(yield Promise.race([s,l]),this.isParsed()){const p={pluginStatus:"loaded",pluginURL:r};return this.setState(p),p}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${r}`)}))}};class ce{constructor(i,r){this.isSupportedScript=hh,this.zoom=i,r?(this.now=r.now||0,this.fadeDuration=r.fadeDuration||0,this.zoomHistory=r.zoomHistory||new $n,this.transition=r.transition||{}):(this.now=0,this.fadeDuration=0,this.zoomHistory=new $n,this.transition={})}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,r=i-Math.floor(i),s=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}function hh(o){return(function(i,r){for(const s of i)if(!yc(s.charCodeAt(0),r))return!1;return!0})(o,Cr.getRTLTextPluginStatus()==="loaded")}class js{constructor(i,r,s){this.property=i,this.value=r,this.expression=(function(l,p,f){if(Qo(l))return new Fa(l,p);if(Is(l)){const _=Xl(l,p,f);if(_.result==="error")throw new Error(_.value.map((g=>`${g.key}: ${g.message}`)).join(", "));return _.value}{let _=l;return p.type==="color"&&typeof l=="string"?_=Ut.parse(l):p.type!=="padding"||typeof l!="number"&&!Array.isArray(l)?p.type!=="numberArray"||typeof l!="number"&&!Array.isArray(l)?p.type!=="colorArray"||typeof l!="string"&&!Array.isArray(l)?p.type==="variableAnchorOffsetCollection"&&Array.isArray(l)?_=ai.parse(l):p.type==="projectionDefinition"&&typeof l=="string"&&(_=Ci.parse(l)):_=Ne.parse(l):_=di.parse(l):_=He.parse(l),{globalStateRefs:new Set,_globalState:null,kind:"constant",evaluate:()=>_}}})(r===void 0?i.specification.default:r,i.specification,s)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}getGlobalStateRefs(){return this.expression.globalStateRefs||new Set}possiblyEvaluate(i,r,s){return this.property.possiblyEvaluate(this,i,r,s)}}class Vs{constructor(i,r){this.property=i,this.value=new js(i,void 0,r)}transitioned(i,r){return new Gn(this.property,this.value,r,Li({},i.transition,this.transition),i.now)}untransitioned(){return new Gn(this.property,this.value,null,{},0)}}class Zn{constructor(i,r){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues),this._globalState=r}getValue(i){return Fi(this._values[i].value.value)}setValue(i,r){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Vs(this._values[i].property,this._globalState)),this._values[i].value=new js(this._values[i].property,r===null?void 0:Fi(r),this._globalState)}getTransition(i){return Fi(this._values[i].transition)}setTransition(i,r){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Vs(this._values[i].property,this._globalState)),this._values[i].transition=Fi(r)||void 0}serialize(){const i={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(i[r]=s);const l=this.getTransition(r);l!==void 0&&(i[`${r}-transition`]=l)}return i}transitioned(i,r){const s=new qn(this._properties);for(const l of Object.keys(this._values))s._values[l]=this._values[l].transitioned(i,r._values[l]);return s}untransitioned(){const i=new qn(this._properties);for(const r of Object.keys(this._values))i._values[r]=this._values[r].untransitioned();return i}}class Gn{constructor(i,r,s,l,p){this.property=i,this.value=r,this.begin=p+l.delay||0,this.end=this.begin+l.duration||0,i.specification.transition&&(l.delay||l.duration)&&(this.prior=s)}possiblyEvaluate(i,r,s){const l=i.now||0,p=this.value.possiblyEvaluate(i,r,s),f=this.prior;if(f){if(l>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(l<this.begin)return f.possiblyEvaluate(i,r,s);{const _=(l-this.begin)/(this.end-this.begin);return this.property.interpolate(f.possiblyEvaluate(i,r,s),p,Hi(_))}}return p}}class qn{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,r,s){const l=new la(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].possiblyEvaluate(i,r,s);return l}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Ns{constructor(i,r){this._properties=i,this._values=Object.create(i.defaultPropertyValues),this._globalState=r}hasValue(i){return this._values[i].value!==void 0}getValue(i){return Fi(this._values[i].value)}setValue(i,r){this._values[i]=new js(this._values[i].property,r===null?void 0:Fi(r),this._globalState)}serialize(){const i={};for(const r of Object.keys(this._values)){const s=this.getValue(r);s!==void 0&&(i[r]=s)}return i}possiblyEvaluate(i,r,s){const l=new la(this._properties);for(const p of Object.keys(this._values))l._values[p]=this._values[p].possiblyEvaluate(i,r,s);return l}}class ur{constructor(i,r,s){this.property=i,this.value=r,this.parameters=s}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,r,s,l){return this.property.evaluate(this.value,this.parameters,i,r,s,l)}}class la{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Rt{constructor(i){this.specification=i}possiblyEvaluate(i,r){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(r)}interpolate(i,r,s){const l=wi[this.specification.type];return l?l(i,r,s):i}}class Ft{constructor(i,r){this.specification=i,this.overrides=r}possiblyEvaluate(i,r,s,l){return new ur(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(r,null,{},s,l)}:i.expression,r)}interpolate(i,r,s){if(i.value.kind!=="constant"||r.value.kind!=="constant")return i;if(i.value.value===void 0||r.value.value===void 0)return new ur(this,{kind:"constant",value:void 0},i.parameters);const l=wi[this.specification.type];if(l){const p=l(i.value.value,r.value.value,s);return new ur(this,{kind:"constant",value:p},i.parameters)}return i}evaluate(i,r,s,l,p,f){return i.kind==="constant"?i.value:i.evaluate(r,s,l,p,f)}}class ca extends Ft{possiblyEvaluate(i,r,s,l){if(i.value===void 0)return new ur(this,{kind:"constant",value:void 0},r);if(i.expression.kind==="constant"){const p=i.expression.evaluate(r,null,{},s,l),f=i.property.specification.type==="resolvedImage"&&typeof p!="string"?p.name:p,_=this._calculate(f,f,f,r);return new ur(this,{kind:"constant",value:_},r)}if(i.expression.kind==="camera"){const p=this._calculate(i.expression.evaluate({zoom:r.zoom-1}),i.expression.evaluate({zoom:r.zoom}),i.expression.evaluate({zoom:r.zoom+1}),r);return new ur(this,{kind:"constant",value:p},r)}return new ur(this,i.expression,r)}evaluate(i,r,s,l,p,f){if(i.kind==="source"){const _=i.evaluate(r,s,l,p,f);return this._calculate(_,_,_,r)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(r.zoom)-1},s,l),i.evaluate({zoom:Math.floor(r.zoom)},s,l),i.evaluate({zoom:Math.floor(r.zoom)+1},s,l),r):i.value}_calculate(i,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:i,to:r}:{from:s,to:r}}interpolate(i){return i}}class Wn{constructor(i){this.specification=i}possiblyEvaluate(i,r,s,l){if(i.value!==void 0){if(i.expression.kind==="constant"){const p=i.expression.evaluate(r,null,{},s,l);return this._calculate(p,p,p,r)}return this._calculate(i.expression.evaluate(new ce(Math.floor(r.zoom-1),r)),i.expression.evaluate(new ce(Math.floor(r.zoom),r)),i.expression.evaluate(new ce(Math.floor(r.zoom+1),r)),r)}}_calculate(i,r,s,l){return l.zoom>l.zoomHistory.lastIntegerZoom?{from:i,to:r}:{from:s,to:r}}interpolate(i){return i}}class Va{constructor(i){this.specification=i}possiblyEvaluate(i,r,s,l){return!!i.expression.evaluate(r,null,{},s,l)}interpolate(){return!1}}class Ti{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in i){const s=i[r];s.specification.overridable&&this.overridableProperties.push(r);const l=this.defaultPropertyValues[r]=new js(s,void 0,void 0),p=this.defaultTransitionablePropertyValues[r]=new Vs(s,void 0);this.defaultTransitioningPropertyValues[r]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=l.possiblyEvaluate({})}}}Ct("DataDrivenProperty",Ft),Ct("DataConstantProperty",Rt),Ct("CrossFadedDataDrivenProperty",ca),Ct("CrossFadedProperty",Wn),Ct("ColorRampProperty",Va);const xc="-transition";class Ji extends Et{constructor(i,r,s){if(super(),this.id=i.id,this.type=i.type,this._globalState=s,this._featureFilter={filter:()=>!0,needGeometry:!1,getGlobalStateRefs:()=>new Set},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter,this._featureFilter=ta(i.filter,s)),r.layout&&(this._unevaluatedLayout=new Ns(r.layout,s)),r.paint)){this._transitionablePaint=new Zn(r.paint,s);for(const l in i.paint)this.setPaintProperty(l,i.paint[l],{validate:!1});for(const l in i.layout)this.setLayoutProperty(l,i.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new la(r.paint)}}setFilter(i){this.filter=i,this._featureFilter=ta(i,this._globalState)}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}getLayoutAffectingGlobalStateRefs(){const i=new Set;if(this._unevaluatedLayout)for(const r in this._unevaluatedLayout._values){const s=this._unevaluatedLayout._values[r];for(const l of s.getGlobalStateRefs())i.add(l)}for(const r of this._featureFilter.getGlobalStateRefs())i.add(r);return i}getPaintAffectingGlobalStateRefs(){var i;const r=new globalThis.Map;if(this._transitionablePaint)for(const s in this._transitionablePaint._values){const l=this._transitionablePaint._values[s].value;for(const p of l.getGlobalStateRefs()){const f=(i=r.get(p))!==null&&i!==void 0?i:[];f.push({name:s,value:l.value}),r.set(p,f)}}return r}setLayoutProperty(i,r,s={}){r!=null&&this._validate(Un,`layers.${this.id}.layout.${i}`,i,r,s)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,r):this.visibility=r)}getPaintProperty(i){return i.endsWith(xc)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,r,s={}){if(r!=null&&this._validate(lh,`layers.${this.id}.paint.${i}`,i,r,s))return!1;if(i.endsWith(xc))return this._transitionablePaint.setTransition(i.slice(0,-11),r||void 0),!1;{const l=this._transitionablePaint._values[i],p=l.property.specification["property-type"]==="cross-faded-data-driven",f=l.value.isDataDriven(),_=l.value;this._transitionablePaint.setValue(i,r),this._handleSpecialPaintPropertyUpdate(i);const g=this._transitionablePaint._values[i].value;return g.isDataDriven()||f||p||this._handleOverridablePaintPropertyUpdate(i,_,g)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,r,s){return!1}isHidden(i,r=!1){return!!(this.minzoom&&i<(r?Math.floor(this.minzoom):this.minzoom))||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,r){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,r)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),wa(i,((r,s)=>!(r===void 0||s==="layout"&&!Object.keys(r).length||s==="paint"&&!Object.keys(r).length)))}_validate(i,r,s,l,p={}){return(!p||p.validate!==!1)&&cc(this,i.call(hr,{key:r,layerType:this.type,objectKey:s,value:l,styleSpec:rt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const r=this.paint.get(i);if(r instanceof ur&&Yo(r.property.specification)&&(r.value.kind==="source"||r.value.kind==="composite")&&r.value.isStateDependent)return!0}return!1}}let vc;var uh={get paint(){return vc=vc||new Ti({"raster-opacity":new Rt(rt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Rt(rt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Rt(rt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Rt(rt.paint_raster["raster-brightness-max"]),"raster-saturation":new Rt(rt.paint_raster["raster-saturation"]),"raster-contrast":new Rt(rt.paint_raster["raster-contrast"]),"raster-resampling":new Rt(rt.paint_raster["raster-resampling"]),"raster-fade-duration":new Rt(rt.paint_raster["raster-fade-duration"])})}};class ha extends Ji{constructor(i,r){super(i,uh,r)}}const dh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Na{constructor(i,r){this._structArray=i,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Te{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,r){return i._trim(),r&&(i.isTransferred=!0,r.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const r=Object.create(this.prototype);return r.arrayBuffer=i.arrayBuffer,r.length=i.length,r.capacity=i.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ie(o,i=1){let r=0,s=0;return{members:o.map((l=>{const p=dh[l.type].BYTES_PER_ELEMENT,f=r=bc(r,Math.max(i,p)),_=l.components||1;return s=Math.max(s,p),r+=p*_,{name:l.name,type:l.type,components:_,offset:f}})),size:bc(r,Math.max(s,i)),alignment:i}}function bc(o,i){return Math.ceil(o/i)*i}class Ua extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r){const s=this.length;return this.resize(s+1),this.emplace(s,i,r)}emplace(i,r,s){const l=2*i;return this.int16[l+0]=r,this.int16[l+1]=s,i}}Ua.prototype.bytesPerElement=4,Ct("StructArrayLayout2i4",Ua);class dr extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,i,r,s)}emplace(i,r,s,l){const p=3*i;return this.int16[p+0]=r,this.int16[p+1]=s,this.int16[p+2]=l,i}}dr.prototype.bytesPerElement=6,Ct("StructArrayLayout3i6",dr);class Us extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,i,r,s,l)}emplace(i,r,s,l,p){const f=4*i;return this.int16[f+0]=r,this.int16[f+1]=s,this.int16[f+2]=l,this.int16[f+3]=p,i}}Us.prototype.bytesPerElement=8,Ct("StructArrayLayout4i8",Us);class $a extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r,s,l,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,i,r,s,l,p,f)}emplace(i,r,s,l,p,f,_){const g=6*i;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=l,this.int16[g+3]=p,this.int16[g+4]=f,this.int16[g+5]=_,i}}$a.prototype.bytesPerElement=12,Ct("StructArrayLayout2i4i12",$a);class $s extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r,s,l,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,i,r,s,l,p,f)}emplace(i,r,s,l,p,f,_){const g=4*i,v=8*i;return this.int16[g+0]=r,this.int16[g+1]=s,this.uint8[v+4]=l,this.uint8[v+5]=p,this.uint8[v+6]=f,this.uint8[v+7]=_,i}}$s.prototype.bytesPerElement=8,Ct("StructArrayLayout2i4ub8",$s);class vo extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r){const s=this.length;return this.resize(s+1),this.emplace(s,i,r)}emplace(i,r,s){const l=2*i;return this.float32[l+0]=r,this.float32[l+1]=s,i}}vo.prototype.bytesPerElement=8,Ct("StructArrayLayout2f8",vo);class Hn extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r,s,l,p,f,_,g,v,b){const S=this.length;return this.resize(S+1),this.emplace(S,i,r,s,l,p,f,_,g,v,b)}emplace(i,r,s,l,p,f,_,g,v,b,S){const I=10*i;return this.uint16[I+0]=r,this.uint16[I+1]=s,this.uint16[I+2]=l,this.uint16[I+3]=p,this.uint16[I+4]=f,this.uint16[I+5]=_,this.uint16[I+6]=g,this.uint16[I+7]=v,this.uint16[I+8]=b,this.uint16[I+9]=S,i}}Hn.prototype.bytesPerElement=20,Ct("StructArrayLayout10ui20",Hn);class ua extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r,s,l,p,f,_,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,r,s,l,p,f,_,g)}emplace(i,r,s,l,p,f,_,g,v){const b=8*i;return this.uint16[b+0]=r,this.uint16[b+1]=s,this.uint16[b+2]=l,this.uint16[b+3]=p,this.uint16[b+4]=f,this.uint16[b+5]=_,this.uint16[b+6]=g,this.uint16[b+7]=v,i}}ua.prototype.bytesPerElement=16,Ct("StructArrayLayout8ui16",ua);class bo extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r,s,l,p,f,_,g,v,b,S,I){const C=this.length;return this.resize(C+1),this.emplace(C,i,r,s,l,p,f,_,g,v,b,S,I)}emplace(i,r,s,l,p,f,_,g,v,b,S,I,C){const R=12*i;return this.int16[R+0]=r,this.int16[R+1]=s,this.int16[R+2]=l,this.int16[R+3]=p,this.uint16[R+4]=f,this.uint16[R+5]=_,this.uint16[R+6]=g,this.uint16[R+7]=v,this.int16[R+8]=b,this.int16[R+9]=S,this.int16[R+10]=I,this.int16[R+11]=C,i}}bo.prototype.bytesPerElement=24,Ct("StructArrayLayout4i4ui4i24",bo);class Xn extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,i,r,s)}emplace(i,r,s,l){const p=3*i;return this.float32[p+0]=r,this.float32[p+1]=s,this.float32[p+2]=l,i}}Xn.prototype.bytesPerElement=12,Ct("StructArrayLayout3f12",Xn);class Zs extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const r=this.length;return this.resize(r+1),this.emplace(r,i)}emplace(i,r){return this.uint32[1*i+0]=r,i}}Zs.prototype.bytesPerElement=4,Ct("StructArrayLayout1ul4",Zs);class wo extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r,s,l,p,f,_,g,v){const b=this.length;return this.resize(b+1),this.emplace(b,i,r,s,l,p,f,_,g,v)}emplace(i,r,s,l,p,f,_,g,v,b){const S=10*i,I=5*i;return this.int16[S+0]=r,this.int16[S+1]=s,this.int16[S+2]=l,this.int16[S+3]=p,this.int16[S+4]=f,this.int16[S+5]=_,this.uint32[I+3]=g,this.uint16[S+8]=v,this.uint16[S+9]=b,i}}wo.prototype.bytesPerElement=20,Ct("StructArrayLayout6i1ul2ui20",wo);class Kn extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r,s,l,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,i,r,s,l,p,f)}emplace(i,r,s,l,p,f,_){const g=6*i;return this.int16[g+0]=r,this.int16[g+1]=s,this.int16[g+2]=l,this.int16[g+3]=p,this.int16[g+4]=f,this.int16[g+5]=_,i}}Kn.prototype.bytesPerElement=12,Ct("StructArrayLayout2i2i2i12",Kn);class Yn extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r,s,l,p){const f=this.length;return this.resize(f+1),this.emplace(f,i,r,s,l,p)}emplace(i,r,s,l,p,f){const _=4*i,g=8*i;return this.float32[_+0]=r,this.float32[_+1]=s,this.float32[_+2]=l,this.int16[g+6]=p,this.int16[g+7]=f,i}}Yn.prototype.bytesPerElement=16,Ct("StructArrayLayout2f1f2i16",Yn);class Gs extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,r,s,l,p,f){const _=this.length;return this.resize(_+1),this.emplace(_,i,r,s,l,p,f)}emplace(i,r,s,l,p,f,_){const g=16*i,v=4*i,b=8*i;return this.uint8[g+0]=r,this.uint8[g+1]=s,this.float32[v+1]=l,this.float32[v+2]=p,this.int16[b+6]=f,this.int16[b+7]=_,i}}Gs.prototype.bytesPerElement=16,Ct("StructArrayLayout2ub2f2i16",Gs);class qs extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,i,r,s)}emplace(i,r,s,l){const p=3*i;return this.uint16[p+0]=r,this.uint16[p+1]=s,this.uint16[p+2]=l,i}}qs.prototype.bytesPerElement=6,Ct("StructArrayLayout3ui6",qs);class u extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r,s,l,p,f,_,g,v,b,S,I,C,R,L,B,N){const it=this.length;return this.resize(it+1),this.emplace(it,i,r,s,l,p,f,_,g,v,b,S,I,C,R,L,B,N)}emplace(i,r,s,l,p,f,_,g,v,b,S,I,C,R,L,B,N,it){const G=24*i,K=12*i,at=48*i;return this.int16[G+0]=r,this.int16[G+1]=s,this.uint16[G+2]=l,this.uint16[G+3]=p,this.uint32[K+2]=f,this.uint32[K+3]=_,this.uint32[K+4]=g,this.uint16[G+10]=v,this.uint16[G+11]=b,this.uint16[G+12]=S,this.float32[K+7]=I,this.float32[K+8]=C,this.uint8[at+36]=R,this.uint8[at+37]=L,this.uint8[at+38]=B,this.uint32[K+10]=N,this.int16[G+22]=it,i}}u.prototype.bytesPerElement=48,Ct("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",u);class e extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r,s,l,p,f,_,g,v,b,S,I,C,R,L,B,N,it,G,K,at,dt,gt,Mt,bt,St,kt,Tt){const Pt=this.length;return this.resize(Pt+1),this.emplace(Pt,i,r,s,l,p,f,_,g,v,b,S,I,C,R,L,B,N,it,G,K,at,dt,gt,Mt,bt,St,kt,Tt)}emplace(i,r,s,l,p,f,_,g,v,b,S,I,C,R,L,B,N,it,G,K,at,dt,gt,Mt,bt,St,kt,Tt,Pt){const ft=32*i,Bt=16*i;return this.int16[ft+0]=r,this.int16[ft+1]=s,this.int16[ft+2]=l,this.int16[ft+3]=p,this.int16[ft+4]=f,this.int16[ft+5]=_,this.int16[ft+6]=g,this.int16[ft+7]=v,this.uint16[ft+8]=b,this.uint16[ft+9]=S,this.uint16[ft+10]=I,this.uint16[ft+11]=C,this.uint16[ft+12]=R,this.uint16[ft+13]=L,this.uint16[ft+14]=B,this.uint16[ft+15]=N,this.uint16[ft+16]=it,this.uint16[ft+17]=G,this.uint16[ft+18]=K,this.uint16[ft+19]=at,this.uint16[ft+20]=dt,this.uint16[ft+21]=gt,this.uint16[ft+22]=Mt,this.uint32[Bt+12]=bt,this.float32[Bt+13]=St,this.float32[Bt+14]=kt,this.uint16[ft+30]=Tt,this.uint16[ft+31]=Pt,i}}e.prototype.bytesPerElement=64,Ct("StructArrayLayout8i15ui1ul2f2ui64",e);class a extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const r=this.length;return this.resize(r+1),this.emplace(r,i)}emplace(i,r){return this.float32[1*i+0]=r,i}}a.prototype.bytesPerElement=4,Ct("StructArrayLayout1f4",a);class n extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,i,r,s)}emplace(i,r,s,l){const p=3*i;return this.uint16[6*i+0]=r,this.float32[p+1]=s,this.float32[p+2]=l,i}}n.prototype.bytesPerElement=12,Ct("StructArrayLayout1ui2f12",n);class c extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r,s){const l=this.length;return this.resize(l+1),this.emplace(l,i,r,s)}emplace(i,r,s,l){const p=4*i;return this.uint32[2*i+0]=r,this.uint16[p+2]=s,this.uint16[p+3]=l,i}}c.prototype.bytesPerElement=8,Ct("StructArrayLayout1ul2ui8",c);class d extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,r){const s=this.length;return this.resize(s+1),this.emplace(s,i,r)}emplace(i,r,s){const l=2*i;return this.uint16[l+0]=r,this.uint16[l+1]=s,i}}d.prototype.bytesPerElement=4,Ct("StructArrayLayout2ui4",d);class m extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const r=this.length;return this.resize(r+1),this.emplace(r,i)}emplace(i,r){return this.uint16[1*i+0]=r,i}}m.prototype.bytesPerElement=2,Ct("StructArrayLayout1ui2",m);class y extends Te{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,r,s,l){const p=this.length;return this.resize(p+1),this.emplace(p,i,r,s,l)}emplace(i,r,s,l,p){const f=4*i;return this.float32[f+0]=r,this.float32[f+1]=s,this.float32[f+2]=l,this.float32[f+3]=p,i}}y.prototype.bytesPerElement=16,Ct("StructArrayLayout4f16",y);class x extends Na{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new It(this.anchorPointX,this.anchorPointY)}}x.prototype.size=20;class w extends wo{get(i){return new x(this,i)}}Ct("CollisionBoxArray",w);class T extends Na{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}T.prototype.size=48;class M extends u{get(i){return new T(this,i)}}Ct("PlacedSymbolArray",M);class P extends Na{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}P.prototype.size=64;class A extends e{get(i){return new P(this,i)}}Ct("SymbolInstanceArray",A);class D extends a{getoffsetX(i){return this.float32[1*i+0]}}Ct("GlyphOffsetArray",D);class O extends dr{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Ct("SymbolLineVertexArray",O);class j extends Na{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}j.prototype.size=12;class V extends n{get(i){return new j(this,i)}}Ct("TextAnchorOffsetArray",V);class $ extends Na{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}$.prototype.size=8;class W extends c{get(i){return new $(this,i)}}Ct("FeatureIndexArray",W);class U extends Ua{}class H extends Ua{}class Y extends Ua{}class Z extends $a{}class J extends $s{}class lt extends vo{}class ot extends Hn{}class st extends ua{}class ct extends bo{}class xt extends Xn{}class vt extends Zs{}class mt extends Kn{}class At extends Gs{}class jt extends qs{}class ae extends d{}const _e=Ie([{name:"a_pos",components:2,type:"Int16"}],4),{members:de}=_e;class Wt{constructor(i=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=i}prepareSegment(i,r,s,l){const p=this.segments[this.segments.length-1];return i>Wt.MAX_VERTEX_ARRAY_LENGTH&&Ee(`Max vertices per segment is ${Wt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Wt.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!p||p.vertexLength+i>Wt.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==l?this.createNewSegment(r,s,l):p}createNewSegment(i,r,s){const l={vertexOffset:i.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0,vaos:{}};return s!==void 0&&(l.sortKey=s),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(l),l}getOrCreateLatestSegment(i,r,s){return this.prepareSegment(0,i,r,s)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const i of this.segments)for(const r in i.vaos)i.vaos[r].destroy()}static simpleSegment(i,r,s,l){return new Wt([{vertexOffset:i,primitiveOffset:r,vertexLength:s,primitiveLength:l,vaos:{},sortKey:0}])}}function ue(o,i){return 256*(o=ui(Math.floor(o),0,255))+ui(Math.floor(i),0,255)}Wt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ct("SegmentVector",Wt);const Ze=Ie([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Se=Ie([{name:"a_dasharray_from",components:4,type:"Uint16"},{name:"a_dasharray_to",components:4,type:"Uint16"}]);var Xe,De,Le,ni={exports:{}},$r={exports:{}},Zr={exports:{}},To=(function(){if(Le)return ni.exports;Le=1;var o=(Xe||(Xe=1,$r.exports=function(r,s){var l,p,f,_,g,v,b,S;for(p=r.length-(l=3&r.length),f=s,g=3432918353,v=461845907,S=0;S<p;)b=255&r.charCodeAt(S)|(255&r.charCodeAt(++S))<<8|(255&r.charCodeAt(++S))<<16|(255&r.charCodeAt(++S))<<24,++S,f=27492+(65535&(_=5*(65535&(f=(f^=b=(65535&(b=(b=(65535&b)*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295)<<13|f>>>19))+((5*(f>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(b=0,l){case 3:b^=(255&r.charCodeAt(S+2))<<16;case 2:b^=(255&r.charCodeAt(S+1))<<8;case 1:f^=b=(65535&(b=(b=(65535&(b^=255&r.charCodeAt(S)))*g+(((b>>>16)*g&65535)<<16)&4294967295)<<15|b>>>17))*v+(((b>>>16)*v&65535)<<16)&4294967295}return f^=r.length,f=2246822507*(65535&(f^=f>>>16))+((2246822507*(f>>>16)&65535)<<16)&4294967295,f=3266489909*(65535&(f^=f>>>13))+((3266489909*(f>>>16)&65535)<<16)&4294967295,(f^=f>>>16)>>>0}),$r.exports),i=(De||(De=1,Zr.exports=function(r,s){for(var l,p=r.length,f=s^p,_=0;p>=4;)l=1540483477*(65535&(l=255&r.charCodeAt(_)|(255&r.charCodeAt(++_))<<8|(255&r.charCodeAt(++_))<<16|(255&r.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),f=1540483477*(65535&f)+((1540483477*(f>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),p-=4,++_;switch(p){case 3:f^=(255&r.charCodeAt(_+2))<<16;case 2:f^=(255&r.charCodeAt(_+1))<<8;case 1:f=1540483477*(65535&(f^=255&r.charCodeAt(_)))+((1540483477*(f>>>16)&65535)<<16)}return f=1540483477*(65535&(f^=f>>>13))+((1540483477*(f>>>16)&65535)<<16),(f^=f>>>15)>>>0}),Zr.exports);return ni.exports=o,ni.exports.murmur3=o,ni.exports.murmur2=i,ni.exports})(),Gr=pe(To);class So{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,r,s,l){this.ids.push(Za(i)),this.positions.push(r,s,l)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const r=Za(i);let s=0,l=this.ids.length-1;for(;s<l;){const f=s+l>>1;this.ids[f]>=r?l=f:s=f+1}const p=[];for(;this.ids[s]===r;)p.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return p}static serialize(i,r){const s=new Float64Array(i.ids),l=new Uint32Array(i.positions);return qr(s,l,0,s.length-1),r&&r.push(s.buffer,l.buffer),{ids:s,positions:l}}static deserialize(i){const r=new So;return r.ids=i.ids,r.positions=i.positions,r.indexed=!0,r}}function Za(o){const i=+o;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:Gr(String(o))}function qr(o,i,r,s){for(;r<s;){const l=o[r+s>>1];let p=r-1,f=s+1;for(;;){do p++;while(o[p]<l);do f--;while(o[f]>l);if(p>=f)break;Si(o,p,f),Si(i,3*p,3*f),Si(i,3*p+1,3*f+1),Si(i,3*p+2,3*f+2)}f-r<s-f?(qr(o,i,r,f),r=f+1):(qr(o,i,f+1,s),s=f)}}function Si(o,i,r){const s=o[i];o[i]=o[r],o[r]=s}Ct("FeaturePositionMap",So);class fi{constructor(i,r){this.gl=i.gl,this.location=r}}class pr extends fi{constructor(i,r){super(i,r),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class da extends fi{constructor(i,r){super(i,r),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Be extends fi{constructor(i,r){super(i,r),this.current=Ut.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Ke=new Float32Array(16);function zi(o){return[ue(255*o.r,255*o.g),ue(255*o.b,255*o.a)]}class ze{constructor(i,r,s){this.value=i,this.uniformNames=r.map((l=>`u_${l}`)),this.type=s}setUniform(i,r,s){i.set(s.constantOr(this.value))}getBinding(i,r,s){return this.type==="color"?new Be(i,r):new pr(i,r)}}class Po{constructor(i,r){this.uniformNames=r.map((s=>`u_${s}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=r.tlbr,this.patternTo=i.tlbr}setConstantDashPositions(i,r){this.dashTo=[0,i.y,i.height,i.width],this.dashFrom=[0,r.y,r.height,r.width]}setUniform(i,r,s,l){let p=null;l==="u_pattern_to"?p=this.patternTo:l==="u_pattern_from"?p=this.patternFrom:l==="u_dasharray_to"?p=this.dashTo:l==="u_dasharray_from"?p=this.dashFrom:l==="u_pixel_ratio_to"?p=this.pixelRatioTo:l==="u_pixel_ratio_from"&&(p=this.pixelRatioFrom),p!==null&&i.set(p)}getBinding(i,r,s){return s.substr(0,9)==="u_pattern"||s.substr(0,12)==="u_dasharray_"?new da(i,r):new pr(i,r)}}class Ar{constructor(i,r,s,l){this.expression=i,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map((p=>({name:`a_${p}`,type:"Float32",components:s==="color"?2:1,offset:0}))),this.paintVertexArray=new l}populatePaintArray(i,r,s){const l=this.paintVertexArray.length,p=this.expression.evaluate(new ce(0,s),r,{},s.canonical,[],s.formattedSection);this.paintVertexArray.resize(i),this._setPaintValue(l,i,p)}updatePaintArray(i,r,s,l,p){const f=this.expression.evaluate(new ce(0,p),s,l);this._setPaintValue(i,r,f)}_setPaintValue(i,r,s){if(this.type==="color"){const l=zi(s);for(let p=i;p<r;p++)this.paintVertexArray.emplace(p,l[0],l[1])}else{for(let l=i;l<r;l++)this.paintVertexArray.emplace(l,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tr{constructor(i,r,s,l,p,f){this.expression=i,this.uniformNames=r.map((_=>`u_${_}_t`)),this.type=s,this.useIntegerZoom=l,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=r.map((_=>({name:`a_${_}`,type:"Float32",components:s==="color"?4:2,offset:0}))),this.paintVertexArray=new f}populatePaintArray(i,r,s){const l=this.expression.evaluate(new ce(this.zoom,s),r,{},s.canonical,[],s.formattedSection),p=this.expression.evaluate(new ce(this.zoom+1,s),r,{},s.canonical,[],s.formattedSection),f=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(f,i,l,p)}updatePaintArray(i,r,s,l,p){const f=this.expression.evaluate(new ce(this.zoom,p),s,l),_=this.expression.evaluate(new ce(this.zoom+1,p),s,l);this._setPaintValue(i,r,f,_)}_setPaintValue(i,r,s,l){if(this.type==="color"){const p=zi(s),f=zi(l);for(let _=i;_<r;_++)this.paintVertexArray.emplace(_,p[0],p[1],f[0],f[1])}else{for(let p=i;p<r;p++)this.paintVertexArray.emplace(p,s,l);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(l))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,l=ui(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);i.set(l)}getBinding(i,r,s){return new pr(i,r)}}class Wr{constructor(i,r,s,l,p,f){this.expression=i,this.type=r,this.useIntegerZoom=s,this.zoom=l,this.layerId=f,this.zoomInPaintVertexArray=new p,this.zoomOutPaintVertexArray=new p}populatePaintArray(i,r,s){const l=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(l,i,this.getPositionIds(r),s)}updatePaintArray(i,r,s,l,p){this._setPaintValues(i,r,this.getPositionIds(s),p)}_setPaintValues(i,r,s,l){const p=this.getPositions(l);if(!p||!s)return;const f=p[s.min],_=p[s.mid],g=p[s.max];if(f&&_&&g)for(let v=i;v<r;v++)this.emplace(this.zoomInPaintVertexArray,v,_,f),this.emplace(this.zoomOutPaintVertexArray,v,_,g)}upload(i){if(this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer){const r=this.getVertexAttributes();this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,r,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,r,this.expression.isStateDependent)}}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class wc extends Wr{getPositions(i){return i.imagePositions}getPositionIds(i){return i.patterns&&i.patterns[this.layerId]}getVertexAttributes(){return Ze.members}emplace(i,r,s,l){i.emplace(r,s.tlbr[0],s.tlbr[1],s.tlbr[2],s.tlbr[3],l.tlbr[0],l.tlbr[1],l.tlbr[2],l.tlbr[3],s.pixelRatio,l.pixelRatio)}}class Tc extends Wr{getPositions(i){return i.dashPositions}getPositionIds(i){return i.dashes&&i.dashes[this.layerId]}getVertexAttributes(){return Se.members}emplace(i,r,s,l){i.emplace(r,0,s.y,s.height,s.width,0,l.y,l.height,l.width)}}class Hr{constructor(i,r,s){this.binders={},this._buffers=[];const l=[];for(const p in i.paint._values){if(!s(p))continue;const f=i.paint.get(p);if(!(f instanceof ur&&Yo(f.property.specification)))continue;const _=Sc(p,i.type),g=f.value,v=f.property.specification.type,b=f.property.useIntegerZoom,S=f.property.specification["property-type"],I=S==="cross-faded"||S==="cross-faded-data-driven";if(g.kind==="constant")this.binders[p]=I?new Po(g.value,_):new ze(g.value,_,v),l.push(`/u_${p}`);else if(g.kind==="source"||I){const C=Qn(p,v,"source");this.binders[p]=I?p==="line-dasharray"?new Tc(g,v,b,r,C,i.id):new wc(g,v,b,r,C,i.id):new Ar(g,_,v,C),l.push(`/a_${p}`)}else{const C=Qn(p,v,"composite");this.binders[p]=new tr(g,_,v,b,r,C),l.push(`/z_${p}`)}}this.cacheKey=l.sort().join("")}getMaxValue(i){const r=this.binders[i];return r instanceof Ar||r instanceof tr?r.maxValue:0}populatePaintArrays(i,r,s){for(const l in this.binders){const p=this.binders[l];(p instanceof Ar||p instanceof tr||p instanceof Wr)&&p.populatePaintArray(i,r,s)}}setConstantPatternPositions(i,r){for(const s in this.binders){const l=this.binders[s];l instanceof Po&&l.setConstantPatternPositions(i,r)}}setConstantDashPositions(i,r){for(const s in this.binders){const l=this.binders[s];l instanceof Po&&l.setConstantDashPositions(i,r)}}updatePaintArrays(i,r,s,l,p){let f=!1;for(const _ in i){const g=r.getPositions(_);for(const v of g){const b=s.feature(v.index);for(const S in this.binders){const I=this.binders[S];if((I instanceof Ar||I instanceof tr||I instanceof Wr)&&I.expression.isStateDependent===!0){const C=l.paint.get(S);I.expression=C.value,I.updatePaintArray(v.start,v.end,b,i[_],p),f=!0}}}}return f}defines(){const i=[];for(const r in this.binders){const s=this.binders[r];(s instanceof ze||s instanceof Po)&&i.push(...s.uniformNames.map((l=>`#define HAS_UNIFORM_${l}`)))}return i}getBinderAttributes(){const i=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Ar||s instanceof tr)for(let l=0;l<s.paintVertexAttributes.length;l++)i.push(s.paintVertexAttributes[l].name);else if(s instanceof Wr){const l=s.getVertexAttributes();for(const p of l)i.push(p.name)}}return i}getBinderUniforms(){const i=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof ze||s instanceof Po||s instanceof tr)for(const l of s.uniformNames)i.push(l)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,r){const s=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof ze||p instanceof Po||p instanceof tr){for(const f of p.uniformNames)if(r[f]){const _=p.getBinding(i,r[f],f);s.push({name:f,property:l,binding:_})}}}return s}setUniforms(i,r,s,l){for(const{name:p,property:f,binding:_}of r)this.binders[f].setUniform(_,l,s.get(f),p)}updatePaintBuffers(i){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(i&&s instanceof Wr){const l=i.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;l&&this._buffers.push(l)}else(s instanceof Ar||s instanceof tr)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(i){for(const r in this.binders){const s=this.binders[r];(s instanceof Ar||s instanceof tr||s instanceof Wr)&&s.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const r=this.binders[i];(r instanceof Ar||r instanceof tr||r instanceof Wr)&&r.destroy()}}}class Xr{constructor(i,r,s=()=>!0){this.programConfigurations={};for(const l of i)this.programConfigurations[l.id]=new Hr(l,r,s);this.needsUpload=!1,this._featureMap=new So,this._bufferOffset=0}populatePaintArrays(i,r,s,l){for(const p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(i,r,l);r.id!==void 0&&this._featureMap.add(r.id,s,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,r,s,l){for(const p of s)this.needsUpload=this.programConfigurations[p.id].updatePaintArrays(i,this._featureMap,r,p,l)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Sc(o,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-dasharray":["dasharray_to","dasharray_from"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}function Qn(o,i,r){const s={color:{source:vo,composite:y},number:{source:a,composite:vo}},l=(function(p){return{"line-pattern":{source:ot,composite:ot},"fill-pattern":{source:ot,composite:ot},"fill-extrusion-pattern":{source:ot,composite:ot},"line-dasharray":{source:st,composite:st}}[p]})(o);return l&&l[r]||s[i][r]}Ct("ConstantBinder",ze),Ct("CrossFadedConstantBinder",Po),Ct("SourceExpressionBinder",Ar),Ct("CrossFadedPatternBinder",wc),Ct("CrossFadedDasharrayBinder",Tc),Ct("CompositeExpressionBinder",tr),Ct("ProgramConfiguration",Hr,{omit:["_buffers"]}),Ct("ProgramConfigurationSet",Xr);const Ga=Math.pow(2,14)-1,Jn=-Ga-1;function zr(o){const i=ne/o.extent,r=o.loadGeometry();for(let s=0;s<r.length;s++){const l=r[s];for(let p=0;p<l.length;p++){const f=l[p],_=Math.round(f.x*i),g=Math.round(f.y*i);f.x=ui(_,Jn,Ga),f.y=ui(g,Jn,Ga),(_<f.x||_>f.x+1||g<f.y||g>f.y+1)&&Ee("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return r}function qa(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?zr(o):[]}}const ou=-32768;function Nd(o,i,r,s,l){o.emplaceBack(ou+8*i+s,ou+8*r+l)}class ph{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=i.index,this.hasDependencies=!1,this.layoutVertexArray=new H,this.indexArray=new jt,this.segments=new Wt,this.programConfigurations=new Xr(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(i,r,s){const l=this.layers[0],p=[];let f=null,_=!1,g=l.type==="heatmap";if(l.type==="circle"){const b=l;f=b.layout.get("circle-sort-key"),_=!f.isConstant(),g=g||b.paint.get("circle-pitch-alignment")==="map"}const v=g?r.subdivisionGranularity.circle:1;for(const{feature:b,id:S,index:I,sourceLayerIndex:C}of i){const R=this.layers[0]._featureFilter.needGeometry,L=qa(b,R);if(!this.layers[0]._featureFilter.filter(new ce(this.zoom),L,s))continue;const B=_?f.evaluate(L,{},s):void 0,N={id:S,properties:b.properties,type:b.type,sourceLayerIndex:C,index:I,geometry:R?L.geometry:zr(b),patterns:{},sortKey:B};p.push(N)}_&&p.sort(((b,S)=>b.sortKey-S.sortKey));for(const b of p){const{geometry:S,index:I,sourceLayerIndex:C}=b,R=i[I].feature;this.addFeature(b,S,I,s,v),r.featureIndex.insert(R,S,I,C,this.index)}}update(i,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,r,this.stateDependentLayers,{imagePositions:s})}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,de),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,r,s,l,p=1){let f;switch(p){case 1:f=[0,7];break;case 3:f=[0,2,5,7];break;case 5:f=[0,1,3,4,6,7];break;case 7:f=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${p}; valid values are 1, 3, 5, 7.`)}const _=f.length;for(const g of r)for(const v of g){const b=v.x,S=v.y;if(b<0||b>=ne||S<0||S>=ne)continue;const I=this.segments.prepareSegment(_*_,this.layoutVertexArray,this.indexArray,i.sortKey),C=I.vertexLength;for(let R=0;R<_;R++)for(let L=0;L<_;L++)Nd(this.layoutVertexArray,b,S,f[L],f[R]);for(let R=0;R<_-1;R++)for(let L=0;L<_-1;L++){const B=C+R*_+L,N=C+(R+1)*_+L;this.indexArray.emplaceBack(B,N+1,B+1),this.indexArray.emplaceBack(B,N,N+1)}I.vertexLength+=_*_,I.primitiveLength+=(_-1)*(_-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,s,{imagePositions:{},canonical:l})}}function au(o,i){for(let r=0;r<o.length;r++)if(Ws(i,o[r]))return!0;for(let r=0;r<i.length;r++)if(Ws(o,i[r]))return!0;return!!fh(o,i)}function Pc(o,i,r){return!!Ws(o,i)||!!mh(i,o,r)}function su(o,i){if(o.length===1)return lu(i,o[0]);for(let r=0;r<i.length;r++){const s=i[r];for(let l=0;l<s.length;l++)if(Ws(o,s[l]))return!0}for(let r=0;r<o.length;r++)if(lu(i,o[r]))return!0;for(let r=0;r<i.length;r++)if(fh(o,i[r]))return!0;return!1}function Ud(o,i,r){if(o.length>1){if(fh(o,i))return!0;for(let s=0;s<i.length;s++)if(mh(i[s],o,r))return!0}for(let s=0;s<o.length;s++)if(mh(o[s],i,r))return!0;return!1}function fh(o,i){if(o.length===0||i.length===0)return!1;for(let r=0;r<o.length-1;r++){const s=o[r],l=o[r+1];for(let p=0;p<i.length-1;p++)if($d(s,l,i[p],i[p+1]))return!0}return!1}function $d(o,i,r,s){return fe(o,r,s)!==fe(i,r,s)&&fe(o,i,r)!==fe(o,i,s)}function mh(o,i,r){const s=r*r;if(i.length===1)return o.distSqr(i[0])<s;for(let l=1;l<i.length;l++)if(nu(o,i[l-1],i[l])<s)return!0;return!1}function nu(o,i,r){const s=i.distSqr(r);if(s===0)return o.distSqr(i);const l=((o.x-i.x)*(r.x-i.x)+(o.y-i.y)*(r.y-i.y))/s;return o.distSqr(l<0?i:l>1?r:r.sub(i)._mult(l)._add(i))}function lu(o,i){let r,s,l,p=!1;for(let f=0;f<o.length;f++){r=o[f];for(let _=0,g=r.length-1;_<r.length;g=_++)s=r[_],l=r[g],s.y>i.y!=l.y>i.y&&i.x<(l.x-s.x)*(i.y-s.y)/(l.y-s.y)+s.x&&(p=!p)}return p}function Ws(o,i){let r=!1;for(let s=0,l=o.length-1;s<o.length;l=s++){const p=o[s],f=o[l];p.y>i.y!=f.y>i.y&&i.x<(f.x-p.x)*(i.y-p.y)/(f.y-p.y)+p.x&&(r=!r)}return r}function Zd(o,i,r){const s=r[0],l=r[2];if(o.x<s.x&&i.x<s.x||o.x>l.x&&i.x>l.x||o.y<s.y&&i.y<s.y||o.y>l.y&&i.y>l.y)return!1;const p=fe(o,i,r[0]);return p!==fe(o,i,r[1])||p!==fe(o,i,r[2])||p!==fe(o,i,r[3])}function Hs(o,i,r){const s=i.paint.get(o).value;return s.kind==="constant"?s.value:r.programConfigurations.get(i.id).getMaxValue(o)}function Mc(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Ic(o,i,r,s,l){if(!i[0]&&!i[1])return o;const p=It.convert(i)._mult(l);r==="viewport"&&p._rotate(-s);const f=[];for(let _=0;_<o.length;_++)f.push(o[_].sub(p));return f}function Gd({queryGeometry:o,size:i},r){return Pc(o,r,i)}function qd({queryGeometry:o,size:i,transform:r,unwrappedTileID:s,getElevation:l},p){return Pc(o,p,i*(r.projectTileCoordinates(p.x,p.y,s,l).signedDistanceFromCamera/r.cameraToCenterDistance))}function Wd({queryGeometry:o,size:i,transform:r,unwrappedTileID:s,getElevation:l},p){const f=r.projectTileCoordinates(p.x,p.y,s,l).signedDistanceFromCamera,_=i*(r.cameraToCenterDistance/f);return Pc(o,_h(p,r,s,l),_)}function Hd({queryGeometry:o,size:i,transform:r,unwrappedTileID:s,getElevation:l},p){return Pc(o,_h(p,r,s,l),i)}function cu({queryGeometry:o,size:i,transform:r,unwrappedTileID:s,getElevation:l,pitchAlignment:p="map",pitchScale:f="map"},_){const g=p==="map"?f==="map"?Gd:qd:f==="map"?Wd:Hd,v={queryGeometry:o,size:i,transform:r,unwrappedTileID:s,getElevation:l};for(const b of _)for(const S of b)if(g(v,S))return!0;return!1}function _h(o,i,r,s){const l=i.projectTileCoordinates(o.x,o.y,r,s).point;return new It((.5*l.x+.5)*i.width,(.5*-l.y+.5)*i.height)}let hu,uu;Ct("CircleBucket",ph,{omit:["layers"]});var Xd={get paint(){return uu=uu||new Ti({"circle-radius":new Ft(rt.paint_circle["circle-radius"]),"circle-color":new Ft(rt.paint_circle["circle-color"]),"circle-blur":new Ft(rt.paint_circle["circle-blur"]),"circle-opacity":new Ft(rt.paint_circle["circle-opacity"]),"circle-translate":new Rt(rt.paint_circle["circle-translate"]),"circle-translate-anchor":new Rt(rt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Rt(rt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Rt(rt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ft(rt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ft(rt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ft(rt.paint_circle["circle-stroke-opacity"])})},get layout(){return hu=hu||new Ti({"circle-sort-key":new Ft(rt.layout_circle["circle-sort-key"])})}};class Kd extends Ji{constructor(i,r){super(i,Xd,r)}createBucket(i){return new ph(i)}queryRadius(i){const r=i;return Hs("circle-radius",this,r)+Hs("circle-stroke-width",this,r)+Mc(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:i,feature:r,featureState:s,geometry:l,transform:p,pixelsToTileUnits:f,unwrappedTileID:_,getElevation:g}){const v=Ic(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-p.bearingInRadians,f),b=this.paint.get("circle-radius").evaluate(r,s)+this.paint.get("circle-stroke-width").evaluate(r,s),S=this.paint.get("circle-pitch-scale"),I=this.paint.get("circle-pitch-alignment");let C,R;return I==="map"?(C=v,R=b*f):(C=(function(L,B,N,it){return L.map((G=>_h(G,B,N,it)))})(v,p,_,g),R=b),cu({queryGeometry:C,size:R,transform:p,unwrappedTileID:_,getElevation:g,pitchAlignment:I,pitchScale:S},l)}}class du extends ph{}let pu;Ct("HeatmapBucket",du,{omit:["layers"]});var Yd={get paint(){return pu=pu||new Ti({"heatmap-radius":new Ft(rt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ft(rt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Rt(rt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Va(rt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Rt(rt.paint_heatmap["heatmap-opacity"])})}};function gh(o,{width:i,height:r},s,l){if(l){if(l instanceof Uint8ClampedArray)l=new Uint8Array(l.buffer);else if(l.length!==i*r*s)throw new RangeError(`mismatched image size. expected: ${l.length} but got: ${i*r*s}`)}else l=new Uint8Array(i*r*s);return o.width=i,o.height=r,o.data=l,o}function fu(o,{width:i,height:r},s){if(i===o.width&&r===o.height)return;const l=gh({},{width:i,height:r},s);yh(o,l,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,i),height:Math.min(o.height,r)},s),o.width=i,o.height=r,o.data=l.data}function yh(o,i,r,s,l,p){if(l.width===0||l.height===0)return i;if(l.width>o.width||l.height>o.height||r.x>o.width-l.width||r.y>o.height-l.height)throw new RangeError("out of range source coordinates for image copy");if(l.width>i.width||l.height>i.height||s.x>i.width-l.width||s.y>i.height-l.height)throw new RangeError("out of range destination coordinates for image copy");const f=o.data,_=i.data;if(f===_)throw new Error("srcData equals dstData, so image is already copied");for(let g=0;g<l.height;g++){const v=((r.y+g)*o.width+r.x)*p,b=((s.y+g)*i.width+s.x)*p;for(let S=0;S<l.width*p;S++)_[b+S]=f[v+S]}return i}class tl{constructor(i,r){gh(this,i,1,r)}resize(i){fu(this,i,1)}clone(){return new tl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,r,s,l,p){yh(i,r,s,l,p,1)}}class Oi{constructor(i,r){gh(this,i,4,r)}resize(i){fu(this,i,4)}replace(i,r){r?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Oi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,r,s,l,p){yh(i,r,s,l,p,4)}setPixel(i,r,s){const l=4*(i*this.width+r);this.data[l+0]=Math.round(255*s.r/s.a),this.data[l+1]=Math.round(255*s.g/s.a),this.data[l+2]=Math.round(255*s.b/s.a),this.data[l+3]=Math.round(255*s.a)}}function mu(o){const i={},r=o.resolution||256,s=o.clips?o.clips.length:1,l=o.image||new Oi({width:r,height:s});if(Math.log(r)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${r}`);const p=(f,_,g)=>{i[o.evaluationKey]=g;const v=o.expression.evaluate(i);l.setPixel(f/4/r,_/4,v)};if(o.clips)for(let f=0,_=0;f<s;++f,_+=4*r)for(let g=0,v=0;g<r;g++,v+=4){const b=g/(r-1),{start:S,end:I}=o.clips[f];p(_,v,S*(1-b)+I*b)}else for(let f=0,_=0;f<r;f++,_+=4)p(0,_,f/(r-1));return l}Ct("AlphaImage",tl),Ct("RGBAImage",Oi);const xh="big-fb";class Qd extends Ji{createBucket(i){return new du(i)}constructor(i,r){super(i,Yd,r),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=mu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(xh)&&this.heatmapFbos.delete(xh)}queryRadius(i){return Hs("heatmap-radius",this,i)}queryIntersectsFeature({queryGeometry:i,feature:r,featureState:s,geometry:l,transform:p,pixelsToTileUnits:f,unwrappedTileID:_,getElevation:g}){return cu({queryGeometry:i,size:this.paint.get("heatmap-radius").evaluate(r,s)*f,transform:p,unwrappedTileID:_,getElevation:g},l)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let _u;var Jd={get paint(){return _u=_u||new Ti({"hillshade-illumination-direction":new Rt(rt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-altitude":new Rt(rt.paint_hillshade["hillshade-illumination-altitude"]),"hillshade-illumination-anchor":new Rt(rt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Rt(rt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Rt(rt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Rt(rt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Rt(rt.paint_hillshade["hillshade-accent-color"]),"hillshade-method":new Rt(rt.paint_hillshade["hillshade-method"])})}};class tp extends Ji{constructor(i,r){super(i,Jd,r),this.recalculate({zoom:0,zoomHistory:{}},void 0)}getIlluminationProperties(){let i=this.paint.get("hillshade-illumination-direction").values,r=this.paint.get("hillshade-illumination-altitude").values,s=this.paint.get("hillshade-highlight-color").values,l=this.paint.get("hillshade-shadow-color").values;const p=Math.max(i.length,r.length,s.length,l.length);i=i.concat(Array(p-i.length).fill(i.at(-1))),r=r.concat(Array(p-r.length).fill(r.at(-1))),s=s.concat(Array(p-s.length).fill(s.at(-1))),l=l.concat(Array(p-l.length).fill(l.at(-1)));const f=r.map(Fo);return{directionRadians:i.map(Fo),altitudeRadians:f,shadowColor:l,highlightColor:s}}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}let gu;var ep={get paint(){return gu=gu||new Ti({"color-relief-opacity":new Rt(rt["paint_color-relief"]["color-relief-opacity"]),"color-relief-color":new Va(rt["paint_color-relief"]["color-relief-color"])})}};class vh{constructor(i,r,s,l){this.context=i,this.format=s,this.texture=i.gl.createTexture(),this.update(r,l)}update(i,r,s){const{width:l,height:p}=i,f=!(this.size&&this.size[0]===l&&this.size[1]===p||s),{context:_}=this,{gl:g}=_;if(this.useMipmap=!!(r&&r.useMipmap),g.bindTexture(g.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===g.RGBA&&(!r||r.premultiply!==!1)),f)this.size=[l,p],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||vr(i)?g.texImage2D(g.TEXTURE_2D,0,this.format,this.format,g.UNSIGNED_BYTE,i):g.texImage2D(g.TEXTURE_2D,0,this.format,l,p,0,this.format,g.UNSIGNED_BYTE,i.data);else{const{x:v,y:b}=s||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||vr(i)?g.texSubImage2D(g.TEXTURE_2D,0,v,b,g.RGBA,g.UNSIGNED_BYTE,i):g.texSubImage2D(g.TEXTURE_2D,0,v,b,l,p,g.RGBA,g.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&g.generateMipmap(g.TEXTURE_2D),_.pixelStoreUnpackFlipY.setDefault(),_.pixelStoreUnpack.setDefault(),_.pixelStoreUnpackPremultiplyAlpha.setDefault()}bind(i,r,s){const{context:l}=this,{gl:p}=l;p.bindTexture(p.TEXTURE_2D,this.texture),s!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=p.LINEAR),i!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,s||i),this.filter=i),r!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,r),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class yu{constructor(i,r,s,l=1,p=1,f=1,_=0){if(this.uid=i,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&!["mapbox","terrarium","custom"].includes(s))return void Ee(`"${s}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=r.height;const g=this.dim=r.height-2;switch(this.data=new Uint32Array(r.data.buffer),s){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=l,this.greenFactor=p,this.blueFactor=f,this.baseShift=_;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let v=0;v<g;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(g,v)]=this.data[this._idx(g-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,g)]=this.data[this._idx(v,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let v=0;v<g;v++)for(let b=0;b<g;b++){const S=this.get(v,b);S>this.max&&(this.max=S),S<this.min&&(this.min=S)}}get(i,r){const s=new Uint8Array(this.data.buffer),l=4*this._idx(i,r);return this.unpack(s[l],s[l+1],s[l+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,r){if(i<-1||i>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(i+1)}unpack(i,r,s){return i*this.redFactor+r*this.greenFactor+s*this.blueFactor-this.baseShift}pack(i){return xu(i,this.getUnpackVector())}getPixels(){return new Oi({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,r,s){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let l=r*this.dim,p=r*this.dim+this.dim,f=s*this.dim,_=s*this.dim+this.dim;switch(r){case-1:l=p-1;break;case 1:p=l+1}switch(s){case-1:f=_-1;break;case 1:_=f+1}const g=-r*this.dim,v=-s*this.dim;for(let b=f;b<_;b++)for(let S=l;S<p;S++)this.data[this._idx(S,b)]=i.data[this._idx(S+g,b+v)]}}function xu(o,i){const r=i[0],s=i[1],l=i[2],p=i[3],f=Math.min(r,s,l),_=Math.round((o+p)/f);return{r:Math.floor(_*f/r)%256,g:Math.floor(_*f/s)%256,b:Math.floor(_*f/l)%256}}Ct("DEMData",yu);class ip extends Ji{constructor(i,r){super(i,ep,r)}_createColorRamp(i){const r={elevationStops:[],colorStops:[]},s=this._transitionablePaint._values["color-relief-color"].value.expression;if(s instanceof As&&s._styleExpression.expression instanceof bi){this.colorRampExpression=s;const f=s._styleExpression.expression;r.elevationStops=f.labels,r.colorStops=[];for(const _ of r.elevationStops)r.colorStops.push(f.evaluate({globals:{elevation:_}}))}if(r.elevationStops.length<1&&(r.elevationStops=[0],r.colorStops=[Ut.transparent]),r.elevationStops.length<2&&(r.elevationStops.push(r.elevationStops[0]+1),r.colorStops.push(r.colorStops[0])),r.elevationStops.length<=i)return r;const l={elevationStops:[],colorStops:[]},p=(r.elevationStops.length-1)/(i-1);for(let f=0;f<r.elevationStops.length-.5;f+=p)l.elevationStops.push(r.elevationStops[Math.round(f)]),l.colorStops.push(r.colorStops[Math.round(f)]);return Ee(`Too many colors in specification of ${this.id} color-relief layer, may not render properly.`),l}_colorRampChanged(){return this.colorRampExpression!=this._transitionablePaint._values["color-relief-color"].value.expression}getColorRampTextures(i,r,s){if(this.colorRampTextures&&!this._colorRampChanged())return this.colorRampTextures;const l=this._createColorRamp(r),p=new Oi({width:l.colorStops.length,height:1}),f=new Oi({width:l.colorStops.length,height:1});for(let _=0;_<l.elevationStops.length;_++){const g=xu(l.elevationStops[_],s);f.setPixel(0,_,new Ut(g.r/255,g.g/255,g.b/255,1)),p.setPixel(0,_,l.colorStops[_])}return this.colorRampTextures={elevationTexture:new vh(i,f,i.gl.RGBA),colorTexture:new vh(i,p,i.gl.RGBA)},this.colorRampTextures}hasOffscreenPass(){return this.visibility!=="none"&&!!this.colorRampTextures}}const rp=Ie([{name:"a_pos",components:2,type:"Int16"}],4),{members:op}=rp;function Cc(o,i,r){const s=r.patternDependencies;let l=!1;for(const p of i){const f=p.paint.get(`${o}-pattern`);f.isConstant()||(l=!0);const _=f.constantOr(null);_&&(l=!0,s[_.to]=!0,s[_.from]=!0)}return l}function bh(o,i,r,s,l){const{zoom:p}=s,f=l.patternDependencies;for(const _ of i){const g=_.paint.get(`${o}-pattern`).value;if(g.kind!=="constant"){let v=g.evaluate({zoom:p-1},r,{},l.availableImages),b=g.evaluate({zoom:p},r,{},l.availableImages),S=g.evaluate({zoom:p+1},r,{},l.availableImages);v=v&&v.name?v.name:v,b=b&&b.name?b.name:b,S=S&&S.name?S.name:S,f[v]=!0,f[b]=!0,f[S]=!0,r.patterns[_.id]={min:v,mid:b,max:S}}}return r}function vu(o,i,r,s,l){let p;if(l===(function(f,_,g,v){let b=0;for(let S=_,I=g-v;S<g;S+=v)b+=(f[I]-f[S])*(f[S+1]+f[I+1]),I=S;return b})(o,i,r,s)>0)for(let f=i;f<r;f+=s)p=Su(f/s|0,o[f],o[f+1],p);else for(let f=r-s;f>=i;f-=s)p=Su(f/s|0,o[f],o[f+1],p);return p&&Xs(p,p.next)&&(ol(p),p=p.next),p}function Wa(o,i){if(!o)return o;i||(i=o);let r,s=o;do if(r=!1,s.steiner||!Xs(s,s.next)&&Fe(s.prev,s,s.next)!==0)s=s.next;else{if(ol(s),s=i=s.prev,s===s.next)break;r=!0}while(r||s!==i);return i}function el(o,i,r,s,l,p,f){if(!o)return;!f&&p&&(function(g,v,b,S){let I=g;do I.z===0&&(I.z=wh(I.x,I.y,v,b,S)),I.prevZ=I.prev,I.nextZ=I.next,I=I.next;while(I!==g);I.prevZ.nextZ=null,I.prevZ=null,(function(C){let R,L=1;do{let B,N=C;C=null;let it=null;for(R=0;N;){R++;let G=N,K=0;for(let dt=0;dt<L&&(K++,G=G.nextZ,G);dt++);let at=L;for(;K>0||at>0&&G;)K!==0&&(at===0||!G||N.z<=G.z)?(B=N,N=N.nextZ,K--):(B=G,G=G.nextZ,at--),it?it.nextZ=B:C=B,B.prevZ=it,it=B;N=G}it.nextZ=null,L*=2}while(R>1)})(I)})(o,s,l,p);let _=o;for(;o.prev!==o.next;){const g=o.prev,v=o.next;if(p?sp(o,s,l,p):ap(o))i.push(g.i,o.i,v.i),ol(o),o=v.next,_=v.next;else if((o=v)===_){f?f===1?el(o=np(Wa(o),i),i,r,s,l,p,2):f===2&&lp(o,i,r,s,l,p):el(Wa(o),i,r,s,l,p,1);break}}}function ap(o){const i=o.prev,r=o,s=o.next;if(Fe(i,r,s)>=0)return!1;const l=i.x,p=r.x,f=s.x,_=i.y,g=r.y,v=s.y,b=Math.min(l,p,f),S=Math.min(_,g,v),I=Math.max(l,p,f),C=Math.max(_,g,v);let R=s.next;for(;R!==i;){if(R.x>=b&&R.x<=I&&R.y>=S&&R.y<=C&&il(l,_,p,g,f,v,R.x,R.y)&&Fe(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function sp(o,i,r,s){const l=o.prev,p=o,f=o.next;if(Fe(l,p,f)>=0)return!1;const _=l.x,g=p.x,v=f.x,b=l.y,S=p.y,I=f.y,C=Math.min(_,g,v),R=Math.min(b,S,I),L=Math.max(_,g,v),B=Math.max(b,S,I),N=wh(C,R,i,r,s),it=wh(L,B,i,r,s);let G=o.prevZ,K=o.nextZ;for(;G&&G.z>=N&&K&&K.z<=it;){if(G.x>=C&&G.x<=L&&G.y>=R&&G.y<=B&&G!==l&&G!==f&&il(_,b,g,S,v,I,G.x,G.y)&&Fe(G.prev,G,G.next)>=0||(G=G.prevZ,K.x>=C&&K.x<=L&&K.y>=R&&K.y<=B&&K!==l&&K!==f&&il(_,b,g,S,v,I,K.x,K.y)&&Fe(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;G&&G.z>=N;){if(G.x>=C&&G.x<=L&&G.y>=R&&G.y<=B&&G!==l&&G!==f&&il(_,b,g,S,v,I,G.x,G.y)&&Fe(G.prev,G,G.next)>=0)return!1;G=G.prevZ}for(;K&&K.z<=it;){if(K.x>=C&&K.x<=L&&K.y>=R&&K.y<=B&&K!==l&&K!==f&&il(_,b,g,S,v,I,K.x,K.y)&&Fe(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function np(o,i){let r=o;do{const s=r.prev,l=r.next.next;!Xs(s,l)&&wu(s,r,r.next,l)&&rl(s,l)&&rl(l,s)&&(i.push(s.i,r.i,l.i),ol(r),ol(r.next),r=o=l),r=r.next}while(r!==o);return Wa(r)}function lp(o,i,r,s,l,p){let f=o;do{let _=f.next.next;for(;_!==f.prev;){if(f.i!==_.i&&pp(f,_)){let g=Tu(f,_);return f=Wa(f,f.next),g=Wa(g,g.next),el(f,i,r,s,l,p,0),void el(g,i,r,s,l,p,0)}_=_.next}f=f.next}while(f!==o)}function cp(o,i){let r=o.x-i.x;return r===0&&(r=o.y-i.y,r===0)&&(r=(o.next.y-o.y)/(o.next.x-o.x)-(i.next.y-i.y)/(i.next.x-i.x)),r}function hp(o,i){const r=(function(l,p){let f=p;const _=l.x,g=l.y;let v,b=-1/0;if(Xs(l,f))return f;do{if(Xs(l,f.next))return f.next;if(g<=f.y&&g>=f.next.y&&f.next.y!==f.y){const L=f.x+(g-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(L<=_&&L>b&&(b=L,v=f.x<f.next.x?f:f.next,L===_))return v}f=f.next}while(f!==p);if(!v)return null;const S=v,I=v.x,C=v.y;let R=1/0;f=v;do{if(_>=f.x&&f.x>=I&&_!==f.x&&bu(g<C?_:b,g,I,C,g<C?b:_,g,f.x,f.y)){const L=Math.abs(g-f.y)/(_-f.x);rl(f,l)&&(L<R||L===R&&(f.x>v.x||f.x===v.x&&up(v,f)))&&(v=f,R=L)}f=f.next}while(f!==S);return v})(o,i);if(!r)return i;const s=Tu(r,o);return Wa(s,s.next),Wa(r,r.next)}function up(o,i){return Fe(o.prev,o,i.prev)<0&&Fe(i.next,o,o.next)<0}function wh(o,i,r,s,l){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-r)*l|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-s)*l|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function dp(o){let i=o,r=o;do(i.x<r.x||i.x===r.x&&i.y<r.y)&&(r=i),i=i.next;while(i!==o);return r}function bu(o,i,r,s,l,p,f,_){return(l-f)*(i-_)>=(o-f)*(p-_)&&(o-f)*(s-_)>=(r-f)*(i-_)&&(r-f)*(p-_)>=(l-f)*(s-_)}function il(o,i,r,s,l,p,f,_){return!(o===f&&i===_)&&bu(o,i,r,s,l,p,f,_)}function pp(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!(function(r,s){let l=r;do{if(l.i!==r.i&&l.next.i!==r.i&&l.i!==s.i&&l.next.i!==s.i&&wu(l,l.next,r,s))return!0;l=l.next}while(l!==r);return!1})(o,i)&&(rl(o,i)&&rl(i,o)&&(function(r,s){let l=r,p=!1;const f=(r.x+s.x)/2,_=(r.y+s.y)/2;do l.y>_!=l.next.y>_&&l.next.y!==l.y&&f<(l.next.x-l.x)*(_-l.y)/(l.next.y-l.y)+l.x&&(p=!p),l=l.next;while(l!==r);return p})(o,i)&&(Fe(o.prev,o,i.prev)||Fe(o,i.prev,i))||Xs(o,i)&&Fe(o.prev,o,o.next)>0&&Fe(i.prev,i,i.next)>0)}function Fe(o,i,r){return(i.y-o.y)*(r.x-i.x)-(i.x-o.x)*(r.y-i.y)}function Xs(o,i){return o.x===i.x&&o.y===i.y}function wu(o,i,r,s){const l=zc(Fe(o,i,r)),p=zc(Fe(o,i,s)),f=zc(Fe(r,s,o)),_=zc(Fe(r,s,i));return l!==p&&f!==_||!(l!==0||!Ac(o,r,i))||!(p!==0||!Ac(o,s,i))||!(f!==0||!Ac(r,o,s))||!(_!==0||!Ac(r,i,s))}function Ac(o,i,r){return i.x<=Math.max(o.x,r.x)&&i.x>=Math.min(o.x,r.x)&&i.y<=Math.max(o.y,r.y)&&i.y>=Math.min(o.y,r.y)}function zc(o){return o>0?1:o<0?-1:0}function rl(o,i){return Fe(o.prev,o,o.next)<0?Fe(o,i,o.next)>=0&&Fe(o,o.prev,i)>=0:Fe(o,i,o.prev)<0||Fe(o,o.next,i)<0}function Tu(o,i){const r=Th(o.i,o.x,o.y),s=Th(i.i,i.x,i.y),l=o.next,p=i.prev;return o.next=i,i.prev=o,r.next=l,l.prev=r,s.next=r,r.prev=s,p.next=s,s.prev=p,s}function Su(o,i,r,s){const l=Th(o,i,r);return s?(l.next=s.next,l.prev=s,s.next.prev=l,s.next=l):(l.prev=l,l.next=l),l}function ol(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Th(o,i,r){return{i:o,x:i,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class Ks{constructor(i,r){if(r>i)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=i,this._minGranularity=r}getGranularityForZoomLevel(i){return Math.max(Math.floor(this._baseZoomGranularity/(1<<i)),this._minGranularity,1)}}class Rc{constructor(i){this.fill=i.fill,this.line=i.line,this.tile=i.tile,this.stencil=i.stencil,this.circle=i.circle}}Rc.noSubdivision=new Rc({fill:new Ks(0,0),line:new Ks(0,0),tile:new Ks(0,0),stencil:new Ks(0,0),circle:1}),Ct("SubdivisionGranularityExpression",Ks),Ct("SubdivisionGranularitySetting",Rc);const Ys=-32768,al=32767;class fp{constructor(i,r){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=i,this._granularityCellSize=ne/i,this._canonical=r}_getKey(i,r){return(i+=32768)<<16|r+32768}_vertexToIndex(i,r){if(i<-32768||r<-32768||i>32767||r>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const s=0|Math.round(i),l=0|Math.round(r),p=this._getKey(s,l);if(this._vertexDictionary.has(p))return this._vertexDictionary.get(p);const f=this._vertexBuffer.length/2;return this._vertexDictionary.set(p,f),this._vertexBuffer.push(s,l),f}_subdivideTrianglesScanline(i){if(this._granularity<2)return(function(l,p){const f=[];for(let _=0;_<p.length;_+=3){const g=p[_],v=p[_+1],b=p[_+2],S=l[2*g],I=l[2*g+1];(l[2*v]-S)*(l[2*b+1]-I)-(l[2*v+1]-I)*(l[2*b]-S)>0?(f.push(g),f.push(b),f.push(v)):(f.push(g),f.push(v),f.push(b))}return f})(this._vertexBuffer,i);const r=[],s=i.length;for(let l=0;l<s;l+=3){const p=[i[l+0],i[l+1],i[l+2]],f=[this._vertexBuffer[2*i[l+0]+0],this._vertexBuffer[2*i[l+0]+1],this._vertexBuffer[2*i[l+1]+0],this._vertexBuffer[2*i[l+1]+1],this._vertexBuffer[2*i[l+2]+0],this._vertexBuffer[2*i[l+2]+1]];let _=1/0,g=1/0,v=-1/0,b=-1/0;for(let L=0;L<3;L++){const B=f[2*L],N=f[2*L+1];_=Math.min(_,B),v=Math.max(v,B),g=Math.min(g,N),b=Math.max(b,N)}if(_===v||g===b)continue;const S=Math.floor(_/this._granularityCellSize),I=Math.ceil(v/this._granularityCellSize),C=Math.floor(g/this._granularityCellSize),R=Math.ceil(b/this._granularityCellSize);if(S!==I||C!==R)for(let L=C;L<R;L++){const B=this._scanlineGenerateVertexRingForCellRow(L,f,p);mp(this._vertexBuffer,B,r)}else r.push(...p)}return r}_scanlineGenerateVertexRingForCellRow(i,r,s){const l=i*this._granularityCellSize,p=l+this._granularityCellSize,f=[];for(let _=0;_<3;_++){const g=r[2*_],v=r[2*_+1],b=r[2*(_+1)%6],S=r[(2*(_+1)+1)%6],I=r[2*(_+2)%6],C=r[(2*(_+2)+1)%6],R=b-g,L=S-v,B=R===0,N=L===0,it=(l-v)/L,G=(p-v)/L,K=Math.min(it,G),at=Math.max(it,G);if(!N&&(K>=1||at<=0)||N&&(v<l||v>p)){S>=l&&S<=p&&f.push(s[(_+1)%3]);continue}!N&&K>0&&f.push(this._vertexToIndex(g+R*K,v+L*K));const dt=g+R*Math.max(K,0),gt=g+R*Math.min(at,1);B||this._generateIntraEdgeVertices(f,g,v,b,S,dt,gt),!N&&at<1&&f.push(this._vertexToIndex(g+R*at,v+L*at)),(N||S>=l&&S<=p)&&f.push(s[(_+1)%3]),!N&&(S<=l||S>=p)&&this._generateInterEdgeVertices(f,g,v,b,S,I,C,gt,l,p)}return f}_generateIntraEdgeVertices(i,r,s,l,p,f,_){const g=l-r,v=p-s,b=v===0,S=b?Math.min(r,l):Math.min(f,_),I=b?Math.max(r,l):Math.max(f,_),C=Math.floor(S/this._granularityCellSize)+1,R=Math.ceil(I/this._granularityCellSize)-1;if(b?r<l:f<_)for(let L=C;L<=R;L++){const B=L*this._granularityCellSize;i.push(this._vertexToIndex(B,s+v*(B-r)/g))}else for(let L=R;L>=C;L--){const B=L*this._granularityCellSize;i.push(this._vertexToIndex(B,s+v*(B-r)/g))}}_generateInterEdgeVertices(i,r,s,l,p,f,_,g,v,b){const S=p-s,I=f-l,C=_-p,R=(v-p)/C,L=(b-p)/C,B=Math.min(R,L),N=Math.max(R,L),it=l+I*B;let G=Math.floor(Math.min(it,g)/this._granularityCellSize)+1,K=Math.ceil(Math.max(it,g)/this._granularityCellSize)-1,at=g<it;const dt=C===0;if(dt&&(_===v||_===b))return;if(dt||B>=1||N<=0){const Mt=s-_,bt=f+(r-f)*Math.min((v-_)/Mt,(b-_)/Mt);G=Math.floor(Math.min(bt,g)/this._granularityCellSize)+1,K=Math.ceil(Math.max(bt,g)/this._granularityCellSize)-1,at=g<bt}const gt=S>0?b:v;if(at)for(let Mt=G;Mt<=K;Mt++)i.push(this._vertexToIndex(Mt*this._granularityCellSize,gt));else for(let Mt=K;Mt>=G;Mt--)i.push(this._vertexToIndex(Mt*this._granularityCellSize,gt))}_generateOutline(i){const r=[];for(const s of i){const l=Ha(s,this._granularity,!0),p=this._pointArrayToIndices(l),f=[];for(let _=1;_<p.length;_++)f.push(p[_-1]),f.push(p[_]);r.push(f)}return r}_handlePoles(i){let r=!1,s=!1;this._canonical&&(this._canonical.y===0&&(r=!0),this._canonical.y===(1<<this._canonical.z)-1&&(s=!0)),(r||s)&&this._fillPoles(i,r,s)}_ensureNoPoleVertices(){const i=this._vertexBuffer;for(let r=0;r<i.length;r+=2){const s=i[r+1];s===Ys&&(i[r+1]=-32767),s===al&&(i[r+1]=32766)}}_generatePoleQuad(i,r,s,l,p,f){l>p!=(f===Ys)?(i.push(r),i.push(s),i.push(this._vertexToIndex(l,f)),i.push(s),i.push(this._vertexToIndex(p,f)),i.push(this._vertexToIndex(l,f))):(i.push(s),i.push(r),i.push(this._vertexToIndex(l,f)),i.push(this._vertexToIndex(p,f)),i.push(s),i.push(this._vertexToIndex(l,f)))}_fillPoles(i,r,s){const l=this._vertexBuffer,p=ne,f=i.length;for(let _=2;_<f;_+=3){const g=i[_-2],v=i[_-1],b=i[_],S=l[2*g],I=l[2*g+1],C=l[2*v],R=l[2*v+1],L=l[2*b],B=l[2*b+1];r&&(I===0&&R===0&&this._generatePoleQuad(i,g,v,S,C,Ys),R===0&&B===0&&this._generatePoleQuad(i,v,b,C,L,Ys),B===0&&I===0&&this._generatePoleQuad(i,b,g,L,S,Ys)),s&&(I===p&&R===p&&this._generatePoleQuad(i,g,v,S,C,al),R===p&&B===p&&this._generatePoleQuad(i,v,b,C,L,al),B===p&&I===p&&this._generatePoleQuad(i,b,g,L,S,al))}}_initializeVertices(i){for(let r=0;r<i.length;r+=2)this._vertexToIndex(i[r],i[r+1])}subdividePolygonInternal(i,r){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:s,holeIndices:l}=(function(_){const g=[],v=[];for(const b of _)if(b.length!==0){b!==_[0]&&g.push(v.length/2);for(let S=0;S<b.length;S++)v.push(b[S].x),v.push(b[S].y)}return{flattened:v,holeIndices:g}})(i);let p;this._initializeVertices(s);try{const _=(function(v,b,S=2){const I=b&&b.length,C=I?b[0]*S:v.length;let R=vu(v,0,C,S,!0);const L=[];if(!R||R.next===R.prev)return L;let B,N,it;if(I&&(R=(function(G,K,at,dt){const gt=[];for(let Mt=0,bt=K.length;Mt<bt;Mt++){const St=vu(G,K[Mt]*dt,Mt<bt-1?K[Mt+1]*dt:G.length,dt,!1);St===St.next&&(St.steiner=!0),gt.push(dp(St))}gt.sort(cp);for(let Mt=0;Mt<gt.length;Mt++)at=hp(gt[Mt],at);return at})(v,b,R,S)),v.length>80*S){B=v[0],N=v[1];let G=B,K=N;for(let at=S;at<C;at+=S){const dt=v[at],gt=v[at+1];dt<B&&(B=dt),gt<N&&(N=gt),dt>G&&(G=dt),gt>K&&(K=gt)}it=Math.max(G-B,K-N),it=it!==0?32767/it:0}return el(R,L,S,B,N,it,0),L})(s,l),g=this._convertIndices(s,_);p=this._subdivideTrianglesScanline(g)}catch(_){console.error(_)}let f=[];return r&&(f=this._generateOutline(i)),this._ensureNoPoleVertices(),this._handlePoles(p),{verticesFlattened:this._vertexBuffer,indicesTriangles:p,indicesLineList:f}}_convertIndices(i,r){const s=[];for(let l=0;l<r.length;l++)s.push(this._vertexToIndex(i[2*r[l]],i[2*r[l]+1]));return s}_pointArrayToIndices(i){const r=[];for(let s=0;s<i.length;s++){const l=i[s];r.push(this._vertexToIndex(l.x,l.y))}return r}}function Pu(o,i,r,s=!0){return new fp(r,i).subdividePolygonInternal(o,s)}function Ha(o,i,r=!1){if(!o||o.length<1)return[];if(o.length<2)return[];const s=o[0],l=o[o.length-1],p=r&&(s.x!==l.x||s.y!==l.y);if(i<2)return p?[...o,o[0]]:[...o];const f=Math.floor(ne/i),_=[];_.push(new It(o[0].x,o[0].y));const g=o.length,v=p?g:g-1;for(let b=0;b<v;b++){const S=o[b],I=b<g-1?o[b+1]:o[0],C=S.x,R=S.y,L=I.x,B=I.y,N=C!==L,it=R!==B;if(!N&&!it)continue;const G=L-C,K=B-R,at=Math.abs(G),dt=Math.abs(K);let gt=C,Mt=R;for(;;){const St=G>0?(Math.floor(gt/f)+1)*f:(Math.ceil(gt/f)-1)*f,kt=K>0?(Math.floor(Mt/f)+1)*f:(Math.ceil(Mt/f)-1)*f,Tt=Math.abs(gt-St),Pt=Math.abs(Mt-kt),ft=Math.abs(gt-L),Bt=Math.abs(Mt-B),Vt=N?Tt/at:Number.POSITIVE_INFINITY,Lt=it?Pt/dt:Number.POSITIVE_INFINITY;if((ft<=Tt||!N)&&(Bt<=Pt||!it))break;if(Vt<Lt&&N||!it){gt=St,Mt+=K*Vt;const zt=new It(gt,Math.round(Mt));_[_.length-1].x===zt.x&&_[_.length-1].y===zt.y||_.push(zt)}else{gt+=G*Lt,Mt=kt;const zt=new It(Math.round(gt),Mt);_[_.length-1].x===zt.x&&_[_.length-1].y===zt.y||_.push(zt)}}const bt=new It(L,B);_[_.length-1].x===bt.x&&_[_.length-1].y===bt.y||_.push(bt)}return _}function mp(o,i,r){if(i.length===0)throw new Error("Subdivision vertex ring is empty.");let s=0,l=o[2*i[0]];for(let g=1;g<i.length;g++){const v=o[2*i[g]];v<l&&(l=v,s=g)}const p=i.length;let f=s,_=(f+1)%p;for(;;){const g=f-1>=0?f-1:p-1,v=(_+1)%p,b=o[2*i[g]],S=o[2*i[v]],I=o[2*i[f]],C=o[2*i[f]+1],R=o[2*i[_]+1];let L=!1;if(b<S)L=!0;else if(b>S)L=!1;else{const B=R-C,N=-(o[2*i[_]]-I),it=C<R?1:-1;((b-I)*B+(o[2*i[g]+1]-C)*N)*it>((S-I)*B+(o[2*i[v]+1]-C)*N)*it&&(L=!0)}if(L){const B=i[g],N=i[f],it=i[_];B!==N&&B!==it&&N!==it&&r.push(it,N,B),f--,f<0&&(f=p-1)}else{const B=i[v],N=i[f],it=i[_];B!==N&&B!==it&&N!==it&&r.push(it,N,B),_++,_>=p&&(_=0)}if(g===v)break}}function Mu(o,i,r,s,l,p,f,_,g){const v=l.length/2,b=f&&_&&g;if(v<Wt.MAX_VERTEX_ARRAY_LENGTH){const S=i.prepareSegment(v,r,s),I=S.vertexLength;for(let L=0;L<p.length;L+=3)s.emplaceBack(I+p[L],I+p[L+1],I+p[L+2]);let C,R;S.vertexLength+=v,S.primitiveLength+=p.length/3,b&&(R=f.prepareSegment(v,r,_),C=R.vertexLength,R.vertexLength+=v);for(let L=0;L<l.length;L+=2)o(l[L],l[L+1]);if(b)for(let L=0;L<g.length;L++){const B=g[L];for(let N=1;N<B.length;N+=2)_.emplaceBack(C+B[N-1],C+B[N]);R.primitiveLength+=B.length/2}}else(function(S,I,C,R,L,B){const N=[];for(let dt=0;dt<R.length/2;dt++)N.push(-1);const it={count:0};let G=0,K=S.getOrCreateLatestSegment(I,C),at=K.vertexLength;for(let dt=2;dt<L.length;dt+=3){const gt=L[dt-2],Mt=L[dt-1],bt=L[dt];let St=N[gt]<G,kt=N[Mt]<G,Tt=N[bt]<G;K.vertexLength+((St?1:0)+(kt?1:0)+(Tt?1:0))>Wt.MAX_VERTEX_ARRAY_LENGTH&&(K=S.createNewSegment(I,C),G=it.count,St=!0,kt=!0,Tt=!0,at=0);const Pt=sl(N,R,B,it,gt,St,K),ft=sl(N,R,B,it,Mt,kt,K),Bt=sl(N,R,B,it,bt,Tt,K);C.emplaceBack(at+Pt-G,at+ft-G,at+Bt-G),K.primitiveLength++}})(i,r,s,l,p,o),b&&(function(S,I,C,R,L,B){const N=[];for(let dt=0;dt<R.length/2;dt++)N.push(-1);const it={count:0};let G=0,K=S.getOrCreateLatestSegment(I,C),at=K.vertexLength;for(let dt=0;dt<L.length;dt++){const gt=L[dt];for(let Mt=1;Mt<L[dt].length;Mt+=2){const bt=gt[Mt-1],St=gt[Mt];let kt=N[bt]<G,Tt=N[St]<G;K.vertexLength+((kt?1:0)+(Tt?1:0))>Wt.MAX_VERTEX_ARRAY_LENGTH&&(K=S.createNewSegment(I,C),G=it.count,kt=!0,Tt=!0,at=0);const Pt=sl(N,R,B,it,bt,kt,K),ft=sl(N,R,B,it,St,Tt,K);C.emplaceBack(at+Pt-G,at+ft-G),K.primitiveLength++}}})(f,r,_,l,g,o),i.forceNewSegmentOnNextPrepare(),f?.forceNewSegmentOnNextPrepare()}function sl(o,i,r,s,l,p,f){if(p){const _=s.count;return r(i[2*l],i[2*l+1]),o[l]=s.count,s.count++,f.vertexLength++,_}return o[l]}class Sh{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=i.index,this.hasDependencies=!1,this.patternFeatures=[],this.layoutVertexArray=new Y,this.indexArray=new jt,this.indexArray2=new ae,this.programConfigurations=new Xr(i.layers,i.zoom),this.segments=new Wt,this.segments2=new Wt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(i,r,s){this.hasDependencies=Cc("fill",this.layers,r);const l=this.layers[0].layout.get("fill-sort-key"),p=!l.isConstant(),f=[];for(const{feature:_,id:g,index:v,sourceLayerIndex:b}of i){const S=this.layers[0]._featureFilter.needGeometry,I=qa(_,S);if(!this.layers[0]._featureFilter.filter(new ce(this.zoom),I,s))continue;const C=p?l.evaluate(I,{},s,r.availableImages):void 0,R={id:g,properties:_.properties,type:_.type,sourceLayerIndex:b,index:v,geometry:S?I.geometry:zr(_),patterns:{},sortKey:C};f.push(R)}p&&f.sort(((_,g)=>_.sortKey-g.sortKey));for(const _ of f){const{geometry:g,index:v,sourceLayerIndex:b}=_;if(this.hasDependencies){const S=bh("fill",this.layers,_,{zoom:this.zoom},r);this.patternFeatures.push(S)}else this.addFeature(_,g,v,s,{},r.subdivisionGranularity);r.featureIndex.insert(i[v].feature,g,v,b,this.index)}}update(i,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,r,this.stateDependentLayers,{imagePositions:s})}addFeatures(i,r,s){for(const l of this.patternFeatures)this.addFeature(l,l.geometry,l.index,r,s,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,op),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,r,s,l,p,f){for(const _ of Ho(r,500)){const g=Pu(_,l,f.fill.getGranularityForZoomLevel(l.z)),v=this.layoutVertexArray;Mu(((b,S)=>{v.emplaceBack(b,S)}),this.segments,this.layoutVertexArray,this.indexArray,g.verticesFlattened,g.indicesTriangles,this.segments2,this.indexArray2,g.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,s,{imagePositions:p,canonical:l})}}let Iu,Cu;Ct("FillBucket",Sh,{omit:["layers","patternFeatures"]});var _p={get paint(){return Cu=Cu||new Ti({"fill-antialias":new Rt(rt.paint_fill["fill-antialias"]),"fill-opacity":new Ft(rt.paint_fill["fill-opacity"]),"fill-color":new Ft(rt.paint_fill["fill-color"]),"fill-outline-color":new Ft(rt.paint_fill["fill-outline-color"]),"fill-translate":new Rt(rt.paint_fill["fill-translate"]),"fill-translate-anchor":new Rt(rt.paint_fill["fill-translate-anchor"]),"fill-pattern":new ca(rt.paint_fill["fill-pattern"])})},get layout(){return Iu=Iu||new Ti({"fill-sort-key":new Ft(rt.layout_fill["fill-sort-key"])})}};class gp extends Ji{constructor(i,r){super(i,_p,r)}recalculate(i,r){super.recalculate(i,r);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Sh(i)}queryRadius(){return Mc(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:i,geometry:r,transform:s,pixelsToTileUnits:l}){return su(Ic(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-s.bearingInRadians,l),r)}isTileClipped(){return!0}}const yp=Ie([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),xp=Ie([{name:"a_centroid",components:2,type:"Int16"}],4),{members:vp}=yp;class Qs{constructor(i,r,s,l,p){this.properties={},this.extent=s,this.type=0,this.id=void 0,this._pbf=i,this._geometry=-1,this._keys=l,this._values=p,i.readFields(bp,this,r)}loadGeometry(){const i=this._pbf;i.pos=this._geometry;const r=i.readVarint()+i.pos,s=[];let l,p=1,f=0,_=0,g=0;for(;i.pos<r;){if(f<=0){const v=i.readVarint();p=7&v,f=v>>3}if(f--,p===1||p===2)_+=i.readSVarint(),g+=i.readSVarint(),p===1&&(l&&s.push(l),l=[]),l&&l.push(new It(_,g));else{if(p!==7)throw new Error(`unknown command ${p}`);l&&l.push(l[0].clone())}}return l&&s.push(l),s}bbox(){const i=this._pbf;i.pos=this._geometry;const r=i.readVarint()+i.pos;let s=1,l=0,p=0,f=0,_=1/0,g=-1/0,v=1/0,b=-1/0;for(;i.pos<r;){if(l<=0){const S=i.readVarint();s=7&S,l=S>>3}if(l--,s===1||s===2)p+=i.readSVarint(),f+=i.readSVarint(),p<_&&(_=p),p>g&&(g=p),f<v&&(v=f),f>b&&(b=f);else if(s!==7)throw new Error(`unknown command ${s}`)}return[_,v,g,b]}toGeoJSON(i,r,s){const l=this.extent*Math.pow(2,s),p=this.extent*i,f=this.extent*r,_=this.loadGeometry();function g(I){return[360*(I.x+p)/l-180,360/Math.PI*Math.atan(Math.exp((1-2*(I.y+f)/l)*Math.PI))-90]}function v(I){return I.map(g)}let b;if(this.type===1){const I=[];for(const R of _)I.push(R[0]);const C=v(I);b=I.length===1?{type:"Point",coordinates:C[0]}:{type:"MultiPoint",coordinates:C}}else if(this.type===2){const I=_.map(v);b=I.length===1?{type:"LineString",coordinates:I[0]}:{type:"MultiLineString",coordinates:I}}else{if(this.type!==3)throw new Error("unknown feature type");{const I=(function(R){const L=R.length;if(L<=1)return[R];const B=[];let N,it;for(let G=0;G<L;G++){const K=wp(R[G]);K!==0&&(it===void 0&&(it=K<0),it===K<0?(N&&B.push(N),N=[R[G]]):N&&N.push(R[G]))}return N&&B.push(N),B})(_),C=[];for(const R of I)C.push(R.map(v));b=C.length===1?{type:"Polygon",coordinates:C[0]}:{type:"MultiPolygon",coordinates:C}}}const S={type:"Feature",geometry:b,properties:this.properties};return this.id!=null&&(S.id=this.id),S}}function bp(o,i,r){o===1?i.id=r.readVarint():o===2?(function(s,l){const p=s.readVarint()+s.pos;for(;s.pos<p;){const f=l._keys[s.readVarint()],_=l._values[s.readVarint()];l.properties[f]=_}})(r,i):o===3?i.type=r.readVarint():o===4&&(i._geometry=r.pos)}function wp(o){let i=0;for(let r,s,l=0,p=o.length,f=p-1;l<p;f=l++)r=o[l],s=o[f],i+=(s.x-r.x)*(r.y+s.y);return i}Qs.types=["Unknown","Point","LineString","Polygon"];class Au{constructor(i,r){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(Tp,this,r),this.length=this._features.length}feature(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];const r=this._pbf.readVarint()+this._pbf.pos;return new Qs(this._pbf,r,this.extent,this._keys,this._values)}}function Tp(o,i,r){o===15?i.version=r.readVarint():o===1?i.name=r.readString():o===5?i.extent=r.readVarint():o===2?i._features.push(r.pos):o===3?i._keys.push(r.readString()):o===4&&i._values.push((function(s){let l=null;const p=s.readVarint()+s.pos;for(;s.pos<p;){const f=s.readVarint()>>3;l=f===1?s.readString():f===2?s.readFloat():f===3?s.readDouble():f===4?s.readVarint64():f===5?s.readVarint():f===6?s.readSVarint():f===7?s.readBoolean():null}if(l==null)throw new Error("unknown feature value");return l})(r))}class zu{constructor(i,r){this.layers=i.readFields(Sp,{},r)}}function Sp(o,i,r){if(o===3){const s=new Au(r,r.readVarint()+r.pos);s.length&&(i[s.name]=s)}}const Ph=Math.pow(2,13);function nl(o,i,r,s,l,p,f,_){o.emplaceBack(i,r,2*Math.floor(s*Ph)+f,l*Ph*2,p*Ph*2,Math.round(_))}class Mh{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=i.index,this.hasDependencies=!1,this.layoutVertexArray=new Z,this.centroidVertexArray=new U,this.indexArray=new jt,this.programConfigurations=new Xr(i.layers,i.zoom),this.segments=new Wt,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(i,r,s){this.features=[],this.hasDependencies=Cc("fill-extrusion",this.layers,r);for(const{feature:l,id:p,index:f,sourceLayerIndex:_}of i){const g=this.layers[0]._featureFilter.needGeometry,v=qa(l,g);if(!this.layers[0]._featureFilter.filter(new ce(this.zoom),v,s))continue;const b={id:p,sourceLayerIndex:_,index:f,geometry:g?v.geometry:zr(l),properties:l.properties,type:l.type,patterns:{}};this.hasDependencies?this.features.push(bh("fill-extrusion",this.layers,b,{zoom:this.zoom},r)):this.addFeature(b,b.geometry,f,s,{},r.subdivisionGranularity),r.featureIndex.insert(l,b.geometry,f,_,this.index,!0)}}addFeatures(i,r,s){for(const l of this.features){const{geometry:p}=l;this.addFeature(l,p,l.index,r,s,i.subdivisionGranularity)}}update(i,r,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,r,this.stateDependentLayers,{imagePositions:s})}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,vp),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,xp.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,r,s,l,p,f){for(const _ of Ho(r,500)){const g={x:0,y:0,sampleCount:0},v=this.layoutVertexArray.length;this.processPolygon(g,l,i,_,f);const b=this.layoutVertexArray.length-v,S=Math.floor(g.x/g.sampleCount),I=Math.floor(g.y/g.sampleCount);for(let C=0;C<b;C++)this.centroidVertexArray.emplaceBack(S,I)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,s,{imagePositions:p,canonical:l})}processPolygon(i,r,s,l,p){if(l.length<1||Ru(l[0]))return;for(const S of l)S.length!==0&&Pp(i,S);const f={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},_=p.fill.getGranularityForZoomLevel(r.z),g=Qs.types[s.type]==="Polygon";for(const S of l){if(S.length===0||Ru(S))continue;const I=Ha(S,_,g);this._generateSideFaces(I,f)}if(!g)return;const v=Pu(l,r,_,!1),b=this.layoutVertexArray;Mu(((S,I)=>{nl(b,S,I,0,0,1,1,0)}),this.segments,this.layoutVertexArray,this.indexArray,v.verticesFlattened,v.indicesTriangles)}_generateSideFaces(i,r){let s=0;for(let l=1;l<i.length;l++){const p=i[l],f=i[l-1];if(Mp(p,f))continue;r.segment.vertexLength+4>Wt.MAX_VERTEX_ARRAY_LENGTH&&(r.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const _=p.sub(f)._perp()._unit(),g=f.dist(p);s+g>32768&&(s=0),nl(this.layoutVertexArray,p.x,p.y,_.x,_.y,0,0,s),nl(this.layoutVertexArray,p.x,p.y,_.x,_.y,0,1,s),s+=g,nl(this.layoutVertexArray,f.x,f.y,_.x,_.y,0,0,s),nl(this.layoutVertexArray,f.x,f.y,_.x,_.y,0,1,s);const v=r.segment.vertexLength;this.indexArray.emplaceBack(v,v+2,v+1),this.indexArray.emplaceBack(v+1,v+2,v+3),r.segment.vertexLength+=4,r.segment.primitiveLength+=2}}}function Pp(o,i){for(let r=0;r<i.length;r++){const s=i[r];r===i.length-1&&i[0].x===s.x&&i[0].y===s.y||(o.x+=s.x,o.y+=s.y,o.sampleCount++)}}function Mp(o,i){return o.x===i.x&&(o.x<0||o.x>ne)||o.y===i.y&&(o.y<0||o.y>ne)}function Ru(o){return o.every((i=>i.x<0))||o.every((i=>i.x>ne))||o.every((i=>i.y<0))||o.every((i=>i.y>ne))}let Eu;Ct("FillExtrusionBucket",Mh,{omit:["layers","features"]});var Ip={get paint(){return Eu=Eu||new Ti({"fill-extrusion-opacity":new Rt(rt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ft(rt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Rt(rt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Rt(rt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ca(rt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ft(rt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ft(rt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Rt(rt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Cp extends Ji{constructor(i,r){super(i,Ip,r)}createBucket(i){return new Mh(i)}queryRadius(){return Mc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:i,feature:r,featureState:s,geometry:l,transform:p,pixelsToTileUnits:f,pixelPosMatrix:_}){const g=Ic(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-p.bearingInRadians,f),v=this.paint.get("fill-extrusion-height").evaluate(r,s),b=this.paint.get("fill-extrusion-base").evaluate(r,s),S=(function(C,R){const L=[];for(const B of C){const N=[B.x,B.y,0,1];ko(N,N,R),L.push(new It(N[0]/N[3],N[1]/N[3]))}return L})(g,_),I=(function(C,R,L,B){const N=[],it=[],G=B[8]*R,K=B[9]*R,at=B[10]*R,dt=B[11]*R,gt=B[8]*L,Mt=B[9]*L,bt=B[10]*L,St=B[11]*L;for(const kt of C){const Tt=[],Pt=[];for(const ft of kt){const Bt=ft.x,Vt=ft.y,Lt=B[0]*Bt+B[4]*Vt+B[12],zt=B[1]*Bt+B[5]*Vt+B[13],ee=B[2]*Bt+B[6]*Vt+B[14],Ce=B[3]*Bt+B[7]*Vt+B[15],Ge=ee+at,_i=Ce+dt,ir=Lt+gt,ji=zt+Mt,li=ee+bt,Pe=Ce+St,Qe=new It((Lt+G)/_i,(zt+K)/_i);Qe.z=Ge/_i,Tt.push(Qe);const ci=new It(ir/Pe,ji/Pe);ci.z=li/Pe,Pt.push(ci)}N.push(Tt),it.push(Pt)}return[N,it]})(l,b,v,_);return(function(C,R,L){let B=1/0;su(L,R)&&(B=ku(L,R[0]));for(let N=0;N<R.length;N++){const it=R[N],G=C[N];for(let K=0;K<it.length-1;K++){const at=it[K],dt=[at,it[K+1],G[K+1],G[K],at];au(L,dt)&&(B=Math.min(B,ku(L,dt)))}}return B!==1/0&&B})(I[0],I[1],S)}}function ll(o,i){return o.x*i.x+o.y*i.y}function ku(o,i){if(o.length===1){let r=0;const s=i[r++];let l;for(;!l||s.equals(l);)if(l=i[r++],!l)return 1/0;for(;r<i.length;r++){const p=i[r],f=o[0],_=l.sub(s),g=p.sub(s),v=f.sub(s),b=ll(_,_),S=ll(_,g),I=ll(g,g),C=ll(v,_),R=ll(v,g),L=b*I-S*S,B=(I*C-S*R)/L,N=(b*R-S*C)/L,it=s.z*(1-B-N)+l.z*B+p.z*N;if(isFinite(it))return it}return 1/0}{let r=1/0;for(const s of i)r=Math.min(r,s.z);return r}}const Ap=Ie([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:zp}=Ap,Rp=Ie([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ep}=Rp,kp=Math.cos(Math.PI/180*37.5),Du=Math.pow(2,14)/.5;class Ih{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((r=>r.id)),this.index=i.index,this.hasDependencies=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((r=>{this.gradients[r.id]={}})),this.layoutVertexArray=new J,this.layoutVertexArray2=new lt,this.indexArray=new jt,this.programConfigurations=new Xr(i.layers,i.zoom),this.segments=new Wt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((r=>r.isStateDependent())).map((r=>r.id))}populate(i,r,s){this.hasDependencies=Cc("line",this.layers,r)||this.hasLineDasharray(this.layers);const l=this.layers[0].layout.get("line-sort-key"),p=!l.isConstant(),f=[];for(const{feature:_,id:g,index:v,sourceLayerIndex:b}of i){const S=this.layers[0]._featureFilter.needGeometry,I=qa(_,S);if(!this.layers[0]._featureFilter.filter(new ce(this.zoom),I,s))continue;const C=p?l.evaluate(I,{},s):void 0,R={id:g,properties:_.properties,type:_.type,sourceLayerIndex:b,index:v,geometry:S?I.geometry:zr(_),patterns:{},dashes:{},sortKey:C};f.push(R)}p&&f.sort(((_,g)=>_.sortKey-g.sortKey));for(const _ of f){const{geometry:g,index:v,sourceLayerIndex:b}=_;this.hasDependencies?(Cc("line",this.layers,r)?bh("line",this.layers,_,{zoom:this.zoom},r):this.hasLineDasharray(this.layers)&&this.addLineDashDependencies(this.layers,_,this.zoom,r),this.patternFeatures.push(_)):this.addFeature(_,g,v,s,{},{},r.subdivisionGranularity),r.featureIndex.insert(i[v].feature,g,v,b,this.index)}}update(i,r,s,l){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,r,this.stateDependentLayers,{imagePositions:s,dashPositions:l})}addFeatures(i,r,s,l){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,r,s,l,i.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,Ep)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,zp),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,r,s,l,p,f,_){const g=this.layers[0].layout,v=g.get("line-join").evaluate(i,{}),b=g.get("line-cap"),S=g.get("line-miter-limit"),I=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const C of r)this.addLine(C,i,v,b,S,I,l,_);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,s,{imagePositions:p,dashPositions:f,canonical:l})}addLine(i,r,s,l,p,f,_,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,i=Ha(i,_?g.line.getGranularityForZoomLevel(_.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let G=0;G<i.length-1;G++)this.totalDistance+=i[G].dist(i[G+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=Qs.types[r.type]==="Polygon";let b=i.length;for(;b>=2&&i[b-1].equals(i[b-2]);)b--;let S=0;for(;S<b-1&&i[S].equals(i[S+1]);)S++;if(b<(v?3:2))return;s==="bevel"&&(p=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,C=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let R,L,B,N,it;this.e1=this.e2=-1,v&&(R=i[b-2],it=i[S].sub(R)._unit()._perp());for(let G=S;G<b;G++){if(B=G===b-1?v?i[S+1]:void 0:i[G+1],B&&i[G].equals(B))continue;it&&(N=it),R&&(L=R),R=i[G],it=B?B.sub(R)._unit()._perp():N,N=N||it;let K=N.add(it);K.x===0&&K.y===0||K._unit();const at=N.x*it.x+N.y*it.y,dt=K.x*it.x+K.y*it.y,gt=dt!==0?1/dt:1/0,Mt=2*Math.sqrt(2-2*dt),bt=dt<kp&&L&&B,St=N.x*it.y-N.y*it.x>0;if(bt&&G>S){const Pt=R.dist(L);if(Pt>2*I){const ft=R.sub(R.sub(L)._mult(I/Pt)._round());this.updateDistance(L,ft),this.addCurrentVertex(ft,N,0,0,C),L=ft}}const kt=L&&B;let Tt=kt?s:v?"butt":l;if(kt&&Tt==="round"&&(gt<f?Tt="miter":gt<=2&&(Tt="fakeround")),Tt==="miter"&&gt>p&&(Tt="bevel"),Tt==="bevel"&&(gt>2&&(Tt="flipbevel"),gt<p&&(Tt="miter")),L&&this.updateDistance(L,R),Tt==="miter")K._mult(gt),this.addCurrentVertex(R,K,0,0,C);else if(Tt==="flipbevel"){if(gt>100)K=it.mult(-1);else{const Pt=gt*N.add(it).mag()/N.sub(it).mag();K._perp()._mult(Pt*(St?-1:1))}this.addCurrentVertex(R,K,0,0,C),this.addCurrentVertex(R,K.mult(-1),0,0,C)}else if(Tt==="bevel"||Tt==="fakeround"){const Pt=-Math.sqrt(gt*gt-1),ft=St?Pt:0,Bt=St?0:Pt;if(L&&this.addCurrentVertex(R,N,ft,Bt,C),Tt==="fakeround"){const Vt=Math.round(180*Mt/Math.PI/20);for(let Lt=1;Lt<Vt;Lt++){let zt=Lt/Vt;if(zt!==.5){const Ce=zt-.5;zt+=zt*Ce*(zt-1)*((1.0904+at*(at*(3.55645-1.43519*at)-3.2452))*Ce*Ce+(.848013+at*(.215638*at-1.06021)))}const ee=it.sub(N)._mult(zt)._add(N)._unit()._mult(St?-1:1);this.addHalfVertex(R,ee.x,ee.y,!1,St,0,C)}}B&&this.addCurrentVertex(R,it,-ft,-Bt,C)}else if(Tt==="butt")this.addCurrentVertex(R,K,0,0,C);else if(Tt==="square"){const Pt=L?1:-1;this.addCurrentVertex(R,K,Pt,Pt,C)}else Tt==="round"&&(L&&(this.addCurrentVertex(R,N,0,0,C),this.addCurrentVertex(R,N,1,1,C,!0)),B&&(this.addCurrentVertex(R,it,-1,-1,C,!0),this.addCurrentVertex(R,it,0,0,C)));if(bt&&G<b-1){const Pt=R.dist(B);if(Pt>2*I){const ft=R.add(B.sub(R)._mult(I/Pt)._round());this.updateDistance(R,ft),this.addCurrentVertex(ft,it,0,0,C),R=ft}}}}addCurrentVertex(i,r,s,l,p,f=!1){const _=r.y*l-r.x,g=-r.y-r.x*l;this.addHalfVertex(i,r.x+r.y*s,r.y-r.x*s,f,!1,s,p),this.addHalfVertex(i,_,g,f,!0,-l,p),this.distance>Du/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,r,s,l,p,f))}addHalfVertex({x:i,y:r},s,l,p,f,_,g){const v=.5*(this.lineClips?this.scaledDistance*(Du-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(p?1:0),(r<<1)+(f?1:0),Math.round(63*s)+128,Math.round(63*l)+128,1+(_===0?0:_<0?-1:1)|(63&v)<<2,v>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const b=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,b,this.e2),g.primitiveLength++),f?this.e2=b:this.e1=b}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,r){this.distance+=i.dist(r),this.updateScaledDistance()}hasLineDasharray(i){for(const r of i){const s=r.paint.get("line-dasharray");if(s&&!s.isConstant())return!0}return!1}addLineDashDependencies(i,r,s,l){for(const p of i){const f=p.paint.get("line-dasharray");if(!f||f.value.kind==="constant")continue;const _=p.layout.get("line-cap")==="round",g={dasharray:f.value.evaluate({zoom:s-1},r,{}),round:_},v={dasharray:f.value.evaluate({zoom:s},r,{}),round:_},b={dasharray:f.value.evaluate({zoom:s+1},r,{}),round:_},S=`${g.dasharray.join(",")},${g.round}`,I=`${v.dasharray.join(",")},${v.round}`,C=`${b.dasharray.join(",")},${b.round}`;l.dashDependencies[S]=g,l.dashDependencies[I]=v,l.dashDependencies[C]=b,r.dashes[p.id]={min:S,mid:I,max:C}}}}let Lu,Fu;Ct("LineBucket",Ih,{omit:["layers","patternFeatures"]});var Bu={get paint(){return Fu=Fu||new Ti({"line-opacity":new Ft(rt.paint_line["line-opacity"]),"line-color":new Ft(rt.paint_line["line-color"]),"line-translate":new Rt(rt.paint_line["line-translate"]),"line-translate-anchor":new Rt(rt.paint_line["line-translate-anchor"]),"line-width":new Ft(rt.paint_line["line-width"]),"line-gap-width":new Ft(rt.paint_line["line-gap-width"]),"line-offset":new Ft(rt.paint_line["line-offset"]),"line-blur":new Ft(rt.paint_line["line-blur"]),"line-dasharray":new ca(rt.paint_line["line-dasharray"]),"line-pattern":new ca(rt.paint_line["line-pattern"]),"line-gradient":new Va(rt.paint_line["line-gradient"])})},get layout(){return Lu=Lu||new Ti({"line-cap":new Rt(rt.layout_line["line-cap"]),"line-join":new Ft(rt.layout_line["line-join"]),"line-miter-limit":new Rt(rt.layout_line["line-miter-limit"]),"line-round-limit":new Rt(rt.layout_line["line-round-limit"]),"line-sort-key":new Ft(rt.layout_line["line-sort-key"])})}};class Dp extends Ft{possiblyEvaluate(i,r){return r=new ce(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(i,r)}evaluate(i,r,s,l){return r=Li({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(i,r,s,l)}}let Ec;class Lp extends Ji{constructor(i,r){super(i,Bu,r),this.gradientVersion=0,Ec||(Ec=new Dp(Bu.paint.properties["line-width"].specification),Ec.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const r=this.gradientExpression();this.stepInterpolant=!!(function(s){return s._styleExpression!==void 0})(r)&&r._styleExpression.expression instanceof jr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,r){super.recalculate(i,r),this.paint._values["line-floorwidth"]=Ec.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Ih(i)}queryRadius(i){const r=i,s=Ou(Hs("line-width",this,r),Hs("line-gap-width",this,r)),l=Hs("line-offset",this,r);return s/2+Math.abs(l)+Mc(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:i,feature:r,featureState:s,geometry:l,transform:p,pixelsToTileUnits:f}){const _=Ic(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-p.bearingInRadians,f),g=f/2*Ou(this.paint.get("line-width").evaluate(r,s),this.paint.get("line-gap-width").evaluate(r,s)),v=this.paint.get("line-offset").evaluate(r,s);return v&&(l=(function(b,S){const I=[];for(let C=0;C<b.length;C++){const R=b[C],L=[];for(let B=0;B<R.length;B++){const N=R[B-1],it=R[B],G=R[B+1],K=B===0?new It(0,0):it.sub(N)._unit()._perp(),at=B===R.length-1?new It(0,0):G.sub(it)._unit()._perp(),dt=K._add(at)._unit(),gt=dt.x*at.x+dt.y*at.y;gt!==0&&dt._mult(1/gt),L.push(dt._mult(S)._add(it))}I.push(L)}return I})(l,v*f)),(function(b,S,I){for(let C=0;C<S.length;C++){const R=S[C];if(b.length>=3){for(let L=0;L<R.length;L++)if(Ws(b,R[L]))return!0}if(Ud(b,R,I))return!0}return!1})(_,l,g)}isTileClipped(){return!0}}function Ou(o,i){return i>0?i+2*o:o}const Fp=Ie([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Bp=Ie([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ie([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Op=Ie([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);Ie([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const ju=Ie([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),jp=Ie([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Vp(o,i,r){return o.sections.forEach((s=>{s.text=(function(l,p,f){const _=p.layout.get("text-transform").evaluate(f,{});return _==="uppercase"?l=l.toLocaleUpperCase():_==="lowercase"&&(l=l.toLocaleLowerCase()),Cr.applyArabicShaping&&(l=Cr.applyArabicShaping(l)),l})(s.text,i,r)})),o}Ie([{name:"triangle",components:3,type:"Uint16"}]),Ie([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ie([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ie([{type:"Float32",name:"offsetX"}]),Ie([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ie([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const cl={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Ye=24;const Ch=4294967296,Vu=1/Ch,Nu=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");class Ah{constructor(i=new Uint8Array(16)){this.buf=ArrayBuffer.isView(i)?i:new Uint8Array(i),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(i,r,s=this.length){for(;this.pos<s;){const l=this.readVarint(),p=l>>3,f=this.pos;this.type=7&l,i(p,r,this),this.pos===f&&this.skip(l)}return r}readMessage(i,r){return this.readFields(i,r,this.readVarint()+this.pos)}readFixed32(){const i=this.dataView.getUint32(this.pos,!0);return this.pos+=4,i}readSFixed32(){const i=this.dataView.getInt32(this.pos,!0);return this.pos+=4,i}readFixed64(){const i=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Ch;return this.pos+=8,i}readSFixed64(){const i=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Ch;return this.pos+=8,i}readFloat(){const i=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,i}readDouble(){const i=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,i}readVarint(i){const r=this.buf;let s,l;return l=r[this.pos++],s=127&l,l<128?s:(l=r[this.pos++],s|=(127&l)<<7,l<128?s:(l=r[this.pos++],s|=(127&l)<<14,l<128?s:(l=r[this.pos++],s|=(127&l)<<21,l<128?s:(l=r[this.pos],s|=(15&l)<<28,(function(p,f,_){const g=_.buf;let v,b;if(b=g[_.pos++],v=(112&b)>>4,b<128||(b=g[_.pos++],v|=(127&b)<<3,b<128)||(b=g[_.pos++],v|=(127&b)<<10,b<128)||(b=g[_.pos++],v|=(127&b)<<17,b<128)||(b=g[_.pos++],v|=(127&b)<<24,b<128)||(b=g[_.pos++],v|=(1&b)<<31,b<128))return Np(p,v,f);throw new Error("Expected varint not more than 10 bytes")})(s,i,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const i=this.readVarint();return i%2==1?(i+1)/-2:i/2}readBoolean(){return!!this.readVarint()}readString(){const i=this.readVarint()+this.pos,r=this.pos;return this.pos=i,i-r>=12&&Nu?Nu.decode(this.buf.subarray(r,i)):(function(s,l,p){let f="",_=l;for(;_<p;){const g=s[_];let v,b,S,I=null,C=g>239?4:g>223?3:g>191?2:1;if(_+C>p)break;C===1?g<128&&(I=g):C===2?(v=s[_+1],(192&v)==128&&(I=(31&g)<<6|63&v,I<=127&&(I=null))):C===3?(v=s[_+1],b=s[_+2],(192&v)==128&&(192&b)==128&&(I=(15&g)<<12|(63&v)<<6|63&b,(I<=2047||I>=55296&&I<=57343)&&(I=null))):C===4&&(v=s[_+1],b=s[_+2],S=s[_+3],(192&v)==128&&(192&b)==128&&(192&S)==128&&(I=(15&g)<<18|(63&v)<<12|(63&b)<<6|63&S,(I<=65535||I>=1114112)&&(I=null))),I===null?(I=65533,C=1):I>65535&&(I-=65536,f+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),f+=String.fromCharCode(I),_+=C}return f})(this.buf,r,i)}readBytes(){const i=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,i);return this.pos=i,r}readPackedVarint(i=[],r){const s=this.readPackedEnd();for(;this.pos<s;)i.push(this.readVarint(r));return i}readPackedSVarint(i=[]){const r=this.readPackedEnd();for(;this.pos<r;)i.push(this.readSVarint());return i}readPackedBoolean(i=[]){const r=this.readPackedEnd();for(;this.pos<r;)i.push(this.readBoolean());return i}readPackedFloat(i=[]){const r=this.readPackedEnd();for(;this.pos<r;)i.push(this.readFloat());return i}readPackedDouble(i=[]){const r=this.readPackedEnd();for(;this.pos<r;)i.push(this.readDouble());return i}readPackedFixed32(i=[]){const r=this.readPackedEnd();for(;this.pos<r;)i.push(this.readFixed32());return i}readPackedSFixed32(i=[]){const r=this.readPackedEnd();for(;this.pos<r;)i.push(this.readSFixed32());return i}readPackedFixed64(i=[]){const r=this.readPackedEnd();for(;this.pos<r;)i.push(this.readFixed64());return i}readPackedSFixed64(i=[]){const r=this.readPackedEnd();for(;this.pos<r;)i.push(this.readSFixed64());return i}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(i){const r=7&i;if(r===0)for(;this.buf[this.pos++]>127;);else if(r===2)this.pos=this.readVarint()+this.pos;else if(r===5)this.pos+=4;else{if(r!==1)throw new Error(`Unimplemented type: ${r}`);this.pos+=8}}writeTag(i,r){this.writeVarint(i<<3|r)}realloc(i){let r=this.length||16;for(;r<this.pos+i;)r*=2;if(r!==this.length){const s=new Uint8Array(r);s.set(this.buf),this.buf=s,this.dataView=new DataView(s.buffer),this.length=r}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(i){this.realloc(4),this.dataView.setInt32(this.pos,i,!0),this.pos+=4}writeSFixed32(i){this.realloc(4),this.dataView.setInt32(this.pos,i,!0),this.pos+=4}writeFixed64(i){this.realloc(8),this.dataView.setInt32(this.pos,-1&i,!0),this.dataView.setInt32(this.pos+4,Math.floor(i*Vu),!0),this.pos+=8}writeSFixed64(i){this.realloc(8),this.dataView.setInt32(this.pos,-1&i,!0),this.dataView.setInt32(this.pos+4,Math.floor(i*Vu),!0),this.pos+=8}writeVarint(i){(i=+i||0)>268435455||i<0?(function(r,s){let l,p;if(r>=0?(l=r%4294967296|0,p=r/4294967296|0):(l=~(-r%4294967296),p=~(-r/4294967296),4294967295^l?l=l+1|0:(l=0,p=p+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),(function(f,_,g){g.buf[g.pos++]=127&f|128,f>>>=7,g.buf[g.pos++]=127&f|128,f>>>=7,g.buf[g.pos++]=127&f|128,f>>>=7,g.buf[g.pos++]=127&f|128,g.buf[g.pos]=127&(f>>>=7)})(l,0,s),(function(f,_){const g=(7&f)<<4;_.buf[_.pos++]|=g|((f>>>=3)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f|((f>>>=7)?128:0),f&&(_.buf[_.pos++]=127&f)))))})(p,s)})(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))}writeSVarint(i){this.writeVarint(i<0?2*-i-1:2*i)}writeBoolean(i){this.writeVarint(+i)}writeString(i){i=String(i),this.realloc(4*i.length),this.pos++;const r=this.pos;this.pos=(function(l,p,f){for(let _,g,v=0;v<p.length;v++){if(_=p.charCodeAt(v),_>55295&&_<57344){if(!g){_>56319||v+1===p.length?(l[f++]=239,l[f++]=191,l[f++]=189):g=_;continue}if(_<56320){l[f++]=239,l[f++]=191,l[f++]=189,g=_;continue}_=g-55296<<10|_-56320|65536,g=null}else g&&(l[f++]=239,l[f++]=191,l[f++]=189,g=null);_<128?l[f++]=_:(_<2048?l[f++]=_>>6|192:(_<65536?l[f++]=_>>12|224:(l[f++]=_>>18|240,l[f++]=_>>12&63|128),l[f++]=_>>6&63|128),l[f++]=63&_|128)}return f})(this.buf,i,this.pos);const s=this.pos-r;s>=128&&Uu(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s}writeFloat(i){this.realloc(4),this.dataView.setFloat32(this.pos,i,!0),this.pos+=4}writeDouble(i){this.realloc(8),this.dataView.setFloat64(this.pos,i,!0),this.pos+=8}writeBytes(i){const r=i.length;this.writeVarint(r),this.realloc(r);for(let s=0;s<r;s++)this.buf[this.pos++]=i[s]}writeRawMessage(i,r){this.pos++;const s=this.pos;i(r,this);const l=this.pos-s;l>=128&&Uu(s,l,this),this.pos=s-1,this.writeVarint(l),this.pos+=l}writeMessage(i,r,s){this.writeTag(i,2),this.writeRawMessage(r,s)}writePackedVarint(i,r){r.length&&this.writeMessage(i,Up,r)}writePackedSVarint(i,r){r.length&&this.writeMessage(i,$p,r)}writePackedBoolean(i,r){r.length&&this.writeMessage(i,qp,r)}writePackedFloat(i,r){r.length&&this.writeMessage(i,Zp,r)}writePackedDouble(i,r){r.length&&this.writeMessage(i,Gp,r)}writePackedFixed32(i,r){r.length&&this.writeMessage(i,Wp,r)}writePackedSFixed32(i,r){r.length&&this.writeMessage(i,Hp,r)}writePackedFixed64(i,r){r.length&&this.writeMessage(i,Xp,r)}writePackedSFixed64(i,r){r.length&&this.writeMessage(i,Kp,r)}writeBytesField(i,r){this.writeTag(i,2),this.writeBytes(r)}writeFixed32Field(i,r){this.writeTag(i,5),this.writeFixed32(r)}writeSFixed32Field(i,r){this.writeTag(i,5),this.writeSFixed32(r)}writeFixed64Field(i,r){this.writeTag(i,1),this.writeFixed64(r)}writeSFixed64Field(i,r){this.writeTag(i,1),this.writeSFixed64(r)}writeVarintField(i,r){this.writeTag(i,0),this.writeVarint(r)}writeSVarintField(i,r){this.writeTag(i,0),this.writeSVarint(r)}writeStringField(i,r){this.writeTag(i,2),this.writeString(r)}writeFloatField(i,r){this.writeTag(i,5),this.writeFloat(r)}writeDoubleField(i,r){this.writeTag(i,1),this.writeDouble(r)}writeBooleanField(i,r){this.writeVarintField(i,+r)}}function Np(o,i,r){return r?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}function Uu(o,i,r){const s=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));r.realloc(s);for(let l=r.pos-1;l>=o;l--)r.buf[l+s]=r.buf[l]}function Up(o,i){for(let r=0;r<o.length;r++)i.writeVarint(o[r])}function $p(o,i){for(let r=0;r<o.length;r++)i.writeSVarint(o[r])}function Zp(o,i){for(let r=0;r<o.length;r++)i.writeFloat(o[r])}function Gp(o,i){for(let r=0;r<o.length;r++)i.writeDouble(o[r])}function qp(o,i){for(let r=0;r<o.length;r++)i.writeBoolean(o[r])}function Wp(o,i){for(let r=0;r<o.length;r++)i.writeFixed32(o[r])}function Hp(o,i){for(let r=0;r<o.length;r++)i.writeSFixed32(o[r])}function Xp(o,i){for(let r=0;r<o.length;r++)i.writeFixed64(o[r])}function Kp(o,i){for(let r=0;r<o.length;r++)i.writeSFixed64(o[r])}function Yp(o,i,r){o===1&&r.readMessage(Qp,i)}function Qp(o,i,r){if(o===3){const{id:s,bitmap:l,width:p,height:f,left:_,top:g,advance:v}=r.readMessage(Jp,{});i.push({id:s,bitmap:new tl({width:p+6,height:f+6},l),metrics:{width:p,height:f,left:_,top:g,advance:v}})}}function Jp(o,i,r){o===1?i.id=r.readVarint():o===2?i.bitmap=r.readBytes():o===3?i.width=r.readVarint():o===4?i.height=r.readVarint():o===5?i.left=r.readSVarint():o===6?i.top=r.readSVarint():o===7&&(i.advance=r.readVarint())}function $u(o){let i=0,r=0;for(const f of o)i+=f.w*f.h,r=Math.max(r,f.w);o.sort(((f,_)=>_.h-f.h));const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),r),h:1/0}];let l=0,p=0;for(const f of o)for(let _=s.length-1;_>=0;_--){const g=s[_];if(!(f.w>g.w||f.h>g.h)){if(f.x=g.x,f.y=g.y,p=Math.max(p,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===g.w&&f.h===g.h){const v=s.pop();v&&_<s.length&&(s[_]=v)}else f.h===g.h?(g.x+=f.w,g.w-=f.w):f.w===g.w?(g.y+=f.h,g.h-=f.h):(s.push({x:g.x+f.w,y:g.y,w:g.w-f.w,h:f.h}),g.y+=f.h,g.h-=f.h);break}}return{w:l,h:p,fill:i/(l*p)||0}}class zh{constructor(i,{pixelRatio:r,version:s,stretchX:l,stretchY:p,content:f,textFitWidth:_,textFitHeight:g}){this.paddedRect=i,this.pixelRatio=r,this.stretchX=l,this.stretchY=p,this.content=f,this.version=s,this.textFitWidth=_,this.textFitHeight=g}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Zu{constructor(i,r){const s={},l={};this.haveRenderCallbacks=[];const p=[];this.addImages(i,s,p),this.addImages(r,l,p);const{w:f,h:_}=$u(p),g=new Oi({width:f||1,height:_||1});for(const v in i){const b=i[v],S=s[v].paddedRect;Oi.copy(b.data,g,{x:0,y:0},{x:S.x+1,y:S.y+1},b.data)}for(const v in r){const b=r[v],S=l[v].paddedRect,I=S.x+1,C=S.y+1,R=b.data.width,L=b.data.height;Oi.copy(b.data,g,{x:0,y:0},{x:I,y:C},b.data),Oi.copy(b.data,g,{x:0,y:L-1},{x:I,y:C-1},{width:R,height:1}),Oi.copy(b.data,g,{x:0,y:0},{x:I,y:C+L},{width:R,height:1}),Oi.copy(b.data,g,{x:R-1,y:0},{x:I-1,y:C},{width:1,height:L}),Oi.copy(b.data,g,{x:0,y:0},{x:I+R,y:C},{width:1,height:L})}this.image=g,this.iconPositions=s,this.patternPositions=l}addImages(i,r,s){for(const l in i){const p=i[l],f={x:0,y:0,w:p.data.width+2,h:p.data.height+2};s.push(f),r[l]=new zh(f,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(l)}}patchUpdatedImages(i,r){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in i.updatedImages)this.patchUpdatedImage(this.iconPositions[s],i.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],i.getImage(s),r)}patchUpdatedImage(i,r,s){if(!i||!r||i.version===r.version)return;i.version=r.version;const[l,p]=i.tl;s.update(r.data,void 0,{x:l,y:p})}}var pa;Ct("ImagePosition",zh),Ct("ImageAtlas",Zu),z.ao=void 0,(pa=z.ao||(z.ao={}))[pa.none=0]="none",pa[pa.horizontal=1]="horizontal",pa[pa.vertical=2]="vertical",pa[pa.horizontalOnly=3]="horizontalOnly";class hl{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(i,r,s){const l=new hl;return l.scale=i||1,l.fontStack=r,l.verticalAlign=s||"bottom",l}static forImage(i,r){const s=new hl;return s.imageName=i,s.verticalAlign=r||"bottom",s}}class Js{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,r){const s=new Js;for(let l=0;l<i.sections.length;l++){const p=i.sections[l];p.image?s.addImageSection(p):s.addTextSection(p,r)}return s}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=(function(i){let r="";for(let s=0;s<i.length;s++){const l=i.charCodeAt(s+1)||null,p=i.charCodeAt(s-1)||null;r+=l&&mc(l)&&!cl[i[s+1]]||p&&mc(p)&&!cl[i[s-1]]||!cl[i[s]]?i[s]:cl[i[s]]}return r})(this.text)}trim(){let i=0;for(let s=0;s<this.text.length&&Dc[this.text.charCodeAt(s)];s++)i++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=i&&Dc[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(i,r),this.sectionIndex=this.sectionIndex.slice(i,r)}substring(i,r){const s=new Js;return s.text=this.text.substring(i,r),s.sectionIndex=this.sectionIndex.slice(i,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((i,r)=>Math.max(i,this.sections[r].scale)),0)}getMaxImageSize(i){let r=0,s=0;for(let l=0;l<this.length();l++){const p=this.getSection(l);if(p.imageName){const f=i[p.imageName];if(!f)continue;const _=f.displaySize;r=Math.max(r,_[0]),s=Math.max(s,_[1])}}return{maxImageWidth:r,maxImageHeight:s}}addTextSection(i,r){this.text+=i.text,this.sections.push(hl.forText(i.scale,i.fontStack||r,i.verticalAlign));const s=this.sections.length-1;for(let l=0;l<i.text.length;++l)this.sectionIndex.push(s)}addImageSection(i){const r=i.image?i.image.name:"";if(r.length===0)return void Ee("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(hl.forImage(r,i.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Ee("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function kc(o,i,r,s,l,p,f,_,g,v,b,S,I,C,R){const L=Js.fromFeature(o,l);let B;S===z.ao.vertical&&L.verticalizePunctuation();const{processBidirectionalText:N,processStyledBidirectionalText:it}=Cr;if(N&&L.sections.length===1){B=[];const at=N(L.toString(),Rh(L,v,p,i,s,C));for(const dt of at){const gt=new Js;gt.text=dt,gt.sections=L.sections;for(let Mt=0;Mt<dt.length;Mt++)gt.sectionIndex.push(0);B.push(gt)}}else if(it){B=[];const at=it(L.text,L.sectionIndex,Rh(L,v,p,i,s,C));for(const dt of at){const gt=new Js;gt.text=dt[0],gt.sectionIndex=dt[1],gt.sections=L.sections,B.push(gt)}}else B=(function(at,dt){const gt=[],Mt=at.text;let bt=0;for(const St of dt)gt.push(at.substring(bt,St)),bt=St;return bt<Mt.length&&gt.push(at.substring(bt,Mt.length)),gt})(L,Rh(L,v,p,i,s,C));const G=[],K={positionedLines:G,text:L.toString(),top:b[1],bottom:b[1],left:b[0],right:b[0],writingMode:S,iconsInText:!1,verticalizable:!1};return(function(at,dt,gt,Mt,bt,St,kt,Tt,Pt,ft,Bt,Vt){let Lt=0,zt=0,ee=0,Ce=0;const Ge=Tt==="right"?1:Tt==="left"?0:.5,_i=Ye/Vt;let ir=0;for(const Pe of bt){Pe.trim();const Qe=Pe.getMaxScale(),ci={positionedGlyphs:[],lineOffset:0};at.positionedLines[ir]=ci;const hi=ci.positionedGlyphs;let Ri=0;if(!Pe.length()){zt+=St,++ir;continue}const rr=of(Mt,Pe,_i);for(let Vi=0;Vi<Pe.length();Vi++){const qe=Pe.getSection(Vi),ti=Pe.getSectionIndex(Vi),ei=Pe.getCharCode(Vi),Oe=af(Pt,Bt,ei);let ge;if(qe.imageName){if(at.iconsInText=!0,qe.scale=qe.scale*_i,ge=nf(qe,Oe,Qe,rr,Mt),!ge)continue;Ri=Math.max(Ri,ge.imageOffset)}else if(ge=sf(qe,ei,Oe,rr,dt,gt),!ge)continue;const{rect:Rr,metrics:on,baselineOffset:Er}=ge;hi.push({glyph:ei,imageName:qe.imageName,x:Lt,y:zt+Er+-17,vertical:Oe,scale:qe.scale,fontStack:qe.fontStack,sectionIndex:ti,metrics:on,rect:Rr}),Oe?(at.verticalizable=!0,Lt+=(qe.imageName?on.advance:Ye)*qe.scale+ft):Lt+=on.advance*qe.scale+ft}hi.length!==0&&(ee=Math.max(Lt-ft,ee),lf(hi,0,hi.length-1,Ge)),Lt=0,ci.lineOffset=Math.max(Ri,(Qe-1)*Ye);const Je=St*Qe+Ri;zt+=Je,Ce=Math.max(Je,Ce),++ir}const{horizontalAlign:ji,verticalAlign:li}=Eh(kt);(function(Pe,Qe,ci,hi,Ri,rr,Je,Vi,qe){const ti=(Qe-ci)*Ri;let ei=0;ei=rr!==Je?-Vi*hi- -17:-hi*qe*Je+.5*Je;for(const Oe of Pe)for(const ge of Oe.positionedGlyphs)ge.x+=ti,ge.y+=ei})(at.positionedLines,Ge,ji,li,ee,Ce,St,zt,bt.length),at.top+=-li*zt,at.bottom=at.top+zt,at.left+=-ji*ee,at.right=at.left+ee})(K,i,r,s,B,f,_,g,S,v,I,R),!(function(at){for(const dt of at)if(dt.positionedGlyphs.length!==0)return!1;return!0})(G)&&K}const Dc={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tf={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},ef={40:!0};function Gu(o,i,r,s,l,p){if(i.imageName){const f=s[i.imageName];return f?f.displaySize[0]*i.scale*Ye/p+l:0}{const f=r[i.fontStack],_=f&&f[o];return _?_.metrics.advance*i.scale+l:0}}function qu(o,i,r,s){const l=Math.pow(o-i,2);return s?o<i?l/2:2*l:l+Math.abs(r)*r}function rf(o,i,r){let s=0;return o===10&&(s-=1e4),r&&(s+=150),o!==40&&o!==65288||(s+=50),i!==41&&i!==65289||(s+=50),s}function Wu(o,i,r,s,l,p){let f=null,_=qu(i,r,l,p);for(const g of s){const v=qu(i-g.x,r,l,p)+g.badness;v<=_&&(f=g,_=v)}return{index:o,x:i,priorBreak:f,badness:_}}function Hu(o){return o?Hu(o.priorBreak).concat(o.index):[]}function Rh(o,i,r,s,l,p){if(!o)return[];const f=[],_=(function(S,I,C,R,L,B){let N=0;for(let it=0;it<S.length();it++){const G=S.getSection(it);N+=Gu(S.getCharCode(it),G,R,L,I,B)}return N/Math.max(1,Math.ceil(N/C))})(o,i,r,s,l,p),g=o.text.indexOf("")>=0;let v=0;for(let S=0;S<o.length();S++){const I=o.getSection(S),C=o.getCharCode(S);if(Dc[C]||(v+=Gu(C,I,s,l,i,p)),S<o.length()-1){const R=!((b=C)<11904)&&(!!Qt["CJK Compatibility Forms"](b)||!!Qt["CJK Compatibility"](b)||!!Qt["CJK Strokes"](b)||!!Qt["CJK Symbols and Punctuation"](b)||!!Qt["Enclosed CJK Letters and Months"](b)||!!Qt["Halfwidth and Fullwidth Forms"](b)||!!Qt["Ideographic Description Characters"](b)||!!Qt["Vertical Forms"](b)||Bs.test(String.fromCodePoint(b)));(tf[C]||R||I.imageName||S!==o.length()-2&&ef[o.getCharCode(S+1)])&&f.push(Wu(S+1,v,_,f,rf(C,o.getCharCode(S+1),R&&g),!1))}}var b;return Hu(Wu(o.length(),v,_,f,0,!0))}function Eh(o){let i=.5,r=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:i,verticalAlign:r}}function of(o,i,r){const s=i.getMaxScale()*Ye,{maxImageWidth:l,maxImageHeight:p}=i.getMaxImageSize(o),f=Math.max(s,p*r);return{verticalLineContentWidth:Math.max(s,l*r),horizontalLineContentHeight:f}}function Xu(o){switch(o){case"top":return 0;case"center":return .5;default:return 1}}function af(o,i,r){return!(o===z.ao.horizontal||!i&&!Os(r)||i&&(Dc[r]||(s=r,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(s)))));var s}function sf(o,i,r,s,l,p){const f=p[o.fontStack],_=(function(v,b,S,I){if(v&&v.rect)return v;const C=b[S.fontStack],R=C&&C[I];return R?{rect:null,metrics:R.metrics}:null})(f&&f[i],l,o,i);if(_===null)return null;let g;if(r)g=s.verticalLineContentWidth-o.scale*Ye;else{const v=Xu(o.verticalAlign);g=(s.horizontalLineContentHeight-o.scale*Ye)*v}return{rect:_.rect,metrics:_.metrics,baselineOffset:g}}function nf(o,i,r,s,l){const p=l[o.imageName];if(!p)return null;const f=p.paddedRect,_=p.displaySize,g={width:_[0],height:_[1],left:1,top:-3,advance:i?_[1]:_[0]};let v;if(i)v=s.verticalLineContentWidth-_[1]*o.scale;else{const b=Xu(o.verticalAlign);v=(s.horizontalLineContentHeight-_[1]*o.scale)*b}return{rect:f,metrics:g,baselineOffset:v,imageOffset:(i?_[0]:_[1])*o.scale-Ye*r}}function lf(o,i,r,s){if(s===0)return;const l=o[r],p=(o[r].x+l.metrics.advance*l.scale)*s;for(let f=i;f<=r;f++)o[f].x-=p}function cf(o,i,r){const{horizontalAlign:s,verticalAlign:l}=Eh(r),p=i[0]-o.displaySize[0]*s,f=i[1]-o.displaySize[1]*l;return{image:o,top:f,bottom:f+o.displaySize[1],left:p,right:p+o.displaySize[0]}}function Ku(o){var i,r;let s=o.left,l=o.top,p=o.right-s,f=o.bottom-l;const _=(i=o.image.textFitWidth)!==null&&i!==void 0?i:"stretchOrShrink",g=(r=o.image.textFitHeight)!==null&&r!==void 0?r:"stretchOrShrink",v=(o.image.content[2]-o.image.content[0])/(o.image.content[3]-o.image.content[1]);if(g==="proportional"){if(_==="stretchOnly"&&p/f<v||_==="proportional"){const b=Math.ceil(f*v);s*=b/p,p=b}}else if(_==="proportional"&&g==="stretchOnly"&&v!==0&&p/f>v){const b=Math.ceil(p/v);l*=b/f,f=b}return{x1:s,y1:l,x2:s+p,y2:l+f}}function Yu(o,i,r,s,l,p){const f=o.image;let _;if(f.content){const B=f.content,N=f.pixelRatio||1;_=[B[0]/N,B[1]/N,f.displaySize[0]-B[2]/N,f.displaySize[1]-B[3]/N]}const g=i.left*p,v=i.right*p;let b,S,I,C;r==="width"||r==="both"?(C=l[0]+g-s[3],S=l[0]+v+s[1]):(C=l[0]+(g+v-f.displaySize[0])/2,S=C+f.displaySize[0]);const R=i.top*p,L=i.bottom*p;return r==="height"||r==="both"?(b=l[1]+R-s[0],I=l[1]+L+s[2]):(b=l[1]+(R+L-f.displaySize[1])/2,I=b+f.displaySize[1]),{image:f,top:b,right:S,bottom:I,left:C,collisionPadding:_}}const Mo=128,fa=32640;function Qu(o,i){const{expression:r}=i;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ce(o+1))};if(r.kind==="source")return{kind:"source"};{const{zoomStops:s,interpolationType:l}=r;let p=0;for(;p<s.length&&s[p]<=o;)p++;p=Math.max(0,p-1);let f=p;for(;f<s.length&&s[f]<o+1;)f++;f=Math.min(s.length-1,f);const _=s[p],g=s[f];return r.kind==="composite"?{kind:"composite",minZoom:_,maxZoom:g,interpolationType:l}:{kind:"camera",minZoom:_,maxZoom:g,minSize:r.evaluate(new ce(_)),maxSize:r.evaluate(new ce(g)),interpolationType:l}}}function kh(o,i,r){let s="never";const l=o.get(i);return l?s=l:o.get(r)&&(s="always"),s}const hf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Lc(o,i,r,s,l,p,f,_,g,v,b,S,I){const C=_?Math.min(fa,Math.round(_[0])):0,R=_?Math.min(fa,Math.round(_[1])):0;o.emplaceBack(i,r,Math.round(32*s),Math.round(32*l),p,f,(C<<1)+(g?1:0),R,16*v,16*b,256*S,256*I)}function Dh(o,i,r){o.emplaceBack(i.x,i.y,r),o.emplaceBack(i.x,i.y,r),o.emplaceBack(i.x,i.y,r),o.emplaceBack(i.x,i.y,r)}function uf(o){for(const i of o.sections)if(ch(i.text))return!0;return!1}class Lh{constructor(i){this.layoutVertexArray=new ct,this.indexArray=new jt,this.programConfigurations=i,this.segments=new Wt,this.dynamicLayoutVertexArray=new xt,this.opacityVertexArray=new vt,this.hasVisibleVertices=!1,this.placedSymbolArray=new M}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,r,s,l){this.isEmpty()||(s&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Fp.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,Bp.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,hf,!0),this.opacityVertexBuffer.itemSize=1),(s||l)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ct("SymbolBuffers",Lh);class Fh{constructor(i,r,s){this.layoutVertexArray=new i,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Wt,this.collisionVertexArray=new At}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,Op.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ct("CollisionBuffers",Fh);class tn{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=Lr(globalThis)?Math.min(i.overscaling,128):i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map((f=>f.id)),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasDependencies=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Qu(this.zoom,r["text-size"]),this.iconSizeData=Qu(this.zoom,r["icon-size"]);const s=this.layers[0].layout,l=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.canOverlap=kh(s,"text-overlap","text-allow-overlap")!=="never"||kh(s,"icon-overlap","icon-allow-overlap")!=="never"||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&!l.isConstant(),this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map((f=>z.ao[f]))),this.stateDependentLayerIds=this.layers.filter((f=>f.isStateDependent())).map((f=>f.id)),this.sourceID=i.sourceID}createArrays(){this.text=new Lh(new Xr(this.layers,this.zoom,(i=>/^text/.test(i)))),this.icon=new Lh(new Xr(this.layers,this.zoom,(i=>/^icon/.test(i)))),this.glyphOffsetArray=new D,this.lineVertexArray=new O,this.symbolInstances=new A,this.textAnchorOffsets=new V}calculateGlyphDependencies(i,r,s,l,p){for(let f=0;f<i.length;f++)if(r[i.charCodeAt(f)]=!0,(s||l)&&p){const _=cl[i.charAt(f)];_&&(r[_.charCodeAt(0)]=!0)}}populate(i,r,s){const l=this.layers[0],p=l.layout,f=p.get("text-font"),_=p.get("text-field"),g=p.get("icon-image"),v=(_.value.kind!=="constant"||_.value.value instanceof oi&&!_.value.value.isEmpty()||_.value.value.toString().length>0)&&(f.value.kind!=="constant"||f.value.value.length>0),b=g.value.kind!=="constant"||!!g.value.value||Object.keys(g.parameters).length>0,S=p.get("symbol-sort-key");if(this.features=[],!v&&!b)return;const I=r.iconDependencies,C=r.glyphDependencies,R=r.availableImages,L=new ce(this.zoom);for(const{feature:B,id:N,index:it,sourceLayerIndex:G}of i){const K=l._featureFilter.needGeometry,at=qa(B,K);if(!l._featureFilter.filter(L,at,s))continue;let dt,gt;if(K||(at.geometry=zr(B)),v){const bt=l.getValueAndResolveTokens("text-field",at,s,R),St=oi.factory(bt),kt=this.hasRTLText=this.hasRTLText||uf(St);(!kt||Cr.getRTLTextPluginStatus()==="unavailable"||kt&&Cr.isParsed())&&(dt=Vp(St,l,at))}if(b){const bt=l.getValueAndResolveTokens("icon-image",at,s,R);gt=bt instanceof si?bt:si.fromString(bt)}if(!dt&&!gt)continue;const Mt=this.sortFeaturesByKey?S.evaluate(at,{},s):void 0;if(this.features.push({id:N,text:dt,icon:gt,index:it,sourceLayerIndex:G,geometry:at.geometry,properties:B.properties,type:Qs.types[B.type],sortKey:Mt}),gt&&(I[gt.name]=!0),dt){const bt=f.evaluate(at,{},s).join(","),St=p.get("text-rotation-alignment")!=="viewport"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(z.ao.vertical)>=0;for(const kt of dt.sections)if(kt.image)I[kt.image.name]=!0;else{const Tt=na(dt.toString()),Pt=kt.fontStack||bt,ft=C[Pt]=C[Pt]||{};this.calculateGlyphDependencies(kt.text,ft,St,this.allowVerticalPlacement,Tt)}}}p.get("symbol-placement")==="line"&&(this.features=(function(B){const N={},it={},G=[];let K=0;function at(bt){G.push(B[bt]),K++}function dt(bt,St,kt){const Tt=it[bt];return delete it[bt],it[St]=Tt,G[Tt].geometry[0].pop(),G[Tt].geometry[0]=G[Tt].geometry[0].concat(kt[0]),Tt}function gt(bt,St,kt){const Tt=N[St];return delete N[St],N[bt]=Tt,G[Tt].geometry[0].shift(),G[Tt].geometry[0]=kt[0].concat(G[Tt].geometry[0]),Tt}function Mt(bt,St,kt){const Tt=kt?St[0][St[0].length-1]:St[0][0];return`${bt}:${Tt.x}:${Tt.y}`}for(let bt=0;bt<B.length;bt++){const St=B[bt],kt=St.geometry,Tt=St.text?St.text.toString():null;if(!Tt){at(bt);continue}const Pt=Mt(Tt,kt),ft=Mt(Tt,kt,!0);if(Pt in it&&ft in N&&it[Pt]!==N[ft]){const Bt=gt(Pt,ft,kt),Vt=dt(Pt,ft,G[Bt].geometry);delete N[Pt],delete it[ft],it[Mt(Tt,G[Vt].geometry,!0)]=Vt,G[Bt].geometry=null}else Pt in it?dt(Pt,ft,kt):ft in N?gt(Pt,ft,kt):(at(bt),N[Pt]=K-1,it[ft]=K-1)}return G.filter((bt=>bt.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((B,N)=>B.sortKey-N.sortKey))}update(i,r,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,r,this.layers,{imagePositions:s}),this.icon.programConfigurations.updatePaintArrays(i,r,this.layers,{imagePositions:s}))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,r){const s=this.lineVertexArray.length;if(i.segment!==void 0){let l=i.dist(r[i.segment+1]),p=i.dist(r[i.segment]);const f={};for(let _=i.segment+1;_<r.length;_++)f[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:l},_<r.length-1&&(l+=r[_+1].dist(r[_]));for(let _=i.segment||0;_>=0;_--)f[_]={x:r[_].x,y:r[_].y,tileUnitDistanceFromAnchor:p},_>0&&(p+=r[_-1].dist(r[_]));for(let _=0;_<r.length;_++){const g=f[_];this.lineVertexArray.emplaceBack(g.x,g.y,g.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(i,r,s,l,p,f,_,g,v,b,S,I){const C=i.indexArray,R=i.layoutVertexArray,L=i.segments.prepareSegment(4*r.length,R,C,this.canOverlap?f.sortKey:void 0),B=this.glyphOffsetArray.length,N=L.vertexLength,it=this.allowVerticalPlacement&&_===z.ao.vertical?Math.PI/2:0,G=f.text&&f.text.sections;for(let K=0;K<r.length;K++){const{tl:at,tr:dt,bl:gt,br:Mt,tex:bt,pixelOffsetTL:St,pixelOffsetBR:kt,minFontScaleX:Tt,minFontScaleY:Pt,glyphOffset:ft,isSDF:Bt,sectionIndex:Vt}=r[K],Lt=L.vertexLength,zt=ft[1];Lc(R,g.x,g.y,at.x,zt+at.y,bt.x,bt.y,s,Bt,St.x,St.y,Tt,Pt),Lc(R,g.x,g.y,dt.x,zt+dt.y,bt.x+bt.w,bt.y,s,Bt,kt.x,St.y,Tt,Pt),Lc(R,g.x,g.y,gt.x,zt+gt.y,bt.x,bt.y+bt.h,s,Bt,St.x,kt.y,Tt,Pt),Lc(R,g.x,g.y,Mt.x,zt+Mt.y,bt.x+bt.w,bt.y+bt.h,s,Bt,kt.x,kt.y,Tt,Pt),Dh(i.dynamicLayoutVertexArray,g,it),C.emplaceBack(Lt,Lt+2,Lt+1),C.emplaceBack(Lt+1,Lt+2,Lt+3),L.vertexLength+=4,L.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ft[0]),K!==r.length-1&&Vt===r[K+1].sectionIndex||i.programConfigurations.populatePaintArrays(R.length,f,f.index,{imagePositions:{},canonical:I,formattedSection:G&&G[Vt]})}i.placedSymbolArray.emplaceBack(g.x,g.y,B,this.glyphOffsetArray.length-B,N,v,b,g.segment,s?s[0]:0,s?s[1]:0,l[0],l[1],_,0,!1,0,S)}_addCollisionDebugVertex(i,r,s,l,p,f){return r.emplaceBack(0,0),i.emplaceBack(s.x,s.y,l,p,Math.round(f.x),Math.round(f.y))}addCollisionDebugVertices(i,r,s,l,p,f,_){const g=p.segments.prepareSegment(4,p.layoutVertexArray,p.indexArray),v=g.vertexLength,b=p.layoutVertexArray,S=p.collisionVertexArray,I=_.anchorX,C=_.anchorY;this._addCollisionDebugVertex(b,S,f,I,C,new It(i,r)),this._addCollisionDebugVertex(b,S,f,I,C,new It(s,r)),this._addCollisionDebugVertex(b,S,f,I,C,new It(s,l)),this._addCollisionDebugVertex(b,S,f,I,C,new It(i,l)),g.vertexLength+=4;const R=p.indexArray;R.emplaceBack(v,v+1),R.emplaceBack(v+1,v+2),R.emplaceBack(v+2,v+3),R.emplaceBack(v+3,v),g.primitiveLength+=4}addDebugCollisionBoxes(i,r,s,l){for(let p=i;p<r;p++){const f=this.collisionBoxArray.get(p);this.addCollisionDebugVertices(f.x1,f.y1,f.x2,f.y2,l?this.textCollisionBox:this.iconCollisionBox,f.anchorPoint,s)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Fh(mt,ju.members,ae),this.iconCollisionBox=new Fh(mt,ju.members,ae);for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i);this.addDebugCollisionBoxes(r.textBoxStartIndex,r.textBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r,!0),this.addDebugCollisionBoxes(r.iconBoxStartIndex,r.iconBoxEndIndex,r,!1),this.addDebugCollisionBoxes(r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r,!1)}}_deserializeCollisionBoxesForSymbol(i,r,s,l,p,f,_,g,v){const b={};for(let S=r;S<s;S++){const I=i.get(S);b.textBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},b.textFeatureIndex=I.featureIndex;break}for(let S=l;S<p;S++){const I=i.get(S);b.verticalTextBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},b.verticalTextFeatureIndex=I.featureIndex;break}for(let S=f;S<_;S++){const I=i.get(S);b.iconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},b.iconFeatureIndex=I.featureIndex;break}for(let S=g;S<v;S++){const I=i.get(S);b.verticalIconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},b.verticalIconFeatureIndex=I.featureIndex;break}return b}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,r){const s=i.placedSymbolArray.get(r),l=s.vertexStartIndex+4*s.numGlyphs;for(let p=s.vertexStartIndex;p<l;p+=4)i.indexArray.emplaceBack(p,p+2,p+1),i.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const r=Math.sin(i),s=Math.cos(i),l=[],p=[],f=[];for(let _=0;_<this.symbolInstances.length;++_){f.push(_);const g=this.symbolInstances.get(_);l.push(0|Math.round(r*g.anchorX+s*g.anchorY)),p.push(g.featureIndex)}return f.sort(((_,g)=>l[_]-l[g]||p[g]-p[_])),f}addToSortKeyRanges(i,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach(((l,p,f)=>{l>=0&&f.indexOf(l)===p&&this.addIndicesForPlacedSymbol(this.text,l)})),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ju,td;Ct("SymbolBucket",tn,{omit:["layers","collisionBoxArray","features","compareText"]}),tn.MAX_GLYPHS=65535,tn.addDynamicAttributes=Dh;var Bh={get paint(){return td=td||new Ti({"icon-opacity":new Ft(rt.paint_symbol["icon-opacity"]),"icon-color":new Ft(rt.paint_symbol["icon-color"]),"icon-halo-color":new Ft(rt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ft(rt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ft(rt.paint_symbol["icon-halo-blur"]),"icon-translate":new Rt(rt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Rt(rt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ft(rt.paint_symbol["text-opacity"]),"text-color":new Ft(rt.paint_symbol["text-color"],{runtimeType:$i,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Ft(rt.paint_symbol["text-halo-color"]),"text-halo-width":new Ft(rt.paint_symbol["text-halo-width"]),"text-halo-blur":new Ft(rt.paint_symbol["text-halo-blur"]),"text-translate":new Rt(rt.paint_symbol["text-translate"]),"text-translate-anchor":new Rt(rt.paint_symbol["text-translate-anchor"])})},get layout(){return Ju=Ju||new Ti({"symbol-placement":new Rt(rt.layout_symbol["symbol-placement"]),"symbol-spacing":new Rt(rt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Rt(rt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ft(rt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Rt(rt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Rt(rt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Rt(rt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Rt(rt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Rt(rt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Rt(rt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ft(rt.layout_symbol["icon-size"]),"icon-text-fit":new Rt(rt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Rt(rt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ft(rt.layout_symbol["icon-image"]),"icon-rotate":new Ft(rt.layout_symbol["icon-rotate"]),"icon-padding":new Ft(rt.layout_symbol["icon-padding"]),"icon-keep-upright":new Rt(rt.layout_symbol["icon-keep-upright"]),"icon-offset":new Ft(rt.layout_symbol["icon-offset"]),"icon-anchor":new Ft(rt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Rt(rt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Rt(rt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Rt(rt.layout_symbol["text-rotation-alignment"]),"text-field":new Ft(rt.layout_symbol["text-field"]),"text-font":new Ft(rt.layout_symbol["text-font"]),"text-size":new Ft(rt.layout_symbol["text-size"]),"text-max-width":new Ft(rt.layout_symbol["text-max-width"]),"text-line-height":new Rt(rt.layout_symbol["text-line-height"]),"text-letter-spacing":new Ft(rt.layout_symbol["text-letter-spacing"]),"text-justify":new Ft(rt.layout_symbol["text-justify"]),"text-radial-offset":new Ft(rt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Rt(rt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Ft(rt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Ft(rt.layout_symbol["text-anchor"]),"text-max-angle":new Rt(rt.layout_symbol["text-max-angle"]),"text-writing-mode":new Rt(rt.layout_symbol["text-writing-mode"]),"text-rotate":new Ft(rt.layout_symbol["text-rotate"]),"text-padding":new Rt(rt.layout_symbol["text-padding"]),"text-keep-upright":new Rt(rt.layout_symbol["text-keep-upright"]),"text-transform":new Ft(rt.layout_symbol["text-transform"]),"text-offset":new Ft(rt.layout_symbol["text-offset"]),"text-allow-overlap":new Rt(rt.layout_symbol["text-allow-overlap"]),"text-overlap":new Rt(rt.layout_symbol["text-overlap"]),"text-ignore-placement":new Rt(rt.layout_symbol["text-ignore-placement"]),"text-optional":new Rt(rt.layout_symbol["text-optional"])})}};class ed{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:xi,this.defaultValue=i}evaluate(i){if(i.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(i.formattedSection))return r.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ct("FormatSectionOverride",ed,{omit:["defaultValue"]});class Fc extends Ji{constructor(i,r){super(i,Bh,r)}recalculate(i,r){if(super.recalculate(i,r),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const s=this.layout.get("text-writing-mode");if(s){const l=[];for(const p of s)l.indexOf(p)<0&&l.push(p);this.layout._values["text-writing-mode"]=l}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,r,s,l){const p=this.layout.get(i).evaluate(r,{},s,l),f=this._unevaluatedLayout._values[i];return f.isDataDriven()||Is(f.value)||!p?p:(function(_,g){return g.replace(/{([^{}]+)}/g,((v,b)=>_&&b in _?String(_[b]):""))})(r.properties,p)}createBucket(i){return new tn(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of Bh.paint.overridableProperties){if(!Fc.hasPaintOverride(this.layout,i))continue;const r=this.paint.get(i),s=new ed(r),l=new Ms(s,r.property.specification);let p=null;p=r.value.kind==="constant"||r.value.kind==="source"?new As("source",l):new En("composite",l,r.value.zoomStops),this.paint._values[i]=new ur(r.property,p,r.parameters)}}_handleOverridablePaintPropertyUpdate(i,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Fc.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,r){const s=i.get("text-field"),l=Bh.paint.properties[r];let p=!1;const f=_=>{for(const g of _)if(l.overrides&&l.overrides.hasOverride(g))return void(p=!0)};if(s.value.kind==="constant"&&s.value.value instanceof oi)f(s.value.value.sections);else if(s.value.kind==="source"||s.value.kind==="composite"){const _=v=>{p||(v instanceof Pr&&we(v.value)===Oo?f(v.value.sections):v instanceof fs?f(v.sections):v.eachChild(_))},g=s.value;g._styleExpression&&_(g._styleExpression.expression)}return p}}let id;var df={get paint(){return id=id||new Ti({"background-color":new Rt(rt.paint_background["background-color"]),"background-pattern":new Wn(rt.paint_background["background-pattern"]),"background-opacity":new Rt(rt.paint_background["background-opacity"])})}};class pf extends Ji{constructor(i,r){super(i,df,r)}}class ff extends Ji{constructor(i,r){super(i,{},r),this.onAdd=s=>{this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},this.onRemove=s=>{this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class mf{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const _f={once:!0},Oh=63710088e-1;class ma{constructor(i,r){if(isNaN(i)||isNaN(r))throw new Error(`Invalid LngLat object: (${i}, ${r})`);if(this.lng=+i,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ma(io(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const r=Math.PI/180,s=this.lat*r,l=i.lat*r,p=Math.sin(s)*Math.sin(l)+Math.cos(s)*Math.cos(l)*Math.cos((i.lng-this.lng)*r);return Oh*Math.acos(Math.min(p,1))}static convert(i){if(i instanceof ma)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new ma(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new ma(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const rd=2*Math.PI*Oh;function od(o){return rd*Math.cos(o*Math.PI/180)}function ad(o){return(180+o)/360}function sd(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function nd(o,i){return o/od(i)}function jh(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function ld(o,i){return o*od(jh(i))}class ul{constructor(i,r,s=0){this.x=+i,this.y=+r,this.z=+s}static fromLngLat(i,r=0){const s=ma.convert(i);return new ul(ad(s.lng),sd(s.lat),nd(r,s.lat))}toLngLat(){return new ma(360*this.x-180,jh(this.y))}toAltitude(){return ld(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/rd*(i=jh(this.y),1/Math.cos(i*Math.PI/180));var i}}function cd(o,i,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[o*s-2*Math.PI*6378137/2,i*s-2*Math.PI*6378137/2]}class Vh{constructor(i,r,s){if(!(function(l,p,f){return!(l<0||l>25||f<0||f>=Math.pow(2,l)||p<0||p>=Math.pow(2,l))})(i,r,s))throw new Error(`x=${r}, y=${s}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=r,this.y=s,this.key=en(0,i,i,r,s)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,r,s){const l=(f=this.y,_=this.z,g=cd(256*(p=this.x),256*(f=Math.pow(2,_)-f-1),_),v=cd(256*(p+1),256*(f+1),_),g[0]+","+g[1]+","+v[0]+","+v[1]);var p,f,_,g,v;const b=(function(S,I,C){let R,L="";for(let B=S;B>0;B--)R=1<<B-1,L+=(I&R?1:0)+(C&R?2:0);return L})(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,r>1?"@2x":"").replace(/{quadkey}/g,b).replace(/{bbox-epsg-3857}/g,l)}isChildOf(i){const r=this.z-i.z;return r>0&&i.x===this.x>>r&&i.y===this.y>>r}getTilePoint(i){const r=Math.pow(2,this.z);return new It((i.x*r-this.x)*ne,(i.y*r-this.y)*ne)}toString(){return`${this.z}/${this.x}/${this.y}`}}class hd{constructor(i,r){this.wrap=i,this.canonical=r,this.key=en(i,r.z,r.z,r.x,r.y)}}class er{constructor(i,r,s,l,p){if(this.terrainRttPosMatrix32f=null,i<s)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${s}`);this.overscaledZ=i,this.wrap=r,this.canonical=new Vh(s,+l,+p),this.key=en(r,i,s,l,p)}clone(){return new er(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const r=this.canonical.z-i;return i>this.canonical.z?new er(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new er(i,this.wrap,i,this.canonical.x>>r,this.canonical.y>>r)}isOverscaled(){return this.overscaledZ>this.canonical.z}calculateScaledKey(i,r){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const s=this.canonical.z-i;return i>this.canonical.z?en(this.wrap*+r,i,this.canonical.z,this.canonical.x,this.canonical.y):en(this.wrap*+r,i,i,this.canonical.x>>s,this.canonical.y>>s)}isChildOf(i){if(i.wrap!==this.wrap||this.overscaledZ-i.overscaledZ<=0)return!1;if(i.overscaledZ===0)return this.overscaledZ>0;const r=this.canonical.z-i.canonical.z;return!(r<0)&&i.canonical.x===this.canonical.x>>r&&i.canonical.y===this.canonical.y>>r}children(i){if(this.overscaledZ>=i)return[new er(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,l=2*this.canonical.y;return[new er(r,this.wrap,r,s,l),new er(r,this.wrap,r,s+1,l),new er(r,this.wrap,r,s,l+1),new er(r,this.wrap,r,s+1,l+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new er(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new er(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new hd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new ul(i.x-this.wrap,i.y))}}function en(o,i,r,s,l){(o*=2)<0&&(o=-1*o-1);const p=1<<r;return(p*p*o+p*l+s).toString(36)+r.toString(36)+i.toString(36)}function dl(o,i){return i?o.properties[i]:o.id}Ct("CanonicalTileID",Vh),Ct("OverscaledTileID",er,{omit:["terrainRttPosMatrix32f"]});class Xa{constructor(){this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0}extend(i){return this.minX=Math.min(this.minX,i.x),this.minY=Math.min(this.minY,i.y),this.maxX=Math.max(this.maxX,i.x),this.maxY=Math.max(this.maxY,i.y),this}expandBy(i){return this.minX-=i,this.minY-=i,this.maxX+=i,this.maxY+=i,(this.minX>this.maxX||this.minY>this.maxY)&&(this.minX=1/0,this.maxX=-1/0,this.minY=1/0,this.maxY=-1/0),this}shrinkBy(i){return this.expandBy(-i)}map(i){const r=new Xa;return r.extend(i(new It(this.minX,this.minY))),r.extend(i(new It(this.maxX,this.minY))),r.extend(i(new It(this.minX,this.maxY))),r.extend(i(new It(this.maxX,this.maxY))),r}static fromPoints(i){const r=new Xa;for(const s of i)r.extend(s);return r}contains(i){return i.x>=this.minX&&i.x<=this.maxX&&i.y>=this.minY&&i.y<=this.maxY}empty(){return this.minX>this.maxX}width(){return this.maxX-this.minX}height(){return this.maxY-this.minY}covers(i){return!this.empty()&&!i.empty()&&i.minX>=this.minX&&i.maxX<=this.maxX&&i.minY>=this.minY&&i.maxY<=this.maxY}intersects(i){return!this.empty()&&!i.empty()&&i.minX<=this.maxX&&i.maxX>=this.minX&&i.minY<=this.maxY&&i.maxY>=this.minY}}class ud{constructor(i){this._stringToNumber={},this._numberToString=[];for(let r=0;r<i.length;r++){const s=i[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class dd{constructor(i,r,s,l,p){this.type="Feature",this._vectorTileFeature=i,i._z=r,i._x=s,i._y=l,this.properties=i.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const r in this)r!=="_geometry"&&r!=="_vectorTileFeature"&&(i[r]=this[r]);return i}}class pd{constructor(i,r){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Mr(ne,16,0),this.grid3D=new Mr(ne,16,0),this.featureIndexArray=new W,this.promoteId=r}insert(i,r,s,l,p,f){const _=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,l,p);const g=f?this.grid3D:this.grid;for(let v=0;v<r.length;v++){const b=r[v],S=[1/0,1/0,-1/0,-1/0];for(let I=0;I<b.length;I++){const C=b[I];S[0]=Math.min(S[0],C.x),S[1]=Math.min(S[1],C.y),S[2]=Math.max(S[2],C.x),S[3]=Math.max(S[3],C.y)}S[0]<ne&&S[1]<ne&&S[2]>=0&&S[3]>=0&&g.insert(_,S[0],S[1],S[2],S[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new zu(new Ah(this.rawTileData)).layers,this.sourceLayerCoder=new ud(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,r,s,l){this.loadVTLayers();const p=i.params,f=ne/i.tileSize/i.scale,_=ta(p.filter,p.globalState),g=i.queryGeometry,v=i.queryPadding*f,b=Xa.fromPoints(g),S=this.grid.query(b.minX-v,b.minY-v,b.maxX+v,b.maxY+v),I=Xa.fromPoints(i.cameraQueryGeometry).expandBy(v),C=this.grid3D.query(I.minX,I.minY,I.maxX,I.maxY,((B,N,it,G)=>(function(K,at,dt,gt,Mt){for(const St of K)if(at<=St.x&&dt<=St.y&&gt>=St.x&&Mt>=St.y)return!0;const bt=[new It(at,dt),new It(at,Mt),new It(gt,Mt),new It(gt,dt)];if(K.length>2){for(const St of bt)if(Ws(K,St))return!0}for(let St=0;St<K.length-1;St++)if(Zd(K[St],K[St+1],bt))return!0;return!1})(i.cameraQueryGeometry,B-v,N-v,it+v,G+v)));for(const B of C)S.push(B);S.sort(gf);const R={};let L;for(let B=0;B<S.length;B++){const N=S[B];if(N===L)continue;L=N;const it=this.featureIndexArray.get(N);let G=null;this.loadMatchingFeature(R,it.bucketIndex,it.sourceLayerIndex,it.featureIndex,_,p.layers,p.availableImages,r,s,l,((K,at,dt)=>(G||(G=zr(K)),at.queryIntersectsFeature({queryGeometry:g,feature:K,featureState:dt,geometry:G,zoom:this.z,transform:i.transform,pixelsToTileUnits:f,pixelPosMatrix:i.pixelPosMatrix,unwrappedTileID:this.tileID.toUnwrapped(),getElevation:i.getElevation}))))}return R}loadMatchingFeature(i,r,s,l,p,f,_,g,v,b,S){const I=this.bucketLayerIDs[r];if(f&&!I.some((B=>f.has(B))))return;const C=this.sourceLayerCoder.decode(s),R=this.vtLayers[C].feature(l);if(p.needGeometry){const B=qa(R,!0);if(!p.filter(new ce(this.tileID.overscaledZ),B,this.tileID.canonical))return}else if(!p.filter(new ce(this.tileID.overscaledZ),R))return;const L=this.getId(R,C);for(let B=0;B<I.length;B++){const N=I[B];if(f&&!f.has(N))continue;const it=g[N];if(!it)continue;let G={};L&&b&&(G=b.getState(it.sourceLayer||"_geojsonTileLayer",L));const K=Li({},v[N]);K.paint=fd(K.paint,it.paint,R,G,_),K.layout=fd(K.layout,it.layout,R,G,_);const at=!S||S(R,it,G);if(!at)continue;const dt=new dd(R,this.z,this.x,this.y,L);dt.layer=K;let gt=i[N];gt===void 0&&(gt=i[N]=[]),gt.push({featureIndex:l,feature:dt,intersectionZ:at})}}lookupSymbolFeatures(i,r,s,l,p,f,_,g){const v={};this.loadVTLayers();const b=ta(p.filterSpec,p.globalState);for(const S of i)this.loadMatchingFeature(v,s,l,S,b,f,_,g,r);return v}hasLayer(i){for(const r of this.bucketLayerIDs)for(const s of r)if(i===s)return!0;return!1}getId(i,r){var s;let l=i.id;return this.promoteId&&(l=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[r]],typeof l=="boolean"&&(l=Number(l)),l===void 0&&!((s=i.properties)===null||s===void 0)&&s.cluster&&this.promoteId&&(l=Number(i.properties.cluster_id))),l}}function fd(o,i,r,s,l){return ba(o,((p,f)=>{const _=i instanceof la?i.get(f):null;return _&&_.evaluate?_.evaluate(r,s,l):_}))}function gf(o,i){return i-o}function md(o,i,r,s,l){const p=[];for(let f=0;f<o.length;f++){const _=o[f];let g;for(let v=0;v<_.length-1;v++){let b=_[v],S=_[v+1];b.x<i&&S.x<i||(b.x<i?b=new It(i,b.y+(i-b.x)/(S.x-b.x)*(S.y-b.y))._round():S.x<i&&(S=new It(i,b.y+(i-b.x)/(S.x-b.x)*(S.y-b.y))._round()),b.y<r&&S.y<r||(b.y<r?b=new It(b.x+(r-b.y)/(S.y-b.y)*(S.x-b.x),r)._round():S.y<r&&(S=new It(b.x+(r-b.y)/(S.y-b.y)*(S.x-b.x),r)._round()),b.x>=s&&S.x>=s||(b.x>=s?b=new It(s,b.y+(s-b.x)/(S.x-b.x)*(S.y-b.y))._round():S.x>=s&&(S=new It(s,b.y+(s-b.x)/(S.x-b.x)*(S.y-b.y))._round()),b.y>=l&&S.y>=l||(b.y>=l?b=new It(b.x+(l-b.y)/(S.y-b.y)*(S.x-b.x),l)._round():S.y>=l&&(S=new It(b.x+(l-b.y)/(S.y-b.y)*(S.x-b.x),l)._round()),g&&b.equals(g[g.length-1])||(g=[b],p.push(g)),g.push(S)))))}}return p}Ct("FeatureIndex",pd,{omit:["rawTileData","sourceLayerCoder"]});class _a extends It{constructor(i,r,s,l){super(i,r),this.angle=s,l!==void 0&&(this.segment=l)}clone(){return new _a(this.x,this.y,this.angle,this.segment)}}function _d(o,i,r,s,l){if(i.segment===void 0||r===0)return!0;let p=i,f=i.segment+1,_=0;for(;_>-r/2;){if(f--,f<0)return!1;_-=o[f].dist(p),p=o[f]}_+=o[f].dist(o[f+1]),f++;const g=[];let v=0;for(;_<r/2;){const b=o[f],S=o[f+1];if(!S)return!1;let I=o[f-1].angleTo(b)-b.angleTo(S);for(I=Math.abs((I+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:_,angleDelta:I}),v+=I;_-g[0].distance>s;)v-=g.shift().angleDelta;if(v>l)return!1;f++,_+=b.dist(S)}return!0}function gd(o){let i=0;for(let r=0;r<o.length-1;r++)i+=o[r].dist(o[r+1]);return i}function yd(o,i,r){return o?.6*i*r:0}function xd(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function yf(o,i,r,s,l,p){const f=yd(r,l,p),_=xd(r,s)*p;let g=0;const v=gd(o)/2;for(let b=0;b<o.length-1;b++){const S=o[b],I=o[b+1],C=S.dist(I);if(g+C>v){const R=(v-g)/C,L=wi.number(S.x,I.x,R),B=wi.number(S.y,I.y,R),N=new _a(L,B,I.angleTo(S),b);return N._round(),!f||_d(o,N,_,f,i)?N:void 0}g+=C}}function xf(o,i,r,s,l,p,f,_,g){const v=yd(s,p,f),b=xd(s,l),S=b*f,I=o[0].x===0||o[0].x===g||o[0].y===0||o[0].y===g;return i-S<i/4&&(i=S+i/4),vd(o,I?i/2*_%i:(b/2+2*p)*f*_%i,i,v,r,S,I,!1,g)}function vd(o,i,r,s,l,p,f,_,g){const v=p/2,b=gd(o);let S=0,I=i-r,C=[];for(let R=0;R<o.length-1;R++){const L=o[R],B=o[R+1],N=L.dist(B),it=B.angleTo(L);for(;I+r<S+N;){I+=r;const G=(I-S)/N,K=wi.number(L.x,B.x,G),at=wi.number(L.y,B.y,G);if(K>=0&&K<g&&at>=0&&at<g&&I-v>=0&&I+v<=b){const dt=new _a(K,at,it,R);dt._round(),s&&!_d(o,dt,p,s,l)||C.push(dt)}}S+=N}return _||C.length||f||(C=vd(o,S/2,r,s,l,p,f,!0,g)),C}function bd(o,i,r,s){const l=[],p=o.image,f=p.pixelRatio,_=p.paddedRect.w-2,g=p.paddedRect.h-2;let v={x1:o.left,y1:o.top,x2:o.right,y2:o.bottom};const b=p.stretchX||[[0,_]],S=p.stretchY||[[0,g]],I=(ft,Bt)=>ft+Bt[1]-Bt[0],C=b.reduce(I,0),R=S.reduce(I,0),L=_-C,B=g-R;let N=0,it=C,G=0,K=R,at=0,dt=L,gt=0,Mt=B;if(p.content&&s){const ft=p.content,Bt=ft[2]-ft[0],Vt=ft[3]-ft[1];(p.textFitWidth||p.textFitHeight)&&(v=Ku(o)),N=Bc(b,0,ft[0]),G=Bc(S,0,ft[1]),it=Bc(b,ft[0],ft[2]),K=Bc(S,ft[1],ft[3]),at=ft[0]-N,gt=ft[1]-G,dt=Bt-it,Mt=Vt-K}const bt=v.x1,St=v.y1,kt=v.x2-bt,Tt=v.y2-St,Pt=(ft,Bt,Vt,Lt)=>{const zt=Oc(ft.stretch-N,it,kt,bt),ee=jc(ft.fixed-at,dt,ft.stretch,C),Ce=Oc(Bt.stretch-G,K,Tt,St),Ge=jc(Bt.fixed-gt,Mt,Bt.stretch,R),_i=Oc(Vt.stretch-N,it,kt,bt),ir=jc(Vt.fixed-at,dt,Vt.stretch,C),ji=Oc(Lt.stretch-G,K,Tt,St),li=jc(Lt.fixed-gt,Mt,Lt.stretch,R),Pe=new It(zt,Ce),Qe=new It(_i,Ce),ci=new It(_i,ji),hi=new It(zt,ji),Ri=new It(ee/f,Ge/f),rr=new It(ir/f,li/f),Je=i*Math.PI/180;if(Je){const ti=Math.sin(Je),ei=Math.cos(Je),Oe=[ei,-ti,ti,ei];Pe._matMult(Oe),Qe._matMult(Oe),hi._matMult(Oe),ci._matMult(Oe)}const Vi=ft.stretch+ft.fixed,qe=Bt.stretch+Bt.fixed;return{tl:Pe,tr:Qe,bl:hi,br:ci,tex:{x:p.paddedRect.x+1+Vi,y:p.paddedRect.y+1+qe,w:Vt.stretch+Vt.fixed-Vi,h:Lt.stretch+Lt.fixed-qe},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ri,pixelOffsetBR:rr,minFontScaleX:dt/f/kt,minFontScaleY:Mt/f/Tt,isSDF:r}};if(s&&(p.stretchX||p.stretchY)){const ft=wd(b,L,C),Bt=wd(S,B,R);for(let Vt=0;Vt<ft.length-1;Vt++){const Lt=ft[Vt],zt=ft[Vt+1];for(let ee=0;ee<Bt.length-1;ee++)l.push(Pt(Lt,Bt[ee],zt,Bt[ee+1]))}}else l.push(Pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:_+1},{fixed:0,stretch:g+1}));return l}function Bc(o,i,r){let s=0;for(const l of o)s+=Math.max(i,Math.min(r,l[1]))-Math.max(i,Math.min(r,l[0]));return s}function wd(o,i,r){const s=[{fixed:-1,stretch:0}];for(const[l,p]of o){const f=s[s.length-1];s.push({fixed:l-f.stretch,stretch:f.stretch}),s.push({fixed:l-f.stretch,stretch:f.stretch+(p-l)})}return s.push({fixed:i+1,stretch:r}),s}function Oc(o,i,r,s){return o/i*r+s}function jc(o,i,r,s){return o-i*r/s}Ct("Anchor",_a);class Vc{constructor(i,r,s,l,p,f,_,g,v,b){var S;if(this.boxStartIndex=i.length,v){let I=f.top,C=f.bottom;const R=f.collisionPadding;R&&(I-=R[1],C+=R[3]);let L=C-I;L>0&&(L=Math.max(10,L),this.circleDiameter=L)}else{const I=!((S=f.image)===null||S===void 0)&&S.content&&(f.image.textFitWidth||f.image.textFitHeight)?Ku(f):{x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};I.y1=I.y1*_-g[0],I.y2=I.y2*_+g[2],I.x1=I.x1*_-g[3],I.x2=I.x2*_+g[1];const C=f.collisionPadding;if(C&&(I.x1-=C[0]*_,I.y1-=C[1]*_,I.x2+=C[2]*_,I.y2+=C[3]*_),b){const R=new It(I.x1,I.y1),L=new It(I.x2,I.y1),B=new It(I.x1,I.y2),N=new It(I.x2,I.y2),it=b*Math.PI/180;R._rotate(it),L._rotate(it),B._rotate(it),N._rotate(it),I.x1=Math.min(R.x,L.x,B.x,N.x),I.x2=Math.max(R.x,L.x,B.x,N.x),I.y1=Math.min(R.y,L.y,B.y,N.y),I.y2=Math.max(R.y,L.y,B.y,N.y)}i.emplaceBack(r.x,r.y,I.x1,I.y1,I.x2,I.y2,s,l,p)}this.boxEndIndex=i.length}}class vf{constructor(i=[],r=(s,l)=>s<l?-1:s>l?1:0){if(this.data=i,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],r=this.data.pop();return--this.length>0&&(this.data[0]=r,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:r,compare:s}=this,l=r[i];for(;i>0;){const p=i-1>>1,f=r[p];if(s(l,f)>=0)break;r[i]=f,i=p}r[i]=l}_down(i){const{data:r,compare:s}=this,l=this.length>>1,p=r[i];for(;i<l;){let f=1+(i<<1);const _=f+1;if(_<this.length&&s(r[_],r[f])<0&&(f=_),s(r[f],p)>=0)break;r[i]=r[f],i=f}r[i]=p}}function bf(o,i=1,r=!1){const s=Xa.fromPoints(o[0]),l=Math.min(s.width(),s.height());let p=l/2;const f=new vf([],wf),{minX:_,minY:g,maxX:v,maxY:b}=s;if(l===0)return new It(_,g);for(let C=_;C<v;C+=l)for(let R=g;R<b;R+=l)f.push(new rn(C+p,R+p,p,o));let S=(function(C){let R=0,L=0,B=0;const N=C[0];for(let it=0,G=N.length,K=G-1;it<G;K=it++){const at=N[it],dt=N[K],gt=at.x*dt.y-dt.x*at.y;L+=(at.x+dt.x)*gt,B+=(at.y+dt.y)*gt,R+=3*gt}return new rn(L/R,B/R,0,C)})(o),I=f.length;for(;f.length;){const C=f.pop();(C.d>S.d||!S.d)&&(S=C,r&&console.log("found best %d after %d probes",Math.round(1e4*C.d)/1e4,I)),C.max-S.d<=i||(p=C.h/2,f.push(new rn(C.p.x-p,C.p.y-p,p,o)),f.push(new rn(C.p.x+p,C.p.y-p,p,o)),f.push(new rn(C.p.x-p,C.p.y+p,p,o)),f.push(new rn(C.p.x+p,C.p.y+p,p,o)),I+=4)}return r&&(console.log(`num probes: ${I}`),console.log(`best distance: ${S.d}`)),S.p}function wf(o,i){return i.max-o.max}function rn(o,i,r,s){this.p=new It(o,i),this.h=r,this.d=(function(l,p){let f=!1,_=1/0;for(let g=0;g<p.length;g++){const v=p[g];for(let b=0,S=v.length,I=S-1;b<S;I=b++){const C=v[b],R=v[I];C.y>l.y!=R.y>l.y&&l.x<(R.x-C.x)*(l.y-C.y)/(R.y-C.y)+C.x&&(f=!f),_=Math.min(_,nu(l,C,R))}}return(f?1:-1)*Math.sqrt(_)})(this.p,s),this.max=this.d+this.h*Math.SQRT2}var mi;z.aE=void 0,(mi=z.aE||(z.aE={}))[mi.center=1]="center",mi[mi.left=2]="left",mi[mi.right=3]="right",mi[mi.top=4]="top",mi[mi.bottom=5]="bottom",mi[mi["top-left"]=6]="top-left",mi[mi["top-right"]=7]="top-right",mi[mi["bottom-left"]=8]="bottom-left",mi[mi["bottom-right"]=9]="bottom-right";const Nh=Number.POSITIVE_INFINITY;function Td(o,i){return i[1]!==Nh?(function(r,s,l){let p=0,f=0;switch(s=Math.abs(s),l=Math.abs(l),r){case"top-right":case"top-left":case"top":f=l-7;break;case"bottom-right":case"bottom-left":case"bottom":f=7-l}switch(r){case"top-right":case"bottom-right":case"right":p=-s;break;case"top-left":case"bottom-left":case"left":p=s}return[p,f]})(o,i[0],i[1]):(function(r,s){let l=0,p=0;s<0&&(s=0);const f=s/Math.SQRT2;switch(r){case"top-right":case"top-left":p=f-7;break;case"bottom-right":case"bottom-left":p=7-f;break;case"bottom":p=7-s;break;case"top":p=s-7}switch(r){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=s;break;case"right":l=-s}return[l,p]})(o,i[0])}function Sd(o,i,r){var s;const l=o.layout,p=(s=l.get("text-variable-anchor-offset"))===null||s===void 0?void 0:s.evaluate(i,{},r);if(p){const _=p.values,g=[];for(let v=0;v<_.length;v+=2){const b=g[v]=_[v],S=_[v+1].map((I=>I*Ye));b.startsWith("top")?S[1]-=7:b.startsWith("bottom")&&(S[1]+=7),g[v+1]=S}return new ai(g)}const f=l.get("text-variable-anchor");if(f){let _;_=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[l.get("text-radial-offset").evaluate(i,{},r)*Ye,Nh]:l.get("text-offset").evaluate(i,{},r).map((v=>v*Ye));const g=[];for(const v of f)g.push(v,Td(v,_));return new ai(g)}return null}function Uh(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Tf(o,i,r,s,l,p,f,_,g,v,b,S){let I=p.textMaxSize.evaluate(i,{});I===void 0&&(I=f);const C=o.layers[0].layout,R=C.get("icon-offset").evaluate(i,{},b),L=Md(r.horizontal),B=f/24,N=o.tilePixelRatio*B,it=o.tilePixelRatio*I/24,G=o.tilePixelRatio*_,K=o.tilePixelRatio*C.get("symbol-spacing"),at=C.get("text-padding")*o.tilePixelRatio,dt=(function(Vt,Lt,zt,ee=1){const Ce=Vt.get("icon-padding").evaluate(Lt,{},zt),Ge=Ce&&Ce.values;return[Ge[0]*ee,Ge[1]*ee,Ge[2]*ee,Ge[3]*ee]})(C,i,b,o.tilePixelRatio),gt=C.get("text-max-angle")/180*Math.PI,Mt=C.get("text-rotation-alignment")!=="viewport"&&C.get("symbol-placement")!=="point",bt=C.get("icon-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",St=C.get("symbol-placement"),kt=K/2,Tt=C.get("icon-text-fit");let Pt;s&&Tt!=="none"&&(o.allowVerticalPlacement&&r.vertical&&(Pt=Yu(s,r.vertical,Tt,C.get("icon-text-fit-padding"),R,B)),L&&(s=Yu(s,L,Tt,C.get("icon-text-fit-padding"),R,B)));const ft=b?S.line.getGranularityForZoomLevel(b.z):1,Bt=(Vt,Lt)=>{Lt.x<0||Lt.x>=ne||Lt.y<0||Lt.y>=ne||(function(zt,ee,Ce,Ge,_i,ir,ji,li,Pe,Qe,ci,hi,Ri,rr,Je,Vi,qe,ti,ei,Oe,ge,Rr,on,Er,Mf){const an=zt.addToLineVertexArray(ee,Ce);let Ka,sn,nn,ln,zd=0,Rd=0,Ed=0,kd=0,Kh=-1,Yh=-1;const Io={};let Dd=Gr("");if(zt.allowVerticalPlacement&&Ge.vertical){const Pi=li.layout.get("text-rotate").evaluate(ge,{},Er)+90;nn=new Vc(Pe,ee,Qe,ci,hi,Ge.vertical,Ri,rr,Je,Pi),ji&&(ln=new Vc(Pe,ee,Qe,ci,hi,ji,qe,ti,Je,Pi))}if(_i){const Pi=li.layout.get("icon-rotate").evaluate(ge,{}),fr=li.layout.get("icon-text-fit")!=="none",Ya=bd(_i,Pi,on,fr),Kr=ji?bd(ji,Pi,on,fr):void 0;sn=new Vc(Pe,ee,Qe,ci,hi,_i,qe,ti,!1,Pi),zd=4*Ya.length;const Qa=zt.iconSizeData;let Yr=null;Qa.kind==="source"?(Yr=[Mo*li.layout.get("icon-size").evaluate(ge,{})],Yr[0]>fa&&Ee(`${zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Qa.kind==="composite"&&(Yr=[Mo*Rr.compositeIconSizes[0].evaluate(ge,{},Er),Mo*Rr.compositeIconSizes[1].evaluate(ge,{},Er)],(Yr[0]>fa||Yr[1]>fa)&&Ee(`${zt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),zt.addSymbols(zt.icon,Ya,Yr,Oe,ei,ge,z.ao.none,ee,an.lineStartIndex,an.lineLength,-1,Er),Kh=zt.icon.placedSymbolArray.length-1,Kr&&(Rd=4*Kr.length,zt.addSymbols(zt.icon,Kr,Yr,Oe,ei,ge,z.ao.vertical,ee,an.lineStartIndex,an.lineLength,-1,Er),Yh=zt.icon.placedSymbolArray.length-1)}const Ld=Object.keys(Ge.horizontal);for(const Pi of Ld){const fr=Ge.horizontal[Pi];if(!Ka){Dd=Gr(fr.text);const Kr=li.layout.get("text-rotate").evaluate(ge,{},Er);Ka=new Vc(Pe,ee,Qe,ci,hi,fr,Ri,rr,Je,Kr)}const Ya=fr.positionedLines.length===1;if(Ed+=Pd(zt,ee,fr,ir,li,Je,ge,Vi,an,Ge.vertical?z.ao.horizontal:z.ao.horizontalOnly,Ya?Ld:[Pi],Io,Kh,Rr,Er),Ya)break}Ge.vertical&&(kd+=Pd(zt,ee,Ge.vertical,ir,li,Je,ge,Vi,an,z.ao.vertical,["vertical"],Io,Yh,Rr,Er));const If=Ka?Ka.boxStartIndex:zt.collisionBoxArray.length,Cf=Ka?Ka.boxEndIndex:zt.collisionBoxArray.length,Af=nn?nn.boxStartIndex:zt.collisionBoxArray.length,zf=nn?nn.boxEndIndex:zt.collisionBoxArray.length,Rf=sn?sn.boxStartIndex:zt.collisionBoxArray.length,Ef=sn?sn.boxEndIndex:zt.collisionBoxArray.length,kf=ln?ln.boxStartIndex:zt.collisionBoxArray.length,Df=ln?ln.boxEndIndex:zt.collisionBoxArray.length;let kr=-1;const Uc=(Pi,fr)=>Pi&&Pi.circleDiameter?Math.max(Pi.circleDiameter,fr):fr;kr=Uc(Ka,kr),kr=Uc(nn,kr),kr=Uc(sn,kr),kr=Uc(ln,kr);const Fd=kr>-1?1:0;Fd&&(kr*=Mf/Ye),zt.glyphOffsetArray.length>=tn.MAX_GLYPHS&&Ee("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ge.sortKey!==void 0&&zt.addToSortKeyRanges(zt.symbolInstances.length,ge.sortKey);const Lf=Sd(li,ge,Er),[Ff,Bf]=(function(Pi,fr){const Ya=Pi.length,Kr=fr?.values;if(Kr?.length>0)for(let Qa=0;Qa<Kr.length;Qa+=2){const Yr=Kr[Qa+1];Pi.emplaceBack(z.aE[Kr[Qa]],Yr[0],Yr[1])}return[Ya,Pi.length]})(zt.textAnchorOffsets,Lf);zt.symbolInstances.emplaceBack(ee.x,ee.y,Io.right>=0?Io.right:-1,Io.center>=0?Io.center:-1,Io.left>=0?Io.left:-1,Io.vertical||-1,Kh,Yh,Dd,If,Cf,Af,zf,Rf,Ef,kf,Df,Qe,Ed,kd,zd,Rd,Fd,0,Ri,kr,Ff,Bf)})(o,Lt,Vt,r,s,l,Pt,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,N,[at,at,at,at],Mt,g,G,dt,bt,R,i,p,v,b,f)};if(St==="line")for(const Vt of md(i.geometry,0,0,ne,ne)){const Lt=Ha(Vt,ft),zt=xf(Lt,K,gt,r.vertical||L,s,24,it,o.overscaling,ne);for(const ee of zt)L&&Sf(o,L.text,kt,ee)||Bt(Lt,ee)}else if(St==="line-center"){for(const Vt of i.geometry)if(Vt.length>1){const Lt=Ha(Vt,ft),zt=yf(Lt,gt,r.vertical||L,s,24,it);zt&&Bt(Lt,zt)}}else if(i.type==="Polygon")for(const Vt of Ho(i.geometry,0)){const Lt=bf(Vt,16);Bt(Ha(Vt[0],ft,!0),new _a(Lt.x,Lt.y,0))}else if(i.type==="LineString")for(const Vt of i.geometry){const Lt=Ha(Vt,ft);Bt(Lt,new _a(Lt[0].x,Lt[0].y,0))}else if(i.type==="Point")for(const Vt of i.geometry)for(const Lt of Vt)Bt([Lt],new _a(Lt.x,Lt.y,0))}function Pd(o,i,r,s,l,p,f,_,g,v,b,S,I,C,R){const L=(function(it,G,K,at,dt,gt,Mt,bt){const St=at.layout.get("text-rotate").evaluate(gt,{})*Math.PI/180,kt=[];for(const Tt of G.positionedLines)for(const Pt of Tt.positionedGlyphs){if(!Pt.rect)continue;const ft=Pt.rect||{};let Bt=4,Vt=!0,Lt=1,zt=0;const ee=(dt||bt)&&Pt.vertical,Ce=Pt.metrics.advance*Pt.scale/2;if(bt&&G.verticalizable&&(zt=Tt.lineOffset/2-(Pt.imageName?-(Ye-Pt.metrics.width*Pt.scale)/2:(Pt.scale-1)*Ye)),Pt.imageName){const ti=Mt[Pt.imageName];Vt=ti.sdf,Lt=ti.pixelRatio,Bt=1/Lt}const Ge=dt?[Pt.x+Ce,Pt.y]:[0,0];let _i=dt?[0,0]:[Pt.x+Ce+K[0],Pt.y+K[1]-zt],ir=[0,0];ee&&(ir=_i,_i=[0,0]);const ji=Pt.metrics.isDoubleResolution?2:1,li=(Pt.metrics.left-Bt)*Pt.scale-Ce+_i[0],Pe=(-Pt.metrics.top-Bt)*Pt.scale+_i[1],Qe=li+ft.w/ji*Pt.scale/Lt,ci=Pe+ft.h/ji*Pt.scale/Lt,hi=new It(li,Pe),Ri=new It(Qe,Pe),rr=new It(li,ci),Je=new It(Qe,ci);if(ee){const ti=new It(-Ce,Ce- -17),ei=-Math.PI/2,Oe=12-Ce,ge=new It(22-Oe,-(Pt.imageName?Oe:0)),Rr=new It(...ir);hi._rotateAround(ei,ti)._add(ge)._add(Rr),Ri._rotateAround(ei,ti)._add(ge)._add(Rr),rr._rotateAround(ei,ti)._add(ge)._add(Rr),Je._rotateAround(ei,ti)._add(ge)._add(Rr)}if(St){const ti=Math.sin(St),ei=Math.cos(St),Oe=[ei,-ti,ti,ei];hi._matMult(Oe),Ri._matMult(Oe),rr._matMult(Oe),Je._matMult(Oe)}const Vi=new It(0,0),qe=new It(0,0);kt.push({tl:hi,tr:Ri,bl:rr,br:Je,tex:ft,writingMode:G.writingMode,glyphOffset:Ge,sectionIndex:Pt.sectionIndex,isSDF:Vt,pixelOffsetTL:Vi,pixelOffsetBR:qe,minFontScaleX:0,minFontScaleY:0})}return kt})(0,r,_,l,p,f,s,o.allowVerticalPlacement),B=o.textSizeData;let N=null;B.kind==="source"?(N=[Mo*l.layout.get("text-size").evaluate(f,{})],N[0]>fa&&Ee(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):B.kind==="composite"&&(N=[Mo*C.compositeTextSizes[0].evaluate(f,{},R),Mo*C.compositeTextSizes[1].evaluate(f,{},R)],(N[0]>fa||N[1]>fa)&&Ee(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,L,N,_,p,f,v,i,g.lineStartIndex,g.lineLength,I,R);for(const it of b)S[it]=o.text.placedSymbolArray.length-1;return 4*L.length}function Md(o){for(const i in o)return o[i];return null}function Sf(o,i,r,s){const l=o.compareText;if(i in l){const p=l[i];for(let f=p.length-1;f>=0;f--)if(s.dist(p[f])<r)return!0}else l[i]=[];return l[i].push(s),!1}const Id=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $h{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[r,s]=new Uint8Array(i,0,2);if(r!==219)throw new Error("Data does not appear to be in a KDBush format.");const l=s>>4;if(l!==1)throw new Error(`Got v${l} data when expected v1.`);const p=Id[15&s];if(!p)throw new Error("Unrecognized array type.");const[f]=new Uint16Array(i,2,1),[_]=new Uint32Array(i,4,1);return new $h(_,f,p,i)}constructor(i,r=64,s=Float64Array,l){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+r,2),65535),this.ArrayType=s,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const p=Id.indexOf(this.ArrayType),f=2*i*this.ArrayType.BYTES_PER_ELEMENT,_=i*this.IndexArrayType.BYTES_PER_ELEMENT,g=(8-_%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${s}.`);l&&l instanceof ArrayBuffer?(this.data=l,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+_+g,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+f+_+g),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+_+g,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=r,new Uint32Array(this.data,4,1)[0]=i)}add(i,r){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=i,this.coords[this._pos++]=r,s}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Zh(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,r,s,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:f,nodeSize:_}=this,g=[0,p.length-1,0],v=[];for(;g.length;){const b=g.pop()||0,S=g.pop()||0,I=g.pop()||0;if(S-I<=_){for(let B=I;B<=S;B++){const N=f[2*B],it=f[2*B+1];N>=i&&N<=s&&it>=r&&it<=l&&v.push(p[B])}continue}const C=I+S>>1,R=f[2*C],L=f[2*C+1];R>=i&&R<=s&&L>=r&&L<=l&&v.push(p[C]),(b===0?i<=R:r<=L)&&(g.push(I),g.push(C-1),g.push(1-b)),(b===0?s>=R:l>=L)&&(g.push(C+1),g.push(S),g.push(1-b))}return v}within(i,r,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:l,coords:p,nodeSize:f}=this,_=[0,l.length-1,0],g=[],v=s*s;for(;_.length;){const b=_.pop()||0,S=_.pop()||0,I=_.pop()||0;if(S-I<=f){for(let B=I;B<=S;B++)Ad(p[2*B],p[2*B+1],i,r)<=v&&g.push(l[B]);continue}const C=I+S>>1,R=p[2*C],L=p[2*C+1];Ad(R,L,i,r)<=v&&g.push(l[C]),(b===0?i-s<=R:r-s<=L)&&(_.push(I),_.push(C-1),_.push(1-b)),(b===0?i+s>=R:r+s>=L)&&(_.push(C+1),_.push(S),_.push(1-b))}return g}}function Zh(o,i,r,s,l,p){if(l-s<=r)return;const f=s+l>>1;Cd(o,i,f,s,l,p),Zh(o,i,r,s,f-1,1-p),Zh(o,i,r,f+1,l,1-p)}function Cd(o,i,r,s,l,p){for(;l>s;){if(l-s>600){const v=l-s+1,b=r-s+1,S=Math.log(v),I=.5*Math.exp(2*S/3),C=.5*Math.sqrt(S*I*(v-I)/v)*(b-v/2<0?-1:1);Cd(o,i,r,Math.max(s,Math.floor(r-b*I/v+C)),Math.min(l,Math.floor(r+(v-b)*I/v+C)),p)}const f=i[2*r+p];let _=s,g=l;for(pl(o,i,s,r),i[2*l+p]>f&&pl(o,i,s,l);_<g;){for(pl(o,i,_,g),_++,g--;i[2*_+p]<f;)_++;for(;i[2*g+p]>f;)g--}i[2*s+p]===f?pl(o,i,s,g):(g++,pl(o,i,g,l)),g<=r&&(s=g+1),r<=g&&(l=g-1)}}function pl(o,i,r,s){Gh(o,r,s),Gh(i,2*r,2*s),Gh(i,2*r+1,2*s+1)}function Gh(o,i,r){const s=o[i];o[i]=o[r],o[r]=s}function Ad(o,i,r,s){const l=o-r,p=i-s;return l*l+p*p}var qh;z.cx=void 0,(qh=z.cx||(z.cx={})).create="create",qh.load="load",qh.fullLoad="fullLoad";let Nc=null,fl=[];const Wh=1e3/60,Hh="loadTime",Xh="fullLoadTime",Pf={mark(o){performance.mark(o)},frame(o){const i=o;Nc!=null&&fl.push(i-Nc),Nc=i},clearMetrics(){Nc=null,fl=[],performance.clearMeasures(Hh),performance.clearMeasures(Xh);for(const o in z.cx)performance.clearMarks(z.cx[o])},getPerformanceMetrics(){performance.measure(Hh,z.cx.create,z.cx.load),performance.measure(Xh,z.cx.create,z.cx.fullLoad);const o=performance.getEntriesByName(Hh)[0].duration,i=performance.getEntriesByName(Xh)[0].duration,r=fl.length,s=1/(fl.reduce(((p,f)=>p+f),0)/r/1e3),l=fl.filter((p=>p>Wh)).reduce(((p,f)=>p+(f-Wh)/Wh),0);return{loadTime:o,fullLoadTime:i,fps:s,percentDroppedFrames:l/(r+l)*100,totalFrames:r}}};z.$=ne,z.A=Re,z.B=function([o,i,r]){return i+=90,i*=Math.PI/180,r*=Math.PI/180,{x:o*Math.cos(i)*Math.sin(r),y:o*Math.sin(i)*Math.sin(r),z:o*Math.cos(r)}},z.C=wi,z.D=Rt,z.E=Et,z.F=ce,z.G=Nn,z.H=Lr,z.I=zh,z.J=class{constructor(o,i){this.target=o,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new mf((()=>this.process())),this.subscription=Lo(this.target,"message",(r=>this.receive(r)),!1),this.globalScope=xr(self)?o:window}registerMessageHandler(o,i){this.messageHandlers[o]=i}sendAsync(o,i){return new Promise(((r,s)=>{const l=Math.round(1e18*Math.random()).toString(36).substring(0,10),p=i?Lo(i.signal,"abort",(()=>{p?.unsubscribe(),delete this.resolveRejects[l];const g={id:l,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(g)}),_f):null;this.resolveRejects[l]={resolve:g=>{p?.unsubscribe(),r(g)},reject:g=>{p?.unsubscribe(),s(g)}};const f=[],_=Object.assign(Object.assign({},o),{id:l,sourceMapId:this.mapId,origin:location.origin,data:ja(o.data,f)});this.target.postMessage(_,{transfer:f})}))}receive(o){const i=o.data,r=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!=="resource://android"&&location.origin!=="resource://android"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[r];const s=this.abortControllers[r];return delete this.abortControllers[r],void(s&&s.abort())}if(xr(self)||i.mustQueue)return this.tasks[r]=i,this.taskQueue.push(r),void this.invoker.trigger();this.processTask(r,i)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),i=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(o,i)}processTask(o,i){return h(this,void 0,void 0,(function*(){if(i.type==="<response>"){const l=this.resolveRejects[o];return delete this.resolveRejects[o],l?void(i.error?l.reject(Ur(i.error)):l.resolve(Ur(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const r=Ur(i.data),s=new AbortController;this.abortControllers[o]=s;try{const l=yield this.messageHandlers[i.type](i.sourceMapId,r,s);this.completeTask(o,null,l)}catch(l){this.completeTask(o,l)}}))}completeTask(o,i,r){const s=[];delete this.abortControllers[o];const l={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?ja(i):null,data:ja(r,s)};this.target.postMessage(l,{transfer:s})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},z.K=F,z.L=function(){var o=new Re(16);return Re!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},z.M=function(o,i,r){var s,l,p,f,_,g,v,b,S,I,C,R,L=r[0],B=r[1],N=r[2];return i===o?(o[12]=i[0]*L+i[4]*B+i[8]*N+i[12],o[13]=i[1]*L+i[5]*B+i[9]*N+i[13],o[14]=i[2]*L+i[6]*B+i[10]*N+i[14],o[15]=i[3]*L+i[7]*B+i[11]*N+i[15]):(l=i[1],p=i[2],f=i[3],_=i[4],g=i[5],v=i[6],b=i[7],S=i[8],I=i[9],C=i[10],R=i[11],o[0]=s=i[0],o[1]=l,o[2]=p,o[3]=f,o[4]=_,o[5]=g,o[6]=v,o[7]=b,o[8]=S,o[9]=I,o[10]=C,o[11]=R,o[12]=s*L+_*B+S*N+i[12],o[13]=l*L+g*B+I*N+i[13],o[14]=p*L+v*B+C*N+i[14],o[15]=f*L+b*B+R*N+i[15]),o},z.N=function(o,i,r){var s=r[0],l=r[1],p=r[2];return o[0]=i[0]*s,o[1]=i[1]*s,o[2]=i[2]*s,o[3]=i[3]*s,o[4]=i[4]*l,o[5]=i[5]*l,o[6]=i[6]*l,o[7]=i[7]*l,o[8]=i[8]*p,o[9]=i[9]*p,o[10]=i[10]*p,o[11]=i[11]*p,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},z.O=function(o,i,r){var s=i[0],l=i[1],p=i[2],f=i[3],_=i[4],g=i[5],v=i[6],b=i[7],S=i[8],I=i[9],C=i[10],R=i[11],L=i[12],B=i[13],N=i[14],it=i[15],G=r[0],K=r[1],at=r[2],dt=r[3];return o[0]=G*s+K*_+at*S+dt*L,o[1]=G*l+K*g+at*I+dt*B,o[2]=G*p+K*v+at*C+dt*N,o[3]=G*f+K*b+at*R+dt*it,o[4]=(G=r[4])*s+(K=r[5])*_+(at=r[6])*S+(dt=r[7])*L,o[5]=G*l+K*g+at*I+dt*B,o[6]=G*p+K*v+at*C+dt*N,o[7]=G*f+K*b+at*R+dt*it,o[8]=(G=r[8])*s+(K=r[9])*_+(at=r[10])*S+(dt=r[11])*L,o[9]=G*l+K*g+at*I+dt*B,o[10]=G*p+K*v+at*C+dt*N,o[11]=G*f+K*b+at*R+dt*it,o[12]=(G=r[12])*s+(K=r[13])*_+(at=r[14])*S+(dt=r[15])*L,o[13]=G*l+K*g+at*I+dt*B,o[14]=G*p+K*v+at*C+dt*N,o[15]=G*f+K*b+at*R+dt*it,o},z.P=It,z.Q=function(o,i){const r={};for(let s=0;s<i.length;s++){const l=i[s];l in o&&(r[l]=o[l])}return r},z.R=Oi,z.S=ma,z.T=vh,z.U=sd,z.V=ad,z.W=zo,z.X=Dr,z.Y=br,z.Z=er,z._=h,z.a=E,z.a$=Ja,z.a0=function(o,i){var r,s,l,p,f;if(!o)return i??{};if(!i)return o;let _=Object.assign({},o);if(i.removeAll&&(_={removeAll:!0}),i.remove){const g=new Set(i.remove);_.add&&(_.add=_.add.filter((b=>!g.has(b.id)))),_.update&&(_.update=_.update.filter((b=>!g.has(b.id))));const v=new Set(((r=o.add)!==null&&r!==void 0?r:[]).map((b=>b.id)));i.remove=i.remove.filter((b=>!v.has(b)))}if(i.remove){const g=new Set(_.remove?_.remove.concat(i.remove):i.remove);_.remove=Array.from(g.values())}if(i.add){const g=_.add?_.add.concat(i.add):i.add,v=new Map(g.map((b=>[b.id,b])));_.add=Array.from(v.values())}if(i.update){const g=new Map((s=_.update)===null||s===void 0?void 0:s.map((v=>[v.id,v])));for(const v of i.update){const b=(l=g.get(v.id))!==null&&l!==void 0?l:{id:v.id};v.newGeometry&&(b.newGeometry=v.newGeometry),v.addOrUpdateProperties&&(b.addOrUpdateProperties=((p=b.addOrUpdateProperties)!==null&&p!==void 0?p:[]).concat(v.addOrUpdateProperties)),v.removeProperties&&(b.removeProperties=((f=b.removeProperties)!==null&&f!==void 0?f:[]).concat(v.removeProperties)),v.removeAllProperties&&(b.removeAllProperties=!0),g.set(v.id,b)}_.update=Array.from(g.values())}return _.remove&&_.add&&(_.remove=_.remove.filter((g=>_.add.findIndex((v=>v.id===g))===-1))),_},z.a1=ul,z.a2=Xa,z.a3=25,z.a4=Vh,z.a5=o=>{const i=window.document.createElement("video");return i.muted=!0,new Promise((r=>{i.onloadstart=()=>{r(i)};for(const s of o){const l=window.document.createElement("source");nt(s)||(i.crossOrigin="Anonymous"),l.src=s,i.appendChild(l)}}))},z.a6=_t,z.a7=function(){return Ni++},z.a8=w,z.a9=tn,z.aA=function(o){let i=1/0,r=1/0,s=-1/0,l=-1/0;for(const p of o)i=Math.min(i,p.x),r=Math.min(r,p.y),s=Math.max(s,p.x),l=Math.max(l,p.y);return[i,r,s,l]},z.aB=Ye,z.aC=xa,z.aD=function(o,i,r,s,l=!1){if(!r[0]&&!r[1])return[0,0];const p=l?s==="map"?-o.bearingInRadians:0:s==="viewport"?o.bearingInRadians:0;if(p){const f=Math.sin(p),_=Math.cos(p);r=[r[0]*_-r[1]*f,r[0]*f+r[1]*_]}return[l?r[0]:xa(i,r[0],o.zoom),l?r[1]:xa(i,r[1],o.zoom)]},z.aF=kh,z.aG=Uh,z.aH=Eh,z.aI=$h,z.aJ=Ie,z.aK=Rc,z.aL=U,z.aM=Wt,z.aN=jt,z.aO=io,z.aP=Ui,z.aQ=ld,z.aR=Jr,z.aS=Eo,z.aT=function(o){var i=new Re(3);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i},z.aU=function(o,i,r){return o[0]=i[0]-r[0],o[1]=i[1]-r[1],o[2]=i[2]-r[2],o},z.aV=function(o,i){var r=i[0],s=i[1],l=i[2],p=r*r+s*s+l*l;return p>0&&(p=1/Math.sqrt(p)),o[0]=i[0]*p,o[1]=i[1]*p,o[2]=i[2]*p,o},z.aW=to,z.aX=function(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]},z.aY=function(o,i,r){return o[0]=i[0]*r[0],o[1]=i[1]*r[1],o[2]=i[2]*r[2],o[3]=i[3]*r[3],o},z.aZ=ya,z.a_=function(o,i,r){const s=i[0]*r[0]+i[1]*r[1]+i[2]*r[2];return s===0?null:(-(o[0]*r[0]+o[1]*r[1]+o[2]*r[2])-r[3])/s},z.aa=ta,z.ab=qa,z.ac=dd,z.ad=function(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((r,s,l,p)=>{const f=l||p;return i[s]=!f||f.toLowerCase(),""})),i["max-age"]){const r=parseInt(i["max-age"],10);isNaN(r)?delete i["max-age"]:i["max-age"]=r}return i},z.ae=ui,z.af=85.051129,z.ag=Fo,z.ah=function(o){return Math.pow(2,o)},z.ai=Ro,z.aj=nd,z.ak=function(o){return Math.log(o)/Math.LN2},z.al=function(o){var i=o[0],r=o[1];return i*i+r*r},z.am=function(o){if(!o.length)return new Set;const i=Math.max(...o.map((g=>g.canonical.z)));let r=1/0,s=-1/0,l=1/0,p=-1/0;const f=[];for(const g of o){const{x:v,y:b,z:S}=g.canonical,I=Math.pow(2,i-S),C=v*I,R=b*I;f.push({id:g,x:C,y:R}),C<r&&(r=C),C>s&&(s=C),R<l&&(l=R),R>p&&(p=R)}const _=new Set;for(const g of f)g.x!==r&&g.x!==s&&g.y!==l&&g.y!==p||_.add(g.id);return _},z.an=function(o,i){let r=0,s=0;if(o.kind==="constant")s=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:l,minZoom:p,maxZoom:f}=o,_=l?ui(bi.interpolationFactor(l,i,p,f),0,1):0;o.kind==="camera"?s=wi.number(o.minSize,o.maxSize,_):r=_}return{uSizeT:r,uSize:s}},z.ap=function(o,{uSize:i,uSizeT:r},{lowerSize:s,upperSize:l}){return o.kind==="source"?s/Mo:o.kind==="composite"?wi.number(s/Mo,l/Mo,r):i},z.aq=function(o,i){var r=i[0],s=i[1],l=i[2],p=i[3],f=i[4],_=i[5],g=i[6],v=i[7],b=i[8],S=i[9],I=i[10],C=i[11],R=i[12],L=i[13],B=i[14],N=i[15],it=r*_-s*f,G=r*g-l*f,K=r*v-p*f,at=s*g-l*_,dt=s*v-p*_,gt=l*v-p*g,Mt=b*L-S*R,bt=b*B-I*R,St=b*N-C*R,kt=S*B-I*L,Tt=S*N-C*L,Pt=I*N-C*B,ft=it*Pt-G*Tt+K*kt+at*St-dt*bt+gt*Mt;return ft?(o[0]=(_*Pt-g*Tt+v*kt)*(ft=1/ft),o[1]=(l*Tt-s*Pt-p*kt)*ft,o[2]=(L*gt-B*dt+N*at)*ft,o[3]=(I*dt-S*gt-C*at)*ft,o[4]=(g*St-f*Pt-v*bt)*ft,o[5]=(r*Pt-l*St+p*bt)*ft,o[6]=(B*K-R*gt-N*G)*ft,o[7]=(b*gt-I*K+C*G)*ft,o[8]=(f*Tt-_*St+v*Mt)*ft,o[9]=(s*St-r*Tt-p*Mt)*ft,o[10]=(R*dt-L*K+N*it)*ft,o[11]=(S*K-b*dt-C*it)*ft,o[12]=(_*bt-f*kt-g*Mt)*ft,o[13]=(r*kt-s*bt+l*Mt)*ft,o[14]=(L*G-R*at-B*it)*ft,o[15]=(b*at-S*G+I*it)*ft,o):null},z.ar=_r,z.as=function(o){var i=o[0],r=o[1];return Math.sqrt(i*i+r*r)},z.at=function(o){return o[0]=0,o[1]=0,o},z.au=function(o,i,r){return o[0]=i[0]*r,o[1]=i[1]*r,o},z.av=Dh,z.aw=ko,z.ax=function(o,i,r,s){const l=i.y-o.y,p=i.x-o.x,f=s.y-r.y,_=s.x-r.x,g=f*p-_*l;if(g===0)return null;const v=(_*(o.y-r.y)-f*(o.x-r.x))/g;return new It(o.x+v*p,o.y+v*l)},z.ay=md,z.az=au,z.b=vr,z.b$=class extends fi{constructor(o,i){super(o,i),this.current=new Array}set(o){if(o!=this.current){this.current=o;const i=new Float32Array(o);this.gl.uniform1fv(this.location,i)}}},z.b0=function(o,i,r){return o[0]=i[0]*r,o[1]=i[1]*r,o[2]=i[2]*r,o[3]=i[3]*r,o},z.b1=function(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]},z.b2=hd,z.b3=en,z.b4=function(o,i,r,s,l){var p=1/Math.tan(i/2);if(o[0]=p/r,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=p,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,l!=null&&l!==1/0){var f=1/(s-l);o[10]=(l+s)*f,o[14]=2*l*s*f}else o[10]=-1,o[14]=-2*s;return o},z.b5=function(o){var i=new Re(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},z.b6=function(o,i,r){var s=Math.sin(r),l=Math.cos(r),p=i[0],f=i[1],_=i[2],g=i[3],v=i[4],b=i[5],S=i[6],I=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=p*l+v*s,o[1]=f*l+b*s,o[2]=_*l+S*s,o[3]=g*l+I*s,o[4]=v*l-p*s,o[5]=b*l-f*s,o[6]=S*l-_*s,o[7]=I*l-g*s,o},z.b7=function(o,i,r){var s=Math.sin(r),l=Math.cos(r),p=i[4],f=i[5],_=i[6],g=i[7],v=i[8],b=i[9],S=i[10],I=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=p*l+v*s,o[5]=f*l+b*s,o[6]=_*l+S*s,o[7]=g*l+I*s,o[8]=v*l-p*s,o[9]=b*l-f*s,o[10]=S*l-_*s,o[11]=I*l-g*s,o},z.b8=function(){const o=new Float32Array(16);return Ro(o),o},z.b9=function(){const o=new Float64Array(16);return Ro(o),o},z.bA=function(o,i){const r=Wi(o,360),s=Wi(i,360),l=s-r,p=s>r?l-360:l+360;return Math.abs(l)<Math.abs(p)?l:p},z.bB=function(o){return o[0]=0,o[1]=0,o[2]=0,o},z.bC=function(o,i,r,s){const l=Math.sqrt(o*o+i*i),p=Math.sqrt(r*r+s*s);o/=l,i/=l,r/=p,s/=p;const f=Math.acos(o*r+i*s);return-i*r+o*s>0?f:-f},z.bD=function(o,i){const r=Wi(o,2*Math.PI),s=Wi(i,2*Math.PI);return Math.min(Math.abs(r-s),Math.abs(r-s+2*Math.PI),Math.abs(r-s-2*Math.PI))},z.bE=function(){const o={},i=rt.$version;for(const r in rt.$root){const s=rt.$root[r];if(s.required){let l=null;l=r==="version"?i:s.type==="array"?[]:{},l!=null&&(o[r]=l)}}return o},z.bF=$n,z.bG=X,z.bH=function o(i,r){if(Array.isArray(i)){if(!Array.isArray(r)||i.length!==r.length)return!1;for(let s=0;s<i.length;s++)if(!o(i[s],r[s]))return!1;return!0}if(typeof i=="object"&&i!==null&&r!==null){if(typeof r!="object"||Object.keys(i).length!==Object.keys(r).length)return!1;for(const s in i)if(!o(i[s],r[s]))return!1;return!0}return i===r},z.bI=function(o){o=o.slice();const i=Object.create(null);for(let r=0;r<o.length;r++)i[o[r].id]=o[r];for(let r=0;r<o.length;r++)"ref"in o[r]&&(o[r]=ye(o[r],i[o[r].ref]));return o},z.bJ=function(o,i){if(o.type==="custom")return new ff(o,i);switch(o.type){case"background":return new pf(o,i);case"circle":return new Kd(o,i);case"color-relief":return new ip(o,i);case"fill":return new gp(o,i);case"fill-extrusion":return new Cp(o,i);case"heatmap":return new Qd(o,i);case"hillshade":return new tp(o,i);case"line":return new Lp(o,i);case"raster":return new ha(o,i);case"symbol":return new Fc(o,i)}},z.bK=o=>o.type==="raster",z.bL=Fi,z.bM=function(o,i){if(!o)return[{command:"setStyle",args:[i]}];let r=[];try{if(!Dt(o.version,i.version))return[{command:"setStyle",args:[i]}];Dt(o.center,i.center)||r.push({command:"setCenter",args:[i.center]}),Dt(o.state,i.state)||r.push({command:"setGlobalState",args:[i.state]}),Dt(o.centerAltitude,i.centerAltitude)||r.push({command:"setCenterAltitude",args:[i.centerAltitude]}),Dt(o.zoom,i.zoom)||r.push({command:"setZoom",args:[i.zoom]}),Dt(o.bearing,i.bearing)||r.push({command:"setBearing",args:[i.bearing]}),Dt(o.pitch,i.pitch)||r.push({command:"setPitch",args:[i.pitch]}),Dt(o.roll,i.roll)||r.push({command:"setRoll",args:[i.roll]}),Dt(o.sprite,i.sprite)||r.push({command:"setSprite",args:[i.sprite]}),Dt(o.glyphs,i.glyphs)||r.push({command:"setGlyphs",args:[i.glyphs]}),Dt(o.transition,i.transition)||r.push({command:"setTransition",args:[i.transition]}),Dt(o.light,i.light)||r.push({command:"setLight",args:[i.light]}),Dt(o.terrain,i.terrain)||r.push({command:"setTerrain",args:[i.terrain]}),Dt(o.sky,i.sky)||r.push({command:"setSky",args:[i.sky]}),Dt(o.projection,i.projection)||r.push({command:"setProjection",args:[i.projection]});const s={},l=[];(function(f,_,g,v){let b;for(b in _=_||{},f=f||{})Object.prototype.hasOwnProperty.call(f,b)&&(Object.prototype.hasOwnProperty.call(_,b)||je(b,g,v));for(b in _)Object.prototype.hasOwnProperty.call(_,b)&&(Object.prototype.hasOwnProperty.call(f,b)?Dt(f[b],_[b])||(f[b].type==="geojson"&&_[b].type==="geojson"&&ri(f,_,b)?Ht(g,{command:"setGeoJSONSourceData",args:[b,_[b].data]}):Ve(b,_,g,v)):oe(b,_,g))})(o.sources,i.sources,l,s);const p=[];o.layers&&o.layers.forEach((f=>{"source"in f&&s[f.source]?r.push({command:"removeLayer",args:[f.id]}):p.push(f)})),r=r.concat(l),(function(f,_,g){_=_||[];const v=(f=f||[]).map(xe),b=_.map(xe),S=f.reduce(ke,{}),I=_.reduce(ke,{}),C=v.slice(),R=Object.create(null);let L,B,N,it,G;for(let K=0,at=0;K<v.length;K++)L=v[K],Object.prototype.hasOwnProperty.call(I,L)?at++:(Ht(g,{command:"removeLayer",args:[L]}),C.splice(C.indexOf(L,at),1));for(let K=0,at=0;K<b.length;K++)L=b[b.length-1-K],C[C.length-1-K]!==L&&(Object.prototype.hasOwnProperty.call(S,L)?(Ht(g,{command:"removeLayer",args:[L]}),C.splice(C.lastIndexOf(L,C.length-at),1)):at++,it=C[C.length-K],Ht(g,{command:"addLayer",args:[I[L],it]}),C.splice(C.length-K,0,L),R[L]=!0);for(let K=0;K<b.length;K++)if(L=b[K],B=S[L],N=I[L],!R[L]&&!Dt(B,N))if(Dt(B.source,N.source)&&Dt(B["source-layer"],N["source-layer"])&&Dt(B.type,N.type)){for(G in Ae(B.layout,N.layout,g,L,null,"setLayoutProperty"),Ae(B.paint,N.paint,g,L,null,"setPaintProperty"),Dt(B.filter,N.filter)||Ht(g,{command:"setFilter",args:[L,N.filter]}),Dt(B.minzoom,N.minzoom)&&Dt(B.maxzoom,N.maxzoom)||Ht(g,{command:"setLayerZoomRange",args:[L,N.minzoom,N.maxzoom]}),B)Object.prototype.hasOwnProperty.call(B,G)&&G!=="layout"&&G!=="paint"&&G!=="filter"&&G!=="metadata"&&G!=="minzoom"&&G!=="maxzoom"&&(G.indexOf("paint.")===0?Ae(B[G],N[G],g,L,G.slice(6),"setPaintProperty"):Dt(B[G],N[G])||Ht(g,{command:"setLayerProperty",args:[L,G,N[G]]}));for(G in N)Object.prototype.hasOwnProperty.call(N,G)&&!Object.prototype.hasOwnProperty.call(B,G)&&G!=="layout"&&G!=="paint"&&G!=="filter"&&G!=="metadata"&&G!=="minzoom"&&G!=="maxzoom"&&(G.indexOf("paint.")===0?Ae(B[G],N[G],g,L,G.slice(6),"setPaintProperty"):Dt(B[G],N[G])||Ht(g,{command:"setLayerProperty",args:[L,G,N[G]]}))}else Ht(g,{command:"removeLayer",args:[L]}),it=C[C.lastIndexOf(L)+1],Ht(g,{command:"addLayer",args:[N,it]})})(p,i.layers,r)}catch(s){console.warn("Unable to compute style diff:",s),r=[{command:"setStyle",args:[i]}]}return r},z.bN=function(o){const i=[],r=o.id;return r===void 0&&i.push({message:`layers.${r}: missing required property "id"`}),o.render===void 0&&i.push({message:`layers.${r}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&i.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),i},z.bO=ba,z.bP=wa,z.bQ=class extends fi{constructor(o,i){super(o,i),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},z.bR=Be,z.bS=class extends fi{constructor(o,i){super(o,i),this.current=Ke}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let i=1;i<16;i++)if(o[i]!==this.current[i]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},z.bT=da,z.bU=class extends fi{constructor(o,i){super(o,i),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},z.bV=class extends fi{constructor(o,i){super(o,i),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},z.bW=ga,z.bX=function(o,i){var r=Math.sin(i),s=Math.cos(i);return o[0]=s,o[1]=r,o[2]=0,o[3]=-r,o[4]=s,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},z.bY=function(o,i,r){var s=i[0],l=i[1],p=i[2];return o[0]=s*r[0]+l*r[3]+p*r[6],o[1]=s*r[1]+l*r[4]+p*r[7],o[2]=s*r[2]+l*r[5]+p*r[8],o},z.bZ=function(o,i,r,s,l,p,f){var _=1/(i-r),g=1/(s-l),v=1/(p-f);return o[0]=-2*_,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*g,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*v,o[11]=0,o[12]=(i+r)*_,o[13]=(l+s)*g,o[14]=(f+p)*v,o[15]=1,o},z.b_=class extends fi{constructor(o,i){super(o,i),this.current=new Array}set(o){if(o!=this.current){this.current=o;const i=new Float32Array(4*o.length);for(let r=0;r<o.length;r++)i[4*r]=o[r].r,i[4*r+1]=o[r].g,i[4*r+2]=o[r].b,i[4*r+3]=o[r].a;this.gl.uniform4fv(this.location,i)}}},z.ba=function(){return new Float64Array(16)},z.bb=function(o,i,r){const s=new Float64Array(4);return eo(s,o,i-90,r),s},z.bc=function(o,i,r,s){var l,p,f,_,g,v=i[0],b=i[1],S=i[2],I=i[3],C=r[0],R=r[1],L=r[2],B=r[3];return(p=v*C+b*R+S*L+I*B)<0&&(p=-p,C=-C,R=-R,L=-L,B=-B),1-p>be?(l=Math.acos(p),f=Math.sin(l),_=Math.sin((1-s)*l)/f,g=Math.sin(s*l)/f):(_=1-s,g=s),o[0]=_*v+g*C,o[1]=_*b+g*R,o[2]=_*S+g*L,o[3]=_*I+g*B,o},z.bd=function(o){const i=new Float64Array(9);var r,s,l,p,f,_,g,v,b,S,I,C,R,L,B,N,it,G;S=(l=(s=o)[0])*(g=l+l),I=(p=s[1])*g,R=(f=s[2])*g,L=f*(v=p+p),N=(_=s[3])*g,it=_*v,G=_*(b=f+f),(r=i)[0]=1-(C=p*v)-(B=f*b),r[3]=I-G,r[6]=R+it,r[1]=I+G,r[4]=1-S-B,r[7]=L-N,r[2]=R-it,r[5]=L+N,r[8]=1-S-C;const K=Ui(-Math.asin(ui(i[2],-1,1)));let at,dt;return Math.hypot(i[5],i[8])<.001?(at=0,dt=-Ui(Math.atan2(i[3],i[4]))):(at=Ui(i[5]===0&&i[8]===0?0:Math.atan2(i[5],i[8])),dt=Ui(i[1]===0&&i[0]===0?0:Math.atan2(i[1],i[0]))),{roll:at,pitch:K+90,bearing:dt}},z.be=function(o,i){return o.roll==i.roll&&o.pitch==i.pitch&&o.bearing==i.bearing},z.bf=Ut,z.bg=pr,z.bh=Ys,z.bi=al,z.bj=Ks,z.bk=gr,z.bl=Hi,z.bm=Ci,z.bn=function(o,i,r,s,l){return gr(s,l,ui((o-i)/(r-i),0,1))},z.bo=Wi,z.bp=function(){return new Float64Array(3)},z.bq=function(o,i,r,s){return o[0]=i[0]+r[0]*s,o[1]=i[1]+r[1]*s,o[2]=i[2]+r[2]*s,o},z.br=eo,z.bs=function(o,i,r){var s=r[0],l=r[1],p=r[2],f=r[3],_=i[0],g=i[1],v=i[2],b=l*v-p*g,S=p*_-s*v,I=s*g-l*_;return o[0]=_+f*(b+=b)+l*(I+=I)-p*(S+=S),o[1]=g+f*S+p*b-s*I,o[2]=v+f*I+s*S-l*b,o},z.bt=function(o,i,r){const s=(l=[o[0],o[1],o[2],i[0],i[1],i[2],r[0],r[1],r[2]])[0]*((b=l[8])*(f=l[4])-(_=l[5])*(v=l[7]))+l[1]*(-b*(p=l[3])+_*(g=l[6]))+l[2]*(v*p-f*g);var l,p,f,_,g,v,b;if(s===0)return null;const S=to([],[i[0],i[1],i[2]],[r[0],r[1],r[2]]),I=to([],[r[0],r[1],r[2]],[o[0],o[1],o[2]]),C=to([],[o[0],o[1],o[2]],[i[0],i[1],i[2]]),R=Jr([],S,-o[3]);return Eo(R,R,Jr([],I,-i[3])),Eo(R,R,Jr([],C,-r[3])),Jr(R,R,1/s),R},z.bu=Oh,z.bv=function(){return new Float64Array(4)},z.bw=function(o,i,r,s){var l=[],p=[];return l[0]=i[0]-r[0],l[1]=i[1]-r[1],l[2]=i[2]-r[2],p[0]=l[0]*Math.cos(s)-l[1]*Math.sin(s),p[1]=l[0]*Math.sin(s)+l[1]*Math.cos(s),p[2]=l[2],o[0]=p[0]+r[0],o[1]=p[1]+r[1],o[2]=p[2]+r[2],o},z.bx=function(o,i,r,s){var l=[],p=[];return l[0]=i[0]-r[0],l[1]=i[1]-r[1],l[2]=i[2]-r[2],p[0]=l[0],p[1]=l[1]*Math.cos(s)-l[2]*Math.sin(s),p[2]=l[1]*Math.sin(s)+l[2]*Math.cos(s),o[0]=p[0]+r[0],o[1]=p[1]+r[1],o[2]=p[2]+r[2],o},z.by=function(o,i,r,s){var l=[],p=[];return l[0]=i[0]-r[0],l[1]=i[1]-r[1],l[2]=i[2]-r[2],p[0]=l[2]*Math.sin(s)+l[0]*Math.cos(s),p[1]=l[1],p[2]=l[2]*Math.cos(s)-l[0]*Math.sin(s),o[0]=p[0]+r[0],o[1]=p[1]+r[1],o[2]=p[2]+r[2],o},z.bz=function(o,i,r){var s=Math.sin(r),l=Math.cos(r),p=i[0],f=i[1],_=i[2],g=i[3],v=i[8],b=i[9],S=i[10],I=i[11];return i!==o&&(o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=p*l-v*s,o[1]=f*l-b*s,o[2]=_*l-S*s,o[3]=g*l-I*s,o[8]=p*s+v*l,o[9]=f*s+b*l,o[10]=_*s+S*l,o[11]=g*s+I*l,o},z.c=Q,z.c0=class extends Yn{},z.c1=jp,z.c2=class extends qs{},z.c3=xh,z.c4=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},z.c5=mu,z.c6=function(o,i,r){var s=i[0],l=i[1],p=i[2],f=r[3]*s+r[7]*l+r[11]*p+r[15];return o[0]=(r[0]*s+r[4]*l+r[8]*p+r[12])/(f=f||1),o[1]=(r[1]*s+r[5]*l+r[9]*p+r[13])/f,o[2]=(r[2]*s+r[6]*l+r[10]*p+r[14])/f,o},z.c7=class extends Us{},z.c8=class extends m{},z.c9=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]&&o[8]===i[8]&&o[9]===i[9]&&o[10]===i[10]&&o[11]===i[11]&&o[12]===i[12]&&o[13]===i[13]&&o[14]===i[14]&&o[15]===i[15]},z.cA=function(o,i){E.REGISTERED_PROTOCOLS[o]=i},z.cB=function(o){delete E.REGISTERED_PROTOCOLS[o]},z.cC=function(o,i){const r={};for(let l=0;l<o.length;l++){const p=i&&i[o[l].id]||Fn(o[l]);i&&(i[o[l].id]=p);let f=r[p];f||(f=r[p]=[]),f.push(o[l])}const s=[];for(const l in r)s.push(r[l]);return s},z.cD=Ct,z.cE=ud,z.cF=pd,z.cG=Zu,z.cH=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=ne/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const i=o.bucket.layers[0],r=i.layout,s=i._unevaluatedLayout._values,l={layoutIconSize:s["icon-size"].possiblyEvaluate(new ce(o.bucket.zoom+1),o.canonical),layoutTextSize:s["text-size"].possiblyEvaluate(new ce(o.bucket.zoom+1),o.canonical),textMaxSize:s["text-size"].possiblyEvaluate(new ce(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:v,maxZoom:b}=o.bucket.textSizeData;l.compositeTextSizes=[s["text-size"].possiblyEvaluate(new ce(v),o.canonical),s["text-size"].possiblyEvaluate(new ce(b),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:v,maxZoom:b}=o.bucket.iconSizeData;l.compositeIconSizes=[s["icon-size"].possiblyEvaluate(new ce(v),o.canonical),s["icon-size"].possiblyEvaluate(new ce(b),o.canonical)]}const p=r.get("text-line-height")*Ye,f=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",_=r.get("text-keep-upright"),g=r.get("text-size");for(const v of o.bucket.features){const b=r.get("text-font").evaluate(v,{},o.canonical).join(","),S=g.evaluate(v,{},o.canonical),I=l.layoutTextSize.evaluate(v,{},o.canonical),C=l.layoutIconSize.evaluate(v,{},o.canonical),R={horizontal:{},vertical:void 0},L=v.text;let B,N=[0,0];if(L){const K=L.toString(),at=r.get("text-letter-spacing").evaluate(v,{},o.canonical)*Ye,dt=dc(K)?at:0,gt=r.get("text-anchor").evaluate(v,{},o.canonical),Mt=Sd(i,v,o.canonical);if(!Mt){const Tt=r.get("text-radial-offset").evaluate(v,{},o.canonical);N=Tt?Td(gt,[Tt*Ye,Nh]):r.get("text-offset").evaluate(v,{},o.canonical).map((Pt=>Pt*Ye))}let bt=f?"center":r.get("text-justify").evaluate(v,{},o.canonical);const St=r.get("symbol-placement")==="point"?r.get("text-max-width").evaluate(v,{},o.canonical)*Ye:1/0,kt=()=>{o.bucket.allowVerticalPlacement&&na(K)&&(R.vertical=kc(L,o.glyphMap,o.glyphPositions,o.imagePositions,b,St,p,gt,"left",dt,N,z.ao.vertical,!0,I,S))};if(!f&&Mt){const Tt=new Set;if(bt==="auto")for(let ft=0;ft<Mt.values.length;ft+=2)Tt.add(Uh(Mt.values[ft]));else Tt.add(bt);let Pt=!1;for(const ft of Tt)if(!R.horizontal[ft])if(Pt)R.horizontal[ft]=R.horizontal[0];else{const Bt=kc(L,o.glyphMap,o.glyphPositions,o.imagePositions,b,St,p,"center",ft,dt,N,z.ao.horizontal,!1,I,S);Bt&&(R.horizontal[ft]=Bt,Pt=Bt.positionedLines.length===1)}kt()}else{bt==="auto"&&(bt=Uh(gt));const Tt=kc(L,o.glyphMap,o.glyphPositions,o.imagePositions,b,St,p,gt,bt,dt,N,z.ao.horizontal,!1,I,S);Tt&&(R.horizontal[bt]=Tt),kt(),na(K)&&f&&_&&(R.vertical=kc(L,o.glyphMap,o.glyphPositions,o.imagePositions,b,St,p,gt,bt,dt,N,z.ao.vertical,!1,I,S))}}let it=!1;if(v.icon&&v.icon.name){const K=o.imageMap[v.icon.name];K&&(B=cf(o.imagePositions[v.icon.name],r.get("icon-offset").evaluate(v,{},o.canonical),r.get("icon-anchor").evaluate(v,{},o.canonical)),it=!!K.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=it:o.bucket.sdfIcons!==it&&Ee("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(K.pixelRatio!==o.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const G=Md(R.horizontal)||R.vertical;o.bucket.iconsInText=!!G&&G.iconsInText,(G||B)&&Tf(o.bucket,v,R,B,o.imageMap,l,I,C,N,it,o.canonical,o.subdivisionGranularity)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},z.cI=Sh,z.cJ=Mh,z.cK=Ih,z.cL=zu,z.cM=Ah,z.cN=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},z.cO=function(o,i,r,s,l){return h(this,void 0,void 0,(function*(){if(Dr())try{return yield br(o,i,r,s,l)}catch{}return(function(p,f,_,g,v){const b=p.width,S=p.height;Fr&&ar||(Fr=new OffscreenCanvas(b,S),ar=Fr.getContext("2d",{willReadFrequently:!0})),Fr.width=b,Fr.height=S,ar.drawImage(p,0,0,b,S);const I=ar.getImageData(f,_,g,v);return ar.clearRect(0,0,b,S),I.data})(o,i,r,s,l)}))},z.cP=yu,z.cQ=pe,z.cR=Au,z.cS=Qs,z.cT=Cs,z.cU=function(o,i){const r=new Map;if(o!=null)if(o.type==="Feature")r.set(dl(o,i),o);else for(const s of o.features)r.set(dl(s,i),s);return r},z.cV=function(o,i){if(o==null)return!0;if(o.type==="Feature")return dl(o,i)!=null;if(o.type==="FeatureCollection"){const r=new Set;for(const s of o.features){const l=dl(s,i);if(l==null||r.has(l))return!1;r.add(l)}return!0}return!1},z.cW=function(o,i,r){var s,l,p,f;if(i.removeAll&&o.clear(),i.remove)for(const _ of i.remove)o.delete(_);if(i.add)for(const _ of i.add){const g=dl(_,r);g!=null&&o.set(g,_)}if(i.update)for(const _ of i.update){let g=o.get(_.id);if(g==null)continue;const v=!_.removeAllProperties&&(((s=_.removeProperties)===null||s===void 0?void 0:s.length)>0||((l=_.addOrUpdateProperties)===null||l===void 0?void 0:l.length)>0);if((_.newGeometry||_.removeAllProperties||v)&&(g=Object.assign({},g),o.set(_.id,g),v&&(g.properties=Object.assign({},g.properties))),_.newGeometry&&(g.geometry=_.newGeometry),_.removeAllProperties)g.properties={};else if(((p=_.removeProperties)===null||p===void 0?void 0:p.length)>0)for(const b of _.removeProperties)Object.prototype.hasOwnProperty.call(g.properties,b)&&delete g.properties[b];if(((f=_.addOrUpdateProperties)===null||f===void 0?void 0:f.length)>0)for(const{key:b,value:S}of _.addOrUpdateProperties)g.properties[b]=S}},z.cX=Cr,z.ca=function(o,i){var r=o[0],s=o[1],l=o[2],p=o[3],f=o[4],_=o[5],g=o[6],v=o[7],b=o[8],S=o[9],I=o[10],C=o[11],R=o[12],L=o[13],B=o[14],N=o[15],it=i[0],G=i[1],K=i[2],at=i[3],dt=i[4],gt=i[5],Mt=i[6],bt=i[7],St=i[8],kt=i[9],Tt=i[10],Pt=i[11],ft=i[12],Bt=i[13],Vt=i[14],Lt=i[15];return Math.abs(r-it)<=be*Math.max(1,Math.abs(r),Math.abs(it))&&Math.abs(s-G)<=be*Math.max(1,Math.abs(s),Math.abs(G))&&Math.abs(l-K)<=be*Math.max(1,Math.abs(l),Math.abs(K))&&Math.abs(p-at)<=be*Math.max(1,Math.abs(p),Math.abs(at))&&Math.abs(f-dt)<=be*Math.max(1,Math.abs(f),Math.abs(dt))&&Math.abs(_-gt)<=be*Math.max(1,Math.abs(_),Math.abs(gt))&&Math.abs(g-Mt)<=be*Math.max(1,Math.abs(g),Math.abs(Mt))&&Math.abs(v-bt)<=be*Math.max(1,Math.abs(v),Math.abs(bt))&&Math.abs(b-St)<=be*Math.max(1,Math.abs(b),Math.abs(St))&&Math.abs(S-kt)<=be*Math.max(1,Math.abs(S),Math.abs(kt))&&Math.abs(I-Tt)<=be*Math.max(1,Math.abs(I),Math.abs(Tt))&&Math.abs(C-Pt)<=be*Math.max(1,Math.abs(C),Math.abs(Pt))&&Math.abs(R-ft)<=be*Math.max(1,Math.abs(R),Math.abs(ft))&&Math.abs(L-Bt)<=be*Math.max(1,Math.abs(L),Math.abs(Bt))&&Math.abs(B-Vt)<=be*Math.max(1,Math.abs(B),Math.abs(Vt))&&Math.abs(N-Lt)<=be*Math.max(1,Math.abs(N),Math.abs(Lt))},z.cb=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},z.cc=o=>o.type==="symbol",z.cd=o=>o.type==="circle",z.ce=o=>o.type==="heatmap",z.cf=o=>o.type==="line",z.cg=o=>o.type==="fill",z.ch=o=>o.type==="fill-extrusion",z.ci=o=>o.type==="hillshade",z.cj=o=>o.type==="color-relief",z.ck=o=>o.type==="background",z.cl=o=>o.type==="custom",z.cm=va,z.cn=function(o,i,r){const s=ts(i.x-r.x,i.y-r.y),l=ts(o.x-r.x,o.y-r.y);var p,f;return Ui(Math.atan2(s[0]*l[1]-s[1]*l[0],(p=s)[0]*(f=l)[0]+p[1]*f[1]))},z.co=yr,z.cp=function(o,i){return Bo[i]&&(o instanceof MouseEvent||o instanceof WheelEvent)},z.cq=function(o,i){return es[i]&&"touches"in o},z.cr=function(o){return es[o]||Bo[o]},z.cs=function(o,i,r){var s=i[0],l=i[1];return o[0]=r[0]*s+r[4]*l+r[12],o[1]=r[1]*s+r[5]*l+r[13],o},z.ct=function(o,i){const{x:r,y:s}=ul.fromLngLat(i);return!(o<0||o>25||s<0||s>=1||r<0||r>=1)},z.cu=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},z.cv=class extends dr{},z.cw=Pf,z.cy=function(o){return o.message===wr},z.cz=q,z.d=nt,z.e=Li,z.f=o=>h(void 0,void 0,void 0,(function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(i)}catch(r){throw new Error(`Could not load image because of ${r.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),z.g=k,z.h=o=>new Promise(((i,r)=>{const s=new Image;s.onload=()=>{i(s),URL.revokeObjectURL(s.src),s.onload=null,window.requestAnimationFrame((()=>{s.src=Do}))},s.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const l=new Blob([new Uint8Array(o)],{type:"image/png"});s.src=o.byteLength?URL.createObjectURL(l):Do})),z.i=xr,z.j=(o,i)=>et(Li(o,{type:"json"}),i),z.k=pt,z.l=yt,z.m=et,z.n=(o,i)=>et(Li(o,{type:"arrayBuffer"}),i),z.o=function(o){return new Ah(o).readFields(Yp,[])},z.p=$u,z.q=tl,z.r=Ti,z.s=Lo,z.t=Zn,z.u=Qt,z.v=rt,z.w=Ee,z.x=lc,z.y=cc,z.z=hr})),Ei("worker",["./shared"],(function(z){class h{constructor(E,k){this.keyCache={},E&&this.replace(E,k)}replace(E,k){this._layerConfigs={},this._layers={},this.update(E,[],k)}update(E,k,F){for(const X of E){this._layerConfigs[X.id]=X;const et=this._layers[X.id]=z.bJ(X,F);et._featureFilter=z.aa(et.filter,F),this.keyCache[X.id]&&delete this.keyCache[X.id]}for(const X of k)delete this.keyCache[X],delete this._layerConfigs[X],delete this._layers[X];this.familiesBySource={};const q=z.cC(Object.values(this._layerConfigs),this.keyCache);for(const X of q){const et=X.map((Et=>this._layers[Et.id])),nt=et[0];if(nt.visibility==="none")continue;const tt=nt.source||"";let ut=this.familiesBySource[tt];ut||(ut=this.familiesBySource[tt]={});const yt=nt.sourceLayer||"_geojsonTileLayer";let pt=ut[yt];pt||(pt=ut[yt]=[]),pt.push(et)}}}class It{constructor(E){const k={},F=[];for(const nt in E){const tt=E[nt],ut=k[nt]={};for(const yt in tt){const pt=tt[+yt];if(!pt||pt.bitmap.width===0||pt.bitmap.height===0)continue;const Et={x:0,y:0,w:pt.bitmap.width+2,h:pt.bitmap.height+2};F.push(Et),ut[yt]={rect:Et,metrics:pt.metrics}}}const{w:q,h:X}=z.p(F),et=new z.q({width:q||1,height:X||1});for(const nt in E){const tt=E[nt];for(const ut in tt){const yt=tt[+ut];if(!yt||yt.bitmap.width===0||yt.bitmap.height===0)continue;const pt=k[nt][ut].rect;z.q.copy(yt.bitmap,et,{x:0,y:0},{x:pt.x+1,y:pt.y+1},yt.bitmap)}}this.image=et,this.positions=k}}z.cD("GlyphAtlas",It);class pe{constructor(E){this.tileID=new z.Z(E.tileID.overscaledZ,E.tileID.wrap,E.tileID.canonical.z,E.tileID.canonical.x,E.tileID.canonical.y),this.uid=E.uid,this.zoom=E.zoom,this.pixelRatio=E.pixelRatio,this.tileSize=E.tileSize,this.source=E.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=E.showCollisionBoxes,this.collectResourceTiming=!!E.collectResourceTiming,this.returnDependencies=!!E.returnDependencies,this.promoteId=E.promoteId,this.inFlightDependencies=[]}parse(E,k,F,q,X){return z._(this,void 0,void 0,(function*(){this.status="parsing",this.data=E,this.collisionBoxArray=new z.a8;const et=new z.cE(Object.keys(E.layers).sort()),nt=new z.cF(this.tileID,this.promoteId);nt.bucketLayerIDs=[];const tt={},ut={featureIndex:nt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},dashDependencies:{},availableImages:F,subdivisionGranularity:X},yt=k.familiesBySource[this.source];for(const _t in yt){const Me=E.layers[_t];if(!Me)continue;Me.version===1&&z.w(`Vector tile source "${this.source}" layer "${_t}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yi=et.encode(_t),ao=[];for(let xi=0;xi<Me.length;xi++){const wt=Me.feature(xi),$t=nt.getId(wt,_t);ao.push({feature:wt,id:$t,index:xi,sourceLayerIndex:yi})}for(const xi of yt[_t]){const wt=xi[0];wt.source!==this.source&&z.w(`layer.source = ${wt.source} does not equal this.source = ${this.source}`),wt.isHidden(this.zoom,!0)||(he(xi,this.zoom,F),(tt[wt.id]=wt.createBucket({index:nt.bucketLayerIDs.length,layers:xi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yi,sourceID:this.source})).populate(ao,ut,this.tileID.canonical),nt.bucketLayerIDs.push(xi.map(($t=>$t.id))))}}const pt=z.bO(ut.glyphDependencies,(_t=>Object.keys(_t).map(Number)));this.inFlightDependencies.forEach((_t=>_t?.abort())),this.inFlightDependencies=[];let Et=Promise.resolve({});if(Object.keys(pt).length){const _t=new AbortController;this.inFlightDependencies.push(_t),Et=q.sendAsync({type:"GG",data:{stacks:pt,source:this.source,tileID:this.tileID,type:"glyphs"}},_t)}const rt=Object.keys(ut.iconDependencies);let Xt=Promise.resolve({});if(rt.length){const _t=new AbortController;this.inFlightDependencies.push(_t),Xt=q.sendAsync({type:"GI",data:{icons:rt,source:this.source,tileID:this.tileID,type:"icons"}},_t)}const ye=Object.keys(ut.patternDependencies);let Dt=Promise.resolve({});if(ye.length){const _t=new AbortController;this.inFlightDependencies.push(_t),Dt=q.sendAsync({type:"GI",data:{icons:ye,source:this.source,tileID:this.tileID,type:"patterns"}},_t)}const Ht=ut.dashDependencies;let oe=Promise.resolve({});if(Object.keys(Ht).length){const _t=new AbortController;this.inFlightDependencies.push(_t),oe=q.sendAsync({type:"GDA",data:{dashes:Ht}},_t)}const[je,Ve,ri,Ae]=yield Promise.all([Et,Xt,Dt,oe]),xe=new It(je),ke=new z.cG(Ve,ri);for(const _t in tt){const Me=tt[_t];Me instanceof z.a9?(he(Me.layers,this.zoom,F),z.cH({bucket:Me,glyphMap:je,glyphPositions:xe.positions,imageMap:Ve,imagePositions:ke.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:ut.subdivisionGranularity})):Me.hasDependencies&&(Me instanceof z.cI||Me instanceof z.cJ||Me instanceof z.cK)&&(he(Me.layers,this.zoom,F),Me.addFeatures(ut,this.tileID.canonical,ke.patternPositions,Ae))}return this.status="done",{buckets:Object.values(tt).filter((_t=>!_t.isEmpty())),featureIndex:nt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xe.image,imageAtlas:ke,dashPositions:Ae,glyphMap:this.returnDependencies?je:null,iconMap:this.returnDependencies?Ve:null,glyphPositions:this.returnDependencies?xe.positions:null}}))}}function he(Q,E,k){const F=new z.F(E);for(const q of Q)q.recalculate(F,k)}class ki{constructor(E,k,F){this.actor=E,this.layerIndex=k,this.availableImages=F,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(E,k){return z._(this,void 0,void 0,(function*(){const F=yield z.n(E.request,k);try{return{vectorTile:new z.cL(new z.cM(F.data)),rawData:F.data,cacheControl:F.cacheControl,expires:F.expires}}catch(q){const X=new Uint8Array(F.data);let et=`Unable to parse the tile at ${E.request.url}, `;throw et+=X[0]===31&&X[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${q.message}`,new Error(et)}}))}loadTile(E){return z._(this,void 0,void 0,(function*(){const k=E.uid,F=!!(E&&E.request&&E.request.collectResourceTiming)&&new z.cN(E.request),q=new pe(E);this.loading[k]=q;const X=new AbortController;q.abort=X;try{const et=yield this.loadVectorTile(E,X);if(delete this.loading[k],!et)return null;const nt=et.rawData,tt={};et.expires&&(tt.expires=et.expires),et.cacheControl&&(tt.cacheControl=et.cacheControl);const ut={};if(F){const pt=F.finish();pt&&(ut.resourceTiming=JSON.parse(JSON.stringify(pt)))}q.vectorTile=et.vectorTile;const yt=q.parse(et.vectorTile,this.layerIndex,this.availableImages,this.actor,E.subdivisionGranularity);this.loaded[k]=q,this.fetching[k]={rawTileData:nt,cacheControl:tt,resourceTiming:ut};try{const pt=yield yt;return z.e({rawTileData:nt.slice(0)},pt,tt,ut)}finally{delete this.fetching[k]}}catch(et){throw delete this.loading[k],q.status="done",this.loaded[k]=q,et}}))}reloadTile(E){return z._(this,void 0,void 0,(function*(){const k=E.uid;if(!this.loaded||!this.loaded[k])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const F=this.loaded[k];if(F.showCollisionBoxes=E.showCollisionBoxes,F.status==="parsing"){const q=yield F.parse(F.vectorTile,this.layerIndex,this.availableImages,this.actor,E.subdivisionGranularity);let X;if(this.fetching[k]){const{rawTileData:et,cacheControl:nt,resourceTiming:tt}=this.fetching[k];delete this.fetching[k],X=z.e({rawTileData:et.slice(0)},q,nt,tt)}else X=q;return X}if(F.status==="done"&&F.vectorTile)return F.parse(F.vectorTile,this.layerIndex,this.availableImages,this.actor,E.subdivisionGranularity)}))}abortTile(E){return z._(this,void 0,void 0,(function*(){const k=this.loading,F=E.uid;k&&k[F]&&k[F].abort&&(k[F].abort.abort(),delete k[F])}))}removeTile(E){return z._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[E.uid]&&delete this.loaded[E.uid]}))}}class We{constructor(){this.loaded={}}loadTile(E){return z._(this,void 0,void 0,(function*(){const{uid:k,encoding:F,rawImageData:q,redFactor:X,greenFactor:et,blueFactor:nt,baseShift:tt}=E,ut=q.width+2,yt=q.height+2,pt=z.b(q)?new z.R({width:ut,height:yt},yield z.cO(q,-1,-1,ut,yt)):q,Et=new z.cP(k,pt,F,X,et,nt,tt);return this.loaded=this.loaded||{},this.loaded[k]=Et,Et}))}removeTile(E){const k=this.loaded,F=E.uid;k&&k[F]&&delete k[F]}}var mr,Zt,ht=(function(){if(Zt)return mr;function Q(k,F){if(k.length!==0){E(k[0],F);for(var q=1;q<k.length;q++)E(k[q],!F)}}function E(k,F){for(var q=0,X=0,et=0,nt=k.length,tt=nt-1;et<nt;tt=et++){var ut=(k[et][0]-k[tt][0])*(k[tt][1]+k[et][1]),yt=q+ut;X+=Math.abs(q)>=Math.abs(ut)?q-yt+ut:ut-yt+q,q=yt}q+X>=0!=!!F&&k.reverse()}return Zt=1,mr=function k(F,q){var X,et=F&&F.type;if(et==="FeatureCollection")for(X=0;X<F.features.length;X++)k(F.features[X],q);else if(et==="GeometryCollection")for(X=0;X<F.geometries.length;X++)k(F.geometries[X],q);else if(et==="Feature")k(F.geometry,q);else if(et==="Polygon")Q(F.coordinates,q);else if(et==="MultiPolygon")for(X=0;X<F.coordinates.length;X++)Q(F.coordinates[X],q);return F}})(),zo=z.cQ(ht);class Dr extends z.cS{constructor(E,k){super(new z.cM,0,k,[],[]),this.feature=E,this.type=E.type,this.properties=E.tags?E.tags:{},"id"in E&&(typeof E.id=="string"?this.id=parseInt(E.id,10):typeof E.id!="number"||isNaN(E.id)||(this.id=E.id))}loadGeometry(){const E=[],k=this.feature.type===1?[this.feature.geometry]:this.feature.geometry;for(const F of k){const q=[];for(const X of F)q.push(new z.P(X[0],X[1]));E.push(q)}return E}}class be extends z.cR{constructor(E,k){super(new z.cM),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.version=k?k.version:1,this.extent=k?k.extent:4096,this.length=E.length,this.features=E}feature(E){return new Dr(this.features[E],this.extent)}}function Re(Q,E){E.writeVarintField(15,Q.version||1),E.writeStringField(1,Q.name||""),E.writeVarintField(5,Q.extent||4096);const k={keys:[],values:[],keycache:{},valuecache:{}};for(let X=0;X<Q.length;X++)k.feature=Q.feature(X),E.writeMessage(2,ga,k);const F=k.keys;for(const X of F)E.writeStringField(3,X);const q=k.values;for(const X of q)E.writeMessage(4,Eo,X)}function ga(Q,E){if(!Q.feature)return;const k=Q.feature;k.id!==void 0&&E.writeVarintField(1,k.id),E.writeMessage(2,Ro,Q),E.writeVarintField(3,k.type),E.writeMessage(4,Qr,k)}function Ro(Q,E){for(const k in Q.feature?.properties){let F=Q.feature.properties[k],q=Q.keycache[k];if(F===null)continue;q===void 0&&(Q.keys.push(k),q=Q.keys.length-1,Q.keycache[k]=q),E.writeVarint(q),typeof F!="string"&&typeof F!="boolean"&&typeof F!="number"&&(F=JSON.stringify(F));const X=typeof F+":"+F;let et=Q.valuecache[X];et===void 0&&(Q.values.push(F),et=Q.values.length-1,Q.valuecache[X]=et),E.writeVarint(et)}}function gi(Q,E){return(E<<3)+(7&Q)}function ya(Q){return Q<<1^Q>>31}function Qr(Q,E){const k=Q.loadGeometry(),F=Q.type;let q=0,X=0;for(const et of k){let nt=1;F===1&&(nt=et.length),E.writeVarint(gi(1,nt));const tt=F===3?et.length-1:et.length;for(let ut=0;ut<tt;ut++){ut===1&&F!==1&&E.writeVarint(gi(2,tt-1));const yt=et[ut].x-q,pt=et[ut].y-X;E.writeVarint(ya(yt)),E.writeVarint(ya(pt)),q+=yt,X+=pt}Q.type===3&&E.writeVarint(gi(7,1))}}function Eo(Q,E){const k=typeof Q;k==="string"?E.writeStringField(1,Q):k==="boolean"?E.writeBooleanField(7,Q):k==="number"&&(Q%1!=0?E.writeDoubleField(3,Q):Q<0?E.writeSVarintField(6,Q):E.writeVarintField(5,Q))}const Jr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Q=>Q},to=Math.fround||(Di=new Float32Array(1),Q=>(Di[0]=+Q,Di[0]));var Di;class Ja{constructor(E){this.options=Object.assign(Object.create(Jr),E),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(E){const{log:k,minZoom:F,maxZoom:q}=this.options;k&&console.time("total time");const X=`prepare ${E.length} points`;k&&console.time(X),this.points=E;const et=[];for(let tt=0;tt<E.length;tt++){const ut=E[tt];if(!ut.geometry)continue;const[yt,pt]=ut.geometry.coordinates,Et=to(eo(yt)),rt=to(_r(pt));et.push(Et,rt,1/0,tt,-1,1),this.options.reduce&&et.push(0)}let nt=this.trees[q+1]=this._createTree(et);k&&console.timeEnd(X);for(let tt=q;tt>=F;tt--){const ut=+Date.now();nt=this.trees[tt]=this._createTree(this._cluster(nt,tt)),k&&console.log("z%d: %d clusters in %dms",tt,nt.numItems,+Date.now()-ut)}return k&&console.timeEnd("total time"),this}getClusters(E,k){let F=((E[0]+180)%360+360)%360-180;const q=Math.max(-90,Math.min(90,E[1]));let X=E[2]===180?180:((E[2]+180)%360+360)%360-180;const et=Math.max(-90,Math.min(90,E[3]));if(E[2]-E[0]>=360)F=-180,X=180;else if(F>X){const pt=this.getClusters([F,q,180,et],k),Et=this.getClusters([-180,q,X,et],k);return pt.concat(Et)}const nt=this.trees[this._limitZoom(k)],tt=nt.range(eo(F),_r(et),eo(X),_r(q)),ut=nt.data,yt=[];for(const pt of tt){const Et=this.stride*pt;yt.push(ut[Et+5]>1?ko(ut,Et,this.clusterProps):this.points[ut[Et+3]])}return yt}getChildren(E){const k=this._getOriginId(E),F=this._getOriginZoom(E),q="No cluster with the specified id.",X=this.trees[F];if(!X)throw new Error(q);const et=X.data;if(k*this.stride>=et.length)throw new Error(q);const nt=this.options.radius/(this.options.extent*Math.pow(2,F-1)),tt=X.within(et[k*this.stride],et[k*this.stride+1],nt),ut=[];for(const yt of tt){const pt=yt*this.stride;et[pt+4]===E&&ut.push(et[pt+5]>1?ko(et,pt,this.clusterProps):this.points[et[pt+3]])}if(ut.length===0)throw new Error(q);return ut}getLeaves(E,k,F){const q=[];return this._appendLeaves(q,E,k=k||10,F=F||0,0),q}getTile(E,k,F){const q=this.trees[this._limitZoom(E)],X=Math.pow(2,E),{extent:et,radius:nt}=this.options,tt=nt/et,ut=(F-tt)/X,yt=(F+1+tt)/X,pt={features:[]};return this._addTileFeatures(q.range((k-tt)/X,ut,(k+1+tt)/X,yt),q.data,k,F,X,pt),k===0&&this._addTileFeatures(q.range(1-tt/X,ut,1,yt),q.data,X,F,X,pt),k===X-1&&this._addTileFeatures(q.range(0,ut,tt/X,yt),q.data,-1,F,X,pt),pt.features.length?pt:null}getClusterExpansionZoom(E){let k=this._getOriginZoom(E)-1;for(;k<=this.options.maxZoom;){const F=this.getChildren(E);if(k++,F.length!==1)break;E=F[0].properties.cluster_id}return k}_appendLeaves(E,k,F,q,X){const et=this.getChildren(k);for(const nt of et){const tt=nt.properties;if(tt&&tt.cluster?X+tt.point_count<=q?X+=tt.point_count:X=this._appendLeaves(E,tt.cluster_id,F,q,X):X<q?X++:E.push(nt),E.length===F)break}return X}_createTree(E){const k=new z.aI(E.length/this.stride|0,this.options.nodeSize,Float32Array);for(let F=0;F<E.length;F+=this.stride)k.add(E[F],E[F+1]);return k.finish(),k.data=E,k}_addTileFeatures(E,k,F,q,X,et){for(const nt of E){const tt=nt*this.stride,ut=k[tt+5]>1;let yt,pt,Et;if(ut)yt=or(k,tt,this.clusterProps),pt=k[tt],Et=k[tt+1];else{const ye=this.points[k[tt+3]];yt=ye.properties;const[Dt,Ht]=ye.geometry.coordinates;pt=eo(Dt),Et=_r(Ht)}const rt={type:1,geometry:[[Math.round(this.options.extent*(pt*X-F)),Math.round(this.options.extent*(Et*X-q))]],tags:yt};let Xt;Xt=ut||this.options.generateId?k[tt+3]:this.points[k[tt+3]].id,Xt!==void 0&&(rt.id=Xt),et.features.push(rt)}}_limitZoom(E){return Math.max(this.options.minZoom,Math.min(Math.floor(+E),this.options.maxZoom+1))}_cluster(E,k){const{radius:F,extent:q,reduce:X,minPoints:et}=this.options,nt=F/(q*Math.pow(2,k)),tt=E.data,ut=[],yt=this.stride;for(let pt=0;pt<tt.length;pt+=yt){if(tt[pt+2]<=k)continue;tt[pt+2]=k;const Et=tt[pt],rt=tt[pt+1],Xt=E.within(tt[pt],tt[pt+1],nt),ye=tt[pt+5];let Dt=ye;for(const Ht of Xt){const oe=Ht*yt;tt[oe+2]>k&&(Dt+=tt[oe+5])}if(Dt>ye&&Dt>=et){let Ht,oe=Et*ye,je=rt*ye,Ve=-1;const ri=(pt/yt<<5)+(k+1)+this.points.length;for(const Ae of Xt){const xe=Ae*yt;if(tt[xe+2]<=k)continue;tt[xe+2]=k;const ke=tt[xe+5];oe+=tt[xe]*ke,je+=tt[xe+1]*ke,tt[xe+4]=ri,X&&(Ht||(Ht=this._map(tt,pt,!0),Ve=this.clusterProps.length,this.clusterProps.push(Ht)),X(Ht,this._map(tt,xe)))}tt[pt+4]=ri,ut.push(oe/Dt,je/Dt,1/0,ri,-1,Dt),X&&ut.push(Ve)}else{for(let Ht=0;Ht<yt;Ht++)ut.push(tt[pt+Ht]);if(Dt>1)for(const Ht of Xt){const oe=Ht*yt;if(!(tt[oe+2]<=k)){tt[oe+2]=k;for(let je=0;je<yt;je++)ut.push(tt[oe+je])}}}}return ut}_getOriginId(E){return E-this.points.length>>5}_getOriginZoom(E){return(E-this.points.length)%32}_map(E,k,F){if(E[k+5]>1){const et=this.clusterProps[E[k+6]];return F?Object.assign({},et):et}const q=this.points[E[k+3]].properties,X=this.options.map(q);return F&&X===q?Object.assign({},X):X}}function ko(Q,E,k){return{type:"Feature",id:Q[E+3],properties:or(Q,E,k),geometry:{type:"Point",coordinates:[(F=Q[E],360*(F-.5)),ts(Q[E+1])]}};var F}function or(Q,E,k){const F=Q[E+5],q=F>=1e4?`${Math.round(F/1e3)}k`:F>=1e3?Math.round(F/100)/10+"k":F,X=Q[E+6],et=X===-1?{}:Object.assign({},k[X]);return Object.assign(et,{cluster:!0,cluster_id:Q[E+3],point_count:F,point_count_abbreviated:q})}function eo(Q){return Q/360+.5}function _r(Q){const E=Math.sin(Q*Math.PI/180),k=.5-.25*Math.log((1+E)/(1-E))/Math.PI;return k<0?0:k>1?1:k}function ts(Q){const E=(180-360*Q)*Math.PI/180;return 360*Math.atan(Math.exp(E))/Math.PI-90}function ne(Q,E,k,F){let q=F;const X=E+(k-E>>1);let et,nt=k-E;const tt=Q[E],ut=Q[E+1],yt=Q[k],pt=Q[k+1];for(let Et=E+3;Et<k;Et+=3){const rt=xa(Q[Et],Q[Et+1],tt,ut,yt,pt);if(rt>q)et=Et,q=rt;else if(rt===q){const Xt=Math.abs(Et-X);Xt<nt&&(et=Et,nt=Xt)}}q>F&&(et-E>3&&ne(Q,E,et,F),Q[et+2]=q,k-et>3&&ne(Q,et,k,F))}function xa(Q,E,k,F,q,X){let et=q-k,nt=X-F;if(et!==0||nt!==0){const tt=((Q-k)*et+(E-F)*nt)/(et*et+nt*nt);tt>1?(k=q,F=X):tt>0&&(k+=et*tt,F+=nt*tt)}return et=Q-k,nt=E-F,et*et+nt*nt}function Wi(Q,E,k,F){const q={id:Q??null,type:E,geometry:k,tags:F,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(E==="Point"||E==="MultiPoint"||E==="LineString")gr(q,k);else if(E==="Polygon")gr(q,k[0]);else if(E==="MultiLineString")for(const X of k)gr(q,X);else if(E==="MultiPolygon")for(const X of k)gr(q,X[0]);return q}function gr(Q,E){for(let k=0;k<E.length;k+=3)Q.minX=Math.min(Q.minX,E[k]),Q.minY=Math.min(Q.minY,E[k+1]),Q.maxX=Math.max(Q.maxX,E[k]),Q.maxY=Math.max(Q.maxY,E[k+1])}function Hi(Q,E,k,F){if(!E.geometry)return;const q=E.geometry.coordinates;if(q&&q.length===0)return;const X=E.geometry.type,et=Math.pow(k.tolerance/((1<<k.maxZoom)*k.extent),2);let nt=[],tt=E.id;if(k.promoteId?tt=E.properties[k.promoteId]:k.generateId&&(tt=F||0),X==="Point")va(q,nt);else if(X==="MultiPoint")for(const ut of q)va(ut,nt);else if(X==="LineString")yr(q,nt,et,!1);else if(X==="MultiLineString"){if(k.lineMetrics){for(const ut of q)nt=[],yr(ut,nt,et,!1),Q.push(Wi(tt,"LineString",nt,E.properties));return}ui(q,nt,et,!1)}else if(X==="Polygon")ui(q,nt,et,!0);else{if(X!=="MultiPolygon"){if(X==="GeometryCollection"){for(const ut of E.geometry.geometries)Hi(Q,{id:tt,geometry:ut,properties:E.properties},k,F);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ut of q){const yt=[];ui(ut,yt,et,!0),nt.push(yt)}}Q.push(Wi(tt,X,nt,E.properties))}function va(Q,E){E.push(io(Q[0]),Li(Q[1]),0)}function yr(Q,E,k,F){let q,X,et=0;for(let tt=0;tt<Q.length;tt++){const ut=io(Q[tt][0]),yt=Li(Q[tt][1]);E.push(ut,yt,0),tt>0&&(et+=F?(q*yt-ut*X)/2:Math.sqrt(Math.pow(ut-q,2)+Math.pow(yt-X,2))),q=ut,X=yt}const nt=E.length-3;E[2]=1,ne(E,0,nt,k),E[nt+2]=1,E.size=Math.abs(et),E.start=0,E.end=E.size}function ui(Q,E,k,F){for(let q=0;q<Q.length;q++){const X=[];yr(Q[q],X,k,F),E.push(X)}}function io(Q){return Q/360+.5}function Li(Q){const E=Math.sin(Q*Math.PI/180),k=.5-.25*Math.log((1+E)/(1-E))/Math.PI;return k<0?0:k>1?1:k}function Ni(Q,E,k,F,q,X,et,nt){if(F/=E,X>=(k/=E)&&et<F)return Q;if(et<k||X>=F)return null;const tt=[];for(const ut of Q){const yt=ut.geometry;let pt=ut.type;const Et=q===0?ut.minX:ut.minY,rt=q===0?ut.maxX:ut.maxY;if(Et>=k&&rt<F){tt.push(ut);continue}if(rt<k||Et>=F)continue;let Xt=[];if(pt==="Point"||pt==="MultiPoint")ba(yt,Xt,k,F,q);else if(pt==="LineString")wa(yt,Xt,k,F,q,!1,nt.lineMetrics);else if(pt==="MultiLineString")ro(yt,Xt,k,F,q,!1);else if(pt==="Polygon")ro(yt,Xt,k,F,q,!0);else if(pt==="MultiPolygon")for(const ye of yt){const Dt=[];ro(ye,Dt,k,F,q,!0),Dt.length&&Xt.push(Dt)}if(Xt.length){if(nt.lineMetrics&&pt==="LineString"){for(const ye of Xt)tt.push(Wi(ut.id,pt,ye,ut.tags));continue}pt!=="LineString"&&pt!=="MultiLineString"||(Xt.length===1?(pt="LineString",Xt=Xt[0]):pt="MultiLineString"),pt!=="Point"&&pt!=="MultiPoint"||(pt=Xt.length===3?"Point":"MultiPoint"),tt.push(Wi(ut.id,pt,Xt,ut.tags))}}return tt.length?tt:null}function ba(Q,E,k,F,q){for(let X=0;X<Q.length;X+=3){const et=Q[X+q];et>=k&&et<=F&&Ee(E,Q[X],Q[X+1],Q[X+2])}}function wa(Q,E,k,F,q,X,et){let nt=Fi(Q);const tt=q===0?fe:xr;let ut,yt,pt=Q.start;for(let Dt=0;Dt<Q.length-3;Dt+=3){const Ht=Q[Dt],oe=Q[Dt+1],je=Q[Dt+2],Ve=Q[Dt+3],ri=Q[Dt+4],Ae=q===0?Ht:oe,xe=q===0?Ve:ri;let ke=!1;et&&(ut=Math.sqrt(Math.pow(Ht-Ve,2)+Math.pow(oe-ri,2))),Ae<k?xe>k&&(yt=tt(nt,Ht,oe,Ve,ri,k),et&&(nt.start=pt+ut*yt)):Ae>F?xe<F&&(yt=tt(nt,Ht,oe,Ve,ri,F),et&&(nt.start=pt+ut*yt)):Ee(nt,Ht,oe,je),xe<k&&Ae>=k&&(yt=tt(nt,Ht,oe,Ve,ri,k),ke=!0),xe>F&&Ae<=F&&(yt=tt(nt,Ht,oe,Ve,ri,F),ke=!0),!X&&ke&&(et&&(nt.end=pt+ut*yt),E.push(nt),nt=Fi(Q)),et&&(pt+=ut)}let Et=Q.length-3;const rt=Q[Et],Xt=Q[Et+1],ye=q===0?rt:Xt;ye>=k&&ye<=F&&Ee(nt,rt,Xt,Q[Et+2]),Et=nt.length-3,X&&Et>=3&&(nt[Et]!==nt[0]||nt[Et+1]!==nt[1])&&Ee(nt,nt[0],nt[1],nt[2]),nt.length&&E.push(nt)}function Fi(Q){const E=[];return E.size=Q.size,E.start=Q.start,E.end=Q.end,E}function ro(Q,E,k,F,q,X){for(const et of Q)wa(et,E,k,F,q,X,!1)}function Ee(Q,E,k,F){Q.push(E,k,F)}function fe(Q,E,k,F,q,X){const et=(X-E)/(F-E);return Ee(Q,X,k+(q-k)*et,1),et}function xr(Q,E,k,F,q,X){const et=(X-k)/(q-k);return Ee(Q,E+(F-E)*et,X,1),et}function oo(Q,E){const k=[];for(let F=0;F<Q.length;F++){const q=Q[F],X=q.type;let et;if(X==="Point"||X==="MultiPoint"||X==="LineString")et=Lr(q.geometry,E);else if(X==="MultiLineString"||X==="Polygon"){et=[];for(const nt of q.geometry)et.push(Lr(nt,E))}else if(X==="MultiPolygon"){et=[];for(const nt of q.geometry){const tt=[];for(const ut of nt)tt.push(Lr(ut,E));et.push(tt)}}k.push(Wi(q.id,X,et,q.tags))}return k}function Lr(Q,E){const k=[];k.size=Q.size,Q.start!==void 0&&(k.start=Q.start,k.end=Q.end);for(let F=0;F<Q.length;F+=3)k.push(Q[F]+E,Q[F+1],Q[F+2]);return k}function vr(Q,E){if(Q.transformed)return Q;const k=1<<Q.z,F=Q.x,q=Q.y;for(const X of Q.features){const et=X.geometry,nt=X.type;if(X.geometry=[],nt===1)for(let tt=0;tt<et.length;tt+=2)X.geometry.push(Do(et[tt],et[tt+1],E,k,F,q));else for(let tt=0;tt<et.length;tt++){const ut=[];for(let yt=0;yt<et[tt].length;yt+=2)ut.push(Do(et[tt][yt],et[tt][yt+1],E,k,F,q));X.geometry.push(ut)}}return Q.transformed=!0,Q}function Do(Q,E,k,F,q,X){return[Math.round(k*(Q*F-q)),Math.round(k*(E*F-X))]}function br(Q,E,k,F,q){const X=E===q.maxZoom?0:q.tolerance/((1<<E)*q.extent),et={features:[],numPoints:0,numSimplified:0,numFeatures:Q.length,source:null,x:k,y:F,z:E,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const nt of Q)Fr(et,nt,X,q);return et}function Fr(Q,E,k,F){const q=E.geometry,X=E.type,et=[];if(Q.minX=Math.min(Q.minX,E.minX),Q.minY=Math.min(Q.minY,E.minY),Q.maxX=Math.max(Q.maxX,E.maxX),Q.maxY=Math.max(Q.maxY,E.maxY),X==="Point"||X==="MultiPoint")for(let nt=0;nt<q.length;nt+=3)et.push(q[nt],q[nt+1]),Q.numPoints++,Q.numSimplified++;else if(X==="LineString")ar(et,q,Q,k,!1,!1);else if(X==="MultiLineString"||X==="Polygon")for(let nt=0;nt<q.length;nt++)ar(et,q[nt],Q,k,X==="Polygon",nt===0);else if(X==="MultiPolygon")for(let nt=0;nt<q.length;nt++){const tt=q[nt];for(let ut=0;ut<tt.length;ut++)ar(et,tt[ut],Q,k,!0,ut===0)}if(et.length){let nt=E.tags||null;if(X==="LineString"&&F.lineMetrics){nt={};for(const ut in E.tags)nt[ut]=E.tags[ut];nt.mapbox_clip_start=q.start/q.size,nt.mapbox_clip_end=q.end/q.size}const tt={geometry:et,type:X==="Polygon"||X==="MultiPolygon"?3:X==="LineString"||X==="MultiLineString"?2:1,tags:nt};E.id!==null&&(tt.id=E.id),Q.features.push(tt)}}function ar(Q,E,k,F,q,X){const et=F*F;if(F>0&&E.size<(q?et:F))return void(k.numPoints+=E.length/3);const nt=[];for(let tt=0;tt<E.length;tt+=3)(F===0||E[tt+2]>et)&&(k.numSimplified++,nt.push(E[tt],E[tt+1])),k.numPoints++;q&&(function(tt,ut){let yt=0;for(let pt=0,Et=tt.length,rt=Et-2;pt<Et;rt=pt,pt+=2)yt+=(tt[pt]-tt[rt])*(tt[pt+1]+tt[rt+1]);if(yt>0===ut)for(let pt=0,Et=tt.length;pt<Et/2;pt+=2){const rt=tt[pt],Xt=tt[pt+1];tt[pt]=tt[Et-2-pt],tt[pt+1]=tt[Et-1-pt],tt[Et-2-pt]=rt,tt[Et-1-pt]=Xt}})(nt,X),Q.push(nt)}const Lo={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Fo{constructor(E,k){const F=(k=this.options=(function(X,et){for(const nt in et)X[nt]=et[nt];return X})(Object.create(Lo),k)).debug;if(F&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");let q=(function(X,et){const nt=[];if(X.type==="FeatureCollection")for(let tt=0;tt<X.features.length;tt++)Hi(nt,X.features[tt],et,tt);else Hi(nt,X.type==="Feature"?X:{geometry:X},et);return nt})(E,k);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=(function(X,et){const nt=et.buffer/et.extent;let tt=X;const ut=Ni(X,1,-1-nt,nt,0,-1,2,et),yt=Ni(X,1,1-nt,2+nt,0,-1,2,et);return(ut||yt)&&(tt=Ni(X,1,-nt,1+nt,0,-1,2,et)||[],ut&&(tt=oo(ut,1).concat(tt)),yt&&(tt=tt.concat(oo(yt,-1)))),tt})(q,k),q.length&&this.splitTile(q,0,0,0),F&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(E,k,F,q,X,et,nt){const tt=[E,k,F,q],ut=this.options,yt=ut.debug;for(;tt.length;){q=tt.pop(),F=tt.pop(),k=tt.pop(),E=tt.pop();const pt=1<<k,Et=Ui(k,F,q);let rt=this.tiles[Et];if(!rt&&(yt>1&&console.time("creation"),rt=this.tiles[Et]=br(E,k,F,q,ut),this.tileCoords.push({z:k,x:F,y:q}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,F,q,rt.numFeatures,rt.numPoints,rt.numSimplified),console.timeEnd("creation"));const ke=`z${k}`;this.stats[ke]=(this.stats[ke]||0)+1,this.total++}if(rt.source=E,X==null){if(k===ut.indexMaxZoom||rt.numPoints<=ut.indexMaxPoints)continue}else{if(k===ut.maxZoom||k===X)continue;if(X!=null){const ke=X-k;if(F!==et>>ke||q!==nt>>ke)continue}}if(rt.source=null,E.length===0)continue;yt>1&&console.time("clipping");const Xt=.5*ut.buffer/ut.extent,ye=.5-Xt,Dt=.5+Xt,Ht=1+Xt;let oe=null,je=null,Ve=null,ri=null,Ae=Ni(E,pt,F-Xt,F+Dt,0,rt.minX,rt.maxX,ut),xe=Ni(E,pt,F+ye,F+Ht,0,rt.minX,rt.maxX,ut);E=null,Ae&&(oe=Ni(Ae,pt,q-Xt,q+Dt,1,rt.minY,rt.maxY,ut),je=Ni(Ae,pt,q+ye,q+Ht,1,rt.minY,rt.maxY,ut),Ae=null),xe&&(Ve=Ni(xe,pt,q-Xt,q+Dt,1,rt.minY,rt.maxY,ut),ri=Ni(xe,pt,q+ye,q+Ht,1,rt.minY,rt.maxY,ut),xe=null),yt>1&&console.timeEnd("clipping"),tt.push(oe||[],k+1,2*F,2*q),tt.push(je||[],k+1,2*F,2*q+1),tt.push(Ve||[],k+1,2*F+1,2*q),tt.push(ri||[],k+1,2*F+1,2*q+1)}}getTile(E,k,F){E=+E,k=+k,F=+F;const q=this.options,{extent:X,debug:et}=q;if(E<0||E>24)return null;const nt=1<<E,tt=Ui(E,k=k+nt&nt-1,F);if(this.tiles[tt])return vr(this.tiles[tt],X);et>1&&console.log("drilling down to z%d-%d-%d",E,k,F);let ut,yt=E,pt=k,Et=F;for(;!ut&&yt>0;)yt--,pt>>=1,Et>>=1,ut=this.tiles[Ui(yt,pt,Et)];return ut&&ut.source?(et>1&&(console.log("found parent tile z%d-%d-%d",yt,pt,Et),console.time("drilling down")),this.splitTile(ut.source,yt,pt,Et,E,k,F),et>1&&console.timeEnd("drilling down"),this.tiles[tt]?vr(this.tiles[tt],X):null):null}}function Ui(Q,E,k){return 32*((1<<Q)*k+E)+Q}class es extends ki{constructor(E,k,F,q=Bo){super(E,k,F),this._dataUpdateable=new Map,this._createGeoJSONIndex=q}loadVectorTile(E,k){return z._(this,void 0,void 0,(function*(){const F=E.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const q=this._geoJSONIndex.getTile(F.z,F.x,F.y);if(!q)return null;const X=new be(q.features,{version:2,extent:z.$});let et=(function(nt){const tt=new z.cM;return(function(ut,yt){for(const pt in ut.layers)yt.writeMessage(3,Re,ut.layers[pt])})(nt,tt),tt.finish()})(X);return et.byteOffset===0&&et.byteLength===et.buffer.byteLength||(et=new Uint8Array(et)),{vectorTile:X,rawData:et.buffer}}))}loadData(E){return z._(this,void 0,void 0,(function*(){var k;(k=this._pendingRequest)===null||k===void 0||k.abort();const F=!!(E&&E.request&&E.request.collectResourceTiming)&&new z.cN(E.request);this._pendingRequest=new AbortController;try{(!this._pendingData||E.request||E.data||E.dataDiff)&&(this._pendingData=this.loadAndProcessGeoJSON(E,this._pendingRequest));const q=yield this._pendingData;this._geoJSONIndex=this._createGeoJSONIndex(q,E),this.loaded={};const X={data:q};if(F){const et=F.finish();et&&(X.resourceTiming={},X.resourceTiming[E.source]=JSON.parse(JSON.stringify(et)))}return X}catch(q){if(delete this._pendingRequest,z.cy(q))return{abandoned:!0};throw q}}))}getData(){return z._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(E){const k=this.loaded;return k&&k[E.uid]?super.reloadTile(E):this.loadTile(E)}loadAndProcessGeoJSON(E,k){return z._(this,void 0,void 0,(function*(){let F=yield this.loadGeoJSON(E,k);if(delete this._pendingRequest,typeof F!="object")throw new Error(`Input data given to '${E.source}' is not a valid GeoJSON object.`);if(zo(F,!0),E.filter){const q=z.cT(E.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(q.result==="error")throw new Error(q.value.map((X=>`${X.key}: ${X.message}`)).join(", "));F={type:"FeatureCollection",features:F.features.filter((X=>q.value.evaluate({zoom:0},X)))}}return F}))}loadGeoJSON(E,k){return z._(this,void 0,void 0,(function*(){const{promoteId:F}=E;if(E.request){const q=yield z.j(E.request,k);return this._dataUpdateable=z.cV(q.data,F)?z.cU(q.data,F):void 0,q.data}if(typeof E.data=="string")try{const q=JSON.parse(E.data);return this._dataUpdateable=z.cV(q,F)?z.cU(q,F):void 0,q}catch{throw new Error(`Input data given to '${E.source}' is not a valid GeoJSON object.`)}if(!E.dataDiff)throw new Error(`Input data given to '${E.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${E.source}`);return z.cW(this._dataUpdateable,E.dataDiff,F),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(E){return z._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(E){return this._geoJSONIndex.getClusterExpansionZoom(E.clusterId)}getClusterChildren(E){return this._geoJSONIndex.getChildren(E.clusterId)}getClusterLeaves(E){return this._geoJSONIndex.getLeaves(E.clusterId,E.limit,E.offset)}}function Bo(Q,E){return E.cluster?new Ja((function({superclusterOptions:k,clusterProperties:F}){if(!F||!k)return k;const q={},X={},et={accumulated:null,zoom:0},nt={properties:null},tt=Object.keys(F);for(const ut of tt){const[yt,pt]=F[ut],Et=z.cT(pt),rt=z.cT(typeof yt=="string"?[yt,["accumulated"],["get",ut]]:yt);q[ut]=Et.value,X[ut]=rt.value}return k.map=ut=>{nt.properties=ut;const yt={};for(const pt of tt)yt[pt]=q[pt].evaluate(et,nt);return yt},k.reduce=(ut,yt)=>{nt.properties=yt;for(const pt of tt)et.accumulated=ut[pt],ut[pt]=X[pt].evaluate(et,nt)},k})(E)).load(Q.features):(function(k,F){return new Fo(k,F)})(Q,E.geojsonVtOptions)}class wr{constructor(E){this.self=E,this.actor=new z.J(E),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.globalStates=new Map,this.self.registerWorkerSource=(k,F)=>{if(this.externalWorkerSourceTypes[k])throw new Error(`Worker source with name "${k}" already registered.`);this.externalWorkerSourceTypes[k]=F},this.self.addProtocol=z.cA,this.self.removeProtocol=z.cB,this.self.registerRTLTextPlugin=k=>{z.cX.setMethods(k)},this.actor.registerMessageHandler("LDT",((k,F)=>this._getDEMWorkerSource(k,F.source).loadTile(F))),this.actor.registerMessageHandler("RDT",((k,F)=>z._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(k,F.source).removeTile(F)})))),this.actor.registerMessageHandler("GCEZ",((k,F)=>z._(this,void 0,void 0,(function*(){return this._getWorkerSource(k,F.type,F.source).getClusterExpansionZoom(F)})))),this.actor.registerMessageHandler("GCC",((k,F)=>z._(this,void 0,void 0,(function*(){return this._getWorkerSource(k,F.type,F.source).getClusterChildren(F)})))),this.actor.registerMessageHandler("GCL",((k,F)=>z._(this,void 0,void 0,(function*(){return this._getWorkerSource(k,F.type,F.source).getClusterLeaves(F)})))),this.actor.registerMessageHandler("LD",((k,F)=>this._getWorkerSource(k,F.type,F.source).loadData(F))),this.actor.registerMessageHandler("GD",((k,F)=>this._getWorkerSource(k,F.type,F.source).getData())),this.actor.registerMessageHandler("LT",((k,F)=>this._getWorkerSource(k,F.type,F.source).loadTile(F))),this.actor.registerMessageHandler("RT",((k,F)=>this._getWorkerSource(k,F.type,F.source).reloadTile(F))),this.actor.registerMessageHandler("AT",((k,F)=>this._getWorkerSource(k,F.type,F.source).abortTile(F))),this.actor.registerMessageHandler("RMT",((k,F)=>this._getWorkerSource(k,F.type,F.source).removeTile(F))),this.actor.registerMessageHandler("RS",((k,F)=>z._(this,void 0,void 0,(function*(){if(!this.workerSources[k]||!this.workerSources[k][F.type]||!this.workerSources[k][F.type][F.source])return;const q=this.workerSources[k][F.type][F.source];delete this.workerSources[k][F.type][F.source],q.removeSource!==void 0&&q.removeSource(F)})))),this.actor.registerMessageHandler("RM",(k=>z._(this,void 0,void 0,(function*(){delete this.layerIndexes[k],delete this.availableImages[k],delete this.workerSources[k],delete this.demWorkerSources[k],this.globalStates.delete(k)})))),this.actor.registerMessageHandler("SR",((k,F)=>z._(this,void 0,void 0,(function*(){this.referrer=F})))),this.actor.registerMessageHandler("SRPS",((k,F)=>this._syncRTLPluginState(k,F))),this.actor.registerMessageHandler("IS",((k,F)=>z._(this,void 0,void 0,(function*(){this.self.importScripts(F)})))),this.actor.registerMessageHandler("SI",((k,F)=>this._setImages(k,F))),this.actor.registerMessageHandler("UL",((k,F)=>z._(this,void 0,void 0,(function*(){this._getLayerIndex(k).update(F.layers,F.removedIds,this._getGlobalState(k))})))),this.actor.registerMessageHandler("UGS",((k,F)=>z._(this,void 0,void 0,(function*(){const q=this._getGlobalState(k);for(const X in F)q[X]=F[X]})))),this.actor.registerMessageHandler("SL",((k,F)=>z._(this,void 0,void 0,(function*(){this._getLayerIndex(k).replace(F,this._getGlobalState(k))}))))}_getGlobalState(E){let k=this.globalStates.get(E);return k||(k={},this.globalStates.set(E,k)),k}_setImages(E,k){return z._(this,void 0,void 0,(function*(){this.availableImages[E]=k;for(const F in this.workerSources[E]){const q=this.workerSources[E][F];for(const X in q)q[X].availableImages=k}}))}_syncRTLPluginState(E,k){return z._(this,void 0,void 0,(function*(){return yield z.cX.syncState(k,this.self.importScripts)}))}_getAvailableImages(E){let k=this.availableImages[E];return k||(k=[]),k}_getLayerIndex(E){let k=this.layerIndexes[E];return k||(k=this.layerIndexes[E]=new h),k}_getWorkerSource(E,k,F){if(this.workerSources[E]||(this.workerSources[E]={}),this.workerSources[E][k]||(this.workerSources[E][k]={}),!this.workerSources[E][k][F]){const q={sendAsync:(X,et)=>(X.targetMapId=E,this.actor.sendAsync(X,et))};switch(k){case"vector":this.workerSources[E][k][F]=new ki(q,this._getLayerIndex(E),this._getAvailableImages(E));break;case"geojson":this.workerSources[E][k][F]=new es(q,this._getLayerIndex(E),this._getAvailableImages(E));break;default:this.workerSources[E][k][F]=new this.externalWorkerSourceTypes[k](q,this._getLayerIndex(E),this._getAvailableImages(E))}}return this.workerSources[E][k][F]}_getDEMWorkerSource(E,k){return this.demWorkerSources[E]||(this.demWorkerSources[E]={}),this.demWorkerSources[E][k]||(this.demWorkerSources[E][k]=new We),this.demWorkerSources[E][k]}}return z.i(self)&&(self.worker=new wr(self)),wr})),Ei("index",["exports","./shared"],(function(z,h){var It="5.10.0";function pe(){var u=new h.A(4);return h.A!=Float32Array&&(u[1]=0,u[2]=0),u[0]=1,u[3]=1,u}let he,ki;const We={frame(u,e,a){const n=requestAnimationFrame((d=>{c(),e(d)})),{unsubscribe:c}=h.s(u.signal,"abort",(()=>{c(),cancelAnimationFrame(n),a(h.c())}),!1)},frameAsync(u){return new Promise(((e,a)=>{this.frame(u,e,a)}))},getImageData(u,e=0){return this.getImageCanvasContext(u).getImageData(-e,-e,u.width+2*e,u.height+2*e)},getImageCanvasContext(u){const e=window.document.createElement("canvas"),a=e.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return e.width=u.width,e.height=u.height,a.drawImage(u,0,0,u.width,u.height),a},resolveURL:u=>(he||(he=document.createElement("a")),he.href=u,he.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ki==null&&(ki=matchMedia("(prefers-reduced-motion: reduce)")),ki.matches)}},mr=new class{constructor(){this._realTime=typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),this._frozenAt=null}getCurrentTime(){return this._frozenAt!==null?this._frozenAt:this._realTime()}setNow(u){this._frozenAt=u}restoreNow(){this._frozenAt=null}isFrozen(){return this._frozenAt!==null}};function Zt(){return mr.getCurrentTime()}class ht{static testProp(e){if(!ht.docStyle)return e[0];for(let a=0;a<e.length;a++)if(e[a]in ht.docStyle)return e[a];return e[0]}static create(e,a,n){const c=window.document.createElement(e);return a!==void 0&&(c.className=a),n&&n.appendChild(c),c}static createNS(e,a){return window.document.createElementNS(e,a)}static disableDrag(){ht.docStyle&&ht.selectProp&&(ht.userSelect=ht.docStyle[ht.selectProp],ht.docStyle[ht.selectProp]="none")}static enableDrag(){ht.docStyle&&ht.selectProp&&(ht.docStyle[ht.selectProp]=ht.userSelect)}static setTransform(e,a){e.style[ht.transformProp]=a}static addEventListener(e,a,n,c={}){e.addEventListener(a,n,"passive"in c?c:c.capture)}static removeEventListener(e,a,n,c={}){e.removeEventListener(a,n,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",ht.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ht.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",ht.suppressClickInternal,!0)}),0)}static getScale(e){const a=e.getBoundingClientRect();return{x:a.width/e.offsetWidth||1,y:a.height/e.offsetHeight||1,boundingClientRect:a}}static getPoint(e,a,n){const c=a.boundingClientRect;return new h.P((n.clientX-c.left)/a.x-e.clientLeft,(n.clientY-c.top)/a.y-e.clientTop)}static mousePos(e,a){const n=ht.getScale(e);return ht.getPoint(e,n,a)}static touchPos(e,a){const n=[],c=ht.getScale(e);for(let d=0;d<a.length;d++)n.push(ht.getPoint(e,c,a[d]));return n}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}static sanitize(e){const a=new DOMParser().parseFromString(e,"text/html").body||document.createElement("body"),n=a.querySelectorAll("script");for(const c of n)c.remove();return ht.clean(a),a.innerHTML}static isPossiblyDangerous(e,a){const n=a.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(e)||!n.includes("javascript:")&&!n.includes("data:"))||!!e.startsWith("on")||void 0}static clean(e){const a=e.children;for(const n of a)ht.removeAttributes(n),ht.clean(n)}static removeAttributes(e){for(const{name:a,value:n}of e.attributes)ht.isPossiblyDangerous(a,n)&&e.removeAttribute(a)}}ht.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ht.selectProp=ht.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ht.transformProp=ht.testProp(["transform","WebkitTransform"]);const zo={supported:!1,testSupport:function(u){!Re&&be&&(ga?Ro(u):Dr=u)}};let Dr,be,Re=!1,ga=!1;function Ro(u){const e=u.createTexture();u.bindTexture(u.TEXTURE_2D,e);try{if(u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,be),u.isContextLost())return;zo.supported=!0}catch{}u.deleteTexture(e),Re=!0}var gi;typeof document<"u"&&(be=document.createElement("img"),be.onload=()=>{Dr&&Ro(Dr),Dr=null,ga=!0},be.onerror=()=>{Re=!0,Dr=null},be.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(u){let e,a,n,c;u.resetRequestQueue=()=>{e=[],a=0,n=0,c={}},u.addThrottleControl=x=>{const w=n++;return c[w]=x,w},u.removeThrottleControl=x=>{delete c[x],m()},u.getImage=(x,w,T=!0)=>new Promise(((M,P)=>{zo.supported&&(x.headers||(x.headers={}),x.headers.accept="image/webp,*/*"),h.e(x,{type:"image"}),e.push({abortController:w,requestParameters:x,supportImageRefresh:T,state:"queued",onError:A=>{P(A)},onSuccess:A=>{M(A)}}),m()}));const d=x=>h._(this,void 0,void 0,(function*(){x.state="running";const{requestParameters:w,supportImageRefresh:T,onError:M,onSuccess:P,abortController:A}=x,D=T===!1&&!h.i(self)&&!h.g(w.url)&&(!w.headers||Object.keys(w.headers).reduce(((V,$)=>V&&$==="accept"),!0));a++;const O=D?y(w,A):h.m(w,A);try{const V=yield O;delete x.abortController,x.state="completed",V.data instanceof HTMLImageElement||h.b(V.data)?P(V):V.data&&P({data:yield(j=V.data,typeof createImageBitmap=="function"?h.f(j):h.h(j)),cacheControl:V.cacheControl,expires:V.expires})}catch(V){delete x.abortController,M(V)}finally{a--,m()}var j})),m=()=>{const x=(()=>{for(const w of Object.keys(c))if(c[w]())return!0;return!1})()?h.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:h.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let w=a;w<x&&e.length>0;w++){const T=e.shift();T.abortController.signal.aborted?w--:d(T)}},y=(x,w)=>new Promise(((T,M)=>{const P=new Image,A=x.url,D=x.credentials;D&&D==="include"?P.crossOrigin="use-credentials":(D&&D==="same-origin"||!h.d(A))&&(P.crossOrigin="anonymous"),w.signal.addEventListener("abort",(()=>{P.src="",M(h.c())})),P.fetchPriority="high",P.onload=()=>{P.onerror=P.onload=null,T({data:P})},P.onerror=()=>{P.onerror=P.onload=null,w.signal.aborted||M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},P.src=A}))})(gi||(gi={})),gi.resetRequestQueue();class ya{constructor(e){this._transformRequestFn=e??null}transformRequest(e,a){return this._transformRequestFn&&this._transformRequestFn(e,a)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function Qr(u){const e=[];if(typeof u=="string")e.push({id:"default",url:u});else if(u&&u.length>0){const a=[];for(const{id:n,url:c}of u){const d=`${n}${c}`;a.indexOf(d)===-1&&(a.push(d),e.push({id:n,url:c}))}}return e}function Eo(u,e,a){try{const n=new URL(u);return n.pathname+=`${e}${a}`,n.toString()}catch{throw new Error(`Invalid sprite URL "${u}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}function Jr(u){const{userImage:e}=u;return!!(e&&e.render&&e.render())&&(u.data.replace(new Uint8Array(e.data.buffer)),!0)}class to extends h.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new h.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:a,promiseResolve:n}of this.requestors)n(this._getImagesForIds(a));this.requestors=[]}}getImage(e){const a=this.images[e];if(a&&!a.data&&a.spriteData){const n=a.spriteData;a.data=new h.R({width:n.width,height:n.height},n.context.getImageData(n.x,n.y,n.width,n.height).data),a.spriteData=null}return a}addImage(e,a){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,a)&&(this.images[e]=a)}_validate(e,a){let n=!0;const c=a.data||a.spriteData;return this._validateStretch(a.stretchX,c&&c.width)||(this.fire(new h.k(new Error(`Image "${e}" has invalid "stretchX" value`))),n=!1),this._validateStretch(a.stretchY,c&&c.height)||(this.fire(new h.k(new Error(`Image "${e}" has invalid "stretchY" value`))),n=!1),this._validateContent(a.content,a)||(this.fire(new h.k(new Error(`Image "${e}" has invalid "content" value`))),n=!1),n}_validateStretch(e,a){if(!e)return!0;let n=0;for(const c of e){if(c[0]<n||c[1]<c[0]||a<c[1])return!1;n=c[1]}return!0}_validateContent(e,a){if(!e)return!0;if(e.length!==4)return!1;const n=a.spriteData,c=n&&n.width||a.data.width,d=n&&n.height||a.data.height;return!(e[0]<0||c<e[0]||e[1]<0||d<e[1]||e[2]<0||c<e[2]||e[3]<0||d<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,a,n=!0){const c=this.getImage(e);if(n&&(c.data.width!==a.data.width||c.data.height!==a.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${a.data.width}x${a.data.height}).`);a.version=c.version+1,this.images[e]=a,this.updatedImages[e]=!0}removeImage(e){const a=this.images[e];delete this.images[e],delete this.patterns[e],a.userImage&&a.userImage.onRemove&&a.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise(((a,n)=>{let c=!0;if(!this.isLoaded())for(const d of e)this.images[d]||(c=!1);this.isLoaded()||c?a(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:a})}))}_getImagesForIds(e){const a={};for(const n of e){let c=this.getImage(n);c||(this.fire(new h.l("styleimagemissing",{id:n})),c=this.getImage(n)),c?a[n]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:h.w(`Image "${n}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return a}getPixelSize(){const{width:e,height:a}=this.atlasImage;return{width:e,height:a}}getPattern(e){const a=this.patterns[e],n=this.getImage(e);if(!n)return null;if(a&&a.position.version===n.version)return a.position;if(a)a.position.version=n.version;else{const c={w:n.data.width+2,h:n.data.height+2,x:0,y:0},d=new h.I(c,n);this.patterns[e]={bin:c,position:d}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const a=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new h.T(e,this.atlasImage,a.RGBA),this.atlasTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const d in this.patterns)e.push(this.patterns[d].bin);const{w:a,h:n}=h.p(e),c=this.atlasImage;c.resize({width:a||1,height:n||1});for(const d in this.patterns){const{bin:m}=this.patterns[d],y=m.x+1,x=m.y+1,w=this.getImage(d).data,T=w.width,M=w.height;h.R.copy(w,c,{x:0,y:0},{x:y,y:x},{width:T,height:M}),h.R.copy(w,c,{x:0,y:M-1},{x:y,y:x-1},{width:T,height:1}),h.R.copy(w,c,{x:0,y:0},{x:y,y:x+M},{width:T,height:1}),h.R.copy(w,c,{x:T-1,y:0},{x:y-1,y:x},{width:1,height:M}),h.R.copy(w,c,{x:0,y:0},{x:y+T,y:x},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const a of e){if(this.callbackDispatchedThisFrame[a])continue;this.callbackDispatchedThisFrame[a]=!0;const n=this.getImage(a);n||h.w(`Image with ID: "${a}" was not found`),Jr(n)&&this.updateImage(a,n)}}}const Di=1e20;function Ja(u,e,a,n,c,d,m,y,x){for(let w=e;w<e+n;w++)ko(u,a*d+w,d,c,m,y,x);for(let w=a;w<a+c;w++)ko(u,w*d+e,1,n,m,y,x)}function ko(u,e,a,n,c,d,m){d[0]=0,m[0]=-Di,m[1]=Di,c[0]=u[e];for(let y=1,x=0,w=0;y<n;y++){c[y]=u[e+y*a];const T=y*y;do{const M=d[x];w=(c[y]-c[M]+T-M*M)/(y-M)/2}while(w<=m[x]&&--x>-1);x++,d[x]=y,m[x]=w,m[x+1]=Di}for(let y=0,x=0;y<n;y++){for(;m[x+1]<y;)x++;const w=d[x],T=y-w;u[e+y*a]=c[w]+T*T}}class or{constructor(e,a,n){this.requestManager=e,this.localIdeographFontFamily=a,this.entries={},this.lang=n}setURL(e){this.url=e}getGlyphs(e){return h._(this,void 0,void 0,(function*(){const a=[];for(const d in e)for(const m of e[d])a.push(this._getAndCacheGlyphsPromise(d,m));const n=yield Promise.all(a),c={};for(const{stack:d,id:m,glyph:y}of n)c[d]||(c[d]={}),c[d][m]=y&&{id:y.id,bitmap:y.bitmap.clone(),metrics:y.metrics};return c}))}_getAndCacheGlyphsPromise(e,a){return h._(this,void 0,void 0,(function*(){let n=this.entries[e];n||(n=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=n.glyphs[a];if(c!==void 0)return{stack:e,id:a,glyph:c};if(c=this._tinySDF(n,e,a),c)return n.glyphs[a]=c,{stack:e,id:a,glyph:c};const d=Math.floor(a/256);if(256*d>65535)throw new Error("glyphs > 65535 not supported");if(n.ranges[d])return{stack:e,id:a,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!n.requests[d]){const y=or.loadGlyphRange(e,d,this.url,this.requestManager);n.requests[d]=y}const m=yield n.requests[d];for(const y in m)this._doesCharSupportLocalGlyph(+y)||(n.glyphs[+y]=m[+y]);return n.ranges[d]=!0,{stack:e,id:a,glyph:m[a]||null}}))}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&(new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(e))||h.u["CJK Unified Ideographs"](e)||h.u["Hangul Syllables"](e)||h.u.Hiragana(e)||h.u.Katakana(e)||h.u["CJK Symbols and Punctuation"](e)||h.u["Halfwidth and Fullwidth Forms"](e))}_tinySDF(e,a,n){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(n))return;let d=e.tinySDF;if(!d){let y="400";/bold/i.test(a)?y="900":/medium/i.test(a)?y="500":/light/i.test(a)&&(y="200"),d=e.tinySDF=new or.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,lang:this.lang,fontFamily:c,fontWeight:y})}const m=d.draw(String.fromCharCode(n));return{id:n,bitmap:new h.q({width:m.width||60,height:m.height||60},m.data),metrics:{width:m.glyphWidth/2||24,height:m.glyphHeight/2||24,left:m.glyphLeft/2+.5||0,top:m.glyphTop/2-27.5||-8,advance:m.glyphAdvance/2||24,isDoubleResolution:!0}}}}or.loadGlyphRange=function(u,e,a,n){return h._(this,void 0,void 0,(function*(){const c=256*e,d=c+255,m=n.transformRequest(a.replace("{fontstack}",u).replace("{range}",`${c}-${d}`),"Glyphs"),y=yield h.n(m,new AbortController);if(!y||!y.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${d}`);const x={};for(const w of h.o(y.data))x[w.id]=w;return x}))},or.TinySDF=class{constructor({fontSize:u=24,buffer:e=3,radius:a=8,cutoff:n=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:m="normal",lang:y=null}={}){this.buffer=e,this.cutoff=n,this.radius=a,this.lang=y;const x=this.size=u+4*e,w=this._createCanvas(x),T=this.ctx=w.getContext("2d",{willReadFrequently:!0});T.font=`${m} ${d} ${u}px ${c}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(u){const e=document.createElement("canvas");return e.width=e.height=u,e}draw(u){const{width:e,actualBoundingBoxAscent:a,actualBoundingBoxDescent:n,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(u),m=Math.ceil(a),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(d-c))),x=Math.min(this.size-this.buffer,m+Math.ceil(n)),w=y+2*this.buffer,T=x+2*this.buffer,M=Math.max(w*T,0),P=new Uint8ClampedArray(M),A={data:P,width:w,height:T,glyphWidth:y,glyphHeight:x,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(y===0||x===0)return A;const{ctx:D,buffer:O,gridInner:j,gridOuter:V}=this;this.lang&&(D.lang=this.lang),D.clearRect(O,O,y,x),D.fillText(u,O,O+m);const $=D.getImageData(O,O,y,x);V.fill(Di,0,M),j.fill(0,0,M);for(let W=0;W<x;W++)for(let U=0;U<y;U++){const H=$.data[4*(W*y+U)+3]/255;if(H===0)continue;const Y=(W+O)*w+U+O;if(H===1)V[Y]=0,j[Y]=Di;else{const Z=.5-H;V[Y]=Z>0?Z*Z:0,j[Y]=Z<0?Z*Z:0}}Ja(V,0,0,w,T,w,this.f,this.v,this.z),Ja(j,O,O,y,x,w,this.f,this.v,this.z);for(let W=0;W<M;W++){const U=Math.sqrt(V[W])-Math.sqrt(j[W]);P[W]=Math.round(255-255*(U/this.radius+this.cutoff))}return A}};class eo{constructor(){this.specification=h.v.light.position}possiblyEvaluate(e,a){return h.B(e.expression.evaluate(a))}interpolate(e,a,n){return{x:h.C.number(e.x,a.x,n),y:h.C.number(e.y,a.y,n),z:h.C.number(e.z,a.z,n)}}}let _r;class ts extends h.E{constructor(e){super(),_r=_r||new h.r({anchor:new h.D(h.v.light.anchor),position:new eo,color:new h.D(h.v.light.color),intensity:new h.D(h.v.light.intensity)}),this._transitionable=new h.t(_r,void 0),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,a={}){if(!this._validate(h.x,e,a))for(const n in e){const c=e[n];n.endsWith("-transition")?this._transitionable.setTransition(n.slice(0,-11),c):this._transitionable.setValue(n,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,n){return(!n||n.validate!==!1)&&h.y(this,e.call(h.z,{value:a,style:{glyphs:!0,sprite:!0},styleSpec:h.v}))}}const ne=new h.r({"sky-color":new h.D(h.v.sky["sky-color"]),"horizon-color":new h.D(h.v.sky["horizon-color"]),"fog-color":new h.D(h.v.sky["fog-color"]),"fog-ground-blend":new h.D(h.v.sky["fog-ground-blend"]),"horizon-fog-blend":new h.D(h.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new h.D(h.v.sky["sky-horizon-blend"]),"atmosphere-blend":new h.D(h.v.sky["atmosphere-blend"])});class xa extends h.E{constructor(e){super(),this._transitionable=new h.t(ne,void 0),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.F(0))}setSky(e,a={}){if(!this._validate(h.G,e,a)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const n in e){const c=e[n];n.endsWith("-transition")?this._transitionable.setTransition(n.slice(0,-11),c):this._transitionable.setValue(n,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,a,n={}){return n?.validate!==!1&&h.y(this,e.call(h.z,h.e({value:a,style:{glyphs:!0,sprite:!0},styleSpec:h.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class Wi{constructor(e,a){this.width=e,this.height=a,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,a){const n=e.join(",")+String(a);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(e,a)),this.dashEntry[n]}getDashRanges(e,a,n){const c=[];let d=e.length%2==1?-e[e.length-1]*n:0,m=e[0]*n,y=!0;c.push({left:d,right:m,isDash:y,zeroLength:e[0]===0});let x=e[0];for(let w=1;w<e.length;w++){y=!y;const T=e[w];d=x*n,x+=T,m=x*n,c.push({left:d,right:m,isDash:y,zeroLength:T===0})}return c}addRoundDash(e,a,n){const c=a/2;for(let d=-n;d<=n;d++){const m=this.width*(this.nextRow+n+d);let y=0,x=e[y];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++y]);const T=Math.abs(w-x.left),M=Math.abs(w-x.right),P=Math.min(T,M);let A;const D=d/n*(c+1);if(x.isDash){const O=c-Math.abs(D);A=Math.sqrt(P*P+O*O)}else A=c-Math.sqrt(P*P+D*D);this.data[m+w]=Math.max(0,Math.min(255,A+128))}}}addRegularDash(e){for(let y=e.length-1;y>=0;--y){const x=e[y],w=e[y+1];x.zeroLength?e.splice(y,1):w&&w.isDash===x.isDash&&(w.left=x.left,e.splice(y,1))}const a=e[0],n=e[e.length-1];a.isDash===n.isDash&&(a.left=n.left-this.width,n.right=a.right+this.width);const c=this.width*this.nextRow;let d=0,m=e[d];for(let y=0;y<this.width;y++){y/m.right>1&&(m=e[++d]);const x=Math.abs(y-m.left),w=Math.abs(y-m.right),T=Math.min(x,w);this.data[c+y]=Math.max(0,Math.min(255,(m.isDash?T:-T)+128))}}addDash(e,a){const n=a?7:0,c=2*n+1;if(this.nextRow+c>this.height)return h.w("LineAtlas out of space"),null;let d=0;for(let y=0;y<e.length;y++)d+=e[y];if(d!==0){const y=this.width/d,x=this.getDashRanges(e,this.width,y);a?this.addRoundDash(x,y,n):this.addRegularDash(x)}const m={y:this.nextRow+n,height:2*n,width:d};return this.nextRow+=c,this.dirty=!0,m}bind(e){const a=e.gl;this.texture?(a.bindTexture(a.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,a.texSubImage2D(a.TEXTURE_2D,0,0,0,this.width,this.height,a.ALPHA,a.UNSIGNED_BYTE,this.data))):(this.texture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.REPEAT),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,this.width,this.height,0,a.ALPHA,a.UNSIGNED_BYTE,this.data))}}const gr="maplibre_preloaded_worker_pool";class Hi{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Hi.workerCount;)this.workers.push(new Worker(h.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[gr]}numActive(){return Object.keys(this.active).length}}const va=Math.floor(We.hardwareConcurrency/2);let yr,ui;function io(){return yr||(yr=new Hi),yr}Hi.workerCount=h.H(globalThis)?Math.max(Math.min(va,3),1):1;class Li{constructor(e,a){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=a;const n=this.workerPool.acquire(a);for(let c=0;c<n.length;c++){const d=new h.J(n[c],a);d.name=`Worker ${c}`,this.actors.push(d)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,a){const n=[];for(const c of this.actors)n.push(c.sendAsync({type:e,data:a}));return Promise.all(n)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach((a=>{a.remove()})),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,a){for(const n of this.actors)n.registerMessageHandler(e,a)}}function Ni(){return ui||(ui=new Li(io(),h.K),ui.registerMessageHandler("GR",((u,e,a)=>h.m(e,a)))),ui}function ba(u,e){const a=h.L();return h.M(a,a,[1,1,0]),h.N(a,a,[.5*u.width,.5*u.height,1]),u.calculatePosMatrix?h.O(a,a,u.calculatePosMatrix(e.toUnwrapped())):a}function wa(u,e,a,n,c,d,m){var y;const x=(function(P,A,D){if(P)for(const O of P){const j=A[O];if(j&&j.source===D&&j.type==="fill-extrusion")return!0}else for(const O in A){const j=A[O];if(j.source===D&&j.type==="fill-extrusion")return!0}return!1})((y=c?.layers)!==null&&y!==void 0?y:null,e,u.id),w=d.maxPitchScaleFactor(),T=u.tilesIn(n,w,x);T.sort(Fi);const M=[];for(const P of T)M.push({wrappedTileID:P.tileID.wrapped().key,queryResults:P.tile.queryRenderedFeatures(e,a,u._state,P.queryGeometry,P.cameraQueryGeometry,P.scale,c,d,w,ba(u.transform,P.tileID),m?(A,D)=>m(P.tileID,A,D):void 0)});return(function(P,A){for(const D in P)for(const O of P[D])ro(O,A);return P})((function(P){const A={},D={};for(const O of P){const j=O.queryResults,V=O.wrappedTileID,$=D[V]=D[V]||{};for(const W in j){const U=j[W],H=$[W]=$[W]||{},Y=A[W]=A[W]||[];for(const Z of U)H[Z.featureIndex]||(H[Z.featureIndex]=!0,Y.push(Z))}}return A})(M),u)}function Fi(u,e){const a=u.tileID,n=e.tileID;return a.overscaledZ-n.overscaledZ||a.canonical.y-n.canonical.y||a.wrap-n.wrap||a.canonical.x-n.canonical.x}function ro(u,e){const a=u.feature,n=e.getFeatureState(a.layer["source-layer"],a.id);a.source=a.layer.source,a.layer["source-layer"]&&(a.sourceLayer=a.layer["source-layer"]),a.state=n}function Ee(u,e,a){return h._(this,void 0,void 0,(function*(){let n=u;if(u.url?n=(yield h.j(e.transformRequest(u.url,"Source"),a)).data:yield We.frameAsync(a),!n)return null;const c=h.Q(h.e(n,u),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in n&&n.vector_layers&&(c.vectorLayerIds=n.vector_layers.map((d=>d.id))),c}))}class fe{constructor(e,a){e&&(a?this.setSouthWest(e).setNorthEast(a):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof h.S?new h.S(e.lng,e.lat):h.S.convert(e),this}setSouthWest(e){return this._sw=e instanceof h.S?new h.S(e.lng,e.lat):h.S.convert(e),this}extend(e){const a=this._sw,n=this._ne;let c,d;if(e instanceof h.S)c=e,d=e;else{if(!(e instanceof fe))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(fe.convert(e)):this.extend(h.S.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(h.S.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return a||n?(a.lng=Math.min(c.lng,a.lng),a.lat=Math.min(c.lat,a.lat),n.lng=Math.max(d.lng,n.lng),n.lat=Math.max(d.lat,n.lat)):(this._sw=new h.S(c.lng,c.lat),this._ne=new h.S(d.lng,d.lat)),this}getCenter(){return new h.S((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new h.S(this.getWest(),this.getNorth())}getSouthEast(){return new h.S(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:a,lat:n}=h.S.convert(e);let c=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&c}static convert(e){return e instanceof fe?e:e&&new fe(e)}static fromLngLat(e,a=0){const n=360*a/40075017,c=n/Math.cos(Math.PI/180*e.lat);return new fe(new h.S(e.lng-c,e.lat-n),new h.S(e.lng+c,e.lat+n))}adjustAntiMeridian(){const e=new h.S(this._sw.lng,this._sw.lat),a=new h.S(this._ne.lng,this._ne.lat);return new fe(e,e.lng>a.lng?new h.S(a.lng+360,a.lat):a)}}class xr{constructor(e,a,n){this.bounds=fe.convert(this.validateBounds(e)),this.minzoom=a||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const a=Math.pow(2,e.z),n=Math.floor(h.V(this.bounds.getWest())*a),c=Math.floor(h.U(this.bounds.getNorth())*a),d=Math.ceil(h.V(this.bounds.getEast())*a),m=Math.ceil(h.U(this.bounds.getSouth())*a);return e.x>=n&&e.x<d&&e.y>=c&&e.y<m}}class oo extends h.E{constructor(e,a,n,c){if(super(),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,h.e(this,h.Q(a,["url","scheme","tileSize","promoteId"])),this._options=h.e({type:"vector"},a),this._collectResourceTiming=a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield Ee(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(h.e(this,e),e.bounds&&(this.tileBounds=new xr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this._loaded=!0,this.fire(new h.k(e))}}))}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return h.e({},this._options)}loadTile(e){return h._(this,void 0,void 0,(function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n={request:this.map._requestManager.transformRequest(a,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};n.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise(((d,m)=>{e.reloadPromise={resolve:d,reject:m}}))}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const d=yield e.actor.sendAsync({type:c,data:n},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,d)}catch(d){if(delete e.abortController,e.aborted)return;if(d&&d.status!==404)throw d;this._afterTileLoadWorkerResponse(e,null)}}))}_afterTileLoadWorkerResponse(e,a){if(a&&a.resourceTiming&&(e.resourceTiming=a.resourceTiming),a&&this.map._refreshExpiredTiles&&e.setExpiryData(a),e.loadVectorData(a,this.map.painter),e.reloadPromise){const n=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(n.resolve).catch(n.reject)}}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Lr extends h.E{constructor(e,a,n,c){super(),this.id=e,this.dispatcher=n,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=h.e({type:"raster"},a),h.e(this,h.Q(a,["url","scheme","tileSize"]))}load(){return h._(this,arguments,void 0,(function*(e=!1){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield Ee(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(h.e(this,a),a.bounds&&(this.tileBounds=new xr(a.bounds,this.minzoom,this.maxzoom)),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new h.l("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:e})))}catch(a){this._tileJSONRequest=null,this._loaded=!0,this.fire(new h.k(a))}}))}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load(!0)}setTiles(e){return this.setSourceProperty((()=>{this._options.tiles=e})),this}setUrl(e){return this.setSourceProperty((()=>{this.url=e,this._options.url=e})),this}serialize(){return h.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return h._(this,void 0,void 0,(function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const n=yield gi.getImage(this.map._requestManager.transformRequest(a,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(n&&n.data){this.map._refreshExpiredTiles&&(n.cacheControl||n.expires)&&e.setExpiryData({cacheControl:n.cacheControl,expires:n.expires});const c=this.map.painter.context,d=c.gl,m=n.data;e.texture=this.map.painter.getTileTexture(m.width),e.texture?e.texture.update(m,{useMipmap:!0}):(e.texture=new h.T(c,m,d.RGBA,{useMipmap:!0}),e.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE,d.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(n){if(delete e.abortController,e.aborted)e.state="unloaded";else if(n)throw e.state="errored",n}}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)}))}hasTransition(){return!1}}class vr extends Lr{constructor(e,a,n,c){super(e,a,n,c),this.type="raster-dem",this.maxzoom=22,this._options=h.e({type:"raster-dem"},a),this.encoding=a.encoding||"mapbox",this.redFactor=a.redFactor,this.greenFactor=a.greenFactor,this.blueFactor=a.blueFactor,this.baseShift=a.baseShift}loadTile(e){return h._(this,void 0,void 0,(function*(){const a=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),n=this.map._requestManager.transformRequest(a,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield gi.getImage(n,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const d=c.data;this.map._refreshExpiredTiles&&(c.cacheControl||c.expires)&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const m=h.b(d)&&h.W()?d:yield this.readImageNow(d),y={type:this.type,uid:e.uid,source:this.id,rawImageData:m,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const x=yield e.actor.sendAsync({type:"LDT",data:y});e.dem=x,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}}))}readImageNow(e){return h._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&h.X()){const a=e.width+2,n=e.height+2;try{return new h.R({width:a,height:n},yield h.Y(e,-1,-1,a,n))}catch{}}return We.getImageData(e,1)}))}_getNeighboringTiles(e){const a=e.canonical,n=Math.pow(2,a.z),c=(a.x-1+n)%n,d=a.x===0?e.wrap-1:e.wrap,m=(a.x+1+n)%n,y=a.x+1===n?e.wrap+1:e.wrap,x={};return x[new h.Z(e.overscaledZ,d,a.z,c,a.y).key]={backfilled:!1},x[new h.Z(e.overscaledZ,y,a.z,m,a.y).key]={backfilled:!1},a.y>0&&(x[new h.Z(e.overscaledZ,d,a.z,c,a.y-1).key]={backfilled:!1},x[new h.Z(e.overscaledZ,e.wrap,a.z,a.x,a.y-1).key]={backfilled:!1},x[new h.Z(e.overscaledZ,y,a.z,m,a.y-1).key]={backfilled:!1}),a.y+1<n&&(x[new h.Z(e.overscaledZ,d,a.z,c,a.y+1).key]={backfilled:!1},x[new h.Z(e.overscaledZ,e.wrap,a.z,a.x,a.y+1).key]={backfilled:!1},x[new h.Z(e.overscaledZ,y,a.z,m,a.y+1).key]={backfilled:!1}),x}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))}))}}class Do extends h.E{constructor(e,a,n,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._isUpdatingWorker=!1,this._pendingWorkerUpdate={data:a.data},this.actor=n.getActor(),this.setEventedParent(c),this._data=a.data,this._options=h.e({},a),this._collectResourceTiming=a.collectResourceTiming,a.maxzoom!==void 0&&(this.maxzoom=a.maxzoom),a.type&&(this.type=a.type),a.attribution&&(this.attribution=a.attribution),this.promoteId=a.promoteId,a.clusterMaxZoom!==void 0&&this.maxzoom<=a.clusterMaxZoom&&h.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${a.clusterMaxZoom}".`),this.workerOptions=h.e({source:this.id,cluster:a.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(a.buffer!==void 0?a.buffer:128),tolerance:this._pixelsToTileUnits(a.tolerance!==void 0?a.tolerance:.375),extent:h.$,maxZoom:this.maxzoom,lineMetrics:a.lineMetrics||!1,generateId:a.generateId||!1},superclusterOptions:{maxZoom:this._getClusterMaxZoom(a.clusterMaxZoom),minPoints:Math.max(2,a.clusterMinPoints||2),extent:h.$,radius:this._pixelsToTileUnits(a.clusterRadius||50),log:!1,generateId:a.generateId||!1},clusterProperties:a.clusterProperties,filter:a.filter},a.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_hasPendingWorkerUpdate(){return this._pendingWorkerUpdate.data!==void 0||this._pendingWorkerUpdate.diff!==void 0||this._pendingWorkerUpdate.optionsChanged}_pixelsToTileUnits(e){return e*(h.$/this.tileSize)}_getClusterMaxZoom(e){const a=e?Math.round(e):this.maxzoom-1;return Number.isInteger(e)||e===void 0||h.w(`Integer expected for option 'clusterMaxZoom': provided value "${e}" rounded to "${a}"`),a}load(){return h._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._pendingWorkerUpdate={data:e},this._updateWorkerData(),this}updateData(e){return this._pendingWorkerUpdate.diff=h.a0(this._pendingWorkerUpdate.diff,e),this._updateWorkerData(),this}getData(){return h._(this,void 0,void 0,(function*(){const e=h.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})}))}getCoordinatesFromGeometry(e){return e.type==="GeometryCollection"?e.geometries.map((a=>a.coordinates)).flat(1/0):e.coordinates.flat(1/0)}getBounds(){return h._(this,void 0,void 0,(function*(){const e=new fe,a=yield this.getData();let n;switch(a.type){case"FeatureCollection":n=a.features.map((c=>this.getCoordinatesFromGeometry(c.geometry))).flat(1/0);break;case"Feature":n=this.getCoordinatesFromGeometry(a.geometry);break;default:n=this.getCoordinatesFromGeometry(a)}if(n.length==0)return e;for(let c=0;c<n.length-1;c+=2)e.extend([n[c],n[c+1]]);return e}))}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(e.clusterRadius)),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=this._getClusterMaxZoom(e.clusterMaxZoom)),this._pendingWorkerUpdate.optionsChanged=!0,this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,a,n){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:a,offset:n}})}_updateWorkerData(){return h._(this,void 0,void 0,(function*(){if(this._isUpdatingWorker)return;if(!this._hasPendingWorkerUpdate())return void h.w(`No pending worker updates for GeoJSONSource ${this.id}.`);const{data:e,diff:a}=this._pendingWorkerUpdate,n=h.e({type:this.type},this.workerOptions);e?(typeof e=="string"?(n.request=this.map._requestManager.transformRequest(We.resolveURL(e),"Source"),n.request.collectResourceTiming=this._collectResourceTiming):n.data=JSON.stringify(e),this._pendingWorkerUpdate.data=void 0):a&&(n.dataDiff=a,this._pendingWorkerUpdate.diff=void 0),this._pendingWorkerUpdate.optionsChanged=void 0,this._isUpdatingWorker=!0,this.fire(new h.l("dataloading",{dataType:"source"}));try{const c=yield this.actor.sendAsync({type:"LD",data:n});if(this._isUpdatingWorker=!1,this._removed||c.abandoned)return void this.fire(new h.l("dataabort",{dataType:"source"}));this._data=c.data;let d=null;c.resourceTiming&&c.resourceTiming[this.id]&&(d=c.resourceTiming[this.id].slice(0));const m={dataType:"source"};this._collectResourceTiming&&d&&d.length>0&&h.e(m,{resourceTiming:d}),this.fire(new h.l("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new h.l("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(c){if(this._isUpdatingWorker=!1,this._removed)return void this.fire(new h.l("dataabort",{dataType:"source"}));this.fire(new h.k(c))}finally{this._hasPendingWorkerUpdate()&&this._updateWorkerData()}}))}loaded(){return!this._isUpdatingWorker&&!this._hasPendingWorkerUpdate()}loadTile(e){return h._(this,void 0,void 0,(function*(){const a=e.actor?"RT":"LT";e.actor=this.actor;const n={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:a,data:n},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,a==="RT")}))}abortTile(e){return h._(this,void 0,void 0,(function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0}))}unloadTile(e){return h._(this,void 0,void 0,(function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return h.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class br extends h.E{constructor(e,a,n,c){super(),this.flippedWindingOrder=!1,this.id=e,this.dispatcher=n,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=a}load(e){return h._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new h.l("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const a=yield gi.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,a&&a.data&&(this.image=a.data,e&&(this.coordinates=e),this._finishLoading())}catch(a){this._request=null,this._loaded=!0,this.fire(new h.k(a))}}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new h.l("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const a=e.map(h.a1.fromLngLat);var n;return this.tileID=(function(c){const d=h.a2.fromPoints(c),m=d.width(),y=d.height(),x=Math.max(m,y),w=Math.max(0,Math.floor(-Math.log(x)/Math.LN2)),T=Math.pow(2,w);return new h.a4(w,Math.floor((d.minX+d.maxX)/2*T),Math.floor((d.minY+d.maxY)/2*T))})(a),this.terrainTileRanges=this._getOverlappingTileRanges(a),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=a.map((c=>this.tileID.getTilePoint(c)._round())),this.flippedWindingOrder=((n=this.tileCoords)[1].x-n[0].x)*(n[2].y-n[0].y)-(n[1].y-n[0].y)*(n[2].x-n[0].x)<0,this.fire(new h.l("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,a=e.gl;this.texture||(this.texture=new h.T(e,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let n=!1;for(const c in this.tiles){const d=this.tiles[c];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,n=!0)}n&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return h._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}_getOverlappingTileRanges(e){const{minX:a,minY:n,maxX:c,maxY:d}=h.a2.fromPoints(e),m={};for(let y=0;y<=h.a3;y++){const x=Math.pow(2,y),w=Math.floor(a*x),T=Math.floor(n*x),M=Math.floor(c*x),P=Math.floor(d*x);m[y]={minTileX:w,minTileY:T,maxTileX:M,maxTileY:P}}return m}}class Fr extends br{constructor(e,a,n,c){super(e,a,n,c),this.roundZoom=!0,this.type="video",this.options=a}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const a of e.urls)this.urls.push(this.map._requestManager.transformRequest(a,"Source").url);try{const a=yield h.a5(this.urls);if(this._loaded=!0,!a)return;this.video=a,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(a){this.fire(new h.k(a))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const a=this.video.seekable;e<a.start(0)||e>a.end(0)?this.fire(new h.k(new h.a6(`sources.${this.id}`,null,`Playback for this video can be set only between the ${a.start(0)} and ${a.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,a=e.gl;this.texture?this.video.paused||(this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.texSubImage2D(a.TEXTURE_2D,0,0,0,a.RGBA,a.UNSIGNED_BYTE,this.video)):(this.texture=new h.T(e,this.video,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE));let n=!1;for(const c in this.tiles){const d=this.tiles[c];d.state!=="loaded"&&(d.state="loaded",d.texture=this.texture,n=!0)}n&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ar extends br{constructor(e,a,n,c){super(e,a,n,c),a.coordinates?Array.isArray(a.coordinates)&&a.coordinates.length===4&&!a.coordinates.some((d=>!Array.isArray(d)||d.length!==2||d.some((m=>typeof m!="number"))))||this.fire(new h.k(new h.a6(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new h.k(new h.a6(`sources.${e}`,null,'missing required property "coordinates"'))),a.animate&&typeof a.animate!="boolean"&&this.fire(new h.k(new h.a6(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),a.canvas?typeof a.canvas=="string"||a.canvas instanceof HTMLCanvasElement||this.fire(new h.k(new h.a6(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new h.k(new h.a6(`sources.${e}`,null,'missing required property "canvas"'))),this.options=a,this.animate=a.animate===void 0||a.animate}load(){return h._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new h.k(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const a=this.map.painter.context,n=a.gl;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new h.T(a,this.canvas,n.RGBA,{premultiply:!0});let c=!1;for(const d in this.tiles){const m=this.tiles[d];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,c=!0)}c&&this.fire(new h.l("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const Lo={},Fo=u=>{switch(u){case"geojson":return Do;case"image":return br;case"raster":return Lr;case"raster-dem":return vr;case"vector":return oo;case"video":return Fr;case"canvas":return ar}return Lo[u]},Ui="RTLPluginLoaded";class es extends h.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ni()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch((a=>{throw this.status="error",a}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return h._(this,arguments,void 0,(function*(a,n=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=We.resolveURL(a),!this.url)throw new Error(`requested url ${a} is invalid`);if(this.status==="unavailable"){if(!n)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return h._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new h.l(Ui))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Bo=null;function wr(){return Bo||(Bo=new es),Bo}var Q,E;(function(u){u[u.Base=0]="Base",u[u.Parent=1]="Parent"})(Q||(Q={})),(function(u){u[u.Departing=0]="Departing",u[u.Incoming=1]="Incoming"})(E||(E={}));class k{constructor(e,a){this.timeAdded=0,this.fadeEndTime=0,this.fadeOpacity=1,this.tileID=e,this.uid=h.a7(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}isRenderable(e){return this.hasData()&&(!this.fadeEndTime||this.fadeOpacity>0)&&(e||!this.holdingForSymbolFade())}setCrossFadeLogic({fadingRole:e,fadingDirection:a,fadingParentID:n,fadeEndTime:c}){this.resetFadeLogic(),this.fadingRole=e,this.fadingDirection=a,this.fadingParentID=n,this.fadeEndTime=c}setSelfFadeLogic(e){this.resetFadeLogic(),this.selfFading=!0,this.fadeEndTime=e}resetFadeLogic(){this.fadingRole=null,this.fadingDirection=null,this.fadingParentID=null,this.selfFading=!1,this.timeAdded=Zt(),this.fadeEndTime=0,this.fadeOpacity=1}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,a,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=(function(c,d){const m={};if(!d)return m;for(const y of c){const x=y.layerIds.map((w=>d.getLayer(w))).filter(Boolean);if(x.length!==0){y.layers=x,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map((w=>x.filter((T=>T.id===w))[0])));for(const w of x)m[w.id]=y}}return m})(e.buckets,a?.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof h.a9){if(this.hasSymbolBuckets=!0,!n)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof h.a9&&d.hasRTLText){this.hasRTLText=!0,wr().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(c).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),this.dashPositions=e.dashPositions}else this.collisionBoxArray=new h.a8}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.dashPositions&&(this.dashPositions=null),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const n in this.buckets){const c=this.buckets[n];c.uploadPending()&&c.upload(e)}const a=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new h.T(e,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new h.T(e,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,a,n,c,d,m,y,x,w,T,M){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:d,scale:m,tileSize:this.tileSize,pixelPosMatrix:T,transform:x,params:y,queryPadding:this.queryPadding*w,getElevation:M},e,a,n):{}}querySourceFeatures(e,a){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const c=n.loadVTLayers(),d=a&&a.sourceLayer?a.sourceLayer:"",m=c._geojsonTileLayer||c[d];if(!m)return;const y=h.aa(a?.filter,a?.globalState),{z:x,x:w,y:T}=this.tileID.canonical,M={z:x,x:w,y:T};for(let P=0;P<m.length;P++){const A=m.feature(P);if(y.needGeometry){const j=h.ab(A,!0);if(!y.filter(new h.F(this.tileID.overscaledZ),j,this.tileID.canonical))continue}else if(!y.filter(new h.F(this.tileID.overscaledZ),A))continue;const D=n.getId(A,d),O=new h.ac(A,x,w,T,D);O.tile=M,e.push(O)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const a=this.expirationTime;if(e.cacheControl){const n=h.ad(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const n=Date.now();let c=!1;if(this.expirationTime>n)c=!1;else if(a)if(this.expirationTime<a)c=!0;else{const d=this.expirationTime-a;d?this.expirationTime=n+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const n=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!a.style.hasLayer(c))continue;const d=this.buckets[c],m=d.layers[0].sourceLayer||"_geojsonTileLayer",y=n[m],x=e[m];if(!y||!x||Object.keys(x).length===0)continue;d.update(x,y,this.imageAtlas&&this.imageAtlas.patternPositions||{},this.dashPositions||{});const w=a&&a.style&&a.style.getLayer(c);w&&(this.queryPadding=Math.max(this.queryPadding,w.queryRadius(d)))}}holdingForSymbolFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Zt()}clearSymbolFadeHold(){this.symbolFadeHoldUntil=void 0}setSymbolHoldDuration(e){this.symbolFadeHoldUntil=Zt()+e}setDependencies(e,a){const n={};for(const c of a)n[c]=!0;this.dependencies[e]=n}hasDependency(e,a){for(const n of e){const c=this.dependencies[n];if(c){for(const d of a)if(c[d])return!0}}return!1}}class F{constructor(e,a){this.max=e,this.onRemove=a,this.reset()}reset(){for(const e in this.data)for(const a of this.data[e])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(e,a,n){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const d={value:a,timeout:void 0};if(n!==void 0&&(d.timeout=setTimeout((()=>{this.remove(e,d)}),n)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const a=this.data[e].shift();return a.timeout&&clearTimeout(a.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),a.value}getByKey(e){const a=this.data[e];return a?a[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,a){if(!this.has(e))return this;const n=e.wrapped().key,c=a===void 0?0:this.data[n].indexOf(a),d=this.data[n][c];return this.data[n].splice(c,1),d.timeout&&clearTimeout(d.timeout),this.data[n].length===0&&delete this.data[n],this.onRemove(d.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(e){const a=[];for(const n in this.data)for(const c of this.data[n])e(c.value)||a.push(c);for(const n of a)this.remove(n.value.tileID,n)}}class q{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,a,n){const c=String(a);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},h.e(this.stateChanges[e][c],n),this.deletedStates[e]===null){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const d in this.state[e][c])n[d]||(this.deletedStates[e][c][d]=null)}else for(const d in n)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][d]===null&&delete this.deletedStates[e][c][d]}removeFeatureState(e,a,n){if(this.deletedStates[e]===null)return;const c=String(a);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&a!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][n]=null);else if(a!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(n in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][n]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,a){const n=String(a),c=h.e({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const d=this.deletedStates[e][a];if(d===null)return{};for(const m in d)delete c[m]}return c}initializeTileState(e,a){e.setFeatureState(this.state,a)}coalesceChanges(e,a){const n={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const m in this.stateChanges[c])this.state[c][m]||(this.state[c][m]={}),h.e(this.state[c][m],this.stateChanges[c][m]),d[m]=this.state[c][m];n[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(this.deletedStates[c]===null)for(const m in this.state[c])d[m]={},this.state[c][m]={};else for(const m in this.deletedStates[c]){if(this.deletedStates[c][m]===null)this.state[c][m]={};else for(const y of Object.keys(this.deletedStates[c][m]))delete this.state[c][m][y];d[m]=this.state[c][m]}n[c]=n[c]||{},h.e(n[c],d)}if(this.stateChanges={},this.deletedStates={},Object.keys(n).length!==0)for(const c in e)e[c].setFeatureState(n,a)}}const X=89.25;function et(u,e){const a=h.ae(e.lat,-h.af,h.af);return new h.P(h.V(e.lng)*u,h.U(a)*u)}function nt(u,e){return new h.a1(e.x/u,e.y/u).toLngLat()}function tt(u){return u.cameraToCenterDistance*Math.min(.85*Math.tan(h.ag(90-u.pitch)),Math.tan(h.ag(X-u.pitch)))}function ut(u,e){const a=u.canonical,n=e/h.ah(a.z),c=a.x+Math.pow(2,a.z)*u.wrap,d=h.ai(new Float64Array(16));return h.M(d,d,[c*n,a.y*n,0]),h.N(d,d,[n/h.$,n/h.$,1]),d}function yt(u,e,a,n,c){const d=h.a1.fromLngLat(u,e),m=c*h.aj(1,u.lat),y=m*Math.cos(h.ag(a)),x=Math.sqrt(m*m-y*y),w=x*Math.sin(h.ag(-n)),T=x*Math.cos(h.ag(-n));return new h.a1(d.x+w,d.y+T,d.z+y)}function pt(u,e,a){const n=e.intersectsFrustum(u);if(!a||n===0)return n;const c=e.intersectsPlane(a);return c===0?0:n===2&&c===2?2:1}function Et(u,e,a){let n=0;const c=(a-e)/10;for(let d=0;d<10;d++)n+=c*Math.pow(Math.cos(e+(d+.5)/10*(a-e)),u);return n}function rt(u,e){return function(a,n,c,d,m){const y=2*((u-1)/h.ak(Math.cos(h.ag(X-m))/Math.cos(h.ag(X)))-1),x=Math.acos(c/d),w=2*Et(y-1,0,h.ag(m/2)),T=Math.min(h.ag(X),x+h.ag(m/2)),M=Et(y-1,Math.min(T,x-h.ag(m/2)),T),P=Math.atan(n/c),A=Math.hypot(n,c);let D=a;return D+=h.ak(d/A/Math.max(.5,Math.cos(h.ag(m/2)))),D+=y*h.ak(Math.cos(P))/2,D-=h.ak(Math.max(1,M/w/e))/2,D}}const Xt=rt(9.314,3);function ye(u,e){const a=(e.roundZoom?Math.round:Math.floor)(u.zoom+h.ak(u.tileSize/e.tileSize));return Math.max(0,a)}function Dt(u,e){const a=u.getCameraFrustum(),n=u.getClippingPlane(),c=u.screenPointToMercatorCoordinate(u.getCameraPoint()),d=h.a1.fromLngLat(u.center,u.elevation);c.z=d.z+Math.cos(u.pitchInRadians)*u.cameraToCenterDistance/u.worldSize;const m=u.getCoveringTilesDetailsProvider(),y=m.allowVariableZoom(u,e),x=ye(u,e),w=e.minzoom||0,T=e.maxzoom!==void 0?e.maxzoom:u.maxZoom,M=Math.min(Math.max(0,x),T),P=Math.pow(2,M),A=[P*c.x,P*c.y,0],D=[P*d.x,P*d.y,0],O=Math.hypot(d.x-c.x,d.y-c.y),j=Math.abs(d.z-c.z),V=Math.hypot(O,j),$=H=>({zoom:0,x:0,y:0,wrap:H,fullyVisible:!1}),W=[],U=[];if(u.renderWorldCopies&&m.allowWorldCopies())for(let H=1;H<=3;H++)W.push($(-H)),W.push($(H));for(W.push($(0));W.length>0;){const H=W.pop(),Y=H.x,Z=H.y;let J=H.fullyVisible;const lt={x:Y,y:Z,z:H.zoom},ot=m.getTileBoundingVolume(lt,H.wrap,u.elevation,e);if(!J){const vt=pt(a,ot,n);if(vt===0)continue;J=vt===2}const st=m.distanceToTile2d(c.x,c.y,lt,ot);let ct=x;y&&(ct=(e.calculateTileZoom||Xt)(u.zoom+h.ak(u.tileSize/e.tileSize),st,j,V,u.fov)),ct=(e.roundZoom?Math.round:Math.floor)(ct),ct=Math.max(0,ct);const xt=Math.min(ct,T);if(H.wrap=m.getWrap(d,lt,H.wrap),H.zoom>=xt){if(H.zoom<w)continue;const vt=M-H.zoom,mt=A[0]-.5-(Y<<vt),At=A[1]-.5-(Z<<vt),jt=e.reparseOverscaled?Math.max(H.zoom,ct):H.zoom;U.push({tileID:new h.Z(H.zoom===T?jt:H.zoom,H.wrap,H.zoom,Y,Z),distanceSq:h.al([D[0]-.5-Y,D[1]-.5-Z]),tileDistanceToCamera:Math.sqrt(mt*mt+At*At)})}else for(let vt=0;vt<4;vt++)W.push({zoom:H.zoom+1,x:(Y<<1)+vt%2,y:(Z<<1)+(vt>>1),wrap:H.wrap,fullyVisible:J})}return U.sort(((H,Y)=>H.distanceSq-Y.distanceSq)).map((H=>H.tileID))}const Ht=h.a2.fromPoints([new h.P(0,0),new h.P(h.$,h.$)]);class oe extends h.E{constructor(e,a,n){super(),this.id=e,this.dispatcher=n,this.on("data",(c=>this._dataHandler(c))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((c,d,m,y)=>{const x=new(Fo(d.type))(c,d,m,y);if(x.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${x.id}`);return x})(e,a,n,this),this._tiles={},this._cache=new F(0,(c=>this._unloadTile(c))),this._timers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._rasterFadeDuration=0,this._maxFadingAncestorLevels=5,this._state=new q,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const a=this._tiles[e];if(a.state!=="loaded"&&a.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,a,n){return h._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,a,n)}catch(c){e.state="errored",c.status!==404?this._source.fire(new h.k(c,{tile:e})):this.update(this.transform,this.terrain)}}))}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new h.l("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const n=this._tiles[a];n.upload(e),n.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((e=>e.tileID)).sort(je).map((e=>e.key))}getRenderableIds(e){const a=[];for(const n in this._tiles)this._isIdRenderable(n,e)&&a.push(this._tiles[n]);return e?a.sort(((n,c)=>{const d=n.tileID,m=c.tileID,y=new h.P(d.canonical.x,d.canonical.y)._rotate(-this.transform.bearingInRadians),x=new h.P(m.canonical.x,m.canonical.y)._rotate(-this.transform.bearingInRadians);return d.overscaledZ-m.overscaledZ||x.y-y.y||x.x-y.x})).map((n=>n.tileID.key)):a.map((n=>n.tileID)).sort(je).map((n=>n.key))}hasRenderableParent(e){const a=e.overscaledZ-1;if(a>=this._source.minzoom){const n=this._getLoadedTile(e.scaledTo(a));if(n)return this._isIdRenderable(n.tileID.key)}return!1}_isIdRenderable(e,a=!1){var n;return(n=this._tiles[e])===null||n===void 0?void 0:n.isRenderable(a)}reload(e){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)e?this._reloadTile(a,"expired"):this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(e,a){return h._(this,void 0,void 0,(function*(){const n=this._tiles[e];n&&(n.state!=="loading"&&(n.state=a),yield this._loadTile(n,e,a))}))}_tileLoaded(e,a,n){e.timeAdded=Zt(),n==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(a,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new h.l("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const a=this.getRenderableIds();for(let c=0;c<a.length;c++){const d=a[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const m=this.getTileByID(d);n(e,m),n(m,e)}}function n(c,d){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let m=d.tileID.canonical.x-c.tileID.canonical.x;const y=d.tileID.canonical.y-c.tileID.canonical.y,x=Math.pow(2,c.tileID.canonical.z),w=d.tileID.key;m===0&&y===0||Math.abs(y)>1||(Math.abs(m)>1&&(Math.abs(m+x)===1?m+=x:Math.abs(m-x)===1&&(m-=x)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,m,y),c.neighboringTiles&&c.neighboringTiles[w]&&(c.neighboringTiles[w].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,a){const n=Object.values(e),c=this._getLoadedDescendents(n),d={};for(const m of n){const y=c[m.key];if(!y?.length){d[m.key]=m;continue}const x=m.overscaledZ+oe.maxUnderzooming,w=y.filter((P=>P.tileID.overscaledZ<=x));if(!w.length){d[m.key]=m;continue}const T=Math.min(...w.map((P=>P.tileID.overscaledZ))),M=w.filter((P=>P.tileID.overscaledZ===T)).map((P=>P.tileID));for(const P of M)a[P.key]=P;this._areDescendentsComplete(M,T,m.overscaledZ)||(d[m.key]=m)}return d}_getLoadedDescendents(e){var a;const n={};for(const c in this._tiles){const d=this._tiles[c];if(d.hasData())for(const m of e)d.tileID.isChildOf(m)&&(n[a=m.key]||(n[a]=[])).push(d)}return n}_areDescendentsComplete(e,a,n){return e.length===1&&e[0].isOverscaled()?e[0].overscaledZ===a:Math.pow(4,a-n)===e.length}_getLoadedTile(e){const a=this._tiles[e.key];return a?.hasData()?a:null}updateCacheSize(e){const a=Math.ceil(e.width/this._source.tileSize)+1,n=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(a*n*(this._maxTileCacheZoomLevels===null?h.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),d=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(d)}handleWrapJump(e){const a=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,a){const n={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+a),n[d.tileID.key]=d}this._tiles=n,this._resetTileReloadTimers()}}update(e,a){if(!this._sourceLoaded||this._paused)return;let n;this.transform=e,this.terrain=a,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this.used||this.usedForTerrain?this._source.tileID?n=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((x=>new h.Z(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y))):(n=Dt(e,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:a,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(n=n.filter((x=>this._source.hasTile(x))))):n=[],this.usedForTerrain&&(n=this._addTerrainIdealTiles(n));const c=n.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,c&&this.fire(new h.l("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const d=ye(e,this._source),m=this._updateRetainedTiles(n,d),y=Ve(this._source.type);y&&this._rasterFadeDuration>0&&!a&&this._updateFadingTiles(n,m),y?this._cleanUpRasterTiles(m):this._cleanUpVectorTiles(m)}_cleanUpRasterTiles(e){for(const a in this._tiles)e[a]||this._removeTile(a)}_cleanUpVectorTiles(e){for(const a in this._tiles){const n=this._tiles[a];e[a]?n.clearSymbolFadeHold():n.hasSymbolBuckets?n.holdingForSymbolFade()?n.symbolFadeFinished()&&this._removeTile(a):n.setSymbolHoldDuration(this.map._fadeDuration):this._removeTile(a)}}_addTerrainIdealTiles(e){const a=[];for(const n of e)if(n.canonical.z>this._source.minzoom){const c=n.scaledTo(n.canonical.z-1);a.push(c);const d=n.scaledTo(Math.max(this._source.minzoom,Math.min(n.canonical.z,5)));a.push(d)}return e.concat(a)}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForSymbolFade()&&this._removeTile(e)}_updateRetainedTiles(e,a){var n;const c={},d={},m=Math.max(a-oe.maxOverzooming,this._source.minzoom);let y={};for(const x of e){const w=this._addTile(x);c[x.key]=x,w.hasData()||(y[x.key]=x)}y=this._retainLoadedChildren(y,c);for(const x in y){const w=y[x];let T=this._tiles[x],M=T?.wasRequested();for(let P=w.overscaledZ-1;P>=m;--P){const A=w.scaledTo(P);if(d[A.key])break;if(d[A.key]=!0,T=this.getTile(A),!T&&M&&(T=this._addTile(A)),T){const D=T.hasData();if((D||!(!((n=this.map)===null||n===void 0)&&n.cancelPendingTileRequestsWhileZooming)||M)&&(c[A.key]=A),M=T.wasRequested(),D)break}}}return c}_updateFadingTiles(e,a){const n=Zt(),c=h.am(e);for(const d of e){const m=this._tiles[d.key];m.fadingDirection!==E.Departing&&m.fadeOpacity!==0||m.resetFadeLogic(),this._updateFadingAncestor(m,a,n)||this._updateFadingDescendents(m,a,n)||this._updateFadingEdge(m,c,n)||m.resetFadeLogic()}}_updateFadingAncestor(e,a,n){if(!e.hasData())return!1;const{tileID:c,fadingRole:d,fadingDirection:m,fadingParentID:y}=e;if(d===Q.Base&&m===E.Incoming&&y)return a[y.key]=y,!0;const x=Math.max(c.overscaledZ-this._maxFadingAncestorLevels,this._source.minzoom);for(let w=c.overscaledZ-1;w>=x;w--){const T=c.scaledTo(w),M=this._getLoadedTile(T);if(M)return e.setCrossFadeLogic({fadingRole:Q.Base,fadingDirection:E.Incoming,fadingParentID:M.tileID,fadeEndTime:n+this._rasterFadeDuration}),M.setCrossFadeLogic({fadingRole:Q.Parent,fadingDirection:E.Departing,fadeEndTime:n+this._rasterFadeDuration}),a[T.key]=T,!0}return!1}_updateFadingDescendents(e,a,n){if(!e.hasData())return!1;const c=e.tileID.children(this._source.maxzoom);let d=this._updateFadingChildren(e,c,a,n);if(d)return!0;for(const m of c){const y=m.children(this._source.maxzoom);this._updateFadingChildren(e,y,a,n)&&(d=!0)}return d}_updateFadingChildren(e,a,n,c){if(a[0].overscaledZ>=this._source.maxzoom)return!1;let d=!1;for(const m of a){const y=this._getLoadedTile(m);if(!y)continue;const{fadingRole:x,fadingDirection:w,fadingParentID:T}=y;x===Q.Base&&w===E.Departing&&T||(y.setCrossFadeLogic({fadingRole:Q.Base,fadingDirection:E.Departing,fadingParentID:e.tileID,fadeEndTime:c+this._rasterFadeDuration}),e.setCrossFadeLogic({fadingRole:Q.Parent,fadingDirection:E.Incoming,fadeEndTime:c+this._rasterFadeDuration})),n[m.key]=m,d=!0}return d}_updateFadingEdge(e,a,n){const c=e.tileID;return!!e.selfFading||!e.hasData()&&!!a.has(c)&&(e.setSelfFadeLogic(n+this._rasterFadeDuration),!0)}_addTile(e){let a=this._tiles[e.key];if(a)return a;a=this._cache.getAndRemove(e),a&&(a.resetFadeLogic(),this._setTileReloadTimer(e.key,a),a.tileID=e,this._state.initializeTileState(a,this.map?this.map.painter:null));const n=a;return a||(a=new k(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(a,e.key,a.state)),a.uses++,this._tiles[e.key]=a,n||this._source.fire(new h.l("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(e,a){this._clearTileReloadTimer(e);const n=a.getExpiryTimeout();n&&(this._timers[e]=setTimeout((()=>{this._reloadTile(e,"expired"),delete this._timers[e]}),n))}_clearTileReloadTimer(e){const a=this._timers[e];a&&(clearTimeout(a),delete this._timers[e])}_resetTileReloadTimers(){for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(e,this._tiles[e])}refreshTiles(e){for(const a in this._tiles)(this._isIdRenderable(a)||this._tiles[a].state=="errored")&&e.some((n=>n.equals(this._tiles[a].tileID.canonical)))&&this._reloadTile(a,"expired")}_removeTile(e){const a=this._tiles[e];a&&(a.uses--,delete this._tiles[e],this._clearTileReloadTimer(e),a.uses>0||(a.hasData()&&a.state!=="reloading"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}_dataHandler(e){e.dataType==="source"&&(e.sourceDataType!=="metadata"?e.sourceDataType==="content"&&this._sourceLoaded&&!this._paused&&(this.reload(e.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0):this._sourceLoaded=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,a,n){const c=[],d=this.transform;if(!d)return c;const m=d.getCoveringTilesDetailsProvider().allowWorldCopies(),y=n?d.getCameraQueryGeometry(e):e,x=A=>d.screenPointToMercatorCoordinate(A,this.terrain),w=this.transformBbox(e,x,!m),T=this.transformBbox(y,x,!m),M=this.getIds(),P=h.a2.fromPoints(T);for(let A=0;A<M.length;A++){const D=this._tiles[M[A]];if(D.holdingForSymbolFade())continue;const O=m?[D.tileID]:[D.tileID.unwrapTo(-1),D.tileID.unwrapTo(0)],j=Math.pow(2,d.zoom-D.tileID.overscaledZ),V=a*D.queryPadding*h.$/D.tileSize/j;for(const $ of O){const W=P.map((U=>$.getTilePoint(new h.a1(U.x,U.y))));if(W.expandBy(V),W.intersects(Ht)){const U=w.map((Y=>$.getTilePoint(Y))),H=T.map((Y=>$.getTilePoint(Y)));c.push({tile:D,tileID:m?$:$.unwrapTo(0),queryGeometry:U,cameraQueryGeometry:H,scale:j})}}}return c}transformBbox(e,a,n){let c=e.map(a);if(n){const d=h.a2.fromPoints(e);d.shrinkBy(.001*Math.min(d.width(),d.height()));const m=d.map(a);h.a2.fromPoints(c).covers(m)||(c=c.map((y=>y.x>.5?new h.a1(y.x-1,y.y,y.z):y)))}return c}getVisibleCoordinates(e){const a=this.getRenderableIds(e).map((n=>this._tiles[n].tileID));return this.transform&&this.transform.populateCache(a),a}hasTransition(){if(this._source.hasTransition())return!0;if(Ve(this._source.type)&&this._rasterFadeDuration>0){const e=Zt();for(const a in this._tiles)if(this._tiles[a].fadeEndTime>=e)return!0}return!1}setRasterFadeDuration(e){this._rasterFadeDuration=e}setFeatureState(e,a,n){this._state.updateState(e=e||"_geojsonTileLayer",a,n)}removeFeatureState(e,a,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",a,n)}getFeatureState(e,a){return this._state.getState(e=e||"_geojsonTileLayer",a)}setDependencies(e,a,n){const c=this._tiles[e];c&&c.setDependencies(a,n)}reloadTilesForDependencies(e,a){for(const n in this._tiles)this._tiles[n].hasDependency(e,a)&&this._reloadTile(n,"reloading");this._cache.filter((n=>!n.hasDependency(e,a)))}}function je(u,e){const a=Math.abs(2*u.wrap)-+(u.wrap<0),n=Math.abs(2*e.wrap)-+(e.wrap<0);return u.overscaledZ-e.overscaledZ||n-a||e.canonical.y-u.canonical.y||e.canonical.x-u.canonical.x}function Ve(u){return u==="raster"||u==="image"||u==="video"}oe.maxOverzooming=10,oe.maxUnderzooming=3;class ri{constructor(e,a){this.reset(e,a)}reset(e,a){this.points=e||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=h.ae(e,0,1);let a=1,n=this._distances[a];const c=e*this.paddedLength+this.padding;for(;n<c&&a<this._distances.length;)n=this._distances[++a];const d=a-1,m=this._distances[d],y=n-m,x=y>0?(c-m)/y:0;return this.points[d].mult(1-x).add(this.points[a].mult(x))}}function Ae(u,e){let a=!0;return u==="always"||u!=="never"&&e!=="never"||(a=!1),a}class xe{constructor(e,a,n){const c=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(e/n),this.yCellCount=Math.ceil(a/n);for(let m=0;m<this.xCellCount*this.yCellCount;m++)c.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=a,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,a,n,c,d){this._forEachCell(a,n,c,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(a),this.bboxes.push(n),this.bboxes.push(c),this.bboxes.push(d)}insertCircle(e,a,n,c){this._forEachCell(a-c,n-c,a+c,n+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(a),this.circles.push(n),this.circles.push(c)}_insertBoxCell(e,a,n,c,d,m){this.boxCells[d].push(m)}_insertCircleCell(e,a,n,c,d,m){this.circleCells[d].push(m)}_query(e,a,n,c,d,m,y){if(n<0||e>this.width||c<0||a>this.height)return[];const x=[];if(e<=0&&a<=0&&this.width<=n&&this.height<=c){if(d)return[{key:null,x1:e,y1:a,x2:n,y2:c}];for(let w=0;w<this.boxKeys.length;w++)x.push({key:this.boxKeys[w],x1:this.bboxes[4*w],y1:this.bboxes[4*w+1],x2:this.bboxes[4*w+2],y2:this.bboxes[4*w+3]});for(let w=0;w<this.circleKeys.length;w++){const T=this.circles[3*w],M=this.circles[3*w+1],P=this.circles[3*w+2];x.push({key:this.circleKeys[w],x1:T-P,y1:M-P,x2:T+P,y2:M+P})}}else this._forEachCell(e,a,n,c,this._queryCell,x,{hitTest:d,overlapMode:m,seenUids:{box:{},circle:{}}},y);return x}query(e,a,n,c){return this._query(e,a,n,c,!1,null)}hitTest(e,a,n,c,d,m){return this._query(e,a,n,c,!0,d,m).length>0}hitTestCircle(e,a,n,c,d){const m=e-n,y=e+n,x=a-n,w=a+n;if(y<0||m>this.width||w<0||x>this.height)return!1;const T=[];return this._forEachCell(m,x,y,w,this._queryCellCircle,T,{hitTest:!0,overlapMode:c,circle:{x:e,y:a,radius:n},seenUids:{box:{},circle:{}}},d),T.length>0}_queryCell(e,a,n,c,d,m,y,x){const{seenUids:w,hitTest:T,overlapMode:M}=y,P=this.boxCells[d];if(P!==null){const D=this.bboxes;for(const O of P)if(!w.box[O]){w.box[O]=!0;const j=4*O,V=this.boxKeys[O];if(e<=D[j+2]&&a<=D[j+3]&&n>=D[j+0]&&c>=D[j+1]&&(!x||x(V))&&(!T||!Ae(M,V.overlapMode))&&(m.push({key:V,x1:D[j],y1:D[j+1],x2:D[j+2],y2:D[j+3]}),T))return!0}}const A=this.circleCells[d];if(A!==null){const D=this.circles;for(const O of A)if(!w.circle[O]){w.circle[O]=!0;const j=3*O,V=this.circleKeys[O];if(this._circleAndRectCollide(D[j],D[j+1],D[j+2],e,a,n,c)&&(!x||x(V))&&(!T||!Ae(M,V.overlapMode))){const $=D[j],W=D[j+1],U=D[j+2];if(m.push({key:V,x1:$-U,y1:W-U,x2:$+U,y2:W+U}),T)return!0}}}return!1}_queryCellCircle(e,a,n,c,d,m,y,x){const{circle:w,seenUids:T,overlapMode:M}=y,P=this.boxCells[d];if(P!==null){const D=this.bboxes;for(const O of P)if(!T.box[O]){T.box[O]=!0;const j=4*O,V=this.boxKeys[O];if(this._circleAndRectCollide(w.x,w.y,w.radius,D[j+0],D[j+1],D[j+2],D[j+3])&&(!x||x(V))&&!Ae(M,V.overlapMode))return m.push(!0),!0}}const A=this.circleCells[d];if(A!==null){const D=this.circles;for(const O of A)if(!T.circle[O]){T.circle[O]=!0;const j=3*O,V=this.circleKeys[O];if(this._circlesCollide(D[j],D[j+1],D[j+2],w.x,w.y,w.radius)&&(!x||x(V))&&!Ae(M,V.overlapMode))return m.push(!0),!0}}}_forEachCell(e,a,n,c,d,m,y,x){const w=this._convertToXCellCoord(e),T=this._convertToYCellCoord(a),M=this._convertToXCellCoord(n),P=this._convertToYCellCoord(c);for(let A=w;A<=M;A++)for(let D=T;D<=P;D++)if(d.call(this,e,a,n,c,this.xCellCount*D+A,m,y,x))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,a,n,c,d,m){const y=c-e,x=d-a,w=n+m;return w*w>y*y+x*x}_circleAndRectCollide(e,a,n,c,d,m,y){const x=(m-c)/2,w=Math.abs(e-(c+x));if(w>x+n)return!1;const T=(y-d)/2,M=Math.abs(a-(d+T));if(M>T+n)return!1;if(w<=x||M<=T)return!0;const P=w-x,A=M-T;return P*P+A*A<=n*n}}function ke(u,e,a){const n=h.L();if(!u){const{vecSouth:M,vecEast:P}=Me(e),A=pe();A[0]=P[0],A[1]=P[1],A[2]=M[0],A[3]=M[1],c=A,(T=(m=(d=A)[0])*(w=d[3])-(x=d[2])*(y=d[1]))&&(c[0]=w*(T=1/T),c[1]=-y*T,c[2]=-x*T,c[3]=m*T),n[0]=A[0],n[1]=A[1],n[4]=A[2],n[5]=A[3]}var c,d,m,y,x,w,T;return h.N(n,n,[1/a,1/a,1]),n}function _t(u,e,a,n){if(u){const c=h.L();if(!e){const{vecSouth:d,vecEast:m}=Me(a);c[0]=m[0],c[1]=m[1],c[4]=d[0],c[5]=d[1]}return h.N(c,c,[n,n,1]),c}return a.pixelsToClipSpaceMatrix}function Me(u){const e=Math.cos(u.rollInRadians),a=Math.sin(u.rollInRadians),n=Math.cos(u.pitchInRadians),c=Math.cos(u.bearingInRadians),d=Math.sin(u.bearingInRadians),m=h.ar();m[0]=-c*n*a-d*e,m[1]=-d*n*a+c*e;const y=h.as(m);y<1e-9?h.at(m):h.au(m,m,1/y);const x=h.ar();x[0]=c*n*e-d*a,x[1]=d*n*e+c*a;const w=h.as(x);return w<1e-9?h.at(x):h.au(x,x,1/w),{vecEast:x,vecSouth:m}}function yi(u,e,a,n){let c;n?(c=[u,e,n(u,e),1],h.aw(c,c,a)):(c=[u,e,0,1],vi(c,c,a));const d=c[3];return{point:new h.P(c[0]/d,c[1]/d),signedDistanceFromCamera:d,isOccluded:!1}}function ao(u,e){return .5+u/e*.5}function xi(u,e){return u.x>=-e[0]&&u.x<=e[0]&&u.y>=-e[1]&&u.y<=e[1]}function wt(u,e,a,n,c,d,m,y,x,w,T,M,P){const A=a?u.textSizeData:u.iconSizeData,D=h.an(A,e.transform.zoom),O=[256/e.width*2+1,256/e.height*2+1],j=a?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;j.clear();const V=u.lineVertexArray,$=a?u.text.placedSymbolArray:u.icon.placedSymbolArray,W=e.transform.width/e.transform.height;let U=!1;for(let H=0;H<$.length;H++){const Y=$.get(H);if(Y.hidden||Y.writingMode===h.ao.vertical&&!U){Sr(Y.numGlyphs,j);continue}U=!1;const Z=new h.P(Y.anchorX,Y.anchorY),J={getElevation:P,pitchedLabelPlaneMatrix:n,lineVertexArray:V,pitchWithMap:d,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:e.transform,tileAnchorPoint:Z,unwrappedTileID:x,width:w,height:T,translation:M},lt=Oo(Y.anchorX,Y.anchorY,J);if(!xi(lt.point,O)){Sr(Y.numGlyphs,j);continue}const ot=ao(e.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),st=h.ap(A,D,Y),ct=d?st*e.transform.getPitchedTextCorrection(Y.anchorX,Y.anchorY,x)/ot:st*ot,xt=$i({projectionContext:J,pitchedLabelPlaneMatrixInverse:c,symbol:Y,fontSize:ct,flip:!1,keepUpright:m,glyphOffsetArray:u.glyphOffsetArray,dynamicLayoutVertexArray:j,aspectRatio:W,rotateToLine:y});U=xt.useVertical,(xt.notEnoughRoom||U||xt.needsFlipping&&$i({projectionContext:J,pitchedLabelPlaneMatrixInverse:c,symbol:Y,fontSize:ct,flip:!0,keepUpright:m,glyphOffsetArray:u.glyphOffsetArray,dynamicLayoutVertexArray:j,aspectRatio:W,rotateToLine:y}).notEnoughRoom)&&Sr(Y.numGlyphs,j)}a?u.text.dynamicLayoutVertexBuffer.updateData(j):u.icon.dynamicLayoutVertexBuffer.updateData(j)}function $t(u,e,a,n,c,d,m,y){const x=d.glyphStartIndex+d.numGlyphs,w=d.lineStartIndex,T=d.lineStartIndex+d.lineLength,M=e.getoffsetX(d.glyphStartIndex),P=e.getoffsetX(x-1),A=no(u*M,a,n,c,d.segment,w,T,y,m);if(!A)return null;const D=no(u*P,a,n,c,d.segment,w,T,y,m);return D?y.projectionCache.anyProjectionOccluded?null:{first:A,last:D}:null}function qt(u,e,a,n){return u===h.ao.horizontal&&Math.abs(a.y-e.y)>Math.abs(a.x-e.x)*n?{useVertical:!0}:(u===h.ao.vertical?e.y<a.y:e.x>a.x)?{needsFlipping:!0}:null}function $i(u){const{projectionContext:e,pitchedLabelPlaneMatrixInverse:a,symbol:n,fontSize:c,flip:d,keepUpright:m,glyphOffsetArray:y,dynamicLayoutVertexArray:x,aspectRatio:w,rotateToLine:T}=u,M=c/24,P=n.lineOffsetX*M,A=n.lineOffsetY*M;let D;if(n.numGlyphs>1){const O=n.glyphStartIndex+n.numGlyphs,j=n.lineStartIndex,V=n.lineStartIndex+n.lineLength,$=$t(M,y,P,A,d,n,T,e);if(!$)return{notEnoughRoom:!0};const W=so($.first.point.x,$.first.point.y,e,a),U=so($.last.point.x,$.last.point.y,e,a);if(m&&!d){const H=qt(n.writingMode,W,U,w);if(H)return H}D=[$.first];for(let H=n.glyphStartIndex+1;H<O-1;H++){const Y=no(M*y.getoffsetX(H),P,A,d,n.segment,j,V,e,T);if(!Y)return{notEnoughRoom:!0};D.push(Y)}D.push($.last)}else{if(m&&!d){const j=Nt(e.tileAnchorPoint.x,e.tileAnchorPoint.y,e).point,V=n.lineStartIndex+n.segment+1,$=new h.P(e.lineVertexArray.getx(V),e.lineVertexArray.gety(V)),W=Nt($.x,$.y,e),U=W.signedDistanceFromCamera>0?W.point:Ta(e.tileAnchorPoint,$,j,1,e),H=so(j.x,j.y,e,a),Y=so(U.x,U.y,e,a),Z=qt(n.writingMode,H,Y,w);if(Z)return Z}const O=no(M*y.getoffsetX(n.glyphStartIndex),P,A,d,n.segment,n.lineStartIndex,n.lineStartIndex+n.lineLength,e,T);if(!O||e.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};D=[O]}for(const O of D)h.av(x,O.point,O.angle);return{}}function Ta(u,e,a,n,c){const d=u.add(u.sub(e)._unit()),m=Nt(d.x,d.y,c).point,y=a.sub(m);return a.add(y._mult(n/y.mag()))}function Tr(u,e,a){const n=e.projectionCache;if(n.projections[u])return n.projections[u];const c=new h.P(e.lineVertexArray.getx(u),e.lineVertexArray.gety(u)),d=Nt(c.x,c.y,e);if(d.signedDistanceFromCamera>0)return n.projections[u]=d.point,n.anyProjectionOccluded=n.anyProjectionOccluded||d.isOccluded,d.point;const m=u-a.direction;return Ta(a.distanceFromAnchor===0?e.tileAnchorPoint:new h.P(e.lineVertexArray.getx(m),e.lineVertexArray.gety(m)),c,a.previousVertex,a.absOffsetX-a.distanceFromAnchor+1,e)}function Nt(u,e,a){const n=u+a.translation[0],c=e+a.translation[1];let d;return a.pitchWithMap?(d=yi(n,c,a.pitchedLabelPlaneMatrix,a.getElevation),d.isOccluded=!1):(d=a.transform.projectTileCoordinates(n,c,a.unwrappedTileID,a.getElevation),d.point.x=(.5*d.point.x+.5)*a.width,d.point.y=(.5*-d.point.y+.5)*a.height),d}function so(u,e,a,n){if(a.pitchWithMap){const c=[u,e,0,1];return h.aw(c,c,n),a.transform.projectTileCoordinates(c[0]/c[3],c[1]/c[3],a.unwrappedTileID,a.getElevation).point}return{x:u/a.width*2-1,y:1-e/a.height*2}}function Oo(u,e,a){return a.transform.projectTileCoordinates(u,e,a.unwrappedTileID,a.getElevation)}function jo(u,e,a){return u._unit()._perp()._mult(e*a)}function Sa(u,e,a,n,c,d,m,y,x){if(y.projectionCache.offsets[u])return y.projectionCache.offsets[u];const w=a.add(e);if(u+x.direction<n||u+x.direction>=c)return y.projectionCache.offsets[u]=w,w;const T=Tr(u+x.direction,y,x),M=jo(T.sub(a),m,x.direction),P=a.add(M),A=T.add(M);return y.projectionCache.offsets[u]=h.ax(d,w,P,A)||w,y.projectionCache.offsets[u]}function no(u,e,a,n,c,d,m,y,x){const w=n?u-e:u+e;let T=w>0?1:-1,M=0;n&&(T*=-1,M=Math.PI),T<0&&(M+=Math.PI);let P,A=T>0?d+c:d+c+1;y.projectionCache.cachedAnchorPoint?P=y.projectionCache.cachedAnchorPoint:(P=Nt(y.tileAnchorPoint.x,y.tileAnchorPoint.y,y).point,y.projectionCache.cachedAnchorPoint=P);let D,O,j=P,V=P,$=0,W=0;const U=Math.abs(w),H=[];let Y;for(;$+W<=U;){if(A+=T,A<d||A>=m)return null;$+=W,V=j,O=D;const lt={absOffsetX:U,direction:T,distanceFromAnchor:$,previousVertex:V};if(j=Tr(A,y,lt),a===0)H.push(V),Y=j.sub(V);else{let ot;const st=j.sub(V);ot=st.mag()===0?jo(Tr(A+T,y,lt).sub(j),a,T):jo(st,a,T),O||(O=V.add(ot)),D=Sa(A,ot,j,d,m,O,a,y,lt),H.push(O),Y=D.sub(O)}W=Y.mag()}const Z=Y._mult((U-$)/W)._add(O||V),J=M+Math.atan2(j.y-V.y,j.x-V.x);return H.push(Z),{point:Z,angle:x?J:0,path:H}}const Pa=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Sr(u,e){for(let a=0;a<u;a++){const n=e.length;e.resize(n+4),e.float32.set(Pa,3*n)}}function vi(u,e,a){const n=e[0],c=e[1];return u[0]=a[0]*n+a[4]*c+a[12],u[1]=a[1]*n+a[5]*c+a[13],u[3]=a[3]*n+a[7]*c+a[15],u}const Kt=100;class $c{constructor(e,a=new xe(e.width+200,e.height+200,25),n=new xe(e.width+200,e.height+200,25)){this.transform=e,this.grid=a,this.ignoredGrid=n,this.pitchFactor=Math.cos(e.pitch*Math.PI/180)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Kt,this.screenBottomBoundary=e.height+Kt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,a,n,c,d,m,y,x,w,T,M,P){const A=this.projectAndGetPerspectiveRatio(e.anchorPointX+x[0],e.anchorPointY+x[1],d,T,P),D=n*A.perspectiveRatio;let O;if(m||y)O=this._projectCollisionBox(e,D,c,d,m,y,x,A,T,M,P);else{const Y=A.x+(M?M.x*D:0),Z=A.y+(M?M.y*D:0);O={allPointsOccluded:!1,box:[Y+e.x1*D,Z+e.y1*D,Y+e.x2*D,Z+e.y2*D]}}const[j,V,$,W]=O.box,U=m?O.allPointsOccluded:A.isOccluded;let H=U;return H||(H=A.perspectiveRatio<this.perspectiveRatioCutoff),H||(H=!this.isInsideGrid(j,V,$,W)),H||a!=="always"&&this.grid.hitTest(j,V,$,W,a,w)?{box:[j,V,$,W],placeable:!1,offscreen:!1,occluded:U}:{box:[j,V,$,W],placeable:!0,offscreen:this.isOffscreen(j,V,$,W),occluded:U}}placeCollisionCircles(e,a,n,c,d,m,y,x,w,T,M,P,A,D){const O=[],j=new h.P(a.anchorX,a.anchorY),V=this.getPerspectiveRatio(j.x,j.y,m,D),$=(w?d*this.transform.getPitchedTextCorrection(a.anchorX,a.anchorY,m)/V:d*V)/h.aB,W={getElevation:D,pitchedLabelPlaneMatrix:y,lineVertexArray:n,pitchWithMap:w,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:j,unwrappedTileID:m,width:this.transform.width,height:this.transform.height,translation:A},U=$t($,c,a.lineOffsetX*$,a.lineOffsetY*$,!1,a,!1,W);let H=!1,Y=!1,Z=!0;if(U){const J=.5*M*V+P,lt=new h.P(-100,-100),ot=new h.P(this.screenRightBoundary,this.screenBottomBoundary),st=new ri,ct=U.first,xt=U.last;let vt=[];for(let jt=ct.path.length-1;jt>=1;jt--)vt.push(ct.path[jt]);for(let jt=1;jt<xt.path.length;jt++)vt.push(xt.path[jt]);const mt=2.5*J;if(w){const jt=this.projectPathToScreenSpace(vt,W);vt=jt.some((ae=>ae.signedDistanceFromCamera<=0))?[]:jt.map((ae=>ae.point))}let At=[];if(vt.length>0){const jt=vt[0].clone(),ae=vt[0].clone();for(let _e=1;_e<vt.length;_e++)jt.x=Math.min(jt.x,vt[_e].x),jt.y=Math.min(jt.y,vt[_e].y),ae.x=Math.max(ae.x,vt[_e].x),ae.y=Math.max(ae.y,vt[_e].y);At=jt.x>=lt.x&&ae.x<=ot.x&&jt.y>=lt.y&&ae.y<=ot.y?[vt]:ae.x<lt.x||jt.x>ot.x||ae.y<lt.y||jt.y>ot.y?[]:h.ay([vt],lt.x,lt.y,ot.x,ot.y)}for(const jt of At){st.reset(jt,.25*J);let ae=0;ae=st.length<=.5*J?1:Math.ceil(st.paddedLength/mt)+1;for(let _e=0;_e<ae;_e++){const de=_e/Math.max(ae-1,1),Wt=st.lerp(de),ue=Wt.x+Kt,Ze=Wt.y+Kt;O.push(ue,Ze,J,0);const Se=ue-J,Xe=Ze-J,De=ue+J,Le=Ze+J;if(Z=Z&&this.isOffscreen(Se,Xe,De,Le),Y=Y||this.isInsideGrid(Se,Xe,De,Le),e!=="always"&&this.grid.hitTestCircle(ue,Ze,J,e,T)&&(H=!0,!x))return{circles:[],offscreen:!1,collisionDetected:H}}}}return{circles:!x&&H||!Y||V<this.perspectiveRatioCutoff?[]:O,offscreen:Z,collisionDetected:H}}projectPathToScreenSpace(e,a){const n=(function(c,d){const m=h.L();return h.aq(m,d.pitchedLabelPlaneMatrix),c.map((y=>{const x=yi(y.x,y.y,m,d.getElevation),w=d.transform.projectTileCoordinates(x.point.x,x.point.y,d.unwrappedTileID,d.getElevation);return w.point.x=(.5*w.point.x+.5)*d.width,w.point.y=(.5*-w.point.y+.5)*d.height,w}))})(e,a);return(function(c){let d=0,m=0,y=0,x=0;for(let w=0;w<c.length;w++)c[w].isOccluded?(y=w+1,x=0):(x++,x>m&&(m=x,d=y));return c.slice(d,d+m)})(n)}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[],n=new h.a2;for(const M of e){const P=new h.P(M.x+Kt,M.y+Kt);n.extend(P),a.push(P)}const{minX:c,minY:d,maxX:m,maxY:y}=n,x=this.grid.query(c,d,m,y).concat(this.ignoredGrid.query(c,d,m,y)),w={},T={};for(const M of x){const P=M.key;if(w[P.bucketInstanceId]===void 0&&(w[P.bucketInstanceId]={}),w[P.bucketInstanceId][P.featureIndex])continue;const A=[new h.P(M.x1,M.y1),new h.P(M.x2,M.y1),new h.P(M.x2,M.y2),new h.P(M.x1,M.y2)];h.az(a,A)&&(w[P.bucketInstanceId][P.featureIndex]=!0,T[P.bucketInstanceId]===void 0&&(T[P.bucketInstanceId]=[]),T[P.bucketInstanceId].push(P.featureIndex))}return T}insertCollisionBox(e,a,n,c,d,m){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:m,overlapMode:a},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,a,n,c,d,m){const y=n?this.ignoredGrid:this.grid,x={bucketInstanceId:c,featureIndex:d,collisionGroupID:m,overlapMode:a};for(let w=0;w<e.length;w+=4)y.insertCircle(x,e[w],e[w+1],e[w+2])}projectAndGetPerspectiveRatio(e,a,n,c,d){if(d){let m;c?(m=[e,a,c(e,a),1],h.aw(m,m,d)):(m=[e,a,0,1],vi(m,m,d));const y=m[3];return{x:(m[0]/y+1)/2*this.transform.width+Kt,y:(-m[1]/y+1)/2*this.transform.height+Kt,perspectiveRatio:.5+this.transform.cameraToCenterDistance/y*.5,isOccluded:!1,signedDistanceFromCamera:y}}{const m=this.transform.projectTileCoordinates(e,a,n,c);return{x:(m.point.x+1)/2*this.transform.width+Kt,y:(1-m.point.y)/2*this.transform.height+Kt,perspectiveRatio:.5+this.transform.cameraToCenterDistance/m.signedDistanceFromCamera*.5,isOccluded:m.isOccluded,signedDistanceFromCamera:m.signedDistanceFromCamera}}}getPerspectiveRatio(e,a,n,c){const d=this.transform.projectTileCoordinates(e,a,n,c);return .5+this.transform.cameraToCenterDistance/d.signedDistanceFromCamera*.5}isOffscreen(e,a,n,c){return n<Kt||e>=this.screenRightBoundary||c<Kt||a>this.screenBottomBoundary}isInsideGrid(e,a,n,c){return n>=0&&e<this.gridRightBoundary&&c>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const e=h.ai([]);return h.M(e,e,[-100,-100,0]),e}_projectCollisionBox(e,a,n,c,d,m,y,x,w,T,M){let P=1,A=0,D=0,O=1;const j=e.anchorPointX+y[0],V=e.anchorPointY+y[1];if(m&&!d){const vt=this.projectAndGetPerspectiveRatio(j+1,V,c,w,M),mt=vt.x-x.x,At=Math.atan((vt.y-x.y)/mt)+(mt<0?Math.PI:0),jt=Math.sin(At),ae=Math.cos(At);P=ae,A=jt,D=-jt,O=ae}else if(!m&&d){const vt=Me(this.transform);P=vt.vecEast[0],A=vt.vecEast[1],D=vt.vecSouth[0],O=vt.vecSouth[1]}let $=x.x,W=x.y,U=a;d&&($=j,W=V,U=Math.pow(2,-(this.transform.zoom-n.overscaledZ)),U*=this.transform.getPitchedTextCorrection(j,V,c),T||(U*=h.ae(.5+x.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),T&&($+=P*T.x*U+D*T.y*U,W+=A*T.x*U+O*T.y*U);const H=e.x1*U,Y=e.x2*U,Z=(H+Y)/2,J=e.y1*U,lt=e.y2*U,ot=(J+lt)/2,st=[{offsetX:H,offsetY:J},{offsetX:Z,offsetY:J},{offsetX:Y,offsetY:J},{offsetX:Y,offsetY:ot},{offsetX:Y,offsetY:lt},{offsetX:Z,offsetY:lt},{offsetX:H,offsetY:lt},{offsetX:H,offsetY:ot}];let ct=[];for(const{offsetX:vt,offsetY:mt}of st)ct.push(new h.P($+P*vt+D*mt,W+A*vt+O*mt));let xt=!1;if(d){const vt=ct.map((mt=>this.projectAndGetPerspectiveRatio(mt.x,mt.y,c,w,M)));xt=vt.some((mt=>!mt.isOccluded)),ct=vt.map((mt=>new h.P(mt.x,mt.y)))}else xt=!0;return{box:h.aA(ct),allPointsOccluded:!xt}}}class Vo{constructor(e,a,n,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?a:-a))):c&&n?1:0,this.placed=n}isHidden(){return this.opacity===0&&!this.placed}}class lo{constructor(e,a,n,c,d){this.text=new Vo(e?e.text:null,a,n,d),this.icon=new Vo(e?e.icon:null,a,c,d)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Br{constructor(e,a,n){this.text=e,this.icon=a,this.skipFade=n}}class Or{constructor(e,a,n,c,d){this.bucketInstanceId=e,this.featureIndex=a,this.sourceLayerIndex=n,this.bucketIndex=c,this.tileID=d}}class _l{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const a=++this.maxGroupID;this.collisionGroups[e]={ID:a,predicate:n=>n.collisionGroupID===a}}return this.collisionGroups[e]}}function cn(u,e,a,n,c){const{horizontalAlign:d,verticalAlign:m}=h.aH(u);return new h.P(-(d-.5)*e+n[0]*c,-(m-.5)*a+n[1]*c)}class gl{constructor(e,a,n,c,d){this.transform=e.clone(),this.terrain=a,this.collisionIndex=new $c(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new _l(c),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const a=this.terrain;return a?(n,c)=>a.getElevation(e,n,c):null}getBucketParts(e,a,n,c){const d=n.getBucket(a),m=n.latestFeatureIndex;if(!d||!m||a.id!==d.layerIds[0])return;const y=n.collisionBoxArray,x=d.layers[0].layout,w=d.layers[0].paint,T=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),M=n.tileSize/h.$,P=n.tileID.toUnwrapped(),A=x.get("text-rotation-alignment")==="map",D=h.aC(n,1,this.transform.zoom),O=h.aD(this.collisionIndex.transform,n,w.get("text-translate"),w.get("text-translate-anchor")),j=h.aD(this.collisionIndex.transform,n,w.get("icon-translate"),w.get("icon-translate-anchor")),V=ke(A,this.transform,D);this.retainedQueryData[d.bucketInstanceId]=new Or(d.bucketInstanceId,m,d.sourceLayerIndex,d.index,n.tileID);const $={bucket:d,layout:x,translationText:O,translationIcon:j,unwrappedTileID:P,pitchedLabelPlaneMatrix:V,scale:T,textPixelRatio:M,holdingForFade:n.holdingForSymbolFade(),collisionBoxArray:y,partiallyEvaluatedTextSize:h.an(d.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(c)for(const W of d.sortKeyRanges){const{sortKey:U,symbolInstanceStart:H,symbolInstanceEnd:Y}=W;e.push({sortKey:U,symbolInstanceStart:H,symbolInstanceEnd:Y,parameters:$})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:$})}attemptAnchorPlacement(e,a,n,c,d,m,y,x,w,T,M,P,A,D,O,j,V,$,W,U){const H=h.aE[e.textAnchor],Y=[e.textOffset0,e.textOffset1],Z=cn(H,n,c,Y,d),J=this.collisionIndex.placeCollisionBox(a,P,x,w,T,y,m,j,M.predicate,W,Z,U);if((!$||this.collisionIndex.placeCollisionBox($,P,x,w,T,y,m,V,M.predicate,W,Z,U).placeable)&&J.placeable){let lt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[A.crossTileID]&&this.prevPlacement.placements[A.crossTileID]&&this.prevPlacement.placements[A.crossTileID].text&&(lt=this.prevPlacement.variableOffsets[A.crossTileID].anchor),A.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[A.crossTileID]={textOffset:Y,width:n,height:c,anchor:H,textBoxScale:d,prevAnchor:lt},this.markUsedJustification(D,H,A,O),D.allowVerticalPlacement&&(this.markUsedOrientation(D,O,A),this.placedOrientations[A.crossTileID]=O),{shift:Z,placedGlyphBoxes:J}}}placeLayerBucketPart(e,a,n){const{bucket:c,layout:d,translationText:m,translationIcon:y,unwrappedTileID:x,pitchedLabelPlaneMatrix:w,textPixelRatio:T,holdingForFade:M,collisionBoxArray:P,partiallyEvaluatedTextSize:A,collisionGroup:D}=e.parameters,O=d.get("text-optional"),j=d.get("icon-optional"),V=h.aF(d,"text-overlap","text-allow-overlap"),$=V==="always",W=h.aF(d,"icon-overlap","icon-allow-overlap"),U=W==="always",H=d.get("text-rotation-alignment")==="map",Y=d.get("text-pitch-alignment")==="map",Z=d.get("icon-text-fit")!=="none",J=d.get("symbol-z-order")==="viewport-y",lt=$&&(U||!c.hasIconData()||j),ot=U&&($||!c.hasTextData()||O);!c.collisionArrays&&P&&c.deserializeCollisionBoxes(P);const st=this.retainedQueryData[c.bucketInstanceId].tileID,ct=this._getTerrainElevationFunc(st),xt=this.transform.getFastPathSimpleProjectionMatrix(st),vt=(mt,At,jt)=>{var ae,_e;if(a[mt.crossTileID])return;if(M)return void(this.placements[mt.crossTileID]=new Br(!1,!1,!1));let de=!1,Wt=!1,ue=!0,Ze=null,Se={box:null,placeable:!1,offscreen:null,occluded:!1},Xe={placeable:!1},De=null,Le=null,ni=null,$r=0,Zr=0,To=0;At.textFeatureIndex?$r=At.textFeatureIndex:mt.useRuntimeCollisionCircles&&($r=mt.featureIndex),At.verticalTextFeatureIndex&&(Zr=At.verticalTextFeatureIndex);const Gr=At.textBox;if(Gr){const Si=Be=>{let Ke=h.ao.horizontal;if(c.allowVerticalPlacement&&!Be&&this.prevPlacement){const zi=this.prevPlacement.placedOrientations[mt.crossTileID];zi&&(this.placedOrientations[mt.crossTileID]=zi,Ke=zi,this.markUsedOrientation(c,Ke,mt))}return Ke},fi=(Be,Ke)=>{if(c.allowVerticalPlacement&&mt.numVerticalGlyphVertices>0&&At.verticalTextBox){for(const zi of c.writingModes)if(zi===h.ao.vertical?(Se=Ke(),Xe=Se):Se=Be(),Se&&Se.placeable)break}else Se=Be()},pr=mt.textAnchorOffsetStartIndex,da=mt.textAnchorOffsetEndIndex;if(da===pr){const Be=(Ke,zi)=>{const ze=this.collisionIndex.placeCollisionBox(Ke,V,T,st,x,Y,H,m,D.predicate,ct,void 0,xt);return ze&&ze.placeable&&(this.markUsedOrientation(c,zi,mt),this.placedOrientations[mt.crossTileID]=zi),ze};fi((()=>Be(Gr,h.ao.horizontal)),(()=>{const Ke=At.verticalTextBox;return c.allowVerticalPlacement&&mt.numVerticalGlyphVertices>0&&Ke?Be(Ke,h.ao.vertical):{box:null,offscreen:null}})),Si(Se&&Se.placeable)}else{let Be=h.aE[(_e=(ae=this.prevPlacement)===null||ae===void 0?void 0:ae.variableOffsets[mt.crossTileID])===null||_e===void 0?void 0:_e.anchor];const Ke=(ze,Po,Ar)=>{const tr=ze.x2-ze.x1,Wr=ze.y2-ze.y1,wc=mt.textBoxScale,Tc=Z&&W==="never"?Po:null;let Hr=null,Xr=V==="never"?1:2,Sc="never";Be&&Xr++;for(let Qn=0;Qn<Xr;Qn++){for(let Ga=pr;Ga<da;Ga++){const Jn=c.textAnchorOffsets.get(Ga);if(Be&&Jn.textAnchor!==Be)continue;const zr=this.attemptAnchorPlacement(Jn,ze,tr,Wr,wc,H,Y,T,st,x,D,Sc,mt,c,Ar,m,y,Tc,ct);if(zr&&(Hr=zr.placedGlyphBoxes,Hr&&Hr.placeable))return de=!0,Ze=zr.shift,Hr}Be?Be=null:Sc=V}return n&&!Hr&&(Hr={box:this.collisionIndex.placeCollisionBox(Gr,"always",T,st,x,Y,H,m,D.predicate,ct,void 0,xt).box,offscreen:!1,placeable:!1,occluded:!1}),Hr};fi((()=>Ke(Gr,At.iconBox,h.ao.horizontal)),(()=>{const ze=At.verticalTextBox;return c.allowVerticalPlacement&&(!Se||!Se.placeable)&&mt.numVerticalGlyphVertices>0&&ze?Ke(ze,At.verticalIconBox,h.ao.vertical):{box:null,occluded:!0,offscreen:null}})),Se&&(de=Se.placeable,ue=Se.offscreen);const zi=Si(Se&&Se.placeable);if(!de&&this.prevPlacement){const ze=this.prevPlacement.variableOffsets[mt.crossTileID];ze&&(this.variableOffsets[mt.crossTileID]=ze,this.markUsedJustification(c,ze.anchor,mt,zi))}}}if(De=Se,de=De&&De.placeable,ue=De&&De.offscreen,mt.useRuntimeCollisionCircles&&mt.centerJustifiedTextSymbolIndex>=0){const Si=c.text.placedSymbolArray.get(mt.centerJustifiedTextSymbolIndex),fi=h.ap(c.textSizeData,A,Si),pr=d.get("text-padding");Le=this.collisionIndex.placeCollisionCircles(V,Si,c.lineVertexArray,c.glyphOffsetArray,fi,x,w,n,Y,D.predicate,mt.collisionCircleDiameter,pr,m,ct),Le.circles.length&&Le.collisionDetected&&!n&&h.w("Collisions detected, but collision boxes are not shown"),de=$||Le.circles.length>0&&!Le.collisionDetected,ue=ue&&Le.offscreen}if(At.iconFeatureIndex&&(To=At.iconFeatureIndex),At.iconBox){const Si=fi=>this.collisionIndex.placeCollisionBox(fi,W,T,st,x,Y,H,y,D.predicate,ct,Z&&Ze?Ze:void 0,xt);Xe&&Xe.placeable&&At.verticalIconBox?(ni=Si(At.verticalIconBox),Wt=ni.placeable):(ni=Si(At.iconBox),Wt=ni.placeable),ue=ue&&ni.offscreen}const So=O||mt.numHorizontalGlyphVertices===0&&mt.numVerticalGlyphVertices===0,Za=j||mt.numIconVertices===0;So||Za?Za?So||(Wt=Wt&&de):de=Wt&&de:Wt=de=Wt&&de;const qr=Wt&&ni.placeable;if(de&&De.placeable&&this.collisionIndex.insertCollisionBox(De.box,V,d.get("text-ignore-placement"),c.bucketInstanceId,Xe&&Xe.placeable&&Zr?Zr:$r,D.ID),qr&&this.collisionIndex.insertCollisionBox(ni.box,W,d.get("icon-ignore-placement"),c.bucketInstanceId,To,D.ID),Le&&de&&this.collisionIndex.insertCollisionCircles(Le.circles,V,d.get("text-ignore-placement"),c.bucketInstanceId,$r,D.ID),n&&this.storeCollisionData(c.bucketInstanceId,jt,At,De,ni,Le),mt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[mt.crossTileID]=new Br((de||lt)&&!De?.occluded,(Wt||ot)&&!ni?.occluded,ue||c.justReloaded),a[mt.crossTileID]=!0};if(J){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const mt=c.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let At=mt.length-1;At>=0;--At){const jt=mt[At];vt(c.symbolInstances.get(jt),c.collisionArrays[jt],jt)}}else for(let mt=e.symbolInstanceStart;mt<e.symbolInstanceEnd;mt++)vt(c.symbolInstances.get(mt),c.collisionArrays[mt],mt);c.justReloaded=!1}storeCollisionData(e,a,n,c,d,m){if(n.textBox||n.iconBox){let y,x;this.collisionBoxArrays.has(e)?y=this.collisionBoxArrays.get(e):(y=new Map,this.collisionBoxArrays.set(e,y)),y.has(a)?x=y.get(a):(x={text:null,icon:null},y.set(a,x)),n.textBox&&(x.text=c.box),n.iconBox&&(x.icon=d.box)}if(m){let y=this.collisionCircleArrays[e];y===void 0&&(y=this.collisionCircleArrays[e]=[]);for(let x=0;x<m.circles.length;x+=4)y.push(m.circles[x+0]-Kt),y.push(m.circles[x+1]-Kt),y.push(m.circles[x+2]),y.push(m.collisionDetected?1:0)}}markUsedJustification(e,a,n,c){let d;d=c===h.ao.vertical?n.verticalPlacedTextSymbolIndex:{left:n.leftJustifiedTextSymbolIndex,center:n.centerJustifiedTextSymbolIndex,right:n.rightJustifiedTextSymbolIndex}[h.aG(a)];const m=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex,n.verticalPlacedTextSymbolIndex];for(const y of m)y>=0&&(e.text.placedSymbolArray.get(y).crossTileID=d>=0&&y!==d?0:n.crossTileID)}markUsedOrientation(e,a,n){const c=a===h.ao.horizontal||a===h.ao.horizontalOnly?a:0,d=a===h.ao.vertical?a:0,m=[n.leftJustifiedTextSymbolIndex,n.centerJustifiedTextSymbolIndex,n.rightJustifiedTextSymbolIndex];for(const y of m)e.text.placedSymbolArray.get(y).placedOrientation=c;n.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(n.verticalPlacedTextSymbolIndex).placedOrientation=d)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let n=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const c=a?a.symbolFadeChange(e):1,d=a?a.opacities:{},m=a?a.variableOffsets:{},y=a?a.placedOrientations:{};for(const x in this.placements){const w=this.placements[x],T=d[x];T?(this.opacities[x]=new lo(T,c,w.text,w.icon),n=n||w.text!==T.text.placed||w.icon!==T.icon.placed):(this.opacities[x]=new lo(null,c,w.text,w.icon,w.skipFade),n=n||w.text||w.icon)}for(const x in d){const w=d[x];if(!this.opacities[x]){const T=new lo(w,c,!1,!1);T.isHidden()||(this.opacities[x]=T,n=n||w.text.placed||w.icon.placed)}}for(const x in m)this.variableOffsets[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.variableOffsets[x]=m[x]);for(const x in y)this.placedOrientations[x]||!this.opacities[x]||this.opacities[x].isHidden()||(this.placedOrientations[x]=y[x]);if(a&&a.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");n?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:e)}updateLayerOpacities(e,a){const n={};for(const c of a){const d=c.getBucket(e);d&&c.latestFeatureIndex&&e.id===d.layerIds[0]&&this.updateBucketOpacities(d,c.tileID,n,c.collisionBoxArray)}}updateBucketOpacities(e,a,n,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const d=e.layers[0],m=d.layout,y=new lo(null,0,!1,!1,!0),x=m.get("text-allow-overlap"),w=m.get("icon-allow-overlap"),T=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),M=m.get("text-rotation-alignment")==="map",P=m.get("text-pitch-alignment")==="map",A=m.get("icon-text-fit")!=="none",D=new lo(null,0,x&&(w||!e.hasIconData()||m.get("icon-optional")),w&&(x||!e.hasTextData()||m.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const O=(V,$,W)=>{for(let U=0;U<$/4;U++)V.opacityVertexArray.emplaceBack(W);V.hasVisibleVertices=V.hasVisibleVertices||W!==No},j=this.collisionBoxArrays.get(e.bucketInstanceId);for(let V=0;V<e.symbolInstances.length;V++){const $=e.symbolInstances.get(V),{numHorizontalGlyphVertices:W,numVerticalGlyphVertices:U,crossTileID:H}=$;let Y=this.opacities[H];n[H]?Y=y:Y||(Y=D,this.opacities[H]=Y),n[H]=!0;const Z=$.numIconVertices>0,J=this.placedOrientations[$.crossTileID],lt=J===h.ao.vertical,ot=J===h.ao.horizontal||J===h.ao.horizontalOnly;if(W>0||U>0){const ct=is(Y.text);O(e.text,W,lt?No:ct),O(e.text,U,ot?No:ct);const xt=Y.text.isHidden();[$.rightJustifiedTextSymbolIndex,$.centerJustifiedTextSymbolIndex,$.leftJustifiedTextSymbolIndex].forEach((At=>{At>=0&&(e.text.placedSymbolArray.get(At).hidden=xt||lt?1:0)})),$.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get($.verticalPlacedTextSymbolIndex).hidden=xt||ot?1:0);const vt=this.variableOffsets[$.crossTileID];vt&&this.markUsedJustification(e,vt.anchor,$,J);const mt=this.placedOrientations[$.crossTileID];mt&&(this.markUsedJustification(e,"left",$,mt),this.markUsedOrientation(e,mt,$))}if(Z){const ct=is(Y.icon),xt=!(A&&$.verticalPlacedIconSymbolIndex&&lt);$.placedIconSymbolIndex>=0&&(O(e.icon,$.numIconVertices,xt?ct:No),e.icon.placedSymbolArray.get($.placedIconSymbolIndex).hidden=Y.icon.isHidden()),$.verticalPlacedIconSymbolIndex>=0&&(O(e.icon,$.numVerticalIconVertices,xt?No:ct),e.icon.placedSymbolArray.get($.verticalPlacedIconSymbolIndex).hidden=Y.icon.isHidden())}const st=j&&j.has(V)?j.get(V):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const ct=e.collisionArrays[V];if(ct){let xt=new h.P(0,0);if(ct.textBox||ct.verticalTextBox){let vt=!0;if(T){const mt=this.variableOffsets[H];mt?(xt=cn(mt.anchor,mt.width,mt.height,mt.textOffset,mt.textBoxScale),M&&xt._rotate(P?-this.transform.bearingInRadians:this.transform.bearingInRadians)):vt=!1}if(ct.textBox||ct.verticalTextBox){let mt;ct.textBox&&(mt=lt),ct.verticalTextBox&&(mt=ot),co(e.textCollisionBox.collisionVertexArray,Y.text.placed,!vt||mt,st.text,xt.x,xt.y)}}if(ct.iconBox||ct.verticalIconBox){const vt=!!(!ot&&ct.verticalIconBox);let mt;ct.iconBox&&(mt=vt),ct.verticalIconBox&&(mt=!vt),co(e.iconCollisionBox.collisionVertexArray,Y.icon.placed,mt,st.icon,A?xt.x:0,A?xt.y:0)}}}}if(e.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);e.bucketInstanceId in this.collisionCircleArrays&&(e.collisionCircleArray=this.collisionCircleArrays[e.bucketInstanceId],delete this.collisionCircleArrays[e.bucketInstanceId])}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,a){const n=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*n>e}setStale(){this.stale=!0}}function co(u,e,a,n,c,d){n&&n.length!==0||(n=[0,0,0,0]);const m=n[0]-Kt,y=n[1]-Kt,x=n[2]-Kt,w=n[3]-Kt;u.emplaceBack(e?1:0,a?1:0,c||0,d||0,m,y),u.emplaceBack(e?1:0,a?1:0,c||0,d||0,x,y),u.emplaceBack(e?1:0,a?1:0,c||0,d||0,x,w),u.emplaceBack(e?1:0,a?1:0,c||0,d||0,m,w)}const yl=Math.pow(2,25),Zc=Math.pow(2,24),Gc=Math.pow(2,17),qc=Math.pow(2,16),xl=Math.pow(2,9),vl=Math.pow(2,8),hn=Math.pow(2,1);function is(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const e=u.placed?1:0,a=Math.floor(127*u.opacity);return a*yl+e*Zc+a*Gc+e*qc+a*xl+e*vl+a*hn+e}const No=0;class un{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,a,n,c,d){const m=this._bucketParts;for(;this._currentTileIndex<e.length;)if(a.getBucketParts(m,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,m.sort(((y,x)=>y.sortKey-x.sortKey)));this._currentPartIndex<m.length;)if(a.placeLayerBucketPart(m[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,d())return!0;return!1}}class dn{constructor(e,a,n,c,d,m,y,x){this.placement=new gl(e,a,m,y,x),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(e,a,n){const c=Zt(),d=()=>!this._forceFullPlacement&&Zt()-c>2;for(;this._currentPlacementIndex>=0;){const m=a[e[this._currentPlacementIndex]],y=this.placement.collisionIndex.transform.zoom;if(m.type==="symbol"&&(!m.minzoom||m.minzoom<=y)&&(!m.maxzoom||m.maxzoom>y)){if(this._inProgressLayer||(this._inProgressLayer=new un(m)),this._inProgressLayer.continuePlacement(n[m.source],this.placement,this._showCollisionBoxes,m,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Ma=512/h.$/2;class Ia{constructor(e,a,n){this.tileID=e,this.bucketInstanceId=n,this._symbolsByKey={};const c=new Map;for(let d=0;d<a.length;d++){const m=a.get(d),y=m.key,x=c.get(y);x?x.push(m):c.set(y,[m])}for(const[d,m]of c){const y={positions:m.map((x=>({x:Math.floor(x.anchorX*Ma),y:Math.floor(x.anchorY*Ma)}))),crossTileIDs:m.map((x=>x.crossTileID))};if(y.positions.length>128){const x=new h.aI(y.positions.length,16,Uint16Array);for(const{x:w,y:T}of y.positions)x.add(w,T);x.finish(),delete y.positions,y.index=x}this._symbolsByKey[d]=y}}getScaledCoordinates(e,a){const{x:n,y:c,z:d}=this.tileID.canonical,{x:m,y,z:x}=a.canonical,w=Ma/Math.pow(2,x-d),T=(y*h.$+e.anchorY)*w,M=c*h.$*Ma;return{x:Math.floor((m*h.$+e.anchorX)*w-n*h.$*Ma),y:Math.floor(T-M)}}findMatches(e,a,n){const c=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z);for(let d=0;d<e.length;d++){const m=e.get(d);if(m.crossTileID)continue;const y=this._symbolsByKey[m.key];if(!y)continue;const x=this.getScaledCoordinates(m,a);if(y.index){const w=y.index.range(x.x-c,x.y-c,x.x+c,x.y+c).sort();for(const T of w){const M=y.crossTileIDs[T];if(!n[M]){n[M]=!0,m.crossTileID=M;break}}}else if(y.positions)for(let w=0;w<y.positions.length;w++){const T=y.positions[w],M=y.crossTileIDs[w];if(Math.abs(T.x-x.x)<=c&&Math.abs(T.y-x.y)<=c&&!n[M]){n[M]=!0,m.crossTileID=M;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:e})=>e))}}class rs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class bl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const a=Math.round((e-this.lng)/360);if(a!==0)for(const n in this.indexes){const c=this.indexes[n],d={};for(const m in c){const y=c[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+a),d[y.tileID.key]=y}this.indexes[n]=d}this.lng=e}addBucket(e,a,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let d=0;d<a.symbolInstances.length;d++)a.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const d in this.indexes){const m=this.indexes[d];if(Number(d)>e.overscaledZ)for(const y in m){const x=m[y];x.tileID.isChildOf(e)&&x.findMatches(a.symbolInstances,e,c)}else{const y=m[e.scaledTo(Number(d)).key];y&&y.findMatches(a.symbolInstances,e,c)}}for(let d=0;d<a.symbolInstances.length;d++){const m=a.symbolInstances.get(d);m.crossTileID||(m.crossTileID=n.generate(),c[m.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Ia(e,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(e,a){for(const n of a.getCrossTileIDsLists())for(const c of n)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let a=!1;for(const n in this.indexes){const c=this.indexes[n];for(const d in c)e[c[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,c[d]),delete c[d],a=!0)}return a}}class ho{constructor(){this.layerIndexes={},this.crossTileIDs=new rs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,a,n){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new bl);let d=!1;const m={};c.handleWrapJump(n);for(const y of a){const x=y.getBucket(e);x&&e.id===x.layerIds[0]&&(x.bucketInstanceId||(x.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(y.tileID,x,this.crossTileIDs)&&(d=!0),m[x.bucketInstanceId]=!0)}return c.removeStaleBuckets(m)&&(d=!0),d}pruneUnusedLayers(e){const a={};e.forEach((n=>{a[n]=!0}));for(const n in this.layerIndexes)a[n]||delete this.layerIndexes[n]}}var pn="void main() {fragColor=vec4(1.0);}";const sr={prelude:Gt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:Gt("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:Gt("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:Gt(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:Gt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Gt(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Gt(pn,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:Gt(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:Gt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Gt("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Gt("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),colorRelief:Gt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;uniform vec4 u_unpack;uniform sampler2D u_elevation_stops;uniform sampler2D u_color_stops;uniform int u_color_ramp_size;uniform float u_opacity;in vec2 v_pos;float getElevation(vec2 coord) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}float getElevationStop(int stop) {float x=(float(stop)+0.5)/float(u_color_ramp_size);vec4 data=texture(u_elevation_stops,vec2(x,0))*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {float el=getElevation(v_pos);int r=(u_color_ramp_size-1);int l=0;float el_l=getElevationStop(l);float el_r=getElevationStop(r);while(r-l > 1){int m=(r+l)/2;float el_m=getElevationStop(m);if(el < el_m){r=m;el_r=el_m;}else
{l=m;el_l=el_m;}}float x=(float(l)+(el-el_l)/(el_r-el_l)+0.5)/float(u_color_ramp_size);fragColor=u_opacity*texture(u_color_stops,vec2(x,0));
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_dimension;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_pos/8192.0)*scale+epsilon;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),debug:Gt("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:Gt(pn,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:Gt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:Gt(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:Gt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:Gt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Gt(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Gt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Gt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack);}void main() {vec2 epsilon=1.0/u_dimension;float tileSize=u_dimension.x-2.0;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))*tileSize/pow(2.0,exaggeration+(28.2562-u_zoom));fragColor=clamp(vec4(deriv.x/8.0+0.5,deriv.y/8.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Gt(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform float u_exaggeration;uniform vec4 u_accent;uniform int u_method;uniform float u_altitudes[NUM_ILLUMINATION_SOURCES];uniform float u_azimuths[NUM_ILLUMINATION_SOURCES];uniform vec4 u_shadows[NUM_ILLUMINATION_SOURCES];uniform vec4 u_highlights[NUM_ILLUMINATION_SOURCES];
#define PI 3.141592653589793
#define STANDARD 0
#define COMBINED 1
#define IGOR 2
#define MULTIDIRECTIONAL 3
#define BASIC 4
float get_aspect(vec2 deriv){return deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);}void igor_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float aspect=get_aspect(deriv);float azimuth=u_azimuths[0]+PI;float slope_stength=atan(length(deriv))*2.0/PI;float aspect_strength=1.0-abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);float shadow_strength=slope_stength*aspect_strength;float highlight_strength=slope_stength*(1.0-aspect_strength);fragColor=u_shadows[0]*shadow_strength+u_highlights[0]*highlight_strength;}void standard_hillshade(vec2 deriv){float azimuth=u_azimuths[0]+PI;float slope=atan(0.625*length(deriv));float aspect=get_aspect(deriv);float intensity=u_exaggeration;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadows[0],u_highlights[0],shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;}void basic_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor=u_highlights[0]*(2.0*shade-1.0);}else
{fragColor=u_shadows[0]*(1.0-2.0*shade);}}void multidirectional_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;fragColor=vec4(0,0,0,0);for(int i=0; i < NUM_ILLUMINATION_SOURCES; i++){float cos_alt=cos(u_altitudes[i]);float sin_alt=sin(u_altitudes[i]);float cos_az=-cos(u_azimuths[i]);float sin_az=-sin(u_azimuths[i]);float cang=(sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv));float shade=clamp(cang,0.0,1.0);if(shade > 0.5){fragColor+=u_highlights[i]*(2.0*shade-1.0)/float(NUM_ILLUMINATION_SOURCES);}else
{fragColor+=u_shadows[i]*(1.0-2.0*shade)/float(NUM_ILLUMINATION_SOURCES);}}}void combined_hillshade(vec2 deriv){deriv=deriv*u_exaggeration*2.0;float azimuth=u_azimuths[0]+PI;float cos_az=cos(azimuth);float sin_az=sin(azimuth);float cos_alt=cos(u_altitudes[0]);float sin_alt=sin(u_altitudes[0]);float cang=acos((sin_alt-(deriv.y*cos_az*cos_alt-deriv.x*sin_az*cos_alt))/sqrt(1.0+dot(deriv,deriv)));cang=clamp(cang,0.0,PI/2.0);float shade=cang*atan(length(deriv))*4.0/PI/PI;float highlight=(PI/2.0-cang)*atan(length(deriv))*4.0/PI/PI;fragColor=u_shadows[0]*shade+u_highlights[0]*highlight;}void main() {vec4 pixel=texture(u_image,v_pos);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));vec2 deriv=((pixel.rg*8.0)-4.0)/scaleFactor;if (u_method==BASIC) {basic_hillshade(deriv);} else if (u_method==COMBINED) {combined_hillshade(deriv);} else if (u_method==IGOR) {igor_hillshade(deriv);} else if (u_method==MULTIDIRECTIONAL) {multidirectional_hillshade(deriv);} else if (u_method==STANDARD) {standard_hillshade(deriv);} else {standard_hillshade(deriv);}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:Gt(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Gt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Gt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Gt(`uniform lowp float u_device_pixel_ratio;uniform lowp float u_lineatlas_width;uniform sampler2D u_image;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0/u_device_pixel_ratio)/min(dasharray_from.w,dasharray_to.w);alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),lineGradientSDF:Gt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform sampler2D u_image_dash;uniform float u_mix;uniform lowp float u_lineatlas_width;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);float sdfdist_a=texture(u_image_dash,v_tex_a).a;float sdfdist_b=texture(u_image_dash,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfgamma=(u_lineatlas_width/256.0)/min(dasharray_from.w,dasharray_to.w);float dash_alpha=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*dash_alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;uniform float u_tileratio;uniform float u_crossfade_from;uniform float u_crossfade_to;uniform float u_lineatlas_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;out vec2 v_tex_a;out vec2 v_tex_b;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define mediump vec4 dasharray_from
#pragma mapbox: define mediump vec4 dasharray_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 dasharray_from
#pragma mapbox: initialize mediump vec4 dasharray_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;float texel_height=1.0/u_image_height;float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
float u_patternscale_a_x=u_tileratio/dasharray_from.w/u_crossfade_from;float u_patternscale_a_y=-dasharray_from.z/2.0/u_lineatlas_height;float u_patternscale_b_x=u_tileratio/dasharray_to.w/u_crossfade_to;float u_patternscale_b_y=-dasharray_to.z/2.0/u_lineatlas_height;v_tex_a=vec2(a_linesofar*u_patternscale_a_x/floorwidth,normal.y*u_patternscale_a_y+(float(dasharray_from.y)+0.5)/u_lineatlas_height);v_tex_b=vec2(a_linesofar*u_patternscale_b_x/floorwidth,normal.y*u_patternscale_b_y+(float(dasharray_to.y)+0.5)/u_lineatlas_height);v_width2=vec2(outset,inset);}`),raster:Gt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:Gt(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Gt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Gt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Gt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:Gt("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:Gt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:Gt("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:Gt(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:Gt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function Gt(u,e){const a=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,n=e.match(/in ([\w]+) ([\w]+)/g),c=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),d=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=d?d.concat(c):c,y={};return{fragmentSource:u=u.replace(a,((x,w,T,M,P)=>(y[P]=!0,w==="define"?`
#ifndef HAS_UNIFORM_u_${P}
in ${T} ${M} ${P};
#else
uniform ${T} ${M} u_${P};
#endif
`:`
#ifdef HAS_UNIFORM_u_${P}
    ${T} ${M} ${P} = u_${P};
#endif
`))),vertexSource:e=e.replace(a,((x,w,T,M,P)=>{const A=M==="float"?"vec2":"vec4",D=P.match(/color/)?"color":A;return y[P]?w==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
in ${T} ${A} a_${P};
out ${T} ${M} ${P};
#else
uniform ${T} ${M} u_${P};
#endif
`:D==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = a_${P};
#else
    ${T} ${M} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = unpack_mix_${D}(a_${P}, u_${P}_t);
#else
    ${T} ${M} ${P} = u_${P};
#endif
`:w==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
in ${T} ${A} a_${P};
#else
uniform ${T} ${M} u_${P};
#endif
`:D==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${T} ${M} ${P} = a_${P};
#else
    ${T} ${M} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    ${T} ${M} ${P} = unpack_mix_${D}(a_${P}, u_${P}_t);
#else
    ${T} ${M} ${P} = u_${P};
#endif
`})),staticAttributes:n,staticUniforms:m}}class Xi{constructor(e,a,n){this.vertexBuffer=e,this.indexBuffer=a,this.segments=n}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Ut=h.aJ([{name:"a_pos",type:"Int16",components:2}]);const os="#define PROJECTION_MERCATOR",wl="mercator";class Ca{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return wl}get shaderDefine(){return os}get shaderPreludeCode(){return sr.projectionMercator}get vertexShaderPreludeCode(){return sr.projectionMercator.vertexSource}get subdivisionGranularity(){return h.aK.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(e){}getMeshFromTileID(e,a,n,c,d){if(this._cachedMesh)return this._cachedMesh;const m=new h.aL;m.emplaceBack(0,0),m.emplaceBack(h.$,0),m.emplaceBack(0,h.$),m.emplaceBack(h.$,h.$);const y=e.createVertexBuffer(m,Ut.members),x=h.aM.simpleSegment(0,0,4,2),w=new h.aN;w.emplaceBack(1,0,2),w.emplaceBack(1,2,3);const T=e.createIndexBuffer(w);return this._cachedMesh=new Xi(y,T,x),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(e){}}class oi{constructor(e=0,a=0,n=0,c=0){if(isNaN(e)||e<0||isNaN(a)||a<0||isNaN(n)||n<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=a,this.left=n,this.right=c}interpolate(e,a,n){return a.top!=null&&e.top!=null&&(this.top=h.C.number(e.top,a.top,n)),a.bottom!=null&&e.bottom!=null&&(this.bottom=h.C.number(e.bottom,a.bottom,n)),a.left!=null&&e.left!=null&&(this.left=h.C.number(e.left,a.left,n)),a.right!=null&&e.right!=null&&(this.right=h.C.number(e.right,a.right,n)),this}getCenter(e,a){const n=h.ae((this.left+e-this.right)/2,0,e),c=h.ae((this.top+a-this.bottom)/2,0,a);return new h.P(n,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new oi(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function He(u,e){if(!u.renderWorldCopies||u.lngRange)return;const a=e.lng-u.center.lng;e.lng+=a>180?-360:a<-180?360:0}function di(u){return Math.max(0,Math.floor(u))}class Ne{constructor(e,a){var n;this._callbacks=e,this._tileSize=512,this._renderWorldCopies=a?.renderWorldCopies===void 0||!!a?.renderWorldCopies,this._minZoom=a?.minZoom||0,this._maxZoom=a?.maxZoom||22,this._minPitch=a?.minPitch==null?0:a?.minPitch,this._maxPitch=a?.maxPitch==null?60:a?.maxPitch,this._constrain=(n=a?.constrain)!==null&&n!==void 0?n:this._callbacks.constrain,this.setMaxBounds(),this._width=0,this._height=0,this._center=new h.S(0,0),this._elevation=0,this._zoom=0,this._tileZoom=di(this._zoom),this._scale=h.ah(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new oi,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(e,a,n){this._latRange=e.latRange,this._lngRange=e.lngRange,this._width=e.width,this._height=e.height,this._center=e.center,this._elevation=e.elevation,this._minElevationForCurrentTile=e.minElevationForCurrentTile,this._zoom=e.zoom,this._tileZoom=di(this._zoom),this._scale=h.ah(this._zoom),this._bearingInRadians=e.bearingInRadians,this._fovInRadians=e.fovInRadians,this._pitchInRadians=e.pitchInRadians,this._rollInRadians=e.rollInRadians,this._unmodified=e.unmodified,this._edgeInsets=new oi(e.padding.top,e.padding.bottom,e.padding.left,e.padding.right),this._minZoom=e.minZoom,this._maxZoom=e.maxZoom,this._minPitch=e.minPitch,this._maxPitch=e.maxPitch,this._renderWorldCopies=e.renderWorldCopies,this._cameraToCenterDistance=e.cameraToCenterDistance,this._nearZ=e.nearZ,this._farZ=e.farZ,this._autoCalculateNearFarZ=!n&&e.autoCalculateNearFarZ,a&&this.constrainInternal(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(e){this._minElevationForCurrentTile=e}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(e){this._minZoom!==e&&(this._minZoom=e,this.setZoom(this.constrain(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.setZoom(this.constrain(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(e){this._minPitch!==e&&(this._minPitch=e,this.setPitch(Math.max(this.pitch,e)))}get maxPitch(){return this._maxPitch}setMaxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.setPitch(Math.min(this.pitch,e)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get constrain(){return this._constrain}setConstrain(e){e||(e=this._callbacks.constrain),this._constrain=e,this.constrainInternal(),this._calcMatrices()}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new h.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(e){const a=h.aO(e,-180,180)*Math.PI/180;var n,c,d,m,y,x,w,T,M;this._bearingInRadians!==a&&(this._unmodified=!1,this._bearingInRadians=a,this._calcMatrices(),this._rotationMatrix=pe(),n=this._rotationMatrix,d=-this._bearingInRadians,m=(c=this._rotationMatrix)[0],y=c[1],x=c[2],w=c[3],T=Math.sin(d),M=Math.cos(d),n[0]=m*M+x*T,n[1]=y*M+w*T,n[2]=m*-T+x*M,n[3]=y*-T+w*M)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(e){const a=h.ae(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==a&&(this._unmodified=!1,this._pitchInRadians=a,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(e){const a=e/180*Math.PI;this._rollInRadians!==a&&(this._unmodified=!1,this._rollInRadians=a,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return h.aP(this._fovInRadians)}setFov(e){e=h.ae(e,.1,150),this.fov!==e&&(this._unmodified=!1,this._fovInRadians=h.ag(e),this._calcMatrices())}get zoom(){return this._zoom}setZoom(e){const a=this.constrain(this._center,e).zoom;this._zoom!==a&&(this._unmodified=!1,this._zoom=a,this._tileZoom=Math.max(0,Math.floor(a)),this._scale=h.ah(a),this.constrainInternal(),this._calcMatrices())}get center(){return this._center}setCenter(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this.constrainInternal(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(e){e!==this._elevation&&(this._elevation=e,this.constrainInternal(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(e,a){this._autoCalculateNearFarZ=!1,this._nearZ=e,this._farZ=a,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,a,n){this._unmodified=!1,this._edgeInsets.interpolate(e,a,n),this.constrainInternal(),this._calcMatrices()}resize(e,a,n=!0){this._width=e,this._height=a,n&&this.constrainInternal(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new fe([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(e){e?(this._lngRange=[e.getWest(),e.getEast()],this._latRange=[e.getSouth(),e.getNorth()],this.constrainInternal()):(this._lngRange=null,this._latRange=[-h.af,h.af])}getCameraQueryGeometry(e,a){if(a.length===1)return[a[0],e];{const{minX:n,minY:c,maxX:d,maxY:m}=h.a2.fromPoints(a).extend(e);return[new h.P(n,c),new h.P(d,c),new h.P(d,m),new h.P(n,m),new h.P(n,c)]}}constrainInternal(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:a,zoom:n}=this.constrain(this.center,this.zoom);this.setCenter(a),this.setZoom(n),this._unmodified=e,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let e=h.ai(new Float64Array(16));h.N(e,e,[this._width/2,-this._height/2,1]),h.M(e,e,[1,-1,0]),this._clipSpaceToPixelsMatrix=e,e=h.ai(new Float64Array(16)),h.N(e,e,[1,-1,1]),h.M(e,e,[-1,-1,0]),h.N(e,e,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=e,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(e,a,n,c){const d=n!==void 0?n:this.bearing,m=c=c!==void 0?c:this.pitch,y=h.a1.fromLngLat(e,a),x=-Math.cos(h.ag(m)),w=Math.sin(h.ag(m)),T=w*Math.sin(h.ag(d)),M=-w*Math.cos(h.ag(d));let P=this.elevation;const A=a-P;let D;x*A>=0||Math.abs(x)<.1?(D=1e4,P=a+D*x):D=-A/x;let O,j,V=h.aQ(1,y.y),$=0;do{if($+=1,$>10)break;j=D/V,O=new h.a1(y.x+T*j,y.y+M*j),V=1/O.meterInMercatorCoordinateUnits()}while(Math.abs(D-j*V)>1e-12);return{center:O.toLngLat(),elevation:P,zoom:h.ak(this.height/2/Math.tan(this.fovInRadians/2)/j/this.tileSize)}}recalculateZoomAndCenter(e){if(this.elevation-e==0)return;const a=h.aj(1,this.center.lat)*this.worldSize,n=this.cameraToCenterDistance/a,c=h.a1.fromLngLat(this.center,this.elevation),d=yt(this.center,this.elevation,this.pitch,this.bearing,n);this._elevation=e;const m=this.calculateCenterFromCameraLngLatAlt(d.toLngLat(),h.aQ(d.z,c.y),this.bearing,this.pitch);this._elevation=m.elevation,this._center=m.center,this.setZoom(m.zoom)}getCameraPoint(){const e=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new h.P(e*Math.sin(this.rollInRadians),e*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const e=h.aj(1,this.center.lat)*this.worldSize;return yt(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/e).toLngLat()}getMercatorTileCoordinates(e){if(!e)return[0,0,1,1];const a=e.canonical.z>=0?1<<e.canonical.z:Math.pow(2,e.canonical.z);return[e.canonical.x/a,e.canonical.y/a,1/a/h.$,1/a/h.$]}}class me{constructor(e,a){this.min=e,this.max=a,this.center=h.aR([],h.aS([],this.min,this.max),.5)}quadrant(e){const a=[e%2==0,e<2],n=h.aT(this.min),c=h.aT(this.max);for(let d=0;d<a.length;d++)n[d]=a[d]?this.min[d]:this.center[d],c[d]=a[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new me(n,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersectsFrustum(e){let a=!0;for(let n=0;n<e.planes.length;n++){const c=this.intersectsPlane(e.planes[n]);if(c===0)return 0;c===1&&(a=!1)}return a?2:e.aabb.min[0]>this.max[0]||e.aabb.min[1]>this.max[1]||e.aabb.min[2]>this.max[2]||e.aabb.max[0]<this.min[0]||e.aabb.max[1]<this.min[1]||e.aabb.max[2]<this.min[2]?0:1}intersectsPlane(e){let a=e[3],n=e[3];for(let c=0;c<3;c++)e[c]>0?(a+=e[c]*this.min[c],n+=e[c]*this.max[c]):(n+=e[c]*this.min[c],a+=e[c]*this.max[c]);return a>=0?2:n<0?0:1}}class Wc{distanceToTile2d(e,a,n,c){const d=c.distanceX([e,a]),m=c.distanceY([e,a]);return Math.hypot(d,m)}getWrap(e,a,n){return n}getTileBoundingVolume(e,a,n,c){var d,m;let y=0,x=0;if(c?.terrain){const T=new h.Z(e.z,a,e.z,e.x,e.y),M=c.terrain.getMinMaxElevation(T);y=(d=M.minElevation)!==null&&d!==void 0?d:Math.min(0,n),x=(m=M.maxElevation)!==null&&m!==void 0?m:Math.max(0,n)}const w=1<<e.z;return new me([a+e.x/w,e.y/w,y],[a+(e.x+1)/w,(e.y+1)/w,x])}allowVariableZoom(e,a){const n=e.fov*(Math.abs(Math.cos(e.rollInRadians))*e.height+Math.abs(Math.sin(e.rollInRadians))*e.width)/e.height,c=h.ae(78.5-n/2,0,60);return!!a.terrain||e.pitch>c}allowWorldCopies(){return!0}prepareNextFrame(){}}class ai{constructor(e,a,n){this.points=e,this.planes=a,this.aabb=n}static fromInvProjectionMatrix(e,a=1,n=0,c,d){const m=d?[[6,5,4],[0,1,2],[0,3,7],[2,1,5],[3,2,6],[0,4,5]]:[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]],y=Math.pow(2,n),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((P=>(function(A,D,O,j){const V=h.aw([],A,D),$=1/V[3]/O*j;return h.aY(V,V,[$,$,1/V[3],$])})(P,e,a,y)));c&&(function(P,A,D,O){const j=O?4:0,V=O?0:4;let $=0;const W=[],U=[];for(let Z=0;Z<4;Z++){const J=h.aU([],P[Z+V],P[Z+j]),lt=h.aZ(J);h.aR(J,J,1/lt),W.push(lt),U.push(J)}for(let Z=0;Z<4;Z++){const J=h.a_(P[Z+j],U[Z],D);$=J!==null&&J>=0?Math.max($,J):Math.max($,W[Z])}const H=(function(Z,J){const lt=h.aU([],Z[J[0]],Z[J[1]]),ot=h.aU([],Z[J[2]],Z[J[1]]),st=[0,0,0,0];return h.aV(st,h.aW([],lt,ot)),st[3]=-h.aX(st,Z[J[0]]),st})(P,A),Y=(function(Z,J){const lt=h.a$(Z),ot=h.b0([],Z,1/lt),st=h.aU([],J,h.aR([],ot,h.aX(J,ot))),ct=h.a$(st);if(ct>0){const xt=Math.sqrt(1-ot[3]*ot[3]),vt=h.aR([],ot,-ot[3]),mt=h.aS([],vt,h.aR([],st,xt/ct));return h.b1(J,mt)}return null})(D,H);if(Y!==null){const Z=Y/h.aX(U[0],H);$=Math.min($,Z)}for(let Z=0;Z<4;Z++){const J=Math.min($,W[Z]);P[Z+V]=[P[Z+j][0]+U[Z][0]*J,P[Z+j][1]+U[Z][1]*J,P[Z+j][2]+U[Z][2]*J,1]}})(x,m[0],c,d);const w=m.map((P=>{const A=h.aU([],x[P[0]],x[P[1]]),D=h.aU([],x[P[2]],x[P[1]]),O=h.aV([],h.aW([],A,D)),j=-h.aX(O,x[P[1]]);return O.concat(j)})),T=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],M=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const P of x)for(let A=0;A<3;A++)T[A]=Math.min(T[A],P[A]),M[A]=Math.max(M[A],P[A]);return new ai(x,w,new me(T,M))}}class si{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,n){return this._helper.interpolatePadding(e,a,n)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,n=!0){this._helper.resize(e,a,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrain(e){this._helper.setConstrain(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e,a){}constructor(e){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this.defaultConstrain=(a,n)=>{n=h.ae(+n,this.minZoom,this.maxZoom);const c={center:new h.S(a.lng,a.lat),zoom:n};let d=this._helper._lngRange;if(!this._helper._renderWorldCopies&&d===null){const U=179.9999999999;d=[-U,U]}const m=this.tileSize*h.ah(c.zoom);let y=0,x=m,w=0,T=m,M=0,P=0;const{x:A,y:D}=this.size;if(this._helper._latRange){const U=this._helper._latRange;y=h.U(U[1])*m,x=h.U(U[0])*m,x-y<D&&(M=D/(x-y))}d&&(w=h.aO(h.V(d[0])*m,0,m),T=h.aO(h.V(d[1])*m,0,m),T<w&&(T+=m),T-w<A&&(P=A/(T-w)));const{x:O,y:j}=et(m,a);let V,$;const W=Math.max(P||0,M||0);if(W){const U=new h.P(P?(T+w)/2:O,M?(x+y)/2:j);return c.center=nt(m,U).wrap(),c.zoom+=h.ak(W),c}if(this._helper._latRange){const U=D/2;j-U<y&&($=y+U),j+U>x&&($=x-U)}if(d){const U=(w+T)/2;let H=O;this._helper._renderWorldCopies&&(H=h.aO(O,U-m/2,U+m/2));const Y=A/2;H-Y<w&&(V=w+Y),H+Y>T&&(V=T-Y)}if(V!==void 0||$!==void 0){const U=new h.P(V??O,$??j);c.center=nt(m,U).wrap()}return c},this._helper=new Ne({calcMatrices:()=>{this._calcMatrices()},constrain:(a,n)=>this.defaultConstrain(a,n)},e),this._coveringTilesDetailsProvider=new Wc}clone(){const e=new si;return e.apply(this),e}apply(e,a,n){this._helper.apply(e,a,n)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(e){const a=[new h.b2(0,e)];if(this._helper._renderWorldCopies){const n=this.screenPointToMercatorCoordinate(new h.P(0,0)),c=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,0)),d=this.screenPointToMercatorCoordinate(new h.P(this._helper._width,this._helper._height)),m=this.screenPointToMercatorCoordinate(new h.P(0,this._helper._height)),y=Math.floor(Math.min(n.x,c.x,d.x,m.x)),x=Math.floor(Math.max(n.x,c.x,d.x,m.x)),w=1;for(let T=y-w;T<=x+w;T++)T!==0&&a.push(new h.b2(T,e))}return a}getCameraFrustum(){return ai.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){const a=this.screenPointToLocation(this.centerPoint,e),n=e?e.getElevationForLngLatZoom(a,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(n)}setLocationAtPoint(e,a){const n=h.aj(this.elevation,this.center.lat),c=this.screenPointToMercatorCoordinateAtZ(a,n),d=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,n),m=h.a1.fromLngLat(e),y=new h.a1(m.x-(c.x-d.x),m.y-(c.y-d.y));this.setCenter(y?.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(e,a){return a?this.coordinatePoint(h.a1.fromLngLat(e),a.getElevationForLngLatZoom(e,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(h.a1.fromLngLat(e))}screenPointToLocation(e,a){var n;return(n=this.screenPointToMercatorCoordinate(e,a))===null||n===void 0?void 0:n.toLngLat()}screenPointToMercatorCoordinate(e,a){if(a){const n=a.pointCoordinate(e);if(n!=null)return n}return this.screenPointToMercatorCoordinateAtZ(e)}screenPointToMercatorCoordinateAtZ(e,a){const n=a||0,c=[e.x,e.y,0,1],d=[e.x,e.y,1,1];h.aw(c,c,this._pixelMatrixInverse),h.aw(d,d,this._pixelMatrixInverse);const m=c[3],y=d[3],x=c[1]/m,w=d[1]/y,T=c[2]/m,M=d[2]/y,P=T===M?0:(n-T)/(M-T);return new h.a1(h.C.number(c[0]/m,d[0]/y,P)/this.worldSize,h.C.number(x,w,P)/this.worldSize,n)}coordinatePoint(e,a=0,n=this._pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,a,1];return h.aw(c,c,n),new h.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this._helper._height/2-tt(this));return new fe().extend(this.screenPointToLocation(new h.P(0,e))).extend(this.screenPointToLocation(new h.P(this._helper._width,e))).extend(this.screenPointToLocation(new h.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new h.P(0,this._helper._height)))}isPointOnMapSurface(e,a){return a?a.pointCoordinate(e)!=null:e.y>this.height/2-tt(this)}calculatePosMatrix(e,a=!1,n){var c;const d=(c=e.key)!==null&&c!==void 0?c:h.b3(e.wrap,e.canonical.z,e.canonical.z,e.canonical.x,e.canonical.y),m=a?this._alignedPosMatrixCache:this._posMatrixCache;if(m.has(d)){const w=m.get(d);return n?w.f32:w.f64}const y=ut(e,this.worldSize);h.O(y,a?this._alignedProjMatrix:this._viewProjMatrix,y);const x={f64:y,f32:new Float32Array(y)};return m.set(d,x),n?x.f32:x.f64}calculateFogMatrix(e){const a=e.key,n=this._fogMatrixCacheF32;if(n.has(a))return n.get(a);const c=ut(e,this.worldSize);return h.O(c,this._fogMatrix,c),n.set(a,new Float32Array(c)),n.get(a)}calculateCenterFromCameraLngLatAlt(e,a,n,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,n,c)}_calculateNearFarZIfNeeded(e,a,n){if(!this._helper.autoCalculateNearFarZ)return;const c=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),d=e-c*this._helper._pixelPerMeter/Math.cos(a),m=c<0?d:e,y=Math.PI/2+this.pitchInRadians,x=h.ag(this.fov)*(Math.abs(Math.cos(h.ag(this.roll)))*this.height+Math.abs(Math.sin(h.ag(this.roll)))*this.width)/this.height*(.5+n.y/this.height),w=Math.sin(x)*m/Math.sin(h.ae(Math.PI-y-x,.01,Math.PI-.01)),T=tt(this),M=Math.atan(T/this._helper.cameraToCenterDistance),P=h.ag(.75),A=M>P?2*M*(.5+n.y/(2*T)):P,D=Math.sin(A)*m/Math.sin(h.ae(Math.PI-y-A,.01,Math.PI-.01)),O=Math.min(w,D);this._helper._farZ=1.01*(Math.cos(Math.PI/2-a)*O+m),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const e=this.centerOffset,a=et(this.worldSize,this.center),n=a.x,c=a.y;this._helper._pixelPerMeter=h.aj(1,this.center.lat)*this.worldSize;const d=h.ag(Math.min(this.pitch,X)),m=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(d));let y;this._calculateNearFarZIfNeeded(m,d,e),y=new Float64Array(16),h.b4(y,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),h.aq(this._invProjMatrix,y),y[8]=2*-e.x/this._helper._width,y[9]=2*e.y/this._helper._height,this._projectionMatrix=h.b5(y),h.N(y,y,[1,-1,1]),h.M(y,y,[0,0,-this._helper.cameraToCenterDistance]),h.b6(y,y,-this.rollInRadians),h.b7(y,y,this.pitchInRadians),h.b6(y,y,-this.bearingInRadians),h.M(y,y,[-n,-c,0]),this._mercatorMatrix=h.N([],y,[this.worldSize,this.worldSize,this.worldSize]),h.N(y,y,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=h.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,y),h.M(y,y,[0,0,-this.elevation]),this._viewProjMatrix=y,this._invViewProjMatrix=h.aq([],y);const x=[0,0,-1,1];h.aw(x,x,this._invViewProjMatrix),this._cameraPosition=[x[0]/x[3],x[1]/x[3],x[2]/x[3]],this._fogMatrix=new Float64Array(16),h.b4(this._fogMatrix,this.fovInRadians,this.width/this.height,m,this._helper._farZ),this._fogMatrix[8]=2*-e.x/this.width,this._fogMatrix[9]=2*e.y/this.height,h.N(this._fogMatrix,this._fogMatrix,[1,-1,1]),h.M(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),h.b6(this._fogMatrix,this._fogMatrix,-this.rollInRadians),h.b7(this._fogMatrix,this._fogMatrix,this.pitchInRadians),h.b6(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),h.M(this._fogMatrix,this._fogMatrix,[-n,-c,0]),h.N(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),h.M(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=h.O(new Float64Array(16),this.clipSpaceToPixelsMatrix,y);const w=this._helper._width%2/2,T=this._helper._height%2/2,M=Math.cos(this.bearingInRadians),P=Math.sin(-this.bearingInRadians),A=n-Math.round(n)+M*w+P*T,D=c-Math.round(c)+M*T+P*w,O=new Float64Array(y);if(h.M(O,O,[A>.5?A-1:A,D>.5?D-1:D,0]),this._alignedProjMatrix=O,y=h.aq(new Float64Array(16),this._pixelMatrix),!y)throw new Error("failed to invert matrix");this._pixelMatrixInverse=y,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const e=this.screenPointToMercatorCoordinate(new h.P(0,0)),a=[e.x*this.worldSize,e.y*this.worldSize,0,1];return h.aw(a,a,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const e=h.aj(1,this.center.lat)*this.worldSize;return yt(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/e).toLngLat()}lngLatToCameraDepth(e,a){const n=h.a1.fromLngLat(e),c=[n.x*this.worldSize,n.y*this.worldSize,a,1];return h.aw(c,c,this._viewProjMatrix),c[2]/c[3]}getProjectionData(e){const{overscaledTileID:a,aligned:n,applyTerrainMatrix:c}=e,d=this._helper.getMercatorTileCoordinates(a),m=a?this.calculatePosMatrix(a,n,!0):null;let y;return y=a&&a.terrainRttPosMatrix32f&&c?a.terrainRttPosMatrix32f:m||h.b8(),{mainMatrix:y,tileMercatorCoords:d,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:y}}isLocationOccluded(e){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(e,a,n){return 1}transformLightDirection(e){return h.aT(e)}getRayDirectionFromPixel(e){throw new Error("Not implemented.")}projectTileCoordinates(e,a,n,c){const d=this.calculatePosMatrix(n);let m;c?(m=[e,a,c(e,a),1],h.aw(m,m,d)):(m=[e,a,0,1],vi(m,m,d));const y=m[3];return{point:new h.P(m[0]/y,m[1]/y),signedDistanceFromCamera:y,isOccluded:!1}}populateCache(e){for(const a of e)this.calculatePosMatrix(a)}getMatrixForModel(e,a){const n=h.a1.fromLngLat(e,a),c=n.meterInMercatorCoordinateUnits(),d=h.b9();return h.M(d,d,[n.x,n.y,n.z]),h.b6(d,d,Math.PI),h.b7(d,d,Math.PI/2),h.N(d,d,[-c,c,c]),d}getProjectionDataForCustomLayer(e=!0){const a=new h.Z(0,0,0,0,0),n=this.getProjectionData({overscaledTileID:a,applyGlobeMatrix:e}),c=ut(a,this.worldSize);h.O(c,this._viewProjMatrix,c),n.tileMercatorCoords=[0,0,1,1];const d=[h.$,h.$,this.worldSize/this._helper.pixelsPerMeter],m=h.ba();return h.N(m,c,d),n.fallbackMatrix=m,n.mainMatrix=m,n}getFastPathSimpleProjectionMatrix(e){return this.calculatePosMatrix(e)}}function Ci(){h.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function fn(u){if(u.useSlerp)if(u.k<1){const e=h.bb(u.startEulerAngles.roll,u.startEulerAngles.pitch,u.startEulerAngles.bearing),a=h.bb(u.endEulerAngles.roll,u.endEulerAngles.pitch,u.endEulerAngles.bearing),n=new Float64Array(4);h.bc(n,e,a,u.k);const c=h.bd(n);u.tr.setRoll(c.roll),u.tr.setPitch(c.pitch),u.tr.setBearing(c.bearing)}else u.tr.setRoll(u.endEulerAngles.roll),u.tr.setPitch(u.endEulerAngles.pitch),u.tr.setBearing(u.endEulerAngles.bearing);else u.tr.setRoll(h.C.number(u.startEulerAngles.roll,u.endEulerAngles.roll,u.k)),u.tr.setPitch(h.C.number(u.startEulerAngles.pitch,u.endEulerAngles.pitch,u.k)),u.tr.setBearing(h.C.number(u.startEulerAngles.bearing,u.endEulerAngles.bearing,u.k))}function Uo(u,e,a,n,c){const d=c.padding,m=et(c.worldSize,a.getNorthWest()),y=et(c.worldSize,a.getNorthEast()),x=et(c.worldSize,a.getSouthEast()),w=et(c.worldSize,a.getSouthWest()),T=h.ag(-n),M=m.rotate(T),P=y.rotate(T),A=x.rotate(T),D=w.rotate(T),O=new h.P(Math.max(M.x,P.x,D.x,A.x),Math.max(M.y,P.y,D.y,A.y)),j=new h.P(Math.min(M.x,P.x,D.x,A.x),Math.min(M.y,P.y,D.y,A.y)),V=O.sub(j),$=(c.width-(d.left+d.right+e.left+e.right))/V.x,W=(c.height-(d.top+d.bottom+e.top+e.bottom))/V.y;if(W<0||$<0)return void Ci();const U=Math.min(h.ak(c.scale*Math.min($,W)),u.maxZoom),H=h.P.convert(u.offset),Y=new h.P((e.left-e.right)/2,(e.top-e.bottom)/2).rotate(h.ag(n)),Z=H.add(Y).mult(c.scale/h.ah(U));return{center:nt(c.worldSize,m.add(x).div(2).sub(Z)),zoom:U,bearing:n}}class we{get useGlobeControls(){return!1}handlePanInertia(e,a){const n=e.mag(),c=Math.abs(tt(a));return{easingOffset:e.mult(Math.min(.75*c/n,1)),easingCenter:a.center}}handleMapControlsRollPitchBearingZoom(e,a){e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta),e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta)}handleMapControlsPan(e,a,n){e.around.distSqr(a.centerPoint)<.01||a.setLocationAtPoint(n,e.around)}cameraForBoxAndBearing(e,a,n,c,d){return Uo(e,a,n,c,d)}handleJumpToCenterZoom(e,a){e.zoom!==(a.zoom!==void 0?+a.zoom:e.zoom)&&e.setZoom(+a.zoom),a.center!==void 0&&e.setCenter(h.S.convert(a.center))}handleEaseTo(e,a){const n=e.zoom,c=e.padding,d={roll:e.roll,pitch:e.pitch,bearing:e.bearing},m={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},y=a.zoom!==void 0,x=!e.isPaddingEqual(a.padding);let w=!1;const T=y?+a.zoom:e.zoom;let M=e.centerPoint.add(a.offsetAsPoint);const P=e.screenPointToLocation(M),{center:A,zoom:D}=e.constrain(h.S.convert(a.center||P),T??n);He(e,A);const O=et(e.worldSize,P),j=et(e.worldSize,A).sub(O),V=h.ah(D-n);return w=D!==n,{easeFunc:$=>{if(w&&e.setZoom(h.C.number(n,D,$)),h.be(d,m)||fn({startEulerAngles:d,endEulerAngles:m,tr:e,k:$,useSlerp:d.roll!=m.roll}),x&&(e.interpolatePadding(c,a.padding,$),M=e.centerPoint.add(a.offsetAsPoint)),a.around)e.setLocationAtPoint(a.around,a.aroundPoint);else{const W=h.ah(e.zoom-n),U=D>n?Math.min(2,V):Math.max(.5,V),H=Math.pow(U,1-$),Y=nt(e.worldSize,O.add(j.mult($*H)).mult(W));e.setLocationAtPoint(e.renderWorldCopies?Y.wrap():Y,M)}},isZooming:w,elevationCenter:A}}handleFlyTo(e,a){const n=a.zoom!==void 0,c=e.zoom,d=e.constrain(h.S.convert(a.center||a.locationAtOffset),n?+a.zoom:c),m=d.center,y=d.zoom;He(e,m);const x=et(e.worldSize,a.locationAtOffset),w=et(e.worldSize,m).sub(x),T=w.mag(),M=h.ah(y-c);let P;if(a.minZoom!==void 0){const A=Math.min(+a.minZoom,c,y),D=e.constrain(m,A).zoom;P=h.ah(D-c)}return{easeFunc:(A,D,O,j)=>{e.setZoom(A===1?y:c+h.ak(D));const V=A===1?m:nt(e.worldSize,x.add(w.mult(O)).mult(D));e.setLocationAtPoint(e.renderWorldCopies?V.wrap():V,j)},scaleOfZoom:M,targetCenter:m,scaleOfMinZoom:P,pixelPathLength:T}}}class le{constructor(e,a,n){this.blendFunction=e,this.blendColor=a,this.mask=n}}le.Replace=[1,0],le.disabled=new le(le.Replace,h.bf.transparent,[!1,!1,!1,!1]),le.unblended=new le(le.Replace,h.bf.transparent,[!0,!0,!0,!0]),le.alphaBlended=new le([1,771],h.bf.transparent,[!0,!0,!0,!0]);const Pr=2305;class ie{constructor(e,a,n){this.enable=e,this.mode=a,this.frontFace=n}}ie.disabled=new ie(!1,1029,Pr),ie.backCCW=new ie(!0,1029,Pr),ie.frontCCW=new ie(!0,1028,Pr);class Ot{constructor(e,a,n){this.func=e,this.mask=a,this.range=n}}Ot.ReadOnly=!1,Ot.ReadWrite=!0,Ot.disabled=new Ot(519,Ot.ReadOnly,[0,1]);const as=7680;class Yt{constructor(e,a,n,c,d,m){this.test=e,this.ref=a,this.mask=n,this.fail=c,this.depthFail=d,this.pass=m}}Yt.disabled=new Yt({func:519,mask:0},0,0,as,as,as);const mn=new WeakMap;function nr(u){var e;if(mn.has(u))return mn.get(u);{const a=(e=u.getParameter(u.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return mn.set(u,a),a}}class $o{get awaitingQuery(){return!!this._readbackQueue}constructor(e){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=e;const a=e.context,n=a.gl;this._texFormat=n.RGBA,this._texType=n.UNSIGNED_BYTE;const c=new h.aL;c.emplaceBack(-1,-1),c.emplaceBack(2,-1),c.emplaceBack(-1,2);const d=new h.aN;d.emplaceBack(0,1,2),this._fullscreenTriangle=new Xi(a.createVertexBuffer(c,Ut.members),a.createIndexBuffer(d),h.aM.simpleSegment(0,0,c.length,d.length)),this._resultBuffer=new Uint8Array(4),a.activeTexture.set(n.TEXTURE1);const m=n.createTexture();n.bindTexture(n.TEXTURE_2D,m),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texImage2D(n.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=a.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(m),nr(n)&&(this._pbo=n.createBuffer(),n.bindBuffer(n.PIXEL_PACK_BUFFER,this._pbo),n.bufferData(n.PIXEL_PACK_BUFFER,4,n.STREAM_READ),n.bindBuffer(n.PIXEL_PACK_BUFFER,null))}destroy(){const e=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),e.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(e,a){const n=this._updateCount;return this._readbackQueue?n>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():n>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(e,a),this._updateCount++,this._measuredError}_bindFramebuffer(){const e=this._cachedRenderContext.context,a=e.gl;e.activeTexture.set(a.TEXTURE1),a.bindTexture(a.TEXTURE_2D,this._fbo.colorAttachment.get()),e.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(e,a){const n=this._cachedRenderContext.context,c=n.gl;if(this._bindFramebuffer(),n.viewport.set([0,0,this._texWidth,this._texHeight]),n.clear({color:h.bf.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(n,c.TRIANGLES,Ot.disabled,Yt.disabled,le.unblended,ie.disabled,((d,m)=>({u_input:d,u_output_expected:m}))(e,a),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&nr(c)){c.bindBuffer(c.PIXEL_PACK_BUFFER,this._pbo),c.readBuffer(c.COLOR_ATTACHMENT0),c.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null);const d=c.fenceSync(c.SYNC_GPU_COMMANDS_COMPLETE,0);c.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:d}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const e=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&nr(e)){const a=e.clientWaitSync(this._readbackQueue.sync,0,0);if(a===e.WAIT_FAILED)return h.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(a===e.TIMEOUT_EXPIRED)return;e.bindBuffer(e.PIXEL_PACK_BUFFER,this._pbo),e.getBufferSubData(e.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),e.bindBuffer(e.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),e.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=$o._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(e){let a=0;return a+=e[0]/256,a+=e[1]/65536,a+=e[2]/16777216,e[3]<127&&(a=-a),a/128}}const uo=h.$/128;function Aa(u,e){const a=u.granularity!==void 0?Math.max(u.granularity,1):1,n=a+(u.generateBorders?2:0),c=a+(u.extendToNorthPole||u.generateBorders?1:0)+(u.extendToSouthPole||u.generateBorders?1:0),d=n+1,m=c+1,y=u.generateBorders?-1:0,x=u.generateBorders||u.extendToNorthPole?-1:0,w=a+(u.generateBorders?1:0),T=a+(u.generateBorders||u.extendToSouthPole?1:0),M=d*m,P=n*c*6,A=d*m>65536;if(A&&e==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const D=A||e==="32bit",O=new Int16Array(2*M);let j=0;for(let W=x;W<=T;W++)for(let U=y;U<=w;U++){let H=U/a*h.$;U===-1&&(H=-uo),U===a+1&&(H=h.$+uo);let Y=W/a*h.$;W===-1&&(Y=u.extendToNorthPole?h.bh:-uo),W===a+1&&(Y=u.extendToSouthPole?h.bi:h.$+uo),O[j++]=H,O[j++]=Y}const V=D?new Uint32Array(P):new Uint16Array(P);let $=0;for(let W=0;W<c;W++)for(let U=0;U<n;U++){const H=U+1+W*d,Y=U+(W+1)*d,Z=U+1+(W+1)*d;V[$++]=U+W*d,V[$++]=Y,V[$++]=H,V[$++]=H,V[$++]=Y,V[$++]=Z}return{vertices:O.buffer.slice(0),indices:V.buffer.slice(0),uses32bitIndices:D}}const za=new h.aK({fill:new h.bj(128,2),line:new h.bj(512,0),tile:new h.bj(128,32),stencil:new h.bj(128,1),circle:3});class ss{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return sr.projectionGlobe}get vertexShaderPreludeCode(){return sr.projectionMercator.vertexSource}get subdivisionGranularity(){return za}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(e){this._errorMeasurement||(this._errorMeasurement=new $o(e));const a=h.U(this._errorQueryLatitudeDegrees),n=2*Math.atan(Math.exp(Math.PI-a*Math.PI*2))-.5*Math.PI,c=this._errorMeasurement.updateErrorLoop(a,n),d=Zt();c!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=c,this._errorMeasurementLastChangeTime=d);const m=Math.min(Math.max((d-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=h.bk(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,h.bl(m))}_getMeshKey(e){return`${e.granularity.toString(36)}_${e.generateBorders?"b":""}${e.extendToNorthPole?"n":""}${e.extendToSouthPole?"s":""}`}getMeshFromTileID(e,a,n,c,d){const m=(d==="stencil"?za.stencil:za.tile).getGranularityForZoomLevel(a.z);return this._getMesh(e,{granularity:m,generateBorders:n,extendToNorthPole:a.y===0&&c,extendToSouthPole:a.y===(1<<a.z)-1&&c})}_getMesh(e,a){const n=this._getMeshKey(a);if(n in this._tileMeshCache)return this._tileMeshCache[n];const c=(function(d,m){const y=Aa(m,"16bit"),x=h.aL.deserialize({arrayBuffer:y.vertices,length:y.vertices.byteLength/2/2}),w=h.aN.deserialize({arrayBuffer:y.indices,length:y.indices.byteLength/2/3});return new Xi(d.createVertexBuffer(x,Ut.members),d.createIndexBuffer(w),h.aM.simpleSegment(0,0,x.length,w.length))})(e,a);return this._tileMeshCache[n]=c,c}recalculate(e){}hasTransition(){const e=Zt();let a=!1;return a=a||(e-this._errorMeasurementLastChangeTime)/1e3<.7,a=a||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,a}setErrorQueryLatitudeDegrees(e){this._errorQueryLatitudeDegrees=e}}const ns=new h.r({type:new h.D(h.v.projection.type)});class ls extends h.E{constructor(e){super(),this._transitionable=new h.t(ns,void 0),this.setProjection(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new h.F(0)),this._mercatorProjection=new Ca,this._verticalPerspectiveProjection=new ss}get transitionState(){const e=this.properties.get("type");if(typeof e=="string"&&e==="mercator")return 0;if(typeof e=="string"&&e==="vertical-perspective")return 1;if(e instanceof h.bm){if(e.from==="vertical-perspective"&&e.to==="mercator")return 1-e.transition;if(e.from==="mercator"&&e.to==="vertical-perspective")return e.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(e){this._mercatorProjection.updateGPUdependent(e),this._verticalPerspectiveProjection.updateGPUdependent(e)}getMeshFromTileID(e,a,n,c,d){return this.currentProjection.getMeshFromTileID(e,a,n,c,d)}setProjection(e){this._transitionable.setValue("type",e?.type||"mercator")}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}setErrorQueryLatitudeDegrees(e){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(e),this._mercatorProjection.setErrorQueryLatitudeDegrees(e)}}function cs(u){const e=jr(u.worldSize,u.center.lat);return 2*Math.PI*e}function Ki(u,e,a,n,c){const d=1/(1<<c),m=e/h.$*d+n*d,y=h.bo((u/h.$*d+a*d)*Math.PI*2+Math.PI,2*Math.PI),x=2*Math.atan(Math.exp(Math.PI-m*Math.PI*2))-.5*Math.PI,w=Math.cos(x),T=new Float64Array(3);return T[0]=Math.sin(y)*w,T[1]=Math.sin(x),T[2]=Math.cos(y)*w,T}function Ue(u){return(function(e,a){const n=Math.cos(a),c=new Float64Array(3);return c[0]=Math.sin(e)*n,c[1]=Math.sin(a),c[2]=Math.cos(e)*n,c})(u.lng*Math.PI/180,u.lat*Math.PI/180)}function jr(u,e){return u/(2*Math.PI)/Math.cos(e*Math.PI/180)}function Tl(u){const e=Math.asin(u[1])/Math.PI*180,a=Math.sqrt(u[0]*u[0]+u[2]*u[2]);if(a>1e-6){const n=u[0]/a,c=Math.acos(u[2]/a),d=(n>0?c:-c)/Math.PI*180;return new h.S(h.aO(d,-180,180),e)}return new h.S(0,e)}function Zo(u){return Math.cos(u*Math.PI/180)}function $e(u,e){const a=Zo(u),n=Zo(e);return h.ak(n/a)}function Sl(u,e){const a=u.rotate(e.bearingInRadians),n=e.zoom+$e(e.center.lat,0),c=h.bk(1/Zo(e.center.lat),1/Zo(Math.min(Math.abs(e.center.lat),60)),h.bn(n,7,3,0,1)),d=360/cs({worldSize:e.worldSize,center:{lat:e.center.lat}});return new h.S(e.center.lng-a.x*d*c,h.ae(e.center.lat+a.y*d,-h.af,h.af))}function _n(u){const e=.5*u,a=Math.sin(e),n=Math.cos(e);return Math.log(a+n)-Math.log(n-a)}function bi(u,e,a,n){const c=u.lat+a*n;if(Math.abs(a)>1){const d=(Math.sign(u.lat+a)!==Math.sign(u.lat)?-Math.abs(u.lat):Math.abs(u.lat))*Math.PI/180,m=Math.abs(u.lat+a)*Math.PI/180,y=_n(d+n*(m-d)),x=_n(d),w=_n(m);return new h.S(u.lng+e*((y-x)/(w-x)),c)}return new h.S(u.lng+e*n,c)}class gn{constructor(e){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._boundingVolumeFactory=e}swapBuffers(){if(!this._hadAnyChanges)return;const e=this._cachePrevious;this._cachePrevious=this._cache,this._cache=e,this._cache.clear(),this._hadAnyChanges=!1}getTileBoundingVolume(e,a,n,c){const d=`${e.z}_${e.x}_${e.y}_${c?.terrain?"t":""}`,m=this._cache.get(d);if(m)return m;const y=this._cachePrevious.get(d);if(y)return this._cache.set(d,y),y;const x=this._boundingVolumeFactory(e,a,n,c);return this._cache.set(d,x),this._hadAnyChanges=!0,x}}class wi{constructor(e,a,n,c){this.min=n,this.max=c,this.points=e,this.planes=a}static fromAabb(e,a){const n=[];for(let c=0;c<8;c++)n.push([1&~c?e[0]:a[0],(c>>1&1)==1?a[1]:e[1],(c>>2&1)==1?a[2]:e[2]]);return new wi(n,[[-1,0,0,a[0]],[1,0,0,-e[0]],[0,-1,0,a[1]],[0,1,0,-e[1]],[0,0,-1,a[2]],[0,0,1,-e[2]]],e,a)}static fromCenterSizeAngles(e,a,n){const c=h.br([],n[0],n[1],n[2]),d=h.bs([],[a[0],0,0],c),m=h.bs([],[0,a[1],0],c),y=h.bs([],[0,0,a[2]],c),x=[...e],w=[...e];for(let M=0;M<8;M++)for(let P=0;P<3;P++){const A=e[P]+d[P]*(1&~M?-1:1)+m[P]*((M>>1&1)==1?1:-1)+y[P]*((M>>2&1)==1?1:-1);x[P]=Math.min(x[P],A),w[P]=Math.max(w[P],A)}const T=[];for(let M=0;M<8;M++){const P=[...e];h.aS(P,P,h.aR([],d,1&~M?-1:1)),h.aS(P,P,h.aR([],m,(M>>1&1)==1?1:-1)),h.aS(P,P,h.aR([],y,(M>>2&1)==1?1:-1)),T.push(P)}return new wi(T,[[...d,-h.aX(d,T[0])],[...m,-h.aX(m,T[0])],[...y,-h.aX(y,T[0])],[-d[0],-d[1],-d[2],-h.aX(d,T[7])],[-m[0],-m[1],-m[2],-h.aX(m,T[7])],[-y[0],-y[1],-y[2],-h.aX(y,T[7])]],x,w)}intersectsFrustum(e){let a=!0;const n=this.points.length,c=this.planes.length,d=e.planes.length,m=e.points.length;for(let y=0;y<d;y++){const x=e.planes[y];let w=0;for(let T=0;T<n;T++){const M=this.points[T];x[0]*M[0]+x[1]*M[1]+x[2]*M[2]+x[3]>=0&&w++}if(w===0)return 0;w<n&&(a=!1)}if(a)return 2;for(let y=0;y<c;y++){const x=this.planes[y];let w=0;for(let T=0;T<m;T++){const M=e.points[T];x[0]*M[0]+x[1]*M[1]+x[2]*M[2]+x[3]>=0&&w++}if(w===0)return 0}return 1}intersectsPlane(e){const a=this.points.length;let n=0;for(let c=0;c<a;c++){const d=this.points[c];e[0]*d[0]+e[1]*d[1]+e[2]*d[2]+e[3]>=0&&n++}return n===a?2:n===0?0:1}}function po(u,e,a){const n=u-e;return n<0?-n:Math.max(0,n-a)}function hs(u,e,a,n,c){const d=u-a;let m;return m=d<0?Math.min(-d,1+d-c):d>1?Math.min(Math.max(d-c,0),1-d):0,Math.max(m,po(e,n,c))}class Pl{constructor(){this._boundingVolumeCache=new gn(this._computeTileBoundingVolume)}prepareNextFrame(){this._boundingVolumeCache.swapBuffers()}distanceToTile2d(e,a,n,c){const d=1<<n.z,m=1/d,y=n.x/d,x=n.y/d;let w=2;return w=Math.min(w,hs(e,a,y,x,m)),w=Math.min(w,hs(e,a,y+.5,-x-m,m)),w=Math.min(w,hs(e,a,y+.5,2-x-m,m)),w}getWrap(e,a,n){const c=1<<a.z,d=1/c,m=a.x/c,y=po(e.x,m,d),x=po(e.x,m-1,d),w=po(e.x,m+1,d),T=Math.min(y,x,w);return T===w?1:T===x?-1:0}allowVariableZoom(e,a){return ye(e,a)>4}allowWorldCopies(){return!1}getTileBoundingVolume(e,a,n,c){return this._boundingVolumeCache.getTileBoundingVolume(e,a,n,c)}_computeTileBoundingVolume(e,a,n,c){var d,m;let y=0,x=0;if(c?.terrain){const w=new h.Z(e.z,a,e.z,e.x,e.y),T=c.terrain.getMinMaxElevation(w);y=(d=T.minElevation)!==null&&d!==void 0?d:Math.min(0,n),x=(m=T.maxElevation)!==null&&m!==void 0?m:Math.max(0,n)}if(y/=h.bu,x/=h.bu,y+=1,x+=1,e.z<=0)return wi.fromAabb([-x,-x,-x],[x,x,x]);if(e.z===1)return wi.fromAabb([e.x===0?-x:0,e.y===0?0:-x,-x],[e.x===0?0:x,e.y===0?x:0,x]);{const w=[Ki(0,0,e.x,e.y,e.z),Ki(h.$,0,e.x,e.y,e.z),Ki(h.$,h.$,e.x,e.y,e.z),Ki(0,h.$,e.x,e.y,e.z)],T=[];for(const st of w)T.push(h.aR([],st,x));if(x!==y)for(const st of w)T.push(h.aR([],st,y));e.y===0&&T.push([0,1,0]),e.y===(1<<e.z)-1&&T.push([0,-1,0]);const M=[1,1,1],P=[-1,-1,-1];for(const st of T)for(let ct=0;ct<3;ct++)M[ct]=Math.min(M[ct],st[ct]),P[ct]=Math.max(P[ct],st[ct]);const A=Ki(h.$/2,h.$/2,e.x,e.y,e.z),D=h.aW([],[0,1,0],A);h.aV(D,D);const O=h.aW([],A,D);h.aV(O,O);const j=h.aW([],w[2],w[1]);h.aV(j,j);const V=h.aW([],w[0],w[3]);h.aV(V,V),T.push(h.aR([],A,x)),e.y>=(1<<e.z)/2&&T.push(h.aR([],Ki(h.$/2,0,e.x,e.y,e.z),x)),e.y<(1<<e.z)/2&&T.push(h.aR([],Ki(h.$/2,h.$,e.x,e.y,e.z),x));const $=fo(A,T),W=fo(O,T),U=[-A[0],-A[1],-A[2],$.max],H=[A[0],A[1],A[2],-$.min],Y=[-O[0],-O[1],-O[2],W.max],Z=[O[0],O[1],O[2],-W.min],J=[...j,0],lt=[...V,0],ot=[];return e.y===0?ot.push(h.bt(lt,J,U),h.bt(lt,J,H)):ot.push(h.bt(Y,J,U),h.bt(Y,J,H),h.bt(Y,lt,U),h.bt(Y,lt,H)),e.y===(1<<e.z)-1?ot.push(h.bt(lt,J,U),h.bt(lt,J,H)):ot.push(h.bt(Z,J,U),h.bt(Z,J,H),h.bt(Z,lt,U),h.bt(Z,lt,H)),new wi(ot,[U,H,Y,Z,J,lt],M,P)}}}function fo(u,e){let a=1/0,n=-1/0;for(const c of e){const d=h.aX(u,c);a=Math.min(a,d),n=Math.max(n,d)}return{min:a,max:n}}class us{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,n){return this._helper.interpolatePadding(e,a,n)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a){this._helper.resize(e,a)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrain(e){this._helper.setConstrain(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(e){}constructor(e){this._cachedClippingPlane=h.bv(),this._projectionMatrix=h.b9(),this._globeViewProjMatrix32f=h.b8(),this._globeViewProjMatrixNoCorrection=h.b9(),this._globeViewProjMatrixNoCorrectionInverted=h.b9(),this._globeProjMatrixInverted=h.b9(),this._cameraPosition=h.bp(),this._globeLatitudeErrorCorrectionRadians=0,this.defaultConstrain=(a,n)=>{const c=h.ae(a.lat,-h.af,h.af),d=h.ae(+n,this.minZoom+$e(0,c),this.maxZoom);return{center:new h.S(a.lng,c),zoom:d}},this._helper=new Ne({calcMatrices:()=>{this._calcMatrices()},constrain:(a,n)=>this.defaultConstrain(a,n)},e),this._coveringTilesDetailsProvider=new Pl}clone(){const e=new us;return e.apply(this),e}apply(e,a){this._globeLatitudeErrorCorrectionRadians=a||0,this._helper.apply(e)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const e=h.bp();return e[0]=this._cameraPosition[0],e[1]=this._cameraPosition[1],e[2]=this._cameraPosition[2],e}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(e){const{overscaledTileID:a,applyGlobeMatrix:n}=e,c=this._helper.getMercatorTileCoordinates(a);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:c,clippingPlane:this._cachedClippingPlane,projectionTransition:n?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(e){const a=this.pitchInRadians,n=this.cameraToCenterDistance/e,c=Math.sin(a)*n,d=Math.cos(a)*n+1,m=1/Math.sqrt(c*c+d*d)*1;let y=-c,x=d;const w=Math.sqrt(y*y+x*x);y/=w,x/=w;const T=[0,y,x];h.bw(T,T,[0,0,0],-this.bearingInRadians),h.bx(T,T,[0,0,0],-1*this.center.lat*Math.PI/180),h.by(T,T,[0,0,0],this.center.lng*Math.PI/180);const M=1/h.aZ(T);return h.aR(T,T,M),[...T,-m*M]}isLocationOccluded(e){return!this.isSurfacePointVisible(Ue(e))}transformLightDirection(e){const a=this._helper._center.lng*Math.PI/180,n=this._helper._center.lat*Math.PI/180,c=Math.cos(n),d=[Math.sin(a)*c,Math.sin(n),Math.cos(a)*c],m=[d[2],0,-d[0]],y=[0,0,0];h.aW(y,m,d),h.aV(m,m),h.aV(y,y);const x=[0,0,0];return h.aV(x,[m[0]*e[0]+y[0]*e[1]+d[0]*e[2],m[1]*e[0]+y[1]*e[1]+d[1]*e[2],m[2]*e[0]+y[2]*e[1]+d[2]*e[2]]),x}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(e,a,n){const c=(function(y,x,w){const T=1/(1<<w.z);return new h.a1(y/h.$*T+w.x*T,x/h.$*T+w.y*T)})(e,a,n.canonical),d=(m=c.y,[h.bo(c.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-m*Math.PI*2))-.5*Math.PI]);var m;return this.getCircleRadiusCorrection()/Math.cos(d[1])}projectTileCoordinates(e,a,n,c){const d=n.canonical,m=Ki(e,a,d.x,d.y,d.z),y=1+(c?c(e,a):0)/h.bu,x=[m[0]*y,m[1]*y,m[2]*y,1];h.aw(x,x,this._globeViewProjMatrixNoCorrection);const w=this._cachedClippingPlane,T=w[0]*m[0]+w[1]*m[1]+w[2]*m[2]+w[3]<0;return{point:new h.P(x[0]/x[3],x[1]/x[3]),signedDistanceFromCamera:x[3],isOccluded:T}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const e=jr(this.worldSize,this.center.lat),a=h.ba(),n=h.ba();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*e),h.b4(a,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const c=this.centerOffset;a[8]=2*-c.x/this._helper._width,a[9]=2*c.y/this._helper._height,this._projectionMatrix=h.b5(a),this._globeProjMatrixInverted=h.ba(),h.aq(this._globeProjMatrixInverted,a),h.M(a,a,[0,0,-this.cameraToCenterDistance]),h.b6(a,a,this.rollInRadians),h.b7(a,a,-this.pitchInRadians),h.b6(a,a,this.bearingInRadians),h.M(a,a,[0,0,-e]);const d=h.bp();d[0]=e,d[1]=e,d[2]=e,h.b7(n,a,this.center.lat*Math.PI/180),h.bz(n,n,-this.center.lng*Math.PI/180),h.N(n,n,d),this._globeViewProjMatrixNoCorrection=n,h.b7(a,a,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),h.bz(a,a,-this.center.lng*Math.PI/180),h.N(a,a,d),this._globeViewProjMatrix32f=new Float32Array(a),this._globeViewProjMatrixNoCorrectionInverted=h.ba(),h.aq(this._globeViewProjMatrixNoCorrectionInverted,n);const m=h.bp();this._cameraPosition=h.bp(),this._cameraPosition[2]=this.cameraToCenterDistance/e,h.bw(this._cameraPosition,this._cameraPosition,m,-this.rollInRadians),h.bx(this._cameraPosition,this._cameraPosition,m,this.pitchInRadians),h.bw(this._cameraPosition,this._cameraPosition,m,-this.bearingInRadians),h.aS(this._cameraPosition,this._cameraPosition,[0,0,1]),h.bx(this._cameraPosition,this._cameraPosition,m,-this.center.lat*Math.PI/180),h.by(this._cameraPosition,this._cameraPosition,m,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(e);const y=h.b5(this._globeViewProjMatrixNoCorrectionInverted);h.N(y,y,[1,1,-1]),this._cachedFrustum=ai.fromInvProjectionMatrix(y,1,0,this._cachedClippingPlane,!0)}calculateFogMatrix(e){h.w("calculateFogMatrix is not supported on globe projection.");const a=h.ba();return h.ai(a),a}getVisibleUnwrappedCoordinates(e){return[new h.b2(0,e)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(e){e&&h.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){if(!this._globeViewProjMatrixNoCorrection)return 1;const n=Ue(e);h.aR(n,n,1+a/h.bu);const c=h.bv();return h.aw(c,[n[0],n[1],n[2],1],this._globeViewProjMatrixNoCorrection),c[2]/c[3]}populateCache(e){}getBounds(){const e=.5*this.width,a=.5*this.height,n=[new h.P(0,0),new h.P(e,0),new h.P(this.width,0),new h.P(this.width,a),new h.P(this.width,this.height),new h.P(e,this.height),new h.P(0,this.height),new h.P(0,a)],c=[];for(const M of n)c.push(this.unprojectScreenPoint(M));let d=0,m=0,y=0,x=0;const w=this.center;for(const M of c){const P=h.bA(w.lng,M.lng),A=h.bA(w.lat,M.lat);P<m&&(m=P),P>d&&(d=P),A<x&&(x=A),A>y&&(y=A)}const T=[w.lng+m,w.lat+x,w.lng+d,w.lat+y];return this.isSurfacePointOnScreen([0,1,0])&&(T[3]=90,T[0]=-180,T[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(T[1]=-90,T[0]=-180,T[2]=180),new fe(T)}calculateCenterFromCameraLngLatAlt(e,a,n,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,n,c)}setLocationAtPoint(e,a){const n=Ue(this.unprojectScreenPoint(a)),c=Ue(e),d=h.bp();h.bB(d);const m=h.bp();h.by(m,n,d,-this.center.lng*Math.PI/180),h.bx(m,m,d,this.center.lat*Math.PI/180);const y=c[0]*c[0]+c[2]*c[2],x=m[0]*m[0];if(y<x)return;const w=Math.sqrt(y-x),T=-w,M=h.bC(c[0],c[2],m[0],w),P=h.bC(c[0],c[2],m[0],T),A=h.bp();h.by(A,c,d,-M);const D=h.bC(A[1],A[2],m[1],m[2]),O=h.bp();h.by(O,c,d,-P);const j=h.bC(O[1],O[2],m[1],m[2]),V=.5*Math.PI,$=D>=-V&&D<=V,W=j>=-V&&j<=V;let U,H;if($&&W){const lt=this.center.lng*Math.PI/180,ot=this.center.lat*Math.PI/180;h.bD(M,lt)+h.bD(D,ot)<h.bD(P,lt)+h.bD(j,ot)?(U=M,H=D):(U=P,H=j)}else if($)U=M,H=D;else{if(!W)return;U=P,H=j}const Y=U/Math.PI*180,Z=H/Math.PI*180,J=this.center.lat;this.setCenter(new h.S(Y,h.ae(Z,-90,90))),this.setZoom(this.zoom+$e(J,this.center.lat))}locationToScreenPoint(e,a){const n=Ue(e);if(a){const c=a.getElevationForLngLatZoom(e,this._helper._tileZoom);h.aR(n,n,1+c/h.bu)}return this._projectSurfacePointToScreen(n)}_projectSurfacePointToScreen(e){const a=h.bv();return h.aw(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],new h.P((.5*a[0]+.5)*this.width,(.5*-a[1]+.5)*this.height)}screenPointToMercatorCoordinate(e,a){if(a){const n=a.pointCoordinate(e);if(n)return n}return h.a1.fromLngLat(this.unprojectScreenPoint(e))}screenPointToLocation(e,a){var n;return(n=this.screenPointToMercatorCoordinate(e,a))===null||n===void 0?void 0:n.toLngLat()}isPointOnMapSurface(e,a){const n=this._cameraPosition,c=this.getRayDirectionFromPixel(e);return!!this.rayPlanetIntersection(n,c)}getRayDirectionFromPixel(e){const a=h.bv();a[0]=e.x/this.width*2-1,a[1]=-1*(e.y/this.height*2-1),a[2]=1,a[3]=1,h.aw(a,a,this._globeViewProjMatrixNoCorrectionInverted),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];const n=h.bp();n[0]=a[0]-this._cameraPosition[0],n[1]=a[1]-this._cameraPosition[1],n[2]=a[2]-this._cameraPosition[2];const c=h.bp();return h.aV(c,n),c}isSurfacePointVisible(e){const a=this._cachedClippingPlane;return a[0]*e[0]+a[1]*e[1]+a[2]*e[2]+a[3]>=0}isSurfacePointOnScreen(e){if(!this.isSurfacePointVisible(e))return!1;const a=h.bv();return h.aw(a,[...e,1],this._globeViewProjMatrixNoCorrection),a[0]/=a[3],a[1]/=a[3],a[2]/=a[3],a[0]>-1&&a[0]<1&&a[1]>-1&&a[1]<1&&a[2]>-1&&a[2]<1}rayPlanetIntersection(e,a){const n=h.aX(e,a),c=h.bp(),d=h.bp();h.aR(d,a,n),h.aU(c,e,d);const m=1-h.aX(c,c);if(m<0)return null;const y=h.aX(e,e)-1,x=-n+(n<0?1:-1)*Math.sqrt(m),w=y/x,T=x;return{tMin:Math.min(w,T),tMax:Math.max(w,T)}}unprojectScreenPoint(e){const a=this._cameraPosition,n=this.getRayDirectionFromPixel(e),c=this.rayPlanetIntersection(a,n);if(c){const T=h.bp();h.aS(T,a,[n[0]*c.tMin,n[1]*c.tMin,n[2]*c.tMin]);const M=h.bp();return h.aV(M,T),Tl(M)}const d=this._cachedClippingPlane,m=d[0]*n[0]+d[1]*n[1]+d[2]*n[2],y=-h.b1(d,a)/m,x=h.bp();if(y>0)h.aS(x,a,[n[0]*y,n[1]*y,n[2]*y]);else{const T=h.bp();h.aS(T,a,[2*n[0],2*n[1],2*n[2]]);const M=h.b1(this._cachedClippingPlane,T);h.aU(x,T,[this._cachedClippingPlane[0]*M,this._cachedClippingPlane[1]*M,this._cachedClippingPlane[2]*M])}const w=(function(T){const M=h.bp();return M[0]=T[0]*-T[3],M[1]=T[1]*-T[3],M[2]=T[2]*-T[3],{center:M,radius:Math.sqrt(1-T[3]*T[3])}})(d);return Tl((function(T,M,P){const A=h.bp();h.aU(A,P,T);const D=h.bp();return h.bq(D,T,A,M/h.a$(A)),D})(w.center,w.radius,x))}getMatrixForModel(e,a){const n=h.S.convert(e),c=1/h.bu,d=h.b9();return h.bz(d,d,n.lng/180*Math.PI),h.b7(d,d,-n.lat/180*Math.PI),h.M(d,d,[0,0,1+a/h.bu]),h.b7(d,d,.5*Math.PI),h.N(d,d,[c,c,c]),d}getProjectionDataForCustomLayer(e=!0){const a=this.getProjectionData({overscaledTileID:new h.Z(0,0,0,0,0),applyGlobeMatrix:e});return a.tileMercatorCoords=[0,0,1,1],a}getFastPathSimpleProjectionMatrix(e){}}class ds{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(e){this._helper.setMinZoom(e)}setMaxZoom(e){this._helper.setMaxZoom(e)}setMinPitch(e){this._helper.setMinPitch(e)}setMaxPitch(e){this._helper.setMaxPitch(e)}setRenderWorldCopies(e){this._helper.setRenderWorldCopies(e)}setBearing(e){this._helper.setBearing(e)}setPitch(e){this._helper.setPitch(e)}setRoll(e){this._helper.setRoll(e)}setFov(e){this._helper.setFov(e)}setZoom(e){this._helper.setZoom(e)}setCenter(e){this._helper.setCenter(e)}setElevation(e){this._helper.setElevation(e)}setMinElevationForCurrentTile(e){this._helper.setMinElevationForCurrentTile(e)}setPadding(e){this._helper.setPadding(e)}interpolatePadding(e,a,n){return this._helper.interpolatePadding(e,a,n)}isPaddingEqual(e){return this._helper.isPaddingEqual(e)}resize(e,a,n=!0){this._helper.resize(e,a,n)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(e){this._helper.setMaxBounds(e)}setConstrain(e){this._helper.setConstrain(e)}overrideNearFarZ(e,a){this._helper.overrideNearFarZ(e,a)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(e){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),e)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get constrain(){return this._helper.constrain}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(e,a){this._globeness=e,this._globeLatitudeErrorCorrectionRadians=a,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().prepareNextFrame(),this._mercatorTransform.getCoveringTilesDetailsProvider().prepareNextFrame()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(e){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this.defaultConstrain=(a,n)=>this.currentTransform.defaultConstrain(a,n),this._helper=new Ne({calcMatrices:()=>{this._calcMatrices()},constrain:(a,n)=>this.defaultConstrain(a,n)},e),this._globeness=1,this._mercatorTransform=new si,this._verticalPerspectiveTransform=new us}clone(){const e=new ds;return e._globeness=this._globeness,e._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,e.apply(this),e}apply(e){this._helper.apply(e),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(e){const a=this._mercatorTransform.getProjectionData(e),n=this._verticalPerspectiveTransform.getProjectionData(e);return{mainMatrix:this.isGlobeRendering?n.mainMatrix:a.mainMatrix,clippingPlane:n.clippingPlane,tileMercatorCoords:n.tileMercatorCoords,projectionTransition:e.applyGlobeMatrix?this._globeness:0,fallbackMatrix:a.fallbackMatrix}}isLocationOccluded(e){return this.currentTransform.isLocationOccluded(e)}transformLightDirection(e){return this.currentTransform.transformLightDirection(e)}getPixelScale(){return h.bk(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return h.bk(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(e,a,n){const c=this._mercatorTransform.getPitchedTextCorrection(e,a,n),d=this._verticalPerspectiveTransform.getPitchedTextCorrection(e,a,n);return h.bk(c,d,this._globeness)}projectTileCoordinates(e,a,n,c){return this.currentTransform.projectTileCoordinates(e,a,n,c)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(e){return this.currentTransform.calculateFogMatrix(e)}getVisibleUnwrappedCoordinates(e){return this.currentTransform.getVisibleUnwrappedCoordinates(e)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(e){this._mercatorTransform.recalculateZoomAndCenter(e),this._verticalPerspectiveTransform.recalculateZoomAndCenter(e)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(e,a){return this.currentTransform.lngLatToCameraDepth(e,a)}populateCache(e){this._mercatorTransform.populateCache(e),this._verticalPerspectiveTransform.populateCache(e)}getBounds(){return this.currentTransform.getBounds()}calculateCenterFromCameraLngLatAlt(e,a,n,c){return this._helper.calculateCenterFromCameraLngLatAlt(e,a,n,c)}setLocationAtPoint(e,a){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(e,a),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(e,a),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(e,a){return this.currentTransform.locationToScreenPoint(e,a)}screenPointToMercatorCoordinate(e,a){return this.currentTransform.screenPointToMercatorCoordinate(e,a)}screenPointToLocation(e,a){return this.currentTransform.screenPointToLocation(e,a)}isPointOnMapSurface(e,a){return this.currentTransform.isPointOnMapSurface(e,a)}getRayDirectionFromPixel(e){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(e)}getMatrixForModel(e,a){return this.currentTransform.getMatrixForModel(e,a)}getProjectionDataForCustomLayer(e=!0){const a=this._mercatorTransform.getProjectionDataForCustomLayer(e);if(!this.isGlobeRendering)return a;const n=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(e);return n.fallbackMatrix=a.mainMatrix,n}getFastPathSimpleProjectionMatrix(e){return this.currentTransform.getFastPathSimpleProjectionMatrix(e)}}class Yi{get useGlobeControls(){return!0}handlePanInertia(e,a){const n=Sl(e,a);return Math.abs(n.lng-a.center.lng)>180&&(n.lng=a.center.lng+179.5*Math.sign(n.lng-a.center.lng)),{easingCenter:n,easingOffset:new h.P(0,0)}}handleMapControlsRollPitchBearingZoom(e,a){const n=e.around,c=a.screenPointToLocation(n);e.bearingDelta&&a.setBearing(a.bearing+e.bearingDelta),e.pitchDelta&&a.setPitch(a.pitch+e.pitchDelta),e.rollDelta&&a.setRoll(a.roll+e.rollDelta);const d=a.zoom;e.zoomDelta&&a.setZoom(a.zoom+e.zoomDelta);const m=a.zoom-d;if(m===0)return;const y=h.bA(a.center.lng,c.lng),x=y/(Math.abs(y/180)+1),w=h.bA(a.center.lat,c.lat),T=a.getRayDirectionFromPixel(n),M=a.cameraPosition,P=-1*h.aX(M,T),A=h.bp();h.aS(A,M,[T[0]*P,T[1]*P,T[2]*P]);const D=h.aZ(A)-1,O=Math.exp(.5*-Math.max(D-.3,0)),j=jr(a.worldSize,a.center.lat)/Math.min(a.width,a.height),V=h.bn(j,.9,.5,1,.25),$=(1-h.ah(-m))*Math.min(O,V),W=a.center.lat,U=a.zoom,H=new h.S(a.center.lng+x*$,h.ae(a.center.lat+w*$,-h.af,h.af));a.setLocationAtPoint(c,n);const Y=a.center,Z=h.bn(Math.abs(y),45,85,0,1),J=h.bn(j,.75,.35,0,1),lt=Math.pow(Math.max(Z,J),.25),ot=h.bA(Y.lng,H.lng),st=h.bA(Y.lat,H.lat);a.setCenter(new h.S(Y.lng+ot*lt,Y.lat+st*lt).wrap()),a.setZoom(U+$e(W,a.center.lat))}handleMapControlsPan(e,a,n){if(!e.panDelta)return;const c=a.center.lat,d=a.zoom;a.setCenter(Sl(e.panDelta,a).wrap()),a.setZoom(d+$e(c,a.center.lat))}cameraForBoxAndBearing(e,a,n,c,d){const m=Uo(e,a,n,c,d),y=a.left/d.width*2-1,x=(d.width-a.right)/d.width*2-1,w=a.top/d.height*-2+1,T=(d.height-a.bottom)/d.height*-2+1,M=h.bA(n.getWest(),n.getEast())<0,P=M?n.getEast():n.getWest(),A=M?n.getWest():n.getEast(),D=Math.max(n.getNorth(),n.getSouth()),O=Math.min(n.getNorth(),n.getSouth()),j=P+.5*h.bA(P,A),V=D+.5*h.bA(D,O),$=d.clone();$.setCenter(m.center),$.setBearing(m.bearing),$.setPitch(0),$.setRoll(0),$.setZoom(m.zoom);const W=$.modelViewProjectionMatrix,U=[Ue(n.getNorthWest()),Ue(n.getNorthEast()),Ue(n.getSouthWest()),Ue(n.getSouthEast()),Ue(new h.S(A,V)),Ue(new h.S(P,V)),Ue(new h.S(j,D)),Ue(new h.S(j,O))],H=Ue(m.center);let Y=Number.POSITIVE_INFINITY;for(const Z of U)y<0&&(Y=Yi.getLesserNonNegativeNonNull(Y,Yi.solveVectorScale(Z,H,W,"x",y))),x>0&&(Y=Yi.getLesserNonNegativeNonNull(Y,Yi.solveVectorScale(Z,H,W,"x",x))),w>0&&(Y=Yi.getLesserNonNegativeNonNull(Y,Yi.solveVectorScale(Z,H,W,"y",w))),T<0&&(Y=Yi.getLesserNonNegativeNonNull(Y,Yi.solveVectorScale(Z,H,W,"y",T)));if(Number.isFinite(Y)&&Y!==0)return m.zoom=$.zoom+h.ak(Y),m;Ci()}handleJumpToCenterZoom(e,a){const n=e.center.lat,c=e.constrain(a.center?h.S.convert(a.center):e.center,e.zoom).center;e.setCenter(c.wrap());const d=a.zoom!==void 0?+a.zoom:e.zoom+$e(n,c.lat);e.zoom!==d&&e.setZoom(d)}handleEaseTo(e,a){const n=e.zoom,c=e.center,d=e.padding,m={roll:e.roll,pitch:e.pitch,bearing:e.bearing},y={roll:a.roll===void 0?e.roll:a.roll,pitch:a.pitch===void 0?e.pitch:a.pitch,bearing:a.bearing===void 0?e.bearing:a.bearing},x=a.zoom!==void 0,w=!e.isPaddingEqual(a.padding);let T=!1;const M=a.center?h.S.convert(a.center):c,P=e.constrain(M,n).center;He(e,P);const A=e.clone();A.setCenter(P),A.setZoom(x?+a.zoom:n+$e(c.lat,M.lat)),A.setBearing(a.bearing);const D=new h.P(h.ae(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),h.ae(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));A.setLocationAtPoint(P,D);const O=(a.offset&&a.offsetAsPoint.mag())>0?A.center:P,j=x?+a.zoom:n+$e(c.lat,O.lat),V=n+$e(c.lat,0),$=j+$e(O.lat,0),W=h.bA(c.lng,O.lng),U=h.bA(c.lat,O.lat),H=h.ah($-V);return T=j!==n,{easeFunc:Y=>{if(h.be(m,y)||fn({startEulerAngles:m,endEulerAngles:y,tr:e,k:Y,useSlerp:m.roll!=y.roll}),w&&e.interpolatePadding(d,a.padding,Y),a.around)h.w("Easing around a point is not supported under globe projection."),e.setLocationAtPoint(a.around,a.aroundPoint);else{const Z=$>V?Math.min(2,H):Math.max(.5,H),J=Math.pow(Z,1-Y),lt=bi(c,W,U,Y*J);e.setCenter(lt.wrap())}if(T){const Z=h.C.number(V,$,Y)+$e(0,e.center.lat);e.setZoom(Z)}},isZooming:T,elevationCenter:O}}handleFlyTo(e,a){const n=a.zoom!==void 0,c=e.center,d=e.zoom,m=e.padding,y=!e.isPaddingEqual(a.padding),x=e.constrain(h.S.convert(a.center||a.locationAtOffset),d).center,w=n?+a.zoom:e.zoom+$e(e.center.lat,x.lat),T=e.clone();T.setCenter(x),T.setZoom(w),T.setBearing(a.bearing);const M=new h.P(h.ae(e.centerPoint.x+a.offsetAsPoint.x,0,e.width),h.ae(e.centerPoint.y+a.offsetAsPoint.y,0,e.height));T.setLocationAtPoint(x,M);const P=T.center;He(e,P);const A=(function(U,H,Y){const Z=Ue(H),J=Ue(Y),lt=h.aX(Z,J),ot=Math.acos(lt),st=cs(U);return ot/(2*Math.PI)*st})(e,c,P),D=d+$e(c.lat,0),O=w+$e(P.lat,0),j=h.ah(O-D);let V;if(typeof a.minZoom=="number"){const U=+a.minZoom+$e(P.lat,0),H=Math.min(U,D,O)+$e(0,P.lat),Y=e.constrain(P,H).zoom+$e(P.lat,0);V=h.ah(Y-D)}const $=h.bA(c.lng,P.lng),W=h.bA(c.lat,P.lat);return{easeFunc:(U,H,Y,Z)=>{const J=bi(c,$,W,Y);y&&e.interpolatePadding(m,a.padding,U);const lt=U===1?P:J;e.setCenter(lt.wrap());const ot=D+h.ak(H);e.setZoom(U===1?w:ot+$e(0,lt.lat))},scaleOfZoom:j,targetCenter:P,scaleOfMinZoom:V,pixelPathLength:A}}static solveVectorScale(e,a,n,c,d){const m=c==="x"?[n[0],n[4],n[8],n[12]]:[n[1],n[5],n[9],n[13]],y=[n[3],n[7],n[11],n[15]],x=e[0]*m[0]+e[1]*m[1]+e[2]*m[2],w=e[0]*y[0]+e[1]*y[1]+e[2]*y[2],T=a[0]*m[0]+a[1]*m[1]+a[2]*m[2],M=a[0]*y[0]+a[1]*y[1]+a[2]*y[2];return T+d*w===x+d*M||y[3]*(x-T)+m[3]*(M-w)+x*M==T*w?null:(T+m[3]-d*M-d*y[3])/(T-x-d*M+d*w)}static getLesserNonNegativeNonNull(e,a){return a!==null&&a>=0&&a<e?a:e}}class Ml{constructor(e){this._globe=e,this._mercatorCameraHelper=new we,this._verticalPerspectiveCameraHelper=new Yi}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(e,a){return this.currentHelper.handlePanInertia(e,a)}handleMapControlsRollPitchBearingZoom(e,a){return this.currentHelper.handleMapControlsRollPitchBearingZoom(e,a)}handleMapControlsPan(e,a,n){this.currentHelper.handleMapControlsPan(e,a,n)}cameraForBoxAndBearing(e,a,n,c,d){return this.currentHelper.cameraForBoxAndBearing(e,a,n,c,d)}handleJumpToCenterZoom(e,a){this.currentHelper.handleJumpToCenterZoom(e,a)}handleEaseTo(e,a){return this.currentHelper.handleEaseTo(e,a)}handleFlyTo(e,a){return this.currentHelper.handleFlyTo(e,a)}}const ps=(u,e)=>h.y(u,e&&e.filter((a=>a.identifier!=="source.canvas"))),Hc=h.bE();class Go extends h.E{constructor(e,a={}){var n,c;super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const y=this.sourceCaches[m].getSource().type;y!=="vector"&&y!=="geojson"||this.sourceCaches[m].reload()}},this.map=e,this.dispatcher=new Li(io(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",((m,y)=>this.getGlyphs(m,y))),this.dispatcher.registerMessageHandler("GI",((m,y)=>this.getImages(m,y))),this.dispatcher.registerMessageHandler("GDA",((m,y)=>this.getDashes(m,y))),this.imageManager=new to,this.imageManager.setEventedParent(this);const d=((n=e._container)===null||n===void 0?void 0:n.lang)||typeof document<"u"&&((c=document.documentElement)===null||c===void 0?void 0:c.lang)||void 0;this.glyphManager=new or(e._requestManager,a.localIdeographFontFamily,d),this.lineAtlas=new Wi(256,512),this.crossTileSymbolIndex=new ho,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new h.bF,this._loaded=!1,this._availableImages=[],this._globalState={},this._resetUpdates(),this.dispatcher.broadcast("SR",h.bG()),wr().on(Ui,this._rtlPluginLoaded),this.on("data",(m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const y=this.sourceCaches[m.sourceId];if(!y)return;const x=y.getSource();if(x&&x.vectorLayerIds)for(const w in this._layers){const T=this._layers[w];T.source===x.id&&this._validateLayer(T)}}))}setGlobalStateProperty(e,a){var n,c,d;this._checkLoaded();const m=a===null?(d=(c=(n=this.stylesheet.state)===null||n===void 0?void 0:n[e])===null||c===void 0?void 0:c.default)!==null&&d!==void 0?d:null:a;if(h.bH(m,this._globalState[e]))return this;this._globalState[e]=m,this._applyGlobalStateChanges([e])}getGlobalState(){return this._globalState}setGlobalState(e){this._checkLoaded();const a=[];for(const n in e)!h.bH(this._globalState[n],e[n].default)&&(a.push(n),this._globalState[n]=e[n].default);this._applyGlobalStateChanges(a)}_applyGlobalStateChanges(e){if(e.length===0)return;const a=new Set,n={};for(const c of e){n[c]=this._globalState[c];for(const d in this._layers){const m=this._layers[d],y=m.getLayoutAffectingGlobalStateRefs(),x=m.getPaintAffectingGlobalStateRefs();if(y.has(c)&&a.add(m.source),x.has(c))for(const{name:w,value:T}of x.get(c))this._updatePaintProperty(m,w,T)}}this.dispatcher.broadcast("UGS",n);for(const c in this.sourceCaches)a.has(c)&&(this._reloadSource(c),this._changed=!0)}loadURL(e,a={},n){this.fire(new h.l("dataloading",{dataType:"style"})),a.validate=typeof a.validate!="boolean"||a.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const d=this._loadStyleRequest;h.j(c,this._loadStyleRequest).then((m=>{this._loadStyleRequest=null,this._load(m.data,a,n)})).catch((m=>{this._loadStyleRequest=null,m&&!d.signal.aborted&&this.fire(new h.k(m))}))}loadJSON(e,a={},n){this.fire(new h.l("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,We.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,a.validate=a.validate!==!1,this._load(e,a,n)})).catch((()=>{}))}loadEmpty(){this.fire(new h.l("dataloading",{dataType:"style"})),this._load(Hc,{validate:!1})}_load(e,a,n){var c,d;let m=a.transformStyle?a.transformStyle(n,e):e;if(!a.validate||!ps(this,h.z(m))){m=Object.assign({},m),this._loaded=!0,this.stylesheet=m;for(const y in m.sources)this.addSource(y,m.sources[y],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new ts(this.stylesheet.light),this._setProjectionInternal(((c=this.stylesheet.projection)===null||c===void 0?void 0:c.type)||"mercator"),this.sky=new xa(this.stylesheet.sky),this.map.setTerrain((d=this.stylesheet.terrain)!==null&&d!==void 0?d:null),this.fire(new h.l("data",{dataType:"style"})),this.fire(new h.l("style.load"))}}_createLayers(){var e,a,n;const c=h.bI(this.stylesheet.layers);this.setGlobalState((e=this.stylesheet.state)!==null&&e!==void 0?e:null),this.dispatcher.broadcast("SL",c),this._order=c.map((d=>d.id)),this._layers={},this._serializedLayers=null;for(const d of c){const m=h.bJ(d,this._globalState);if(m.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=m,h.bK(m)&&this.sourceCaches[m.source]){const y=(n=(a=d.paint)===null||a===void 0?void 0:a["raster-fade-duration"])!==null&&n!==void 0?n:m.paint.get("raster-fade-duration");this.sourceCaches[m.source].setRasterFadeDuration(y)}}}_loadSprite(e,a=!1,n=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(d,m,y,x){return h._(this,void 0,void 0,(function*(){const w=Qr(d),T=y>1?"@2x":"",M={},P={};for(const{id:A,url:D}of w){const O=m.transformRequest(Eo(D,T,".json"),"SpriteJSON");M[A]=h.j(O,x);const j=m.transformRequest(Eo(D,T,".png"),"SpriteImage");P[A]=gi.getImage(j,x)}return yield Promise.all([...Object.values(M),...Object.values(P)]),(function(A,D){return h._(this,void 0,void 0,(function*(){const O={};for(const j in A){O[j]={};const V=We.getImageCanvasContext((yield D[j]).data),$=(yield A[j]).data;for(const W in $){const{width:U,height:H,x:Y,y:Z,sdf:J,pixelRatio:lt,stretchX:ot,stretchY:st,content:ct,textFitWidth:xt,textFitHeight:vt}=$[W];O[j][W]={data:null,pixelRatio:lt,sdf:J,stretchX:ot,stretchY:st,content:ct,textFitWidth:xt,textFitHeight:vt,spriteData:{width:U,height:H,x:Y,y:Z,context:V}}}}return O}))})(M,P)}))})(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((d=>{if(this._spriteRequest=null,d)for(const m in d){this._spritesImagesIds[m]=[];const y=this._spritesImagesIds[m]?this._spritesImagesIds[m].filter((x=>!(x in d))):[];for(const x of y)this.imageManager.removeImage(x),this._changedImages[x]=!0;for(const x in d[m]){const w=m==="default"?x:`${m}:${x}`;this._spritesImagesIds[m].push(w),w in this.imageManager.images?this.imageManager.updateImage(w,d[m][x],!1):this.imageManager.addImage(w,d[m][x]),a&&(this._changedImages[w]=!0)}}})).catch((d=>{this._spriteRequest=null,c=d,this.fire(new h.k(c))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),a&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"})),n&&n(c)}))}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}_validateLayer(e){const a=this.sourceCaches[e.source];if(!a)return;const n=e.sourceLayer;if(!n)return;const c=a.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(n)===-1)&&this.fire(new h.k(new Error(`Source layer "${n}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,a=!1){const n=this._serializedAllLayers();if(!e||e.length===0)return Object.values(a?h.bL(n):n);const c=[];for(const d of e)if(n[d]){const m=a?h.bL(n[d]):n[d];c.push(m)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const a=Object.keys(this._layers);for(const n of a){const c=this._layers[n];c.type!=="custom"&&(e[n]=c.serialize())}return e}hasTransitions(){var e,a,n;if(!((e=this.light)===null||e===void 0)&&e.hasTransition()||!((a=this.sky)===null||a===void 0)&&a.hasTransition()||!((n=this.projection)===null||n===void 0)&&n.hasTransition())return!0;for(const c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const a=this._changed;if(a){const c=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(c.length||d.length)&&this._updateWorkerLayers(c,d);for(const m in this._updatedSources){const y=this._updatedSources[m];if(y==="reload")this._reloadSource(m);else{if(y!=="clear")throw new Error(`Invalid action ${y}`);this._clearSource(m)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const m in this._updatedPaintProps)this._layers[m].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const n={};for(const c in this.sourceCaches){const d=this.sourceCaches[c];n[c]=d.used,d.used=!1}for(const c of this._order){const d=this._layers[c];d.recalculate(e,this._availableImages),!d.isHidden(e.zoom)&&d.source&&(this.sourceCaches[d.source].used=!0)}for(const c in n){const d=this.sourceCaches[c];!!n[c]!=!!d.used&&d.fire(new h.l("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.projection.recalculate(e),this.z=e.zoom,a&&this.fire(new h.l("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,a){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:a})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,a={}){var n;this._checkLoaded();const c=this.serialize();if(e=a.transformStyle?a.transformStyle(c,e):e,((n=a.validate)===null||n===void 0||n)&&ps(this,h.z(e)))return!1;(e=h.bL(e)).layers=h.bI(e.layers);const d=h.bM(c,e),m=this._getOperationsToPerform(d);if(m.unimplemented.length>0)throw new Error(`Unimplemented: ${m.unimplemented.join(", ")}.`);if(m.operations.length===0)return!1;for(const y of m.operations)y();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const a=[],n=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":a.push((()=>this.addLayer.apply(this,c.args)));break;case"removeLayer":a.push((()=>this.removeLayer.apply(this,c.args)));break;case"setPaintProperty":a.push((()=>this.setPaintProperty.apply(this,c.args)));break;case"setLayoutProperty":a.push((()=>this.setLayoutProperty.apply(this,c.args)));break;case"setFilter":a.push((()=>this.setFilter.apply(this,c.args)));break;case"addSource":a.push((()=>this.addSource.apply(this,c.args)));break;case"removeSource":a.push((()=>this.removeSource.apply(this,c.args)));break;case"setLayerZoomRange":a.push((()=>this.setLayerZoomRange.apply(this,c.args)));break;case"setLight":a.push((()=>this.setLight.apply(this,c.args)));break;case"setGeoJSONSourceData":a.push((()=>this.setGeoJSONSourceData.apply(this,c.args)));break;case"setGlyphs":a.push((()=>this.setGlyphs.apply(this,c.args)));break;case"setSprite":a.push((()=>this.setSprite.apply(this,c.args)));break;case"setTerrain":a.push((()=>this.map.setTerrain.apply(this,c.args)));break;case"setSky":a.push((()=>this.setSky.apply(this,c.args)));break;case"setProjection":this.setProjection.apply(this,c.args);break;case"setGlobalState":a.push((()=>this.setGlobalState.apply(this,c.args)));break;case"setTransition":a.push((()=>{}));break;default:n.push(c.command)}return{operations:a,unimplemented:n}}addImage(e,a){if(this.getImage(e))return this.fire(new h.k(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,a),this._afterImageUpdated(e)}updateImage(e,a){this.imageManager.updateImage(e,a)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new h.k(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,a,n={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(h.z.source,`sources.${e}`,a,null,n))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const c=this.sourceCaches[e]=new oe(e,a,this.dispatcher);c.style=this,c.setEventedParent(this,(()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e}))),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const n in this._layers)if(this._layers[n].source===e)return this.fire(new h.k(new Error(`Source "${e}" cannot be removed while layer "${n}" is using it.`)));const a=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],a.fire(new h.l("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),a.setEventedParent(null),a.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,a){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const n=this.sourceCaches[e].getSource();if(n.type!=="geojson")throw new Error(`geojsonSource.type is ${n.type}, which is !== 'geojson`);n.setData(a),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,a,n={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new h.k(new Error(`Layer "${c}" already exists on this map.`)));let d;if(e.type==="custom"){if(ps(this,h.bN(e)))return;d=h.bJ(e,this._globalState)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=h.bL(e),e=h.e(e,{source:c})),this._validate(h.z.layer,`layers.${c}`,e,{arrayIndex:-1},n))return;d=h.bJ(e,this._globalState),this._validateLayer(d),d.setEventedParent(this,{layer:{id:c}})}const m=a?this._order.indexOf(a):this._order.length;if(a&&m===-1)this.fire(new h.k(new Error(`Cannot add layer "${c}" before non-existing layer "${a}".`)));else{if(this._order.splice(m,0,c),this._layerOrderChanged=!0,this._layers[c]=d,this._removedLayers[c]&&d.source&&d.type!=="custom"){const y=this._removedLayers[c];delete this._removedLayers[c],y.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",this.sourceCaches[d.source].pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map)}}moveLayer(e,a){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new h.k(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===a)return;const n=this._order.indexOf(e);this._order.splice(n,1);const c=a?this._order.indexOf(a):this._order.length;a&&c===-1?this.fire(new h.k(new Error(`Cannot move layer "${e}" before non-existing layer "${a}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const a=this._layers[e];if(!a)return void this.fire(new h.k(new Error(`Cannot remove non-existing layer "${e}".`)));a.setEventedParent(null);const n=this._order.indexOf(e);this._order.splice(n,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=a,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],a.onRemove&&a.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,a,n){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===a&&c.maxzoom===n||(a!=null&&(c.minzoom=a),n!=null&&(c.maxzoom=n),this._updateLayer(c)):this.fire(new h.k(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,a,n={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!h.bH(c.filter,a))return a==null?(c.setFilter(void 0),void this._updateLayer(c)):void(this._validate(h.z.filter,`layers.${c.id}.filter`,a,null,n)||(c.setFilter(h.bL(a)),this._updateLayer(c)))}else this.fire(new h.k(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return h.bL(this.getLayer(e).filter)}setLayoutProperty(e,a,n,c={}){this._checkLoaded();const d=this.getLayer(e);d?h.bH(d.getLayoutProperty(a),n)||(d.setLayoutProperty(a,n,c),this._updateLayer(d)):this.fire(new h.k(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,a){const n=this.getLayer(e);if(n)return n.getLayoutProperty(a);this.fire(new h.k(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,a,n,c={}){this._checkLoaded();const d=this.getLayer(e);d?h.bH(d.getPaintProperty(a),n)||this._updatePaintProperty(d,a,n,c):this.fire(new h.k(new Error(`Cannot style non-existing layer "${e}".`)))}_updatePaintProperty(e,a,n,c={}){e.setPaintProperty(a,n,c)&&this._updateLayer(e),h.bK(e)&&a==="raster-fade-duration"&&this.sourceCaches[e.source].setRasterFadeDuration(n),this._changed=!0,this._updatedPaintProps[e.id]=!0,this._serializedLayers=null}getPaintProperty(e,a){return this.getLayer(e).getPaintProperty(a)}setFeatureState(e,a){this._checkLoaded();const n=e.source,c=e.sourceLayer,d=this.sourceCaches[n];if(d===void 0)return void this.fire(new h.k(new Error(`The source '${n}' does not exist in the map's style.`)));const m=d.getSource().type;m==="geojson"&&c?this.fire(new h.k(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):m!=="vector"||c?(e.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),d.setFeatureState(c,e.id,a)):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,a){this._checkLoaded();const n=e.source,c=this.sourceCaches[n];if(c===void 0)return void this.fire(new h.k(new Error(`The source '${n}' does not exist in the map's style.`)));const d=c.getSource().type,m=d==="vector"?e.sourceLayer:void 0;d!=="vector"||m?a&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new h.k(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(m,e.id,a):this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const a=e.source,n=e.sourceLayer,c=this.sourceCaches[a];if(c!==void 0)return c.getSource().type!=="vector"||n?(e.id===void 0&&this.fire(new h.k(new Error("The feature id parameter must be provided."))),c.getFeatureState(n,e.id)):void this.fire(new h.k(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new h.k(new Error(`The source '${a}' does not exist in the map's style.`)))}getTransition(){return h.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=h.bO(this.sourceCaches,(d=>d.serialize())),a=this._serializeByIds(this._order,!0),n=this.map.getTerrain()||void 0,c=this.stylesheet;return h.bP({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,projection:c.projection,sources:e,layers:a,terrain:n},(d=>d!==void 0))}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const a=m=>this._layers[m].type==="fill-extrusion",n={},c=[];for(let m=this._order.length-1;m>=0;m--){const y=this._order[m];if(a(y)){n[y]=m;for(const x of e){const w=x[y];if(w)for(const T of w)c.push(T)}}}c.sort(((m,y)=>y.intersectionZ-m.intersectionZ));const d=[];for(let m=this._order.length-1;m>=0;m--){const y=this._order[m];if(a(y))for(let x=c.length-1;x>=0;x--){const w=c[x].feature;if(n[w.layer.id]<m)break;d.push(w),c.pop()}else for(const x of e){const w=x[y];if(w)for(const T of w)d.push(T.feature)}}return d}queryRenderedFeatures(e,a,n){a&&a.filter&&this._validate(h.z.filter,"queryRenderedFeatures.filter",a.filter,null,a);const c={};if(a&&a.layers){if(!(Array.isArray(a.layers)||a.layers instanceof Set))return this.fire(new h.k(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const w of a.layers){const T=this._layers[w];if(!T)return this.fire(new h.k(new Error(`The layer '${w}' does not exist in the map's style and cannot be queried for features.`))),[];c[T.source]=!0}}const d=[];a.availableImages=this._availableImages;const m=this._serializedAllLayers(),y=a.layers instanceof Set?a.layers:Array.isArray(a.layers)?new Set(a.layers):null,x=Object.assign(Object.assign({},a),{layers:y,globalState:this._globalState});for(const w in this.sourceCaches)a.layers&&!c[w]||d.push(wa(this.sourceCaches[w],this._layers,m,e,x,n,this.map.terrain?(T,M,P)=>this.map.terrain.getElevation(T,M,P):void 0));return this.placement&&d.push((function(w,T,M,P,A,D,O){const j={},V=D.queryRenderedSymbols(P),$=[];for(const W of Object.keys(V).map(Number))$.push(O[W]);$.sort(Fi);for(const W of $){const U=W.featureIndex.lookupSymbolFeatures(V[W.bucketInstanceId],T,W.bucketIndex,W.sourceLayerIndex,{filterSpec:A.filter,globalState:A.globalState},A.layers,A.availableImages,w);for(const H in U){const Y=j[H]=j[H]||[],Z=U[H];Z.sort(((J,lt)=>{const ot=W.featureSortOrder;if(ot){const st=ot.indexOf(J.featureIndex);return ot.indexOf(lt.featureIndex)-st}return lt.featureIndex-J.featureIndex}));for(const J of Z)Y.push(J)}}return(function(W,U,H){for(const Y in W)for(const Z of W[Y])ro(Z,H[U[Y].source]);return W})(j,w,M)})(this._layers,m,this.sourceCaches,e,x,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(e,a){a?.filter&&this._validate(h.z.filter,"querySourceFeatures.filter",a.filter,null,a);const n=this.sourceCaches[e];return n?(function(c,d){const m=c.getRenderableIds().map((w=>c.getTileByID(w))),y=[],x={};for(let w=0;w<m.length;w++){const T=m[w],M=T.tileID.canonical.key;x[M]||(x[M]=!0,T.querySourceFeatures(y,d))}return y})(n,a?Object.assign(Object.assign({},a),{globalState:this._globalState}):{globalState:this._globalState}):[]}getLight(){return this.light.getLight()}setLight(e,a={}){this._checkLoaded();const n=this.light.getLight();let c=!1;for(const m in e)if(!h.bH(e[m],n[m])){c=!0;break}if(!c)return;const d={now:Zt(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,a),this.light.updateTransitions(d)}getProjection(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.projection}setProjection(e){if(this._checkLoaded(),this.projection){if(this.projection.name===e.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=e,this._setProjectionInternal(e.type)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,a={}){this._checkLoaded();const n=this.getSky();let c=!1;if(!e&&!n)return;if(e&&!n)c=!0;else if(!e&&n)c=!0;else for(const m in e)if(!h.bH(e[m],n[m])){c=!0;break}if(!c)return;const d={now:Zt(),transition:h.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,a),this.sky.updateTransitions(d)}_setProjectionInternal(e){const a=(function(n,c){const d={constrain:c};if(Array.isArray(n)){const m=new ls({type:n});return{projection:m,transform:new ds(d),cameraHelper:new Ml(m)}}switch(n){case"mercator":return{projection:new Ca,transform:new si(d),cameraHelper:new we};case"globe":{const m=new ls({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:m,transform:new ds(d),cameraHelper:new Ml(m)}}case"vertical-perspective":return{projection:new ss,transform:new us(d),cameraHelper:new Yi};default:return h.w(`Unknown projection name: ${n}. Falling back to mercator projection.`),{projection:new Ca,transform:new si(d),cameraHelper:new we}}})(e,this.map.transformConstrain);this.projection=a.projection,this.map.migrateProjection(a.transform,a.cameraHelper);for(const n in this.sourceCaches)this.sourceCaches[n].reload()}_validate(e,a,n,c,d={}){return(!d||d.validate!==!1)&&ps(this,e.call(h.z,h.e({key:a,style:this.serialize(),value:n,styleSpec:h.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),wr().off(Ui,this._rtlPluginLoaded);for(const a in this._layers)this._layers[a].setEventedParent(null);for(const a in this.sourceCaches){const n=this.sourceCaches[a];n.setEventedParent(null),n.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const a in this.sourceCaches)this.sourceCaches[a].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,a,n,c,d=!1){let m=!1,y=!1;const x={};for(const w of this._order){const T=this._layers[w];if(T.type!=="symbol")continue;if(!x[T.source]){const P=this.sourceCaches[T.source];x[T.source]=P.getRenderableIds(!0).map((A=>P.getTileByID(A))).sort(((A,D)=>D.tileID.overscaledZ-A.tileID.overscaledZ||(A.tileID.isLessThan(D.tileID)?-1:1)))}const M=this.crossTileSymbolIndex.addLayer(T,x[T.source],e.center.lng);m=m||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((d=d||this._layerOrderChanged||n===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(Zt(),e.zoom))&&(this.pauseablePlacement=new dn(e,this.map.terrain,this._order,d,a,n,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,x),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(Zt()),y=!0),m&&this.pauseablePlacement.placement.setStale()),y||m)for(const w of this._order){const T=this._layers[w];T.type==="symbol"&&this.placement.updateLayerOpacities(T,x[T.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(Zt())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,a){return h._(this,void 0,void 0,(function*(){const n=yield this.imageManager.getImages(a.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[a.source];return c&&c.setDependencies(a.tileID.key,a.type,a.icons),n}))}getGlyphs(e,a){return h._(this,void 0,void 0,(function*(){const n=yield this.glyphManager.getGlyphs(a.stacks),c=this.sourceCaches[a.source];return c&&c.setDependencies(a.tileID.key,a.type,[""]),n}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,a={}){this._checkLoaded(),e&&this._validate(h.z.glyphs,"glyphs",e,null,a)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}getDashes(e,a){return h._(this,void 0,void 0,(function*(){const n={};for(const[c,d]of Object.entries(a.dashes))n[c]=this.lineAtlas.getDash(d.dasharray,d.round);return n}))}addSprite(e,a,n={},c){this._checkLoaded();const d=[{id:e,url:a}],m=[...Qr(this.stylesheet.sprite),...d];this._validate(h.z.sprite,"sprite",m,null,n)||(this.stylesheet.sprite=m,this._loadSprite(d,!0,c))}removeSprite(e){this._checkLoaded();const a=Qr(this.stylesheet.sprite);if(a.find((n=>n.id===e))){if(this._spritesImagesIds[e])for(const n of this._spritesImagesIds[e])this.imageManager.removeImage(n),this._changedImages[n]=!0;a.splice(a.findIndex((n=>n.id===e)),1),this.stylesheet.sprite=a.length>0?a:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new h.l("data",{dataType:"style"}))}else this.fire(new h.k(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Qr(this.stylesheet.sprite)}setSprite(e,a={},n){this._checkLoaded(),e&&this._validate(h.z.sprite,"sprite",e,null,a)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,n):(this._unloadSprite(),n&&n(null)))}}var yn=h.aJ([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class fs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,a,n,c,d,m,y,x,w){this.context=e;let T=this.boundPaintVertexBuffers.length!==c.length;for(let M=0;!T&&M<c.length;M++)this.boundPaintVertexBuffers[M]!==c[M]&&(T=!0);!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==n||T||this.boundIndexBuffer!==d||this.boundVertexOffset!==m||this.boundDynamicVertexBuffer!==y||this.boundDynamicVertexBuffer2!==x||this.boundDynamicVertexBuffer3!==w?this.freshBind(a,n,c,d,m,y,x,w):(e.bindVertexArray.set(this.vao),y&&y.bind(),d&&d.dynamicDraw&&d.bind(),x&&x.bind(),w&&w.bind())}freshBind(e,a,n,c,d,m,y,x){const w=e.numAttributes,T=this.context,M=T.gl;this.vao&&this.destroy(),this.vao=T.createVertexArray(),T.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=c,this.boundVertexOffset=d,this.boundDynamicVertexBuffer=m,this.boundDynamicVertexBuffer2=y,this.boundDynamicVertexBuffer3=x,a.enableAttributes(M,e);for(const P of n)P.enableAttributes(M,e);m&&m.enableAttributes(M,e),y&&y.enableAttributes(M,e),x&&x.enableAttributes(M,e),a.bind(),a.setVertexAttribPointers(M,e,d);for(const P of n)P.bind(),P.setVertexAttribPointers(M,e,d);m&&(m.bind(),m.setVertexAttribPointers(M,e,d)),c&&c.bind(),y&&(y.bind(),y.setVertexAttribPointers(M,e,d)),x&&(x.bind(),x.setVertexAttribPointers(M,e,d)),T.currentNumAttributes=w}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const xn=(u,e,a,n,c)=>({u_texture:0,u_ele_delta:u,u_fog_matrix:e,u_fog_color:a?a.properties.get("fog-color"):h.bf.white,u_fog_ground_blend:a?a.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:c?0:a?a.calculateFogBlendOpacity(n):0,u_horizon_color:a?a.properties.get("horizon-color"):h.bf.white,u_horizon_fog_blend:a?a.properties.get("horizon-fog-blend"):1,u_is_globe_mode:c?1:0}),vn={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Bi(u){const e=[];for(let a=0;a<u.length;a++){if(u[a]===null)continue;const n=u[a].split(" ");e.push(n.pop())}return e}class Xc{constructor(e,a,n,c,d,m,y,x,w=[]){const T=e.gl;this.program=T.createProgram();const M=Bi(a.staticAttributes),P=n?n.getBinderAttributes():[],A=M.concat(P),D=sr.prelude.staticUniforms?Bi(sr.prelude.staticUniforms):[],O=y.staticUniforms?Bi(y.staticUniforms):[],j=a.staticUniforms?Bi(a.staticUniforms):[],V=n?n.getBinderUniforms():[],$=D.concat(O).concat(j).concat(V),W=[];for(const ot of $)W.indexOf(ot)<0&&W.push(ot);const U=n?n.defines():[];nr(T)&&U.unshift("#version 300 es"),d&&U.push("#define OVERDRAW_INSPECTOR;"),m&&U.push("#define TERRAIN3D;"),x&&U.push(x),w&&U.push(...w);let H=U.concat(sr.prelude.fragmentSource,y.fragmentSource,a.fragmentSource).join(`
`),Y=U.concat(sr.prelude.vertexSource,y.vertexSource,a.vertexSource).join(`
`);nr(T)||(H=(function(ot){return ot.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")})(H),Y=(function(ot){return ot.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")})(Y));const Z=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(Z,H),T.compileShader(Z),!T.getShaderParameter(Z,T.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${T.getShaderInfoLog(Z)}`);T.attachShader(this.program,Z);const J=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);if(T.shaderSource(J,Y),T.compileShader(J),!T.getShaderParameter(J,T.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${T.getShaderInfoLog(J)}`);T.attachShader(this.program,J),this.attributes={};const lt={};this.numAttributes=A.length;for(let ot=0;ot<this.numAttributes;ot++)A[ot]&&(T.bindAttribLocation(this.program,ot,A[ot]),this.attributes[A[ot]]=ot);if(T.linkProgram(this.program),!T.getProgramParameter(this.program,T.LINK_STATUS))throw new Error(`Program failed to link: ${T.getProgramInfoLog(this.program)}`);T.deleteShader(J),T.deleteShader(Z);for(let ot=0;ot<W.length;ot++){const st=W[ot];if(st&&!lt[st]){const ct=T.getUniformLocation(this.program,st);ct&&(lt[st]=ct)}}this.fixedUniforms=c(e,lt),this.terrainUniforms=((ot,st)=>({u_depth:new h.bQ(ot,st.u_depth),u_terrain:new h.bQ(ot,st.u_terrain),u_terrain_dim:new h.bg(ot,st.u_terrain_dim),u_terrain_matrix:new h.bS(ot,st.u_terrain_matrix),u_terrain_unpack:new h.bT(ot,st.u_terrain_unpack),u_terrain_exaggeration:new h.bg(ot,st.u_terrain_exaggeration)}))(e,lt),this.projectionUniforms=((ot,st)=>({u_projection_matrix:new h.bS(ot,st.u_projection_matrix),u_projection_tile_mercator_coords:new h.bT(ot,st.u_projection_tile_mercator_coords),u_projection_clipping_plane:new h.bT(ot,st.u_projection_clipping_plane),u_projection_transition:new h.bg(ot,st.u_projection_transition),u_projection_fallback_matrix:new h.bS(ot,st.u_projection_fallback_matrix)}))(e,lt),this.binderUniforms=n?n.getUniforms(e,lt):[]}draw(e,a,n,c,d,m,y,x,w,T,M,P,A,D,O,j,V,$,W){const U=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(c),e.setColorMode(d),e.setCullFace(m),x){e.activeTexture.set(U.TEXTURE2),U.bindTexture(U.TEXTURE_2D,x.depthTexture),e.activeTexture.set(U.TEXTURE3),U.bindTexture(U.TEXTURE_2D,x.texture);for(const Y in this.terrainUniforms)this.terrainUniforms[Y].set(x[Y])}if(w)for(const Y in w)this.projectionUniforms[vn[Y]].set(w[Y]);if(y)for(const Y in this.fixedUniforms)this.fixedUniforms[Y].set(y[Y]);j&&j.setUniforms(e,this.binderUniforms,D,{zoom:O});let H=0;switch(a){case U.LINES:H=2;break;case U.TRIANGLES:H=3;break;case U.LINE_STRIP:H=1}for(const Y of A.get()){const Z=Y.vaos||(Y.vaos={});(Z[T]||(Z[T]=new fs)).bind(e,this,M,j?j.getPaintVertexBuffers():[],P,Y.vertexOffset,V,$,W),U.drawElements(a,Y.primitiveLength*H,U.UNSIGNED_SHORT,Y.primitiveOffset*H*2)}}}function ms(u,e,a){const n=1/h.aC(a,1,e.transform.tileZoom),c=Math.pow(2,a.tileID.overscaledZ),d=a.tileSize*Math.pow(2,e.transform.tileZoom)/c,m=d*(a.tileID.canonical.x+a.tileID.wrap*c),y=d*a.tileID.canonical.y;return{u_image:0,u_texsize:a.imageAtlasTexture.size,u_scale:[n,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[m>>16,y>>16],u_pixel_coord_lower:[65535&m,65535&y]}}const qo=(u,e,a,n)=>{const c=u.style.light,d=c.properties.get("position"),m=[d.x,d.y,d.z],y=h.bW();c.properties.get("anchor")==="viewport"&&h.bX(y,u.transform.bearingInRadians),h.bY(m,m,y);const x=u.transform.transformLightDirection(m),w=c.properties.get("color");return{u_lightpos:m,u_lightpos_globe:x,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[w.r,w.g,w.b],u_vertical_gradient:+e,u_opacity:a,u_fill_translate:n}},Ra=(u,e,a,n,c,d,m)=>h.e(qo(u,e,a,n),ms(d,u,m),{u_height_factor:-Math.pow(2,c.overscaledZ)/m.tileSize/8}),Il=(u,e,a,n)=>h.e(ms(e,u,a),{u_fill_translate:n}),_s=(u,e)=>({u_world:u,u_fill_translate:e}),Kc=(u,e,a,n,c)=>h.e(Il(u,e,a,c),{u_world:n}),Wo=(u,e,a,n,c)=>{const d=u.transform;let m,y,x=0;if(a.paint.get("circle-pitch-alignment")==="map"){const w=h.aC(e,1,d.zoom);m=!0,y=[w,w],x=w/(h.$*Math.pow(2,e.tileID.overscaledZ))*2*Math.PI*c}else m=!1,y=d.pixelsToGLUnits;return{u_camera_to_center_distance:d.cameraToCenterDistance,u_scale_with_map:+(a.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+m,u_device_pixel_ratio:u.pixelRatio,u_extrude_scale:y,u_globe_extrude_scale:x,u_translate:n}},Yc=u=>({u_pixel_extrude_scale:[1/u.width,1/u.height]}),Cl=u=>({u_viewport_size:[u.width,u.height]}),Al=(u,e=1)=>({u_color:u,u_overlay:0,u_overlay_scale:e}),bn=(u,e,a,n)=>{const c=h.aC(u,1,e)/(h.$*Math.pow(2,u.tileID.overscaledZ))*2*Math.PI*n;return{u_extrude_scale:h.aC(u,1,e),u_intensity:a,u_globe_extrude_scale:c}},gs=(u,e,a,n)=>{const c=h.L();h.bZ(c,0,u.width,u.height,0,0,1);const d=u.context.gl;return{u_matrix:c,u_world:[d.drawingBufferWidth,d.drawingBufferHeight],u_image:a,u_color_ramp:n,u_opacity:e.paint.get("heatmap-opacity")}},zl=(u,e,a)=>{const n=a.paint.get("hillshade-accent-color");let c;switch(a.paint.get("hillshade-method")){case"basic":c=4;break;case"combined":c=1;break;case"igor":c=2;break;case"multidirectional":c=3;break;default:c=0}const d=a.getIlluminationProperties();for(let m=0;m<d.directionRadians.length;m++)a.paint.get("hillshade-illumination-anchor")==="viewport"&&(d.directionRadians[m]+=u.transform.bearingInRadians);return{u_image:0,u_latrange:El(0,e.tileID),u_exaggeration:a.paint.get("hillshade-exaggeration"),u_altitudes:d.altitudeRadians,u_azimuths:d.directionRadians,u_accent:n,u_method:c,u_highlights:d.highlightColor,u_shadows:d.shadowColor}},Rl=(u,e)=>{const a=e.stride,n=h.L();return h.bZ(n,0,h.$,-h.$,0,0,1),h.M(n,n,[0,-h.$,0]),{u_matrix:n,u_image:1,u_dimension:[a,a],u_zoom:u.overscaledZ,u_unpack:e.getUnpackVector()}};function El(u,e){const a=Math.pow(2,e.canonical.z),n=e.canonical.y;return[new h.a1(0,n/a).toLngLat().lat,new h.a1(0,(n+1)/a).toLngLat().lat]}const kl=(u,e,a=0)=>({u_image:0,u_unpack:e.getUnpackVector(),u_dimension:[e.stride,e.stride],u_elevation_stops:1,u_color_stops:4,u_color_ramp_size:a,u_opacity:u.paint.get("color-relief-opacity")}),lr=(u,e,a,n)=>{const c=u.transform;return{u_translation:Fl(u,e,a),u_ratio:n/h.aC(e,1,c.zoom),u_device_pixel_ratio:u.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},Dl=(u,e,a,n,c)=>h.e(lr(u,e,a,n),{u_image:0,u_image_height:c}),Ll=(u,e,a,n,c)=>{const d=u.transform,m=Ho(e,d);return{u_translation:Fl(u,e,a),u_texsize:e.imageAtlasTexture.size,u_ratio:n/h.aC(e,1,d.zoom),u_device_pixel_ratio:u.pixelRatio,u_image:0,u_scale:[m,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Ea=(u,e,a,n,c)=>{const d=Ho(e,u.transform);return h.e(lr(u,e,a,n),{u_tileratio:d,u_crossfade_from:c.fromScale,u_crossfade_to:c.toScale,u_image:0,u_mix:c.t,u_lineatlas_width:u.lineAtlas.width,u_lineatlas_height:u.lineAtlas.height})},Qc=(u,e,a,n,c,d)=>{const m=Ho(e,u.transform);return h.e(lr(u,e,a,n),{u_image:0,u_image_height:d,u_tileratio:m,u_crossfade_from:c.fromScale,u_crossfade_to:c.toScale,u_image_dash:1,u_mix:c.t,u_lineatlas_width:u.lineAtlas.width,u_lineatlas_height:u.lineAtlas.height})};function Ho(u,e){return 1/h.aC(u,1,e.tileZoom)}function Fl(u,e,a){return h.aD(u.transform,e,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const Jc=(u,e,a,n,c)=>{return{u_tl_parent:u,u_scale_parent:e,u_buffer_scale:1,u_fade_t:a.mix,u_opacity:a.opacity*n.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:n.paint.get("raster-brightness-min"),u_brightness_high:n.paint.get("raster-brightness-max"),u_saturation_factor:(m=n.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(d=n.paint.get("raster-contrast"),d>0?1/(1-d):1+d),u_spin_weights:Bl(n.paint.get("raster-hue-rotate")),u_coords_top:[c[0].x,c[0].y,c[1].x,c[1].y],u_coords_bottom:[c[3].x,c[3].y,c[2].x,c[2].y]};var d,m};function Bl(u){u*=Math.PI/180;const e=Math.sin(u),a=Math.cos(u);return[(2*a+1)/3,(-Math.sqrt(3)*e-a+1)/3,(Math.sqrt(3)*e-a+1)/3]}const wn=(u,e,a,n,c,d,m,y,x,w,T,M,P)=>{const A=m.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:A.cameraToCenterDistance,u_pitch:A.pitch/360*2*Math.PI,u_rotate_symbol:+a,u_aspect_ratio:A.width/A.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_label_plane_matrix:y,u_coord_matrix:x,u_is_text:+T,u_pitch_with_map:+n,u_is_along_line:c,u_is_variable_anchor:d,u_texsize:M,u_texture:0,u_translation:w,u_pitched_scale:P}},Tn=(u,e,a,n,c,d,m,y,x,w,T,M,P,A)=>{const D=m.transform;return h.e(wn(u,e,a,n,c,d,m,y,x,w,T,M,A),{u_gamma_scale:n?Math.cos(D.pitch*Math.PI/180)*D.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:1})},Sn=(u,e,a,n,c,d,m,y,x,w,T,M,P)=>h.e(Tn(u,e,a,n,c,d,m,y,x,w,!0,T,0,P),{u_texsize_icon:M,u_texture_icon:1}),Ol=(u,e)=>({u_opacity:u,u_color:e}),ys=(u,e,a,n,c)=>h.e((function(d,m,y,x){const w=y.imageManager.getPattern(d.from.toString()),T=y.imageManager.getPattern(d.to.toString()),{width:M,height:P}=y.imageManager.getPixelSize(),A=Math.pow(2,x.tileID.overscaledZ),D=x.tileSize*Math.pow(2,y.transform.tileZoom)/A,O=D*(x.tileID.canonical.x+x.tileID.wrap*A),j=D*x.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:w.tl,u_pattern_br_a:w.br,u_pattern_tl_b:T.tl,u_pattern_br_b:T.br,u_texsize:[M,P],u_mix:m.t,u_pattern_size_a:w.displaySize,u_pattern_size_b:T.displaySize,u_scale_a:m.fromScale,u_scale_b:m.toScale,u_tile_units_to_pixels:1/h.aC(x,1,y.transform.tileZoom),u_pixel_coord_upper:[O>>16,j>>16],u_pixel_coord_lower:[65535&O,65535&j]}})(a,c,e,n),{u_opacity:u}),cr=(u,e)=>{},Pn={fillExtrusion:(u,e)=>({u_lightpos:new h.bU(u,e.u_lightpos),u_lightpos_globe:new h.bU(u,e.u_lightpos_globe),u_lightintensity:new h.bg(u,e.u_lightintensity),u_lightcolor:new h.bU(u,e.u_lightcolor),u_vertical_gradient:new h.bg(u,e.u_vertical_gradient),u_opacity:new h.bg(u,e.u_opacity),u_fill_translate:new h.bV(u,e.u_fill_translate)}),fillExtrusionPattern:(u,e)=>({u_lightpos:new h.bU(u,e.u_lightpos),u_lightpos_globe:new h.bU(u,e.u_lightpos_globe),u_lightintensity:new h.bg(u,e.u_lightintensity),u_lightcolor:new h.bU(u,e.u_lightcolor),u_vertical_gradient:new h.bg(u,e.u_vertical_gradient),u_height_factor:new h.bg(u,e.u_height_factor),u_opacity:new h.bg(u,e.u_opacity),u_fill_translate:new h.bV(u,e.u_fill_translate),u_image:new h.bQ(u,e.u_image),u_texsize:new h.bV(u,e.u_texsize),u_pixel_coord_upper:new h.bV(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.bV(u,e.u_pixel_coord_lower),u_scale:new h.bU(u,e.u_scale),u_fade:new h.bg(u,e.u_fade)}),fill:(u,e)=>({u_fill_translate:new h.bV(u,e.u_fill_translate)}),fillPattern:(u,e)=>({u_image:new h.bQ(u,e.u_image),u_texsize:new h.bV(u,e.u_texsize),u_pixel_coord_upper:new h.bV(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.bV(u,e.u_pixel_coord_lower),u_scale:new h.bU(u,e.u_scale),u_fade:new h.bg(u,e.u_fade),u_fill_translate:new h.bV(u,e.u_fill_translate)}),fillOutline:(u,e)=>({u_world:new h.bV(u,e.u_world),u_fill_translate:new h.bV(u,e.u_fill_translate)}),fillOutlinePattern:(u,e)=>({u_world:new h.bV(u,e.u_world),u_image:new h.bQ(u,e.u_image),u_texsize:new h.bV(u,e.u_texsize),u_pixel_coord_upper:new h.bV(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.bV(u,e.u_pixel_coord_lower),u_scale:new h.bU(u,e.u_scale),u_fade:new h.bg(u,e.u_fade),u_fill_translate:new h.bV(u,e.u_fill_translate)}),circle:(u,e)=>({u_camera_to_center_distance:new h.bg(u,e.u_camera_to_center_distance),u_scale_with_map:new h.bQ(u,e.u_scale_with_map),u_pitch_with_map:new h.bQ(u,e.u_pitch_with_map),u_extrude_scale:new h.bV(u,e.u_extrude_scale),u_device_pixel_ratio:new h.bg(u,e.u_device_pixel_ratio),u_globe_extrude_scale:new h.bg(u,e.u_globe_extrude_scale),u_translate:new h.bV(u,e.u_translate)}),collisionBox:(u,e)=>({u_pixel_extrude_scale:new h.bV(u,e.u_pixel_extrude_scale)}),collisionCircle:(u,e)=>({u_viewport_size:new h.bV(u,e.u_viewport_size)}),debug:(u,e)=>({u_color:new h.bR(u,e.u_color),u_overlay:new h.bQ(u,e.u_overlay),u_overlay_scale:new h.bg(u,e.u_overlay_scale)}),depth:cr,clippingMask:cr,heatmap:(u,e)=>({u_extrude_scale:new h.bg(u,e.u_extrude_scale),u_intensity:new h.bg(u,e.u_intensity),u_globe_extrude_scale:new h.bg(u,e.u_globe_extrude_scale)}),heatmapTexture:(u,e)=>({u_matrix:new h.bS(u,e.u_matrix),u_world:new h.bV(u,e.u_world),u_image:new h.bQ(u,e.u_image),u_color_ramp:new h.bQ(u,e.u_color_ramp),u_opacity:new h.bg(u,e.u_opacity)}),hillshade:(u,e)=>({u_image:new h.bQ(u,e.u_image),u_latrange:new h.bV(u,e.u_latrange),u_exaggeration:new h.bg(u,e.u_exaggeration),u_altitudes:new h.b$(u,e.u_altitudes),u_azimuths:new h.b$(u,e.u_azimuths),u_accent:new h.bR(u,e.u_accent),u_method:new h.bQ(u,e.u_method),u_shadows:new h.b_(u,e.u_shadows),u_highlights:new h.b_(u,e.u_highlights)}),hillshadePrepare:(u,e)=>({u_matrix:new h.bS(u,e.u_matrix),u_image:new h.bQ(u,e.u_image),u_dimension:new h.bV(u,e.u_dimension),u_zoom:new h.bg(u,e.u_zoom),u_unpack:new h.bT(u,e.u_unpack)}),colorRelief:(u,e)=>({u_image:new h.bQ(u,e.u_image),u_unpack:new h.bT(u,e.u_unpack),u_dimension:new h.bV(u,e.u_dimension),u_elevation_stops:new h.bQ(u,e.u_elevation_stops),u_color_stops:new h.bQ(u,e.u_color_stops),u_color_ramp_size:new h.bQ(u,e.u_color_ramp_size),u_opacity:new h.bg(u,e.u_opacity)}),line:(u,e)=>({u_translation:new h.bV(u,e.u_translation),u_ratio:new h.bg(u,e.u_ratio),u_device_pixel_ratio:new h.bg(u,e.u_device_pixel_ratio),u_units_to_pixels:new h.bV(u,e.u_units_to_pixels)}),lineGradient:(u,e)=>({u_translation:new h.bV(u,e.u_translation),u_ratio:new h.bg(u,e.u_ratio),u_device_pixel_ratio:new h.bg(u,e.u_device_pixel_ratio),u_units_to_pixels:new h.bV(u,e.u_units_to_pixels),u_image:new h.bQ(u,e.u_image),u_image_height:new h.bg(u,e.u_image_height)}),linePattern:(u,e)=>({u_translation:new h.bV(u,e.u_translation),u_texsize:new h.bV(u,e.u_texsize),u_ratio:new h.bg(u,e.u_ratio),u_device_pixel_ratio:new h.bg(u,e.u_device_pixel_ratio),u_image:new h.bQ(u,e.u_image),u_units_to_pixels:new h.bV(u,e.u_units_to_pixels),u_scale:new h.bU(u,e.u_scale),u_fade:new h.bg(u,e.u_fade)}),lineSDF:(u,e)=>({u_translation:new h.bV(u,e.u_translation),u_ratio:new h.bg(u,e.u_ratio),u_device_pixel_ratio:new h.bg(u,e.u_device_pixel_ratio),u_units_to_pixels:new h.bV(u,e.u_units_to_pixels),u_image:new h.bQ(u,e.u_image),u_mix:new h.bg(u,e.u_mix),u_tileratio:new h.bg(u,e.u_tileratio),u_crossfade_from:new h.bg(u,e.u_crossfade_from),u_crossfade_to:new h.bg(u,e.u_crossfade_to),u_lineatlas_width:new h.bg(u,e.u_lineatlas_width),u_lineatlas_height:new h.bg(u,e.u_lineatlas_height)}),lineGradientSDF:(u,e)=>({u_translation:new h.bV(u,e.u_translation),u_ratio:new h.bg(u,e.u_ratio),u_device_pixel_ratio:new h.bg(u,e.u_device_pixel_ratio),u_units_to_pixels:new h.bV(u,e.u_units_to_pixels),u_image:new h.bQ(u,e.u_image),u_image_height:new h.bg(u,e.u_image_height),u_tileratio:new h.bg(u,e.u_tileratio),u_crossfade_from:new h.bg(u,e.u_crossfade_from),u_crossfade_to:new h.bg(u,e.u_crossfade_to),u_image_dash:new h.bQ(u,e.u_image_dash),u_mix:new h.bg(u,e.u_mix),u_lineatlas_width:new h.bg(u,e.u_lineatlas_width),u_lineatlas_height:new h.bg(u,e.u_lineatlas_height)}),raster:(u,e)=>({u_tl_parent:new h.bV(u,e.u_tl_parent),u_scale_parent:new h.bg(u,e.u_scale_parent),u_buffer_scale:new h.bg(u,e.u_buffer_scale),u_fade_t:new h.bg(u,e.u_fade_t),u_opacity:new h.bg(u,e.u_opacity),u_image0:new h.bQ(u,e.u_image0),u_image1:new h.bQ(u,e.u_image1),u_brightness_low:new h.bg(u,e.u_brightness_low),u_brightness_high:new h.bg(u,e.u_brightness_high),u_saturation_factor:new h.bg(u,e.u_saturation_factor),u_contrast_factor:new h.bg(u,e.u_contrast_factor),u_spin_weights:new h.bU(u,e.u_spin_weights),u_coords_top:new h.bT(u,e.u_coords_top),u_coords_bottom:new h.bT(u,e.u_coords_bottom)}),symbolIcon:(u,e)=>({u_is_size_zoom_constant:new h.bQ(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bQ(u,e.u_is_size_feature_constant),u_size_t:new h.bg(u,e.u_size_t),u_size:new h.bg(u,e.u_size),u_camera_to_center_distance:new h.bg(u,e.u_camera_to_center_distance),u_pitch:new h.bg(u,e.u_pitch),u_rotate_symbol:new h.bQ(u,e.u_rotate_symbol),u_aspect_ratio:new h.bg(u,e.u_aspect_ratio),u_fade_change:new h.bg(u,e.u_fade_change),u_label_plane_matrix:new h.bS(u,e.u_label_plane_matrix),u_coord_matrix:new h.bS(u,e.u_coord_matrix),u_is_text:new h.bQ(u,e.u_is_text),u_pitch_with_map:new h.bQ(u,e.u_pitch_with_map),u_is_along_line:new h.bQ(u,e.u_is_along_line),u_is_variable_anchor:new h.bQ(u,e.u_is_variable_anchor),u_texsize:new h.bV(u,e.u_texsize),u_texture:new h.bQ(u,e.u_texture),u_translation:new h.bV(u,e.u_translation),u_pitched_scale:new h.bg(u,e.u_pitched_scale)}),symbolSDF:(u,e)=>({u_is_size_zoom_constant:new h.bQ(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bQ(u,e.u_is_size_feature_constant),u_size_t:new h.bg(u,e.u_size_t),u_size:new h.bg(u,e.u_size),u_camera_to_center_distance:new h.bg(u,e.u_camera_to_center_distance),u_pitch:new h.bg(u,e.u_pitch),u_rotate_symbol:new h.bQ(u,e.u_rotate_symbol),u_aspect_ratio:new h.bg(u,e.u_aspect_ratio),u_fade_change:new h.bg(u,e.u_fade_change),u_label_plane_matrix:new h.bS(u,e.u_label_plane_matrix),u_coord_matrix:new h.bS(u,e.u_coord_matrix),u_is_text:new h.bQ(u,e.u_is_text),u_pitch_with_map:new h.bQ(u,e.u_pitch_with_map),u_is_along_line:new h.bQ(u,e.u_is_along_line),u_is_variable_anchor:new h.bQ(u,e.u_is_variable_anchor),u_texsize:new h.bV(u,e.u_texsize),u_texture:new h.bQ(u,e.u_texture),u_gamma_scale:new h.bg(u,e.u_gamma_scale),u_device_pixel_ratio:new h.bg(u,e.u_device_pixel_ratio),u_is_halo:new h.bQ(u,e.u_is_halo),u_translation:new h.bV(u,e.u_translation),u_pitched_scale:new h.bg(u,e.u_pitched_scale)}),symbolTextAndIcon:(u,e)=>({u_is_size_zoom_constant:new h.bQ(u,e.u_is_size_zoom_constant),u_is_size_feature_constant:new h.bQ(u,e.u_is_size_feature_constant),u_size_t:new h.bg(u,e.u_size_t),u_size:new h.bg(u,e.u_size),u_camera_to_center_distance:new h.bg(u,e.u_camera_to_center_distance),u_pitch:new h.bg(u,e.u_pitch),u_rotate_symbol:new h.bQ(u,e.u_rotate_symbol),u_aspect_ratio:new h.bg(u,e.u_aspect_ratio),u_fade_change:new h.bg(u,e.u_fade_change),u_label_plane_matrix:new h.bS(u,e.u_label_plane_matrix),u_coord_matrix:new h.bS(u,e.u_coord_matrix),u_is_text:new h.bQ(u,e.u_is_text),u_pitch_with_map:new h.bQ(u,e.u_pitch_with_map),u_is_along_line:new h.bQ(u,e.u_is_along_line),u_is_variable_anchor:new h.bQ(u,e.u_is_variable_anchor),u_texsize:new h.bV(u,e.u_texsize),u_texsize_icon:new h.bV(u,e.u_texsize_icon),u_texture:new h.bQ(u,e.u_texture),u_texture_icon:new h.bQ(u,e.u_texture_icon),u_gamma_scale:new h.bg(u,e.u_gamma_scale),u_device_pixel_ratio:new h.bg(u,e.u_device_pixel_ratio),u_is_halo:new h.bQ(u,e.u_is_halo),u_translation:new h.bV(u,e.u_translation),u_pitched_scale:new h.bg(u,e.u_pitched_scale)}),background:(u,e)=>({u_opacity:new h.bg(u,e.u_opacity),u_color:new h.bR(u,e.u_color)}),backgroundPattern:(u,e)=>({u_opacity:new h.bg(u,e.u_opacity),u_image:new h.bQ(u,e.u_image),u_pattern_tl_a:new h.bV(u,e.u_pattern_tl_a),u_pattern_br_a:new h.bV(u,e.u_pattern_br_a),u_pattern_tl_b:new h.bV(u,e.u_pattern_tl_b),u_pattern_br_b:new h.bV(u,e.u_pattern_br_b),u_texsize:new h.bV(u,e.u_texsize),u_mix:new h.bg(u,e.u_mix),u_pattern_size_a:new h.bV(u,e.u_pattern_size_a),u_pattern_size_b:new h.bV(u,e.u_pattern_size_b),u_scale_a:new h.bg(u,e.u_scale_a),u_scale_b:new h.bg(u,e.u_scale_b),u_pixel_coord_upper:new h.bV(u,e.u_pixel_coord_upper),u_pixel_coord_lower:new h.bV(u,e.u_pixel_coord_lower),u_tile_units_to_pixels:new h.bg(u,e.u_tile_units_to_pixels)}),terrain:(u,e)=>({u_texture:new h.bQ(u,e.u_texture),u_ele_delta:new h.bg(u,e.u_ele_delta),u_fog_matrix:new h.bS(u,e.u_fog_matrix),u_fog_color:new h.bR(u,e.u_fog_color),u_fog_ground_blend:new h.bg(u,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new h.bg(u,e.u_fog_ground_blend_opacity),u_horizon_color:new h.bR(u,e.u_horizon_color),u_horizon_fog_blend:new h.bg(u,e.u_horizon_fog_blend),u_is_globe_mode:new h.bg(u,e.u_is_globe_mode)}),terrainDepth:(u,e)=>({u_ele_delta:new h.bg(u,e.u_ele_delta)}),terrainCoords:(u,e)=>({u_texture:new h.bQ(u,e.u_texture),u_terrain_coords_id:new h.bg(u,e.u_terrain_coords_id),u_ele_delta:new h.bg(u,e.u_ele_delta)}),projectionErrorMeasurement:(u,e)=>({u_input:new h.bg(u,e.u_input),u_output_expected:new h.bg(u,e.u_output_expected)}),atmosphere:(u,e)=>({u_sun_pos:new h.bU(u,e.u_sun_pos),u_atmosphere_blend:new h.bg(u,e.u_atmosphere_blend),u_globe_position:new h.bU(u,e.u_globe_position),u_globe_radius:new h.bg(u,e.u_globe_radius),u_inv_proj_matrix:new h.bS(u,e.u_inv_proj_matrix)}),sky:(u,e)=>({u_sky_color:new h.bR(u,e.u_sky_color),u_horizon_color:new h.bR(u,e.u_horizon_color),u_horizon:new h.bV(u,e.u_horizon),u_horizon_normal:new h.bV(u,e.u_horizon_normal),u_sky_horizon_blend:new h.bg(u,e.u_sky_horizon_blend),u_sky_blend:new h.bg(u,e.u_sky_blend)})};class Mn{constructor(e,a,n){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!n,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const a=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const In={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jl{constructor(e,a,n,c){this.length=a.length,this.attributes=n,this.itemSize=a.bytesPerElement,this.dynamicDraw=c,this.context=e;const d=e.gl;this.buffer=d.createBuffer(),e.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete a.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,a){for(let n=0;n<this.attributes.length;n++){const c=a.attributes[this.attributes[n].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,a,n){for(let c=0;c<this.attributes.length;c++){const d=this.attributes[c],m=a.attributes[d.name];m!==void 0&&e.vertexAttribPointer(m,d.components,e[In[d.type]],!1,this.itemSize,d.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class re{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class mo extends re{getDefault(){return h.bf.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Cn extends re{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class th extends re{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class eh extends re{getDefault(){return[!0,!0,!0,!0]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ih extends re{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class rh extends re{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class Vl extends re{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const a=this.current;(e.func!==a.func||e.ref!==a.ref||e.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class oh extends re{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class Nl extends re{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=e,this.dirty=!1}}class xs extends re{getDefault(){return[0,1]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class vs extends re{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=e,this.dirty=!1}}class bs extends re{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class An extends re{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.BLEND):a.disable(a.BLEND),this.current=e,this.dirty=!1}}class _o extends re{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class ka extends re{getDefault(){return h.bf.transparent}set(e){const a=this.current;(e.r!==a.r||e.g!==a.g||e.b!==a.b||e.a!==a.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Xo extends re{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class Zi extends re{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;e?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=e,this.dirty=!1}}class Ul extends re{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class $l extends re{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class zn extends re{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class go extends re{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class ws extends re{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const a=this.current;(e[0]!==a[0]||e[1]!==a[1]||e[2]!==a[2]||e[3]!==a[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ts extends re{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Da extends re{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ss extends re{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class Zl extends re{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ko extends re{getDefault(){return null}set(e){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Yo extends re{getDefault(){return null}set(e){var a;if(e===this.current&&!this.dirty)return;const n=this.gl;nr(n)?n.bindVertexArray(e):(a=n.getExtension("OES_vertex_array_object"))===null||a===void 0||a.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Gl extends re{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Rn extends re{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Jt extends re{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Qo extends re{constructor(e,a){super(e),this.context=e,this.parent=a}getDefault(){return null}}class ah extends Qo{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class ql extends Qo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class La extends Qo{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,e),this.current=e,this.dirty=!1}}const Wl="Framebuffer is not complete";class sh{constructor(e,a,n,c,d){this.context=e,this.width=a,this.height=n;const m=e.gl,y=this.framebuffer=m.createFramebuffer();if(this.colorAttachment=new ah(e,y),c)this.depthAttachment=d?new La(e,y):new ql(e,y);else if(d)throw new Error("Stencil cannot be set without depth");if(m.checkFramebufferStatus(m.FRAMEBUFFER)!==m.FRAMEBUFFER_COMPLETE)throw new Error(Wl)}destroy(){const e=this.context.gl,a=this.colorAttachment.get();if(a&&e.deleteTexture(a),this.depthAttachment){const n=this.depthAttachment.get();n&&e.deleteRenderbuffer(n)}e.deleteFramebuffer(this.framebuffer)}}class Hl{constructor(e){var a,n;if(this.gl=e,this.clearColor=new mo(this),this.clearDepth=new Cn(this),this.clearStencil=new th(this),this.colorMask=new eh(this),this.depthMask=new ih(this),this.stencilMask=new rh(this),this.stencilFunc=new Vl(this),this.stencilOp=new oh(this),this.stencilTest=new Nl(this),this.depthRange=new xs(this),this.depthTest=new vs(this),this.depthFunc=new bs(this),this.blend=new An(this),this.blendFunc=new _o(this),this.blendColor=new ka(this),this.blendEquation=new Xo(this),this.cullFace=new Zi(this),this.cullFaceSide=new Ul(this),this.frontFace=new $l(this),this.program=new zn(this),this.activeTexture=new go(this),this.viewport=new ws(this),this.bindFramebuffer=new Ts(this),this.bindRenderbuffer=new Da(this),this.bindTexture=new Ss(this),this.bindVertexBuffer=new Zl(this),this.bindElementBuffer=new Ko(this),this.bindVertexArray=new Yo(this),this.pixelStoreUnpack=new Gl(this),this.pixelStoreUnpackPremultiplyAlpha=new Rn(this),this.pixelStoreUnpackFlipY=new Jt(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),nr(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(a=e.RGBA16F)!==null&&a!==void 0?a:c?.RGBA16F_EXT,this.RGB16F=(n=e.RGB16F)!==null&&n!==void 0?n:c?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,a){return new Mn(this,e,a)}createVertexBuffer(e,a,n){return new jl(this,e,a,n)}createRenderbuffer(e,a,n){const c=this.gl,d=c.createRenderbuffer();return this.bindRenderbuffer.set(d),c.renderbufferStorage(c.RENDERBUFFER,e,a,n),this.bindRenderbuffer.set(null),d}createFramebuffer(e,a,n,c){return new sh(this,e,a,n,c)}clear({color:e,depth:a,stencil:n}){const c=this.gl;let d=0;e&&(d|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),a!==void 0&&(d|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),n!==void 0&&(d|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),c.clear(d)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){h.bH(e.blendFunction,le.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return nr(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var a;return nr(this.gl)?this.gl.deleteVertexArray(e):(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}let Ps;function Ms(u,e,a,n,c){const d=u.context,m=u.transform,y=d.gl,x=u.useProgram("collisionBox"),w=[];let T=0,M=0;for(let V=0;V<n.length;V++){const $=n[V],W=e.getTile($).getBucket(a);if(!W)continue;const U=c?W.textCollisionBox:W.iconCollisionBox,H=W.collisionCircleArray;H.length>0&&(w.push({circleArray:H,circleOffset:M,coord:$}),T+=H.length/4,M=T),U&&x.draw(d,y.LINES,Ot.disabled,Yt.disabled,u.colorModeForRenderPass(),ie.disabled,Yc(u.transform),u.style.map.terrain&&u.style.map.terrain.getTerrainData($),m.getProjectionData({overscaledTileID:$,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),a.id,U.layoutVertexBuffer,U.indexBuffer,U.segments,null,u.transform.zoom,null,null,U.collisionVertexBuffer)}if(!c||!w.length)return;const P=u.useProgram("collisionCircle"),A=new h.c0;A.resize(4*T),A._trim();let D=0;for(const V of w)for(let $=0;$<V.circleArray.length/4;$++){const W=4*$,U=V.circleArray[W+0],H=V.circleArray[W+1],Y=V.circleArray[W+2],Z=V.circleArray[W+3];A.emplace(D++,U,H,Y,Z,0),A.emplace(D++,U,H,Y,Z,1),A.emplace(D++,U,H,Y,Z,2),A.emplace(D++,U,H,Y,Z,3)}(!Ps||Ps.length<2*T)&&(Ps=(function(V){const $=2*V,W=new h.c2;W.resize($),W._trim();for(let U=0;U<$;U++){const H=6*U;W.uint16[H+0]=4*U+0,W.uint16[H+1]=4*U+1,W.uint16[H+2]=4*U+2,W.uint16[H+3]=4*U+2,W.uint16[H+4]=4*U+3,W.uint16[H+5]=4*U+0}return W})(T));const O=d.createIndexBuffer(Ps,!0),j=d.createVertexBuffer(A,h.c1.members,!0);for(const V of w){const $=Cl(u.transform);P.draw(d,y.TRIANGLES,Ot.disabled,Yt.disabled,u.colorModeForRenderPass(),ie.disabled,$,u.style.map.terrain&&u.style.map.terrain.getTerrainData(V.coord),null,a.id,j,O,h.aM.simpleSegment(0,2*V.circleOffset,V.circleArray.length,V.circleArray.length/2),null,u.transform.zoom,null,null,null)}j.destroy(),O.destroy()}const Is=h.ai(new Float32Array(16));function Cs(u,e,a,n,c,d){const{horizontalAlign:m,verticalAlign:y}=h.aH(u);return new h.P((-(m-.5)*e/c+n[0])*d,(-(y-.5)*a/c+n[1])*d)}function As(u,e,a,n,c,d){const m=e.tileAnchorPoint.add(new h.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let y=n.mult(d);a||(y=y.rotate(-c));const x=m.add(y);return yi(x.x,x.y,e.pitchedLabelPlaneMatrix,e.getElevation).point}if(a){const y=Nt(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(u),x=Math.atan(y.y/y.x)+(y.x<0?Math.PI:0);return u.add(n.rotate(x))}return u.add(n)}function En(u,e,a,n,c,d,m,y,x,w,T,M){const P=u.text.placedSymbolArray,A=u.text.dynamicLayoutVertexArray,D=u.icon.dynamicLayoutVertexArray,O={};A.clear();for(let j=0;j<P.length;j++){const V=P.get(j),$=V.hidden||!V.crossTileID||u.allowVerticalPlacement&&!V.placedOrientation?null:n[V.crossTileID];if($){const W=new h.P(V.anchorX,V.anchorY),U={getElevation:M,width:c.width,height:c.height,pitchedLabelPlaneMatrix:d,pitchWithMap:a,transform:c,tileAnchorPoint:W,translation:w,unwrappedTileID:T},H=a?Oo(W.x,W.y,U):Nt(W.x,W.y,U),Y=ao(c.cameraToCenterDistance,H.signedDistanceFromCamera);let Z=h.ap(u.textSizeData,y,V)*Y/h.aB;a&&(Z*=u.tilePixelRatio/m);const{width:J,height:lt,anchor:ot,textOffset:st,textBoxScale:ct}=$,xt=Cs(ot,J,lt,st,ct,Z),vt=c.getPitchedTextCorrection(W.x+w[0],W.y+w[1],T),mt=As(H.point,U,e,xt,-c.bearingInRadians,vt),At=u.allowVerticalPlacement&&V.placedOrientation===h.ao.vertical?Math.PI/2:0;for(let jt=0;jt<V.numGlyphs;jt++)h.av(A,mt,At);x&&V.associatedIconIndex>=0&&(O[V.associatedIconIndex]={shiftedAnchor:mt,angle:At})}else Sr(V.numGlyphs,A)}if(x){D.clear();const j=u.icon.placedSymbolArray;for(let V=0;V<j.length;V++){const $=j.get(V);if($.hidden)Sr($.numGlyphs,D);else{const W=O[V];if(W)for(let U=0;U<$.numGlyphs;U++)h.av(D,W.shiftedAnchor,W.angle);else Sr($.numGlyphs,D)}}u.icon.dynamicLayoutVertexBuffer.updateData(D)}u.text.dynamicLayoutVertexBuffer.updateData(A)}function Xl(u,e,a){return a.iconsInText&&e?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function Fa(u,e,a,n,c,d,m,y,x,w,T,M,P){const A=u.context,D=A.gl,O=u.transform,j=y==="map",V=x==="map",$=y!=="viewport"&&a.layout.get("symbol-placement")!=="point",W=j&&!V&&!$,U=!a.layout.get("symbol-sort-key").isConstant();let H=!1;const Y=u.getDepthModeForSublayer(0,Ot.ReadOnly),Z=a._unevaluatedLayout.hasValue("text-variable-anchor")||a._unevaluatedLayout.hasValue("text-variable-anchor-offset"),J=[],lt=O.getCircleRadiusCorrection();for(const ot of n){const st=e.getTile(ot),ct=st.getBucket(a);if(!ct)continue;const xt=c?ct.text:ct.icon;if(!xt||!xt.segments.get().length||!xt.hasVisibleVertices)continue;const vt=xt.programConfigurations.get(a.id),mt=c||ct.sdfIcons,At=c?ct.textSizeData:ct.iconSizeData,jt=V||O.pitch!==0,ae=u.useProgram(Xl(mt,c,ct),vt),_e=h.an(At,O.zoom),de=u.style.map.terrain&&u.style.map.terrain.getTerrainData(ot);let Wt,ue,Ze,Se,Xe=[0,0],De=null;if(c)ue=st.glyphAtlasTexture,Ze=D.LINEAR,Wt=st.glyphAtlasTexture.size,ct.iconsInText&&(Xe=st.imageAtlasTexture.size,De=st.imageAtlasTexture,Se=jt||u.options.rotating||u.options.zooming||At.kind==="composite"||At.kind==="camera"?D.LINEAR:D.NEAREST);else{const Be=a.layout.get("icon-size").constantOr(0)!==1||ct.iconsNeedLinear;ue=st.imageAtlasTexture,Ze=mt||u.options.rotating||u.options.zooming||Be||jt?D.LINEAR:D.NEAREST,Wt=st.imageAtlasTexture.size}const Le=h.aC(st,1,u.transform.zoom),ni=ke(j,u.transform,Le),$r=h.L();h.aq($r,ni);const Zr=_t(V,j,u.transform,Le),To=h.aD(O,st,d,m),Gr=O.getProjectionData({overscaledTileID:ot,applyGlobeMatrix:!P,applyTerrainMatrix:!0}),So=Z&&ct.hasTextData(),Za=a.layout.get("icon-text-fit")!=="none"&&So&&ct.hasIconData();if($){const Be=u.style.map.terrain?(zi,ze)=>u.style.map.terrain.getElevation(ot,zi,ze):null,Ke=a.layout.get("text-rotation-alignment")==="map";wt(ct,u,c,ni,$r,V,w,Ke,ot.toUnwrapped(),O.width,O.height,To,Be)}const qr=c&&Z||Za,Si=$||qr?Is:V?ni:u.transform.clipSpaceToPixelsMatrix,fi=mt&&a.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let pr;pr=mt?ct.iconsInText?Sn(At.kind,_e,W,V,$,qr,u,Si,Zr,To,Wt,Xe,lt):Tn(At.kind,_e,W,V,$,qr,u,Si,Zr,To,c,Wt,0,lt):wn(At.kind,_e,W,V,$,qr,u,Si,Zr,To,c,Wt,lt);const da={program:ae,buffers:xt,uniformValues:pr,projectionData:Gr,atlasTexture:ue,atlasTextureIcon:De,atlasInterpolation:Ze,atlasInterpolationIcon:Se,isSDF:mt,hasHalo:fi};if(U&&ct.canOverlap){H=!0;const Be=xt.segments.get();for(const Ke of Be)J.push({segments:new h.aM([Ke]),sortKey:Ke.sortKey,state:da,terrainData:de})}else J.push({segments:xt.segments,sortKey:0,state:da,terrainData:de})}H&&J.sort(((ot,st)=>ot.sortKey-st.sortKey));for(const ot of J){const st=ot.state;if(A.activeTexture.set(D.TEXTURE0),st.atlasTexture.bind(st.atlasInterpolation,D.CLAMP_TO_EDGE),st.atlasTextureIcon&&(A.activeTexture.set(D.TEXTURE1),st.atlasTextureIcon&&st.atlasTextureIcon.bind(st.atlasInterpolationIcon,D.CLAMP_TO_EDGE)),st.isSDF){const ct=st.uniformValues;st.hasHalo&&(ct.u_is_halo=1,Ba(st.buffers,ot.segments,a,u,st.program,Y,T,M,ct,st.projectionData,ot.terrainData)),ct.u_is_halo=0}Ba(st.buffers,ot.segments,a,u,st.program,Y,T,M,st.uniformValues,st.projectionData,ot.terrainData)}}function Ba(u,e,a,n,c,d,m,y,x,w,T){const M=n.context;c.draw(M,M.gl.TRIANGLES,d,m,y,ie.backCCW,x,T,w,a.id,u.layoutVertexBuffer,u.indexBuffer,e,a.paint,n.transform.zoom,u.programConfigurations.get(a.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function zs(u,e,a,n,c){const d=u.context,m=d.gl,y=Yt.disabled,x=new le([m.ONE,m.ONE],h.bf.transparent,[!0,!0,!0,!0]),w=e.getBucket(a);if(!w)return;const T=n.key;let M=a.heatmapFbos.get(T);M||(M=Rs(d,e.tileSize,e.tileSize),a.heatmapFbos.set(T,M)),d.bindFramebuffer.set(M.framebuffer),d.viewport.set([0,0,e.tileSize,e.tileSize]),d.clear({color:h.bf.transparent});const P=w.programConfigurations.get(a.id),A=u.useProgram("heatmap",P,!c),D=u.transform.getProjectionData({overscaledTileID:e.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),O=u.style.map.terrain.getTerrainData(n);A.draw(d,m.TRIANGLES,Ot.disabled,y,x,ie.disabled,bn(e,u.transform.zoom,a.paint.get("heatmap-intensity"),1),O,D,a.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,a.paint,u.transform.zoom,P)}function Jo(u,e,a,n,c){const d=u.context,m=d.gl,y=u.transform;d.setColorMode(u.colorModeForRenderPass());const x=Kl(d,e),w=a.key,T=e.heatmapFbos.get(w);if(!T)return;d.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,T.colorAttachment.get()),d.activeTexture.set(m.TEXTURE1),x.bind(m.LINEAR,m.CLAMP_TO_EDGE);const M=y.getProjectionData({overscaledTileID:a,applyTerrainMatrix:c,applyGlobeMatrix:!n});u.useProgram("heatmapTexture").draw(d,m.TRIANGLES,Ot.disabled,Yt.disabled,u.colorModeForRenderPass(),ie.disabled,gs(u,e,0,1),null,M,e.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments,e.paint,y.zoom),T.destroy(),e.heatmapFbos.delete(w)}function Rs(u,e,a){var n,c;const d=u.gl,m=d.createTexture();d.bindTexture(d.TEXTURE_2D,m),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.CLAMP_TO_EDGE),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR);const y=(n=u.HALF_FLOAT)!==null&&n!==void 0?n:d.UNSIGNED_BYTE,x=(c=u.RGBA16F)!==null&&c!==void 0?c:d.RGBA;d.texImage2D(d.TEXTURE_2D,0,x,e,a,0,d.RGBA,y,null);const w=u.createFramebuffer(e,a,!1,!1);return w.colorAttachment.set(m),w}function Kl(u,e){return e.colorRampTexture||(e.colorRampTexture=new h.T(u,e.colorRamp,u.gl.RGBA)),e.colorRampTexture}function ta(u,e,a,n,c,d,m,y){let x=256;if(c.stepInterpolant){const w=e.getSource().maxzoom,T=m.canonical.z===w?Math.ceil(1<<u.transform.maxZoom-m.canonical.z):1;x=h.ae(h.c4(d.maxLineLength/h.$*1024*T),256,a.maxTextureSize)}return y.gradient=h.c5({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:x,image:y.gradient||void 0,clips:d.lineClipsArray}),y.texture?y.texture.update(y.gradient):y.texture=new h.T(a,y.gradient,n.RGBA),y.version=c.gradientVersion,y.texture}function nh(u,e,a,n,c){u.activeTexture.set(e.TEXTURE0),a.imageAtlasTexture.bind(e.LINEAR,e.CLAMP_TO_EDGE),n.updatePaintBuffers(c)}function Yl(u,e,a,n,c,d){(c||u.lineAtlas.dirty)&&(e.activeTexture.set(a.TEXTURE0),u.lineAtlas.bind(e)),n.updatePaintBuffers(d)}function Es(u,e,a,n,c,d,m){const y=d.gradients[c.id];let x=y.texture;c.gradientVersion!==y.version&&(x=ta(u,e,a,n,c,d,m,y)),a.activeTexture.set(n.TEXTURE0),x.bind(c.stepInterpolant?n.NEAREST:n.LINEAR,n.CLAMP_TO_EDGE)}function kn(u,e,a,n,c,d,m,y,x){const w=d.gradients[c.id];let T=w.texture;c.gradientVersion!==w.version&&(T=ta(u,e,a,n,c,d,m,w)),a.activeTexture.set(n.TEXTURE0),T.bind(c.stepInterpolant?n.NEAREST:n.LINEAR,n.CLAMP_TO_EDGE),a.activeTexture.set(n.TEXTURE1),u.lineAtlas.bind(a),y.updatePaintBuffers(x)}function Dn(u,e,a,n,c){if(!a||!n||!n.imageAtlas)return;const d=n.imageAtlas.patternPositions;let m=d[a.to.toString()],y=d[a.from.toString()];if(!m&&y&&(m=y),!y&&m&&(y=m),!m||!y){const x=c.getPaintProperty(e);m=d[x],y=d[x]}m&&y&&u.setConstantPatternPositions(m,y)}function Ln(u,e,a,n,c,d,m,y){const x=u.context.gl,w="fill-pattern",T=a.paint.get(w),M=T&&T.constantOr(1),P=a.getCrossfadeParameters();let A,D,O,j,V;const $=u.transform,W=a.paint.get("fill-translate"),U=a.paint.get("fill-translate-anchor");m?(D=M&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",A=x.LINES):(D=M?"fillPattern":"fill",A=x.TRIANGLES);const H=T.constantOr(null);for(const Y of n){const Z=e.getTile(Y);if(M&&!Z.patternsLoaded())continue;const J=Z.getBucket(a);if(!J)continue;const lt=J.programConfigurations.get(a.id),ot=u.useProgram(D,lt),st=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Y);M&&(u.context.activeTexture.set(x.TEXTURE0),Z.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),lt.updatePaintBuffers(P)),Dn(lt,w,H,Z,a);const ct=$.getProjectionData({overscaledTileID:Y,applyGlobeMatrix:!y,applyTerrainMatrix:!0}),xt=h.aD($,Z,W,U);if(m){j=J.indexBuffer2,V=J.segments2;const mt=[x.drawingBufferWidth,x.drawingBufferHeight];O=D==="fillOutlinePattern"&&M?Kc(u,P,Z,mt,xt):_s(mt,xt)}else j=J.indexBuffer,V=J.segments,O=M?Il(u,P,Z,xt):{u_fill_translate:xt};const vt=u.stencilModeForClipping(Y);ot.draw(u.context,A,c,vt,d,ie.backCCW,O,st,ct,a.id,J.layoutVertexBuffer,j,V,a.paint,u.transform.zoom,lt)}}function ea(u,e,a,n,c,d,m,y){const x=u.context,w=x.gl,T="fill-extrusion-pattern",M=a.paint.get(T),P=M.constantOr(1),A=a.getCrossfadeParameters(),D=a.paint.get("fill-extrusion-opacity"),O=M.constantOr(null),j=u.transform;for(const V of n){const $=e.getTile(V),W=$.getBucket(a);if(!W)continue;const U=u.style.map.terrain&&u.style.map.terrain.getTerrainData(V),H=W.programConfigurations.get(a.id),Y=u.useProgram(P?"fillExtrusionPattern":"fillExtrusion",H);P&&(u.context.activeTexture.set(w.TEXTURE0),$.imageAtlasTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),H.updatePaintBuffers(A));const Z=j.getProjectionData({overscaledTileID:V,applyGlobeMatrix:!y,applyTerrainMatrix:!0});Dn(H,T,O,$,a);const J=h.aD(j,$,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),lt=a.paint.get("fill-extrusion-vertical-gradient"),ot=P?Ra(u,lt,D,J,V,A,$):qo(u,lt,D,J);Y.draw(x,x.gl.TRIANGLES,c,d,m,ie.backCCW,ot,U,Z,a.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,a.paint,u.transform.zoom,H,u.style.map.terrain&&W.centroidVertexBuffer)}}function Oa(u,e,a,n,c,d,m,y,x){var w;const T=u.style.projection,M=u.context,P=u.transform,A=M.gl,D=[`#define NUM_ILLUMINATION_SOURCES ${a.paint.get("hillshade-highlight-color").values.length}`],O=u.useProgram("hillshade",null,!1,D),j=!u.options.moving;for(const V of n){const $=e.getTile(V),W=$.fbo;if(!W)continue;const U=T.getMeshFromTileID(M,V.canonical,y,!0,"raster"),H=(w=u.style.map.terrain)===null||w===void 0?void 0:w.getTerrainData(V);M.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,W.colorAttachment.get());const Y=P.getProjectionData({overscaledTileID:V,aligned:j,applyGlobeMatrix:!x,applyTerrainMatrix:!0});O.draw(M,A.TRIANGLES,d,c[V.overscaledZ],m,ie.backCCW,zl(u,$,a),H,Y,a.id,U.vertexBuffer,U.indexBuffer,U.segments)}}function Fn(u,e,a,n,c,d,m,y,x){var w;const T=u.style.projection,M=u.context,P=u.transform,A=M.gl,D=u.useProgram("colorRelief"),O=!u.options.moving;let j=!0,V=0;for(const $ of n){const W=e.getTile($),U=W.dem;if(j){const ot=A.getParameter(A.MAX_TEXTURE_SIZE),{elevationTexture:st,colorTexture:ct}=a.getColorRampTextures(M,ot,U.getUnpackVector());M.activeTexture.set(A.TEXTURE1),st.bind(A.NEAREST,A.CLAMP_TO_EDGE),M.activeTexture.set(A.TEXTURE4),ct.bind(A.LINEAR,A.CLAMP_TO_EDGE),j=!1,V=st.size[0]}if(!U||!U.data)continue;const H=U.stride,Y=U.getPixels();if(M.activeTexture.set(A.TEXTURE0),M.pixelStoreUnpackPremultiplyAlpha.set(!1),W.demTexture=W.demTexture||u.getTileTexture(H),W.demTexture){const ot=W.demTexture;ot.update(Y,{premultiply:!1}),ot.bind(A.LINEAR,A.CLAMP_TO_EDGE)}else W.demTexture=new h.T(M,Y,A.RGBA,{premultiply:!1}),W.demTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE);const Z=T.getMeshFromTileID(M,$.canonical,y,!0,"raster"),J=(w=u.style.map.terrain)===null||w===void 0?void 0:w.getTerrainData($),lt=P.getProjectionData({overscaledTileID:$,aligned:O,applyGlobeMatrix:!x,applyTerrainMatrix:!0});D.draw(M,A.TRIANGLES,d,c[$.overscaledZ],m,ie.backCCW,kl(a,W.dem,V),J,lt,a.id,Z.vertexBuffer,Z.indexBuffer,Z.segments)}}const ks=[new h.P(0,0),new h.P(h.$,0),new h.P(h.$,h.$),new h.P(0,h.$)];function ve(u,e,a,n,c,d,m,y,x=!1,w=!1){const T=n[n.length-1].overscaledZ,M=u.context,P=M.gl,A=u.useProgram("raster"),D=u.transform,O=u.style.projection,j=u.colorModeForRenderPass(),V=!u.options.moving,$=a.paint.get("raster-opacity"),W=a.paint.get("raster-resampling"),U=a.paint.get("raster-fade-duration"),H=!!u.style.map.terrain;for(const Y of n){const Z=u.getDepthModeForSublayer(Y.overscaledZ-T,$===1?Ot.ReadWrite:Ot.ReadOnly,P.LESS),J=e.getTile(Y),lt=W==="nearest"?P.NEAREST:P.LINEAR;M.activeTexture.set(P.TEXTURE0),J.texture.bind(lt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),M.activeTexture.set(P.TEXTURE1);const{parentTile:ot,parentScaleBy:st,parentTopLeft:ct,fadeValues:xt}=yo(J,e,U,H);J.fadeOpacity=xt.tileOpacity,ot?(ot.fadeOpacity=xt.parentTileOpacity,ot.texture.bind(lt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST)):J.texture.bind(lt,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST),J.texture.useMipmap&&M.extTextureFilterAnisotropic&&u.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const vt=u.style.map.terrain&&u.style.map.terrain.getTerrainData(Y),mt=D.getProjectionData({overscaledTileID:Y,aligned:V,applyGlobeMatrix:!w,applyTerrainMatrix:!0}),At=Jc(ct,st,xt.fadeMix,a,y),jt=O.getMeshFromTileID(M,Y.canonical,d,m,"raster");A.draw(M,P.TRIANGLES,Z,c?c[Y.overscaledZ]:Yt.disabled,j,x?ie.frontCCW:ie.backCCW,At,vt,mt,a.id,jt.vertexBuffer,jt.indexBuffer,jt.segments)}}function yo(u,e,a,n){const c={parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:{tileOpacity:1,parentTileOpacity:1,fadeMix:{opacity:1,mix:0}}};if(a===0||n)return c;if(u.fadingParentID){const d=e._getLoadedTile(u.fadingParentID);if(!d)return c;const m=Math.pow(2,d.tileID.overscaledZ-u.tileID.overscaledZ),y=[u.tileID.canonical.x*m%1,u.tileID.canonical.y*m%1],x=(function(w,T,M){const P=Zt(),A=(P-T.timeAdded)/M,D=w.fadingDirection===E.Incoming,O=h.ae((P-w.timeAdded)/M,0,1),j=h.ae(1-A,0,1),V=D?O:j;return{tileOpacity:V,parentTileOpacity:D?j:O,fadeMix:{opacity:1,mix:1-V}}})(u,d,a);return{parentTile:d,parentScaleBy:m,parentTopLeft:y,fadeValues:x}}if(u.selfFading){const d=(function(m,y){const x=(Zt()-m.timeAdded)/y,w=h.ae(x,0,1);return{tileOpacity:w,fadeMix:{opacity:w,mix:0}}})(u,a);return{parentTile:null,parentScaleBy:1,parentTopLeft:[0,0],fadeValues:d}}return c}const Gi=new h.bf(1,0,0,1),Bn=new h.bf(0,1,0,1),Ds=new h.bf(0,0,1,1),Ql=new h.bf(1,0,1,1),ia=new h.bf(0,1,1,1);function Ls(u,e,a,n){oa(u,0,e+a/2,u.transform.width,a,n)}function ra(u,e,a,n){oa(u,e-a/2,0,a,u.transform.height,n)}function oa(u,e,a,n,c,d){const m=u.context,y=m.gl;y.enable(y.SCISSOR_TEST),y.scissor(e*u.pixelRatio,a*u.pixelRatio,n*u.pixelRatio,c*u.pixelRatio),m.clear({color:d}),y.disable(y.SCISSOR_TEST)}function Jl(u,e,a){const n=u.context,c=n.gl,d=u.useProgram("debug"),m=Ot.disabled,y=Yt.disabled,x=u.colorModeForRenderPass(),w="$debug",T=u.style.map.terrain&&u.style.map.terrain.getTerrainData(a);n.activeTexture.set(c.TEXTURE0);const M=e.getTileByID(a.key).latestRawTileData,P=Math.floor((M&&M.byteLength||0)/1024),A=e.getTile(a).tileSize,D=512/Math.min(A,512)*(a.overscaledZ/u.transform.zoom)*.5;let O=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(O+=` => ${a.overscaledZ}`),(function(V,$){V.initDebugOverlayCanvas();const W=V.debugOverlayCanvas,U=V.context.gl,H=V.debugOverlayCanvas.getContext("2d");H.clearRect(0,0,W.width,W.height),H.shadowColor="white",H.shadowBlur=2,H.lineWidth=1.5,H.strokeStyle="white",H.textBaseline="top",H.font="bold 36px Open Sans, sans-serif",H.fillText($,5,5),H.strokeText($,5,5),V.debugOverlayTexture.update(W),V.debugOverlayTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE)})(u,`${O} ${P}kB`);const j=u.transform.getProjectionData({overscaledTileID:a,applyGlobeMatrix:!0,applyTerrainMatrix:!0});d.draw(n,c.TRIANGLES,m,y,le.alphaBlended,ie.disabled,Al(h.bf.transparent,D),null,j,w,u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments),d.draw(n,c.LINE_STRIP,m,y,x,ie.disabled,Al(h.bf.red),T,j,w,u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments)}function On(u,e,a,n){const{isRenderingGlobe:c}=n,d=u.context,m=d.gl,y=u.transform,x=u.colorModeForRenderPass(),w=u.getDepthModeFor3D(),T=u.useProgram("terrain");d.bindFramebuffer.set(null),d.viewport.set([0,0,u.width,u.height]);for(const M of a){const P=e.getTerrainMesh(M.tileID),A=u.renderToTexture.getTexture(M),D=e.getTerrainData(M.tileID);d.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,A.texture);const O=e.getMeshFrameDelta(y.zoom),j=y.calculateFogMatrix(M.tileID.toUnwrapped()),V=xn(O,j,u.style.sky,y.pitch,c),$=y.getProjectionData({overscaledTileID:M.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});T.draw(d,m.TRIANGLES,w,Yt.disabled,x,ie.backCCW,V,D,$,"terrain",P.vertexBuffer,P.indexBuffer,P.segments)}}function jn(u,e){if(!e.mesh){const a=new h.aL;a.emplaceBack(-1,-1),a.emplaceBack(1,-1),a.emplaceBack(1,1),a.emplaceBack(-1,1);const n=new h.aN;n.emplaceBack(0,1,2),n.emplaceBack(0,2,3),e.mesh=new Xi(u.createVertexBuffer(a,Ut.members),u.createIndexBuffer(n),h.aM.simpleSegment(0,0,a.length,n.length))}return e.mesh}class tc{constructor(e,a){this.context=new Hl(e),this.transform=a,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:h.ai(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=oe.maxUnderzooming+oe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ho}resize(e,a,n){if(this.width=Math.floor(e*n),this.height=Math.floor(a*n),this.pixelRatio=n,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,a=new h.aL;a.emplaceBack(0,0),a.emplaceBack(h.$,0),a.emplaceBack(0,h.$),a.emplaceBack(h.$,h.$),this.tileExtentBuffer=e.createVertexBuffer(a,Ut.members),this.tileExtentSegments=h.aM.simpleSegment(0,0,4,2);const n=new h.aL;n.emplaceBack(0,0),n.emplaceBack(h.$,0),n.emplaceBack(0,h.$),n.emplaceBack(h.$,h.$),this.debugBuffer=e.createVertexBuffer(n,Ut.members),this.debugSegments=h.aM.simpleSegment(0,0,4,5);const c=new h.c7;c.emplaceBack(0,0,0,0),c.emplaceBack(h.$,0,h.$,0),c.emplaceBack(0,h.$,0,h.$),c.emplaceBack(h.$,h.$,h.$,h.$),this.rasterBoundsBuffer=e.createVertexBuffer(c,yn.members),this.rasterBoundsSegments=h.aM.simpleSegment(0,0,4,2);const d=new h.aL;d.emplaceBack(0,0),d.emplaceBack(h.$,0),d.emplaceBack(0,h.$),d.emplaceBack(h.$,h.$),this.rasterBoundsBufferPosOnly=e.createVertexBuffer(d,Ut.members),this.rasterBoundsSegmentsPosOnly=h.aM.simpleSegment(0,0,4,5);const m=new h.aL;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(m,Ut.members),this.viewportSegments=h.aM.simpleSegment(0,0,4,2);const y=new h.c8;y.emplaceBack(0),y.emplaceBack(1),y.emplaceBack(3),y.emplaceBack(2),y.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(y);const x=new h.aN;x.emplaceBack(1,0,2),x.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(x);const w=this.context.gl;this.stencilClearMode=new Yt({func:w.ALWAYS,mask:0},0,255,w.ZERO,w.ZERO,w.ZERO),this.tileExtentMesh=new Xi(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const e=this.context,a=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const n=h.L();h.bZ(n,0,this.width,this.height,0,0,1),h.N(n,n,[a.drawingBufferWidth,a.drawingBufferHeight,0]);const c={mainMatrix:n,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:n};this.useProgram("clippingMask",null,!0).draw(e,a.TRIANGLES,Ot.disabled,this.stencilClearMode,le.disabled,ie.disabled,null,null,c,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,a,n){if(this.currentStencilSource===e.source||!e.isTileClipped()||!a||!a.length)return;this.currentStencilSource=e.source,this.nextStencilID+a.length>256&&this.clearStencil();const c=this.context;c.setColorMode(le.disabled),c.setDepthMode(Ot.disabled);const d={};for(const m of a)d[m.key]=this.nextStencilID++;this._renderTileMasks(d,a,n,!0),this._renderTileMasks(d,a,n,!1),this._tileClippingMaskIDs=d}_renderTileMasks(e,a,n,c){const d=this.context,m=d.gl,y=this.style.projection,x=this.transform,w=this.useProgram("clippingMask");for(const T of a){const M=e[T.key],P=this.style.map.terrain&&this.style.map.terrain.getTerrainData(T),A=y.getMeshFromTileID(this.context,T.canonical,c,!0,"stencil"),D=x.getProjectionData({overscaledTileID:T,applyGlobeMatrix:!n,applyTerrainMatrix:!0});w.draw(d,m.TRIANGLES,Ot.disabled,new Yt({func:m.ALWAYS,mask:0},M,255,m.KEEP,m.KEEP,m.REPLACE),le.disabled,n?ie.disabled:ie.backCCW,null,P,D,"$clipping",A.vertexBuffer,A.indexBuffer,A.segments)}}_renderTilesDepthBuffer(){const e=this.context,a=e.gl,n=this.style.projection,c=this.transform,d=this.useProgram("depth"),m=this.getDepthModeFor3D(),y=Dt(c,{tileSize:c.tileSize});for(const x of y){const w=this.style.map.terrain&&this.style.map.terrain.getTerrainData(x),T=n.getMeshFromTileID(this.context,x.canonical,!0,!0,"raster"),M=c.getProjectionData({overscaledTileID:x,applyGlobeMatrix:!0,applyTerrainMatrix:!0});d.draw(e,a.TRIANGLES,m,Yt.disabled,le.disabled,ie.backCCW,null,w,M,"$clipping",T.vertexBuffer,T.indexBuffer,T.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,a=this.context.gl;return new Yt({func:a.NOTEQUAL,mask:255},e,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(e){const a=this.context.gl;return new Yt({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,a.KEEP,a.KEEP,a.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(e){const a=this.context.gl,n=e.sort(((m,y)=>y.overscaledZ-m.overscaledZ)),c=n[n.length-1].overscaledZ,d=n[0].overscaledZ-c+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const m={};for(let y=0;y<d;y++)m[y+c]=new Yt({func:a.GEQUAL,mask:255},y+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=d,[m,n]}return[{[c]:Yt.disabled},n]}stencilConfigForOverlapTwoPass(e){const a=this.context.gl,n=e.sort(((m,y)=>y.overscaledZ-m.overscaledZ)),c=n[n.length-1].overscaledZ,d=n[0].overscaledZ-c+1;if(this.clearStencil(),d>1){const m={},y={};for(let x=0;x<d;x++)m[x+c]=new Yt({func:a.GREATER,mask:255},d+1+x,255,a.KEEP,a.KEEP,a.REPLACE),y[x+c]=new Yt({func:a.GREATER,mask:255},1+x,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID=2*d+1,[m,y,n]}return this.nextStencilID=3,[{[c]:new Yt({func:a.GREATER,mask:255},2,255,a.KEEP,a.KEEP,a.REPLACE)},{[c]:new Yt({func:a.GREATER,mask:255},1,255,a.KEEP,a.KEEP,a.REPLACE)},n]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new le([e.CONSTANT_COLOR,e.ONE],new h.bf(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?le.unblended:le.alphaBlended}getDepthModeForSublayer(e,a,n){if(!this.opaquePassEnabledForLayer())return Ot.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Ot(n||this.context.gl.LEQUAL,a,[c,c])}getDepthModeFor3D(){return new Ot(this.context.gl.LEQUAL,Ot.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,a){var n,c;this.style=e,this.options=a,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(Zt()),this.imageManager.beginFrame();const d=this.style._order,m=this.style.sourceCaches,y={},x={},w={},T={isRenderingToTexture:!1,isRenderingGlobe:((n=e.projection)===null||n===void 0?void 0:n.transitionState)>0};for(const P in m){const A=m[P];A.used&&A.prepare(this.context),y[P]=A.getVisibleCoordinates(!1),x[P]=y[P].slice().reverse(),w[P]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let P=0;P<d.length;P++)if(this.style._layers[d[P]].is3D()){this.opaquePassCutoff=P;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const P of d){const A=this.style._layers[P];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const D=x[A.source];(A.type==="custom"||D.length)&&this.renderLayer(this,m[A.source],A,D,T)}if((c=this.style.projection)===null||c===void 0||c.updateGPUdependent({context:this.context,useProgram:P=>this.useProgram(P)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:a.showOverdrawInspector?h.bf.black:h.bf.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(P,A){const D=P.context,O=D.gl,j=((Y,Z,J)=>{const lt=Math.cos(Z.rollInRadians),ot=Math.sin(Z.rollInRadians),st=tt(Z),ct=Z.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:Y.properties.get("sky-color"),u_horizon_color:Y.properties.get("horizon-color"),u_horizon:[(Z.width/2-st*ot)*J,(Z.height/2+st*lt)*J],u_horizon_normal:[-ot,lt],u_sky_horizon_blend:Y.properties.get("sky-horizon-blend")*Z.height/2*J,u_sky_blend:ct}})(A,P.style.map.transform,P.pixelRatio),V=new Ot(O.LEQUAL,Ot.ReadWrite,[0,1]),$=Yt.disabled,W=P.colorModeForRenderPass(),U=P.useProgram("sky"),H=jn(D,A);U.draw(D,O.TRIANGLES,V,$,W,ie.disabled,j,null,void 0,"sky",H.vertexBuffer,H.indexBuffer,H.segments)})(this,this.style.sky),this._showOverdrawInspector=a.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const P=this.style._layers[d[this.currentLayer]],A=m[P.source],D=y[P.source];this._renderTileClippingMasks(P,D,!1),this.renderLayer(this,A,P,D,T)}this.renderPass="translucent";let M=!1;for(this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const P=this.style._layers[d[this.currentLayer]],A=m[P.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(P,T))continue;this.opaquePassEnabledForLayer()||M||(M=!0,T.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const D=(P.type==="symbol"?w:x)[P.source];this._renderTileClippingMasks(P,y[P.source],!!this.renderToTexture),this.renderLayer(this,A,P,D,T)}if(T.isRenderingGlobe&&(function(P,A,D){const O=P.context,j=O.gl,V=P.useProgram("atmosphere"),$=new Ot(j.LEQUAL,Ot.ReadOnly,[0,1]),W=P.transform,U=(function(ct,xt){const vt=ct.properties.get("position"),mt=[-vt.x,-vt.y,-vt.z],At=h.ai(new Float64Array(16));return ct.properties.get("anchor")==="map"&&(h.b6(At,At,xt.rollInRadians),h.b7(At,At,-xt.pitchInRadians),h.b6(At,At,xt.bearingInRadians),h.b7(At,At,xt.center.lat*Math.PI/180),h.bz(At,At,-xt.center.lng*Math.PI/180)),h.c6(mt,mt,At),mt})(D,P.transform),H=W.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Y=A.properties.get("atmosphere-blend")*H.projectionTransition;if(Y===0)return;const Z=jr(W.worldSize,W.center.lat),J=W.inverseProjectionMatrix,lt=new Float64Array(4);lt[3]=1,h.aw(lt,lt,W.modelViewProjectionMatrix),lt[0]/=lt[3],lt[1]/=lt[3],lt[2]/=lt[3],lt[3]=1,h.aw(lt,lt,J),lt[0]/=lt[3],lt[1]/=lt[3],lt[2]/=lt[3],lt[3]=1;const ot=((ct,xt,vt,mt,At)=>({u_sun_pos:ct,u_atmosphere_blend:xt,u_globe_position:vt,u_globe_radius:mt,u_inv_proj_matrix:At}))(U,Y,[lt[0],lt[1],lt[2]],Z,J),st=jn(O,A);V.draw(O,j.TRIANGLES,$,Yt.disabled,le.alphaBlended,ie.disabled,ot,null,null,"atmosphere",st.vertexBuffer,st.indexBuffer,st.segments)})(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const P=(function(A,D){let O=null;const j=Object.values(A._layers).flatMap((U=>U.source&&!U.isHidden(D)?[A.sourceCaches[U.source]]:[])),V=j.filter((U=>U.getSource().type==="vector")),$=j.filter((U=>U.getSource().type!=="vector")),W=U=>{(!O||O.getSource().maxzoom<U.getSource().maxzoom)&&(O=U)};return V.forEach((U=>W(U))),O||$.forEach((U=>W(U))),O})(this.style,this.transform.zoom);P&&(function(A,D,O){for(let j=0;j<O.length;j++)Jl(A,D,O[j])})(this,P,P.getVisibleCoordinates())}this.options.showPadding&&(function(P){const A=P.transform.padding;Ls(P,P.transform.height-(A.top||0),3,Gi),Ls(P,A.bottom||0,3,Bn),ra(P,A.left||0,3,Ds),ra(P,P.transform.width-(A.right||0),3,Ql);const D=P.transform.centerPoint;(function(O,j,V,$){oa(O,j-1,V-10,2,20,$),oa(O,j-10,V-1,20,2,$)})(P,D.x,P.transform.height-D.y,ia)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const a=this.terrainFacilitator.matrix,n=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!h.c9(a,n):!h.ca(a,n)),c||(c=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),c&&(h.cb(a,n),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(d,m){const y=d.context,x=y.gl,w=d.transform,T=le.unblended,M=new Ot(x.LEQUAL,Ot.ReadWrite,[0,1]),P=m.sourceCache.getRenderableTiles(),A=d.useProgram("terrainDepth");y.bindFramebuffer.set(m.getFramebuffer("depth").framebuffer),y.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),y.clear({color:h.bf.transparent,depth:1});for(const D of P){const O=m.getTerrainMesh(D.tileID),j=m.getTerrainData(D.tileID),V=w.getProjectionData({overscaledTileID:D.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),$={u_ele_delta:m.getMeshFrameDelta(w.zoom)};A.draw(y,x.TRIANGLES,M,Yt.disabled,T,ie.backCCW,$,j,V,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height])})(this,this.style.map.terrain),(function(d,m){const y=d.context,x=y.gl,w=d.transform,T=le.unblended,M=new Ot(x.LEQUAL,Ot.ReadWrite,[0,1]),P=m.getCoordsTexture(),A=m.sourceCache.getRenderableTiles(),D=d.useProgram("terrainCoords");y.bindFramebuffer.set(m.getFramebuffer("coords").framebuffer),y.viewport.set([0,0,d.width/devicePixelRatio,d.height/devicePixelRatio]),y.clear({color:h.bf.transparent,depth:1}),m.coordsIndex=[];for(const O of A){const j=m.getTerrainMesh(O.tileID),V=m.getTerrainData(O.tileID);y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,P.texture);const $={u_terrain_coords_id:(255-m.coordsIndex.length)/255,u_texture:0,u_ele_delta:m.getMeshFrameDelta(w.zoom)},W=w.getProjectionData({overscaledTileID:O.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});D.draw(y,x.TRIANGLES,M,Yt.disabled,T,ie.backCCW,$,V,W,"terrain",j.vertexBuffer,j.indexBuffer,j.segments),m.coordsIndex.push(O.tileID.key)}y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height])})(this,this.style.map.terrain))}renderLayer(e,a,n,c,d){n.isHidden(this.transform.zoom)||(n.type==="background"||n.type==="custom"||(c||[]).length)&&(this.id=n.id,h.cc(n)?(function(m,y,x,w,T,M){if(m.renderPass!=="translucent")return;const{isRenderingToTexture:P}=M,A=Yt.disabled,D=m.colorModeForRenderPass();(x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(O,j,V,$,W,U,H,Y,Z){const J=j.transform,lt=j.style.map.terrain,ot=W==="map",st=U==="map";for(const ct of O){const xt=$.getTile(ct),vt=xt.getBucket(V);if(!vt||!vt.text||!vt.text.segments.get().length)continue;const mt=h.an(vt.textSizeData,J.zoom),At=h.aC(xt,1,j.transform.zoom),jt=ke(ot,j.transform,At),ae=V.layout.get("icon-text-fit")!=="none"&&vt.hasIconData();if(mt){const _e=Math.pow(2,J.zoom-xt.tileID.overscaledZ),de=lt?(Wt,ue)=>lt.getElevation(ct,Wt,ue):null;En(vt,ot,st,Z,J,jt,_e,mt,ae,h.aD(J,xt,H,Y),ct.toUnwrapped(),de)}}})(w,m,x,y,x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),T),x.paint.get("icon-opacity").constantOr(1)!==0&&Fa(m,y,x,w,!1,x.paint.get("icon-translate"),x.paint.get("icon-translate-anchor"),x.layout.get("icon-rotation-alignment"),x.layout.get("icon-pitch-alignment"),x.layout.get("icon-keep-upright"),A,D,P),x.paint.get("text-opacity").constantOr(1)!==0&&Fa(m,y,x,w,!0,x.paint.get("text-translate"),x.paint.get("text-translate-anchor"),x.layout.get("text-rotation-alignment"),x.layout.get("text-pitch-alignment"),x.layout.get("text-keep-upright"),A,D,P),y.map.showCollisionBoxes&&(Ms(m,y,x,w,!0),Ms(m,y,x,w,!1))})(e,a,n,c,this.style.placement.variableOffsets,d):h.cd(n)?(function(m,y,x,w,T){if(m.renderPass!=="translucent")return;const{isRenderingToTexture:M}=T,P=x.paint.get("circle-opacity"),A=x.paint.get("circle-stroke-width"),D=x.paint.get("circle-stroke-opacity"),O=!x.layout.get("circle-sort-key").isConstant();if(P.constantOr(1)===0&&(A.constantOr(1)===0||D.constantOr(1)===0))return;const j=m.context,V=j.gl,$=m.transform,W=m.getDepthModeForSublayer(0,Ot.ReadOnly),U=Yt.disabled,H=m.colorModeForRenderPass(),Y=[],Z=$.getCircleRadiusCorrection();for(let J=0;J<w.length;J++){const lt=w[J],ot=y.getTile(lt),st=ot.getBucket(x);if(!st)continue;const ct=x.paint.get("circle-translate"),xt=x.paint.get("circle-translate-anchor"),vt=h.aD($,ot,ct,xt),mt=st.programConfigurations.get(x.id),At=m.useProgram("circle",mt),jt=st.layoutVertexBuffer,ae=st.indexBuffer,_e=m.style.map.terrain&&m.style.map.terrain.getTerrainData(lt),de={programConfiguration:mt,program:At,layoutVertexBuffer:jt,indexBuffer:ae,uniformValues:Wo(m,ot,x,vt,Z),terrainData:_e,projectionData:$.getProjectionData({overscaledTileID:lt,applyGlobeMatrix:!M,applyTerrainMatrix:!0})};if(O){const Wt=st.segments.get();for(const ue of Wt)Y.push({segments:new h.aM([ue]),sortKey:ue.sortKey,state:de})}else Y.push({segments:st.segments,sortKey:0,state:de})}O&&Y.sort(((J,lt)=>J.sortKey-lt.sortKey));for(const J of Y){const{programConfiguration:lt,program:ot,layoutVertexBuffer:st,indexBuffer:ct,uniformValues:xt,terrainData:vt,projectionData:mt}=J.state;ot.draw(j,V.TRIANGLES,W,U,H,ie.backCCW,xt,vt,mt,x.id,st,ct,J.segments,x.paint,m.transform.zoom,lt)}})(e,a,n,c,d):h.ce(n)?(function(m,y,x,w,T){if(x.paint.get("heatmap-opacity")===0)return;const M=m.context,{isRenderingToTexture:P,isRenderingGlobe:A}=T;if(m.style.map.terrain){for(const D of w){const O=y.getTile(D);y.hasRenderableParent(D)||(m.renderPass==="offscreen"?zs(m,O,x,D,A):m.renderPass==="translucent"&&Jo(m,x,D,P,A))}M.viewport.set([0,0,m.width,m.height])}else m.renderPass==="offscreen"?(function(D,O,j,V){const $=D.context,W=$.gl,U=D.transform,H=Yt.disabled,Y=new le([W.ONE,W.ONE],h.bf.transparent,[!0,!0,!0,!0]);(function(Z,J,lt){const ot=Z.gl;Z.activeTexture.set(ot.TEXTURE1),Z.viewport.set([0,0,J.width/4,J.height/4]);let st=lt.heatmapFbos.get(h.c3);st?(ot.bindTexture(ot.TEXTURE_2D,st.colorAttachment.get()),Z.bindFramebuffer.set(st.framebuffer)):(st=Rs(Z,J.width/4,J.height/4),lt.heatmapFbos.set(h.c3,st))})($,D,j),$.clear({color:h.bf.transparent});for(let Z=0;Z<V.length;Z++){const J=V[Z];if(O.hasRenderableParent(J))continue;const lt=O.getTile(J),ot=lt.getBucket(j);if(!ot)continue;const st=ot.programConfigurations.get(j.id),ct=D.useProgram("heatmap",st),xt=U.getProjectionData({overscaledTileID:J,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),vt=U.getCircleRadiusCorrection();ct.draw($,W.TRIANGLES,Ot.disabled,H,Y,ie.backCCW,bn(lt,U.zoom,j.paint.get("heatmap-intensity"),vt),null,xt,j.id,ot.layoutVertexBuffer,ot.indexBuffer,ot.segments,j.paint,U.zoom,st)}$.viewport.set([0,0,D.width,D.height])})(m,y,x,w):m.renderPass==="translucent"&&(function(D,O){const j=D.context,V=j.gl;j.setColorMode(D.colorModeForRenderPass());const $=O.heatmapFbos.get(h.c3);$&&(j.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,$.colorAttachment.get()),j.activeTexture.set(V.TEXTURE1),Kl(j,O).bind(V.LINEAR,V.CLAMP_TO_EDGE),D.useProgram("heatmapTexture").draw(j,V.TRIANGLES,Ot.disabled,Yt.disabled,D.colorModeForRenderPass(),ie.disabled,gs(D,O,0,1),null,null,O.id,D.viewportBuffer,D.quadTriangleIndexBuffer,D.viewportSegments,O.paint,D.transform.zoom))})(m,x)})(e,a,n,c,d):h.cf(n)?(function(m,y,x,w,T){if(m.renderPass!=="translucent")return;const{isRenderingToTexture:M}=T,P=x.paint.get("line-opacity"),A=x.paint.get("line-width");if(P.constantOr(1)===0||A.constantOr(1)===0)return;const D=m.getDepthModeForSublayer(0,Ot.ReadOnly),O=m.colorModeForRenderPass(),j=x.paint.get("line-dasharray"),V=j.constantOr(1),$=x.paint.get("line-pattern"),W=$.constantOr(1),U=x.paint.get("line-gradient"),H=x.getCrossfadeParameters();let Y;Y=W?"linePattern":V&&U?"lineGradientSDF":V?"lineSDF":U?"lineGradient":"line";const Z=m.context,J=Z.gl,lt=m.transform;let ot=!0;for(const st of w){const ct=y.getTile(st);if(W&&!ct.patternsLoaded())continue;const xt=ct.getBucket(x);if(!xt)continue;const vt=xt.programConfigurations.get(x.id),mt=m.context.program.get(),At=m.useProgram(Y,vt),jt=ot||At.program!==mt,ae=m.style.map.terrain&&m.style.map.terrain.getTerrainData(st),_e=$.constantOr(null),de=j&&j.constantOr(null);if(_e&&ct.imageAtlas){const Xe=ct.imageAtlas,De=Xe.patternPositions[_e.to.toString()],Le=Xe.patternPositions[_e.from.toString()];De&&Le&&vt.setConstantPatternPositions(De,Le)}else if(de){const Xe=x.layout.get("line-cap")==="round",De=m.lineAtlas.getDash(de.to,Xe),Le=m.lineAtlas.getDash(de.from,Xe);vt.setConstantDashPositions(De,Le)}const Wt=lt.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!M,applyTerrainMatrix:!0}),ue=lt.getPixelScale();let Ze;W?(Ze=Ll(m,ct,x,ue,H),nh(Z,J,ct,vt,H)):V&&U?(Ze=Qc(m,ct,x,ue,H,xt.lineClipsArray.length),kn(m,y,Z,J,x,xt,st,vt,H)):V?(Ze=Ea(m,ct,x,ue,H),Yl(m,Z,J,vt,jt,H)):U?(Ze=Dl(m,ct,x,ue,xt.lineClipsArray.length),Es(m,y,Z,J,x,xt,st)):Ze=lr(m,ct,x,ue);const Se=m.stencilModeForClipping(st);At.draw(Z,J.TRIANGLES,D,Se,O,ie.disabled,Ze,ae,Wt,x.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,x.paint,m.transform.zoom,vt,xt.layoutVertexBuffer2),ot=!1}})(e,a,n,c,d):h.cg(n)?(function(m,y,x,w,T){const M=x.paint.get("fill-color"),P=x.paint.get("fill-opacity");if(P.constantOr(1)===0)return;const{isRenderingToTexture:A}=T,D=m.colorModeForRenderPass(),O=x.paint.get("fill-pattern"),j=m.opaquePassEnabledForLayer()&&!O.constantOr(1)&&M.constantOr(h.bf.transparent).a===1&&P.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===j){const V=m.getDepthModeForSublayer(1,m.renderPass==="opaque"?Ot.ReadWrite:Ot.ReadOnly);Ln(m,y,x,w,V,D,!1,A)}if(m.renderPass==="translucent"&&x.paint.get("fill-antialias")){const V=m.getDepthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Ot.ReadOnly);Ln(m,y,x,w,V,D,!0,A)}})(e,a,n,c,d):h.ch(n)?(function(m,y,x,w,T){const M=x.paint.get("fill-extrusion-opacity");if(M===0)return;const{isRenderingToTexture:P}=T;if(m.renderPass==="translucent"){const A=new Ot(m.context.gl.LEQUAL,Ot.ReadWrite,m.depthRangeFor3D);if(M!==1||x.paint.get("fill-extrusion-pattern").constantOr(1))ea(m,y,x,w,A,Yt.disabled,le.disabled,P),ea(m,y,x,w,A,m.stencilModeFor3D(),m.colorModeForRenderPass(),P);else{const D=m.colorModeForRenderPass();ea(m,y,x,w,A,Yt.disabled,D,P)}}})(e,a,n,c,d):h.ci(n)?(function(m,y,x,w,T){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const{isRenderingToTexture:M}=T,P=m.context,A=m.style.projection.useSubdivision,D=m.getDepthModeForSublayer(0,Ot.ReadOnly),O=m.colorModeForRenderPass();if(m.renderPass==="offscreen")(function(j,V,$,W,U,H,Y){const Z=j.context,J=Z.gl;for(const lt of $){const ot=V.getTile(lt),st=ot.dem;if(!st||!st.data||!ot.needsHillshadePrepare)continue;const ct=st.dim,xt=st.stride,vt=st.getPixels();if(Z.activeTexture.set(J.TEXTURE1),Z.pixelStoreUnpackPremultiplyAlpha.set(!1),ot.demTexture=ot.demTexture||j.getTileTexture(xt),ot.demTexture){const At=ot.demTexture;At.update(vt,{premultiply:!1}),At.bind(J.NEAREST,J.CLAMP_TO_EDGE)}else ot.demTexture=new h.T(Z,vt,J.RGBA,{premultiply:!1}),ot.demTexture.bind(J.NEAREST,J.CLAMP_TO_EDGE);Z.activeTexture.set(J.TEXTURE0);let mt=ot.fbo;if(!mt){const At=new h.T(Z,{width:ct,height:ct,data:null},J.RGBA);At.bind(J.LINEAR,J.CLAMP_TO_EDGE),mt=ot.fbo=Z.createFramebuffer(ct,ct,!0,!1),mt.colorAttachment.set(At.texture)}Z.bindFramebuffer.set(mt.framebuffer),Z.viewport.set([0,0,ct,ct]),j.useProgram("hillshadePrepare").draw(Z,J.TRIANGLES,U,H,Y,ie.disabled,Rl(ot.tileID,st),null,null,W.id,j.rasterBoundsBuffer,j.quadTriangleIndexBuffer,j.rasterBoundsSegments),ot.needsHillshadePrepare=!1}})(m,y,w,x,D,Yt.disabled,O),P.viewport.set([0,0,m.width,m.height]);else if(m.renderPass==="translucent")if(A){const[j,V,$]=m.stencilConfigForOverlapTwoPass(w);Oa(m,y,x,$,j,D,O,!1,M),Oa(m,y,x,$,V,D,O,!0,M)}else{const[j,V]=m.getStencilConfigForOverlapAndUpdateStencilID(w);Oa(m,y,x,V,j,D,O,!1,M)}})(e,a,n,c,d):h.cj(n)?(function(m,y,x,w,T){if(m.renderPass!=="translucent"||!w.length)return;const{isRenderingToTexture:M}=T,P=m.style.projection.useSubdivision,A=m.getDepthModeForSublayer(0,Ot.ReadOnly),D=m.colorModeForRenderPass();if(P){const[O,j,V]=m.stencilConfigForOverlapTwoPass(w);Fn(m,y,x,V,O,A,D,!1,M),Fn(m,y,x,V,j,A,D,!0,M)}else{const[O,j]=m.getStencilConfigForOverlapAndUpdateStencilID(w);Fn(m,y,x,j,O,A,D,!1,M)}})(e,a,n,c,d):h.bK(n)?(function(m,y,x,w,T){if(m.renderPass!=="translucent"||x.paint.get("raster-opacity")===0||!w.length)return;const{isRenderingToTexture:M}=T,P=y.getSource(),A=m.style.projection.useSubdivision;if(P instanceof br)ve(m,y,x,w,null,!1,!1,P.tileCoords,P.flippedWindingOrder,M);else if(A){const[D,O,j]=m.stencilConfigForOverlapTwoPass(w);ve(m,y,x,j,D,!1,!0,ks,!1,M),ve(m,y,x,j,O,!0,!0,ks,!1,M)}else{const[D,O]=m.getStencilConfigForOverlapAndUpdateStencilID(w);ve(m,y,x,O,D,!1,!0,ks,!1,M)}})(e,a,n,c,d):h.ck(n)?(function(m,y,x,w,T){const M=x.paint.get("background-color"),P=x.paint.get("background-opacity");if(P===0)return;const{isRenderingToTexture:A}=T,D=m.context,O=D.gl,j=m.style.projection,V=m.transform,$=V.tileSize,W=x.paint.get("background-pattern");if(m.isPatternMissing(W))return;const U=!W&&M.a===1&&P===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==U)return;const H=Yt.disabled,Y=m.getDepthModeForSublayer(0,U==="opaque"?Ot.ReadWrite:Ot.ReadOnly),Z=m.colorModeForRenderPass(),J=m.useProgram(W?"backgroundPattern":"background"),lt=w||Dt(V,{tileSize:$,terrain:m.style.map.terrain});W&&(D.activeTexture.set(O.TEXTURE0),m.imageManager.bind(m.context));const ot=x.getCrossfadeParameters();for(const st of lt){const ct=V.getProjectionData({overscaledTileID:st,applyGlobeMatrix:!A,applyTerrainMatrix:!0}),xt=W?ys(P,m,W,{tileID:st,tileSize:$},ot):Ol(P,M),vt=m.style.map.terrain&&m.style.map.terrain.getTerrainData(st),mt=j.getMeshFromTileID(D,st.canonical,!1,!0,"raster");J.draw(D,O.TRIANGLES,Y,H,Z,ie.backCCW,xt,vt,ct,x.id,mt.vertexBuffer,mt.indexBuffer,mt.segments)}})(e,0,n,c,d):h.cl(n)&&(function(m,y,x,w){const{isRenderingGlobe:T}=w,M=m.context,P=x.implementation,A=m.style.projection,D=m.transform,O=D.getProjectionDataForCustomLayer(T),j={farZ:D.farZ,nearZ:D.nearZ,fov:D.fov*Math.PI/180,modelViewProjectionMatrix:D.modelViewProjectionMatrix,projectionMatrix:D.projectionMatrix,shaderData:{variantName:A.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${A.shaderPreludeCode.vertexSource}`,define:A.shaderDefine},defaultProjectionData:O},V=P.renderingMode?P.renderingMode:"2d";if(m.renderPass==="offscreen"){const $=P.prerender;$&&(m.setCustomLayerDefaults(),M.setColorMode(m.colorModeForRenderPass()),$.call(P,M.gl,j),M.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),M.setColorMode(m.colorModeForRenderPass()),M.setStencilMode(Yt.disabled);const $=V==="3d"?m.getDepthModeFor3D():m.getDepthModeForSublayer(0,Ot.ReadOnly);M.setDepthMode($),P.render(M.gl,j),M.setDirty(),m.setBaseState(),M.bindFramebuffer.set(null)}})(e,0,n,d))}saveTileTexture(e){const a=this._tileTextures[e.size[0]];a?a.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const a=this._tileTextures[e];return a&&a.length>0?a.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const a=this.imageManager.getPattern(e.from.toString()),n=this.imageManager.getPattern(e.to.toString());return!a||!n}useProgram(e,a,n=!1,c=[]){this.cache=this.cache||{};const d=!!this.style.map.terrain,m=this.style.projection,y=n?sr.projectionMercator:m.shaderPreludeCode,x=n?os:m.shaderDefine,w=e+(a?a.cacheKey:"")+`/${n?wl:m.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(d?"/terrain":"")+(c?`/${c.join("/")}`:"");return this.cache[w]||(this.cache[w]=new Xc(this.context,sr[e],a,Pn[e],this._showOverdrawInspector,d,y,x,c)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new h.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:a}=this.context.gl;return this.width!==e||this.height!==a}}function Vn(u,e){let a,n=!1,c=null,d=null;const m=()=>{c=null,n&&(u.apply(d,a),c=setTimeout(m,e),n=!1)};return(...y)=>(n=!0,d=this,a=y,c||m(),c)}class Vr{constructor(e){this._getCurrentHash=()=>{const a=window.location.hash.replace("#","");if(this._hashName){let n;return a.split("&").map((c=>c.split("="))).forEach((c=>{c[0]===this._hashName&&(n=c)})),(n&&n[1]||"").split("/")}return a.split("/")},this._onHashChange=()=>{const a=this._getCurrentHash();if(!this._isValidHash(a))return!1;const n=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(a[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:n,pitch:+(a[4]||0)}),!0},this._updateHashUnthrottled=()=>{const a=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,a)},this._removeHash=()=>{const a=this._getCurrentHash();if(a.length===0)return;const n=a.join("/");let c=n;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${n}`);let d=window.location.hash.replace(c,"");d.startsWith("#&")?d=d.slice(0,1)+d.slice(2):d==="#"&&(d="");let m=window.location.href.replace(/(#.+)?$/,d);m=m.replace("&&","&"),window.history.replaceState(window.history.state,null,m)},this._updateHash=Vn(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const a=this._map.getCenter(),n=Math.round(100*this._map.getZoom())/100,c=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,c),m=Math.round(a.lng*d)/d,y=Math.round(a.lat*d)/d,x=this._map.getBearing(),w=this._map.getPitch();let T="";if(T+=e?`/${m}/${y}/${n}`:`${n}/${y}/${m}`,(x||w)&&(T+="/"+Math.round(10*x)/10),w&&(T+=`/${Math.round(w)}`),this._hashName){const M=this._hashName;let P=!1;const A=window.location.hash.slice(1).split("&").map((D=>{const O=D.split("=")[0];return O===M?(P=!0,`${O}=${T}`):D})).filter((D=>D));return P||A.push(`${M}=${T}`),`#${A.join("&")}`}return`#${T}`}_isValidHash(e){if(e.length<3||e.some(isNaN))return!1;try{new h.S(+e[2],+e[1])}catch{return!1}const a=+e[0],n=+(e[3]||0),c=+(e[4]||0);return a>=this._map.getMinZoom()&&a<=this._map.getMaxZoom()&&n>=-180&&n<=180&&c>=this._map.getMinPitch()&&c<=this._map.getMaxPitch()}}const aa={linearity:.3,easing:h.cm(0,0,.3,1)},ec=h.e({deceleration:2500,maxSpeed:1400},aa),ic=h.e({deceleration:20,maxSpeed:1400},aa),rc=h.e({deceleration:1e3,maxSpeed:360},aa),oc=h.e({deceleration:1e3,maxSpeed:90},aa),ac=h.e({deceleration:1e3,maxSpeed:360},aa);class sc{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:Zt(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,a=Zt();for(;e.length>0&&a-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const a={zoom:0,bearing:0,pitch:0,roll:0,pan:new h.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)a.zoom+=d.zoomDelta||0,a.bearing+=d.bearingDelta||0,a.pitch+=d.pitchDelta||0,a.roll+=d.rollDelta||0,d.panDelta&&a.pan._add(d.panDelta),d.around&&(a.around=d.around),d.pinchAround&&(a.pinchAround=d.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(a.pan.mag()){const d=Nr(a.pan.mag(),n,h.e({},ec,e||{})),m=a.pan.mult(d.amount/a.pan.mag()),y=this._map.cameraHelper.handlePanInertia(m,this._map.transform);c.center=y.easingCenter,c.offset=y.easingOffset,sa(c,d)}if(a.zoom){const d=Nr(a.zoom,n,ic);c.zoom=this._map.transform.zoom+d.amount,sa(c,d)}if(a.bearing){const d=Nr(a.bearing,n,rc);c.bearing=this._map.transform.bearing+h.ae(d.amount,-179,179),sa(c,d)}if(a.pitch){const d=Nr(a.pitch,n,oc);c.pitch=this._map.transform.pitch+d.amount,sa(c,d)}if(a.roll){const d=Nr(a.roll,n,ac);c.roll=this._map.transform.roll+h.ae(d.amount,-179,179),sa(c,d)}if(c.zoom||c.bearing){const d=a.pinchAround===void 0?a.around:a.pinchAround;c.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),h.e(c,{noMoveStart:!0})}}function sa(u,e){(!u.duration||u.duration<e.duration)&&(u.duration=e.duration,u.easing=e.easing)}function Nr(u,e,a){const{maxSpeed:n,linearity:c,deceleration:d}=a,m=h.ae(u*c/(e/1e3),-n,n),y=Math.abs(m)/(d*c);return{easing:a.easing,duration:1e3*y,amount:m*(y/2)}}class Ai extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,n,c={}){n=n instanceof MouseEvent?n:new MouseEvent(e,n);const d=ht.mousePos(a.getCanvas(),n),m=a.unproject(d);super(e,h.e({point:d,lngLat:m,originalEvent:n},c)),this._defaultPrevented=!1,this.target=a}}class pi extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,n){const c=e==="touchend"?n.changedTouches:n.touches,d=ht.touchPos(a.getCanvasContainer(),c),m=d.map((x=>a.unproject(x))),y=d.reduce(((x,w,T,M)=>x.add(w.div(M.length))),new h.P(0,0));super(e,{points:d,point:y,lngLats:m,lngLat:a.unproject(y),originalEvent:n}),this._defaultPrevented=!1}}class qi extends h.l{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,a,n){super(e,{originalEvent:n}),this._defaultPrevented=!1}}class nc{constructor(e,a){this._map=e,this._clickTolerance=a.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new qi(e.type,this._map,e))}mousedown(e,a){return this._mousedownPos=a,this._firePreventable(new Ai(e.type,this._map,e))}mouseup(e){this._map.fire(new Ai(e.type,this._map,e))}click(e,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||this._map.fire(new Ai(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Ai(e.type,this._map,e))}mouseover(e){this._map.fire(new Ai(e.type,this._map,e))}mouseout(e){this._map.fire(new Ai(e.type,this._map,e))}touchstart(e){return this._firePreventable(new pi(e.type,this._map,e))}touchmove(e){this._map.fire(new pi(e.type,this._map,e))}touchend(e){this._map.fire(new pi(e.type,this._map,e))}touchcancel(e){this._map.fire(new pi(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Ai(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ai("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Ai(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hr{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.screenPointToLocation(h.P.convert(e),this._map.terrain)}}class lc{constructor(e,a){this._map=e,this._tr=new hr(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,a){this.isEnabled()&&e.shiftKey&&e.button===0&&(ht.disableDrag(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(e,a){if(!this._active)return;const n=a;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=n,this._box||(this._box=ht.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const d=Math.min(c.x,n.x),m=Math.max(c.x,n.x),y=Math.min(c.y,n.y),x=Math.max(c.y,n.y);ht.setTransform(this._box,`translate(${d}px,${y}px)`),this._box.style.width=m-d+"px",this._box.style.height=x-y+"px"}mouseupWindow(e,a){if(!this._active||e.button!==0)return;const n=this._startPos,c=a;if(this.reset(),ht.suppressClick(),n.x!==c.x||n.y!==c.y)return this._map.fire(new h.l("boxzoomend",{originalEvent:e})),{cameraAnimation:d=>d.fitScreenCoordinates(n,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ht.remove(this._box),this._box=null),ht.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,a){return this._map.fire(new h.l(e,{originalEvent:a}))}}function Nn(u,e){if(u.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${u.length}, points ${e.length}`);const a={};for(let n=0;n<u.length;n++)a[u[n].identifier]=e[n];return a}class lh{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,a,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=(function(c){const d=new h.P(0,0);for(const m of c)d._add(m);return d.div(c.length)})(a),this.touches=Nn(n,a)))}touchmove(e,a,n){if(this.aborted||!this.centroid)return;const c=Nn(n,a);for(const d in this.touches){const m=c[d];(!m||m.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(e,a,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),n.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class Un{constructor(e){this.singleTap=new lh(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,a,n){this.singleTap.touchstart(e,a,n)}touchmove(e,a,n){this.singleTap.touchmove(e,a,n)}touchend(e,a,n){const c=this.singleTap.touchend(e,a,n);if(c){const d=e.timeStamp-this.lastTime<500,m=!this.lastTap||this.lastTap.dist(c)<30;if(d&&m||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class cc{constructor(e){this._tr=new hr(e),this._zoomIn=new Un({numTouches:1,numTaps:2}),this._zoomOut=new Un({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,a,n){this._zoomIn.touchstart(e,a,n),this._zoomOut.touchstart(e,a,n)}touchmove(e,a,n){this._zoomIn.touchmove(e,a,n),this._zoomOut.touchmove(e,a,n)}touchend(e,a,n){const c=this._zoomIn.touchend(e,a,n),d=this._zoomOut.touchend(e,a,n),m=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:m.zoom+1,around:m.unproject(c)},{originalEvent:e})}):d?(this._active=!0,e.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:m.zoom-1,around:m.unproject(d)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const a=this._moveFunction(...e);if(a.bearingDelta||a.pitchDelta||a.rollDelta||a.around||a.panDelta)return this._active=!0,a}dragStart(e,a){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=Array.isArray(a)?a[0]:a,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,a){if(!this.isEnabled())return;const n=this._lastPoint;if(!n)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=Array.isArray(a)?a[0]:a;return!this._moved&&c.dist(n)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(n,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&ht.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Ir=0,Ct=2,hc={[Ir]:1,[Ct]:2};class xo{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const a=ht.mouseButton(e);this._eventButton=a}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!(function(a,n){const c=hc[n];return a.buttons===void 0||(a.buttons&c)!==c})(e,this._eventButton)}isValidEndEvent(e){return ht.mouseButton(e)===this._eventButton}}class uc{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}class ja{constructor(e=new xo({checkCorrectEvent:()=>!0}),a=new uc){this.mouseMoveStateManager=e,this.oneFingerTouchMoveStateManager=a}_executeRelevantHandler(e,a,n){return e instanceof MouseEvent?a(e):typeof TouchEvent<"u"&&e instanceof TouchEvent?n(e):void 0}startMove(e){this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.startMove(a)),(a=>this.oneFingerTouchMoveStateManager.startMove(a)))}endMove(e){this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.endMove(a)),(a=>this.oneFingerTouchMoveStateManager.endMove(a)))}isValidStartEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidStartEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidStartEvent(a)))}isValidMoveEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidMoveEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(a)))}isValidEndEvent(e){return this._executeRelevantHandler(e,(a=>this.mouseMoveStateManager.isValidEndEvent(a)),(a=>this.oneFingerTouchMoveStateManager.isValidEndEvent(a)))}}const Ur=u=>{u.mousedown=u.dragStart,u.mousemoveWindow=u.dragMove,u.mouseup=u.dragEnd,u.contextmenu=e=>{e.preventDefault()}};class $n{constructor(e,a){this._clickTolerance=e.clickTolerance||1,this._map=a,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new h.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,a,n){return this._calculateTransform(e,a,n)}touchmove(e,a,n){if(this._active){if(!this._shouldBePrevented(n.length))return e.preventDefault(),this._calculateTransform(e,a,n);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,a,n){this._calculateTransform(e,a,n),this._active&&this._shouldBePrevented(n.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,a,n){n.length>0&&(this._active=!0);const c=Nn(n,a),d=new h.P(0,0),m=new h.P(0,0);let y=0;for(const w in c){const T=c[w],M=this._touches[w];M&&(d._add(T),m._add(T.sub(M)),y++,c[w]=T)}if(this._touches=c,this._shouldBePrevented(y)||!m.mag())return;const x=m.div(y);return this._sum._add(x),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(y),panDelta:x}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qt{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,a,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([a[0],a[1]]))}touchmove(e,a,n){if(!this._firstTwoTouches)return;e.preventDefault();const[c,d]=this._firstTwoTouches,m=na(n,a,c),y=na(n,a,d);if(!m||!y)return;const x=this._aroundCenter?null:m.add(y).div(2);return this._move([m,y],x,e)}touchend(e,a,n){if(!this._firstTwoTouches)return;const[c,d]=this._firstTwoTouches,m=na(n,a,c),y=na(n,a,d);m&&y||(this._active&&ht.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function na(u,e,a){for(let n=0;n<u.length;n++)if(u[n].identifier===a)return e[n]}function dc(u,e){return Math.log(u/e)/Math.LN2}class Fs extends Qt{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,a){const n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(dc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:dc(this._distance,n),pinchAround:a}}}function pc(u,e){return 180*u.angleWith(e)/Math.PI}class fc extends Qt{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,a,n){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:pc(this._vector,c),pinchAround:a}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const a=25/(Math.PI*this._minDiameter)*360,n=pc(e,this._startVector);return Math.abs(n)<a}}function Bs(u){return Math.abs(u.y)>Math.abs(u.x)}class Os extends Qt{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,a,n){super.touchstart(e,a,n),this._currentTouchCount=n.length}_start(e){this._lastPoints=e,Bs(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,a,n){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),d=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,d,n.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+d.y)/2*-.5}):void 0}gestureBeginsVertically(e,a,n){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,d=a.mag()>=2;if(!c&&!d)return;if(!c||!d)return this._firstMove===void 0&&(this._firstMove=n),n-this._firstMove<100&&void 0;const m=e.y>0==a.y>0;return Bs(e)&&Bs(a)&&m}}const mc={panStep:100,bearingStep:15,pitchStep:10};class _c{constructor(e){this._tr=new hr(e);const a=mc;this._panStep=a.panStep,this._bearingStep=a.bearingStep,this._pitchStep=a.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let a=0,n=0,c=0,d=0,m=0;switch(e.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:e.shiftKey?n=-1:(e.preventDefault(),d=-1);break;case 39:e.shiftKey?n=1:(e.preventDefault(),d=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),m=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),m=1);break;default:return}return this._rotationDisabled&&(n=0,c=0),{cameraAnimation:y=>{const x=this._tr;y.easeTo({duration:300,easeId:"keyboardHandler",easing:gc,zoom:a?Math.round(x.zoom)+a*(e.shiftKey?2:1):x.zoom,bearing:x.bearing+n*this._bearingStep,pitch:x.pitch+c*this._pitchStep,offset:[-d*this._panStep,-m*this._panStep],center:x.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gc(u){return u*(2-u)}const yc=4.000244140625,ch=1/450;class Cr{constructor(e,a){this._onTimeout=n=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)},this._map=e,this._tr=new hr(e),this._triggerRenderFrame=a,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=ch}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let a=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const n=Zt(),c=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,a!==0&&a%yc==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=a,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),e.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=e,this._delta-=a,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=ht.mousePos(this._map.getCanvas(),e),n=this._tr;this._aroundPoint=this._aroundCenter?n.transform.locationToScreenPoint(h.S.convert(n.center)):a,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const y=e.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=y),typeof this._targetZoom=="number"&&(this._targetZoom+=y)}if(this._delta!==0){const y=this._type==="wheel"&&Math.abs(this._delta)>yc?this._wheelZoomRate:this._defaultZoomRate;let x=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&x!==0&&(x=1/x);const w=typeof this._targetZoom!="number"?e.scale:h.ah(this._targetZoom);this._targetZoom=e.constrain(e.getCameraLngLat(),h.ak(w*x)).zoom,this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const a=typeof this._targetZoom!="number"?e.zoom:this._targetZoom,n=this._startZoom,c=this._easing;let d,m=!1;if(this._type==="wheel"&&n&&c){const y=Zt()-this._lastWheelEventTime,x=Math.min((y+5)/200,1),w=c(x);d=h.C.number(n,a,w),x<1?this._frameId||(this._frameId=!0):m=!0}else d=a,m=!0;return this._active=!0,m&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout}),200)),this._lastExpectedZoom=d,{noInertia:!0,needsRenderFrame:!m,zoomDelta:d-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let a=h.co;if(this._prevEase){const n=this._prevEase,c=(Zt()-n.start)/n.duration,d=n.easing(c+.01)-n.easing(c),m=.27/Math.sqrt(d*d+1e-4)*.01,y=Math.sqrt(.0729-m*m);a=h.cm(m,y,.25,1)}return this._prevEase={start:Zt(),duration:e,easing:a},a}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ce{constructor(e,a){this._clickZoom=e,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hh{constructor(e){this._tr=new hr(e),this.reset()}reset(){this._active=!1}dblclick(e,a){return e.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(a)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class js{constructor(){this._tap=new Un({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,a,n){if(!this._swipePoint)if(this._tapTime){const c=a[0],d=e.timeStamp-this._tapTime<500,m=this._tapPoint.dist(c)<30;d&&m?n.length>0&&(this._swipePoint=c,this._swipeTouch=n[0].identifier):this.reset()}else this._tap.touchstart(e,a,n)}touchmove(e,a,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const c=a[0],d=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(e,a,n)}touchend(e,a,n){if(this._tapTime)this._swipePoint&&n.length===0&&this.reset();else{const c=this._tap.touchend(e,a,n);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vs{constructor(e,a,n){this._el=e,this._mousePan=a,this._touchPan=n}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zn{constructor(e,a,n,c){this._pitchWithRotate=e.pitchWithRotate,this._rollEnabled=e.rollEnabled,this._mouseRotate=a,this._mousePitch=n,this._mouseRoll=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class Gn{constructor(e,a,n,c){this._el=e,this._touchZoom=a,this._touchRotate=n,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class qn{constructor(e,a){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=a,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=ht.create("div","maplibregl-cooperative-gesture-screen",e);let a=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(a=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const n=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=a,this._container.appendChild(c);const d=document.createElement("div");d.className="maplibregl-mobile-message",d.textContent=n,this._container.appendChild(d),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ht.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,a){this._enabled&&(this._map.fire(new h.l("cooperativegestureprevented",{gestureType:e,originalEvent:a})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const Ns=u=>u.zoom||u.drag||u.roll||u.pitch||u.rotate;class ur extends h.l{}function la(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta||u.rollDelta}class Rt{constructor(e,a){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,d)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const m=c.type==="renderFrame"?void 0:c,y={needsRenderFrame:!1},x={},w={};for(const{handlerName:P,handler:A,allowed:D}of this._handlers){if(!A.isEnabled())continue;let O;if(this._blockedByActive(w,D,P))A.reset();else if(A[d||c.type]){if(h.cp(c,d||c.type)){const j=ht.mousePos(this._map.getCanvas(),c);O=A[d||c.type](c,j)}else if(h.cq(c,d||c.type)){const j=this._getMapTouches(c.touches),V=ht.touchPos(this._map.getCanvas(),j);O=A[d||c.type](c,V,j)}else h.cr(d||c.type)||(O=A[d||c.type](c));this.mergeHandlerResult(y,x,O,P,m),O&&O.needsRenderFrame&&this._triggerRenderFrame()}(O||A.isActive())&&(w[P]=A)}const T={};for(const P in this._previousActiveHandlers)w[P]||(T[P]=m);this._previousActiveHandlers=w,(Object.keys(T).length||la(y))&&(this._changes.push([y,x,T]),this._triggerRenderFrame()),(Object.keys(w).length||la(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:M}=y;M&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],M(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new sc(e),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(a);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,d,m]of this._listeners)ht.addEventListener(c,d,c===document?this.handleWindowEvent:this.handleEvent,m)}destroy(){for(const[e,a,n]of this._listeners)ht.removeEventListener(e,a,e===document?this.handleWindowEvent:this.handleEvent,n)}_addDefaultHandlers(e){const a=this._map,n=a.getCanvasContainer();this._add("mapEvent",new nc(a,e));const c=a.boxZoom=new lc(a,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const d=a.cooperativeGestures=new qn(a,e.cooperativeGestures);this._add("cooperativeGestures",d),e.cooperativeGestures&&d.enable();const m=new cc(a),y=new hh(a);a.doubleClickZoom=new ce(y,m),this._add("tapZoom",m),this._add("clickZoom",y),e.interactive&&e.doubleClickZoom&&a.doubleClickZoom.enable();const x=new js;this._add("tapDragZoom",x);const w=a.touchPitch=new Os(a);this._add("touchPitch",w),e.interactive&&e.touchPitch&&a.touchPitch.enable(e.touchPitch);const T=()=>a.project(a.getCenter()),M=(function({enable:U,clickTolerance:H,aroundCenter:Y=!0,minPixelCenterThreshold:Z=100,rotateDegreesPerPixelMoved:J=.8},lt){const ot=new xo({checkCorrectEvent:st=>ht.mouseButton(st)===0&&st.ctrlKey||ht.mouseButton(st)===2&&!st.ctrlKey});return new Mr({clickTolerance:H,move:(st,ct)=>{const xt=lt();if(Y&&Math.abs(xt.y-st.y)>Z)return{bearingDelta:h.cn(new h.P(st.x,ct.y),ct,xt)};let vt=(ct.x-st.x)*J;return Y&&ct.y<xt.y&&(vt=-vt),{bearingDelta:vt}},moveStateManager:ot,enable:U,assignEvents:Ur})})(e,T),P=(function({enable:U,clickTolerance:H,pitchDegreesPerPixelMoved:Y=-.5}){const Z=new xo({checkCorrectEvent:J=>ht.mouseButton(J)===0&&J.ctrlKey||ht.mouseButton(J)===2});return new Mr({clickTolerance:H,move:(J,lt)=>({pitchDelta:(lt.y-J.y)*Y}),moveStateManager:Z,enable:U,assignEvents:Ur})})(e),A=(function({enable:U,clickTolerance:H,rollDegreesPerPixelMoved:Y=.3},Z){const J=new xo({checkCorrectEvent:lt=>ht.mouseButton(lt)===2&&lt.ctrlKey});return new Mr({clickTolerance:H,move:(lt,ot)=>{const st=Z();let ct=(ot.x-lt.x)*Y;return ot.y<st.y&&(ct=-ct),{rollDelta:ct}},moveStateManager:J,enable:U,assignEvents:Ur})})(e,T);a.dragRotate=new Zn(e,M,P,A),this._add("mouseRotate",M,["mousePitch"]),this._add("mousePitch",P,["mouseRotate","mouseRoll"]),this._add("mouseRoll",A,["mousePitch"]),e.interactive&&e.dragRotate&&a.dragRotate.enable();const D=(function({enable:U,clickTolerance:H}){const Y=new xo({checkCorrectEvent:Z=>ht.mouseButton(Z)===0&&!Z.ctrlKey});return new Mr({clickTolerance:H,move:(Z,J)=>({around:J,panDelta:J.sub(Z)}),activateOnStart:!0,moveStateManager:Y,enable:U,assignEvents:Ur})})(e),O=new $n(e,a);a.dragPan=new Vs(n,D,O),this._add("mousePan",D),this._add("touchPan",O,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&a.dragPan.enable(e.dragPan);const j=new fc,V=new Fs;a.touchZoomRotate=new Gn(n,V,j,x),this._add("touchRotate",j,["touchPan","touchZoom"]),this._add("touchZoom",V,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&a.touchZoomRotate.enable(e.touchZoomRotate),this._add("blockableMapEvent",new Qi(a));const $=a.scrollZoom=new Cr(a,(()=>this._triggerRenderFrame()));this._add("scrollZoom",$,["mousePan"]),e.interactive&&e.scrollZoom&&a.scrollZoom.enable(e.scrollZoom);const W=a.keyboard=new _c(a);this._add("keyboard",W),e.interactive&&e.keyboard&&a.keyboard.enable()}_add(e,a,n){this._handlers.push({handlerName:e,handler:a,allowed:n}),this._handlersById[e]=a}stop(e){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ns(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,a,n){for(const c in e)if(c!==n&&(!a||a.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const a=[];for(const n of e)this._el.contains(n.target)&&a.push(n);return a}mergeHandlerResult(e,a,n,c,d){if(!n)return;h.e(e,n);const m={handlerName:c,originalEvent:n.originalEvent||d};n.zoomDelta!==void 0&&(a.zoom=m),n.panDelta!==void 0&&(a.drag=m),n.rollDelta!==void 0&&(a.roll=m),n.pitchDelta!==void 0&&(a.pitch=m),n.bearingDelta!==void 0&&(a.rotate=m)}_applyChanges(){const e={},a={},n={};for(const[c,d,m]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new h.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.rollDelta&&(e.rollDelta=(e.rollDelta||0)+c.rollDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),h.e(a,d),h.e(n,m);this._updateMapTransform(e,a,n),this._changes=[]}_updateMapTransform(e,a,n){const c=this._map,d=c._getTransformForUpdate(),m=c.terrain;if(!(la(e)||m&&this._terrainMovement))return this._fireEvents(a,n,!0);c._stop(!0);let{panDelta:y,zoomDelta:x,bearingDelta:w,pitchDelta:T,rollDelta:M,around:P,pinchAround:A}=e;A!==void 0&&(P=A),P=P||c.transform.centerPoint,m&&!d.isPointOnMapSurface(P)&&(P=d.centerPoint);const D={panDelta:y,zoomDelta:x,rollDelta:M,pitchDelta:T,bearingDelta:w,around:P};this._map.cameraHelper.useGlobeControls&&!d.isPointOnMapSurface(P)&&(P=d.centerPoint);const O=P.distSqr(d.centerPoint)<.01?d.center:d.screenPointToLocation(y?P.sub(y):P);this._handleMapControls({terrain:m,tr:d,deltasForHelper:D,preZoomAroundLoc:O,combinedEventsInProgress:a,panDelta:y}),c._applyUpdatedTransform(d),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(a,n,!0)}_handleMapControls({terrain:e,tr:a,deltasForHelper:n,preZoomAroundLoc:c,combinedEventsInProgress:d,panDelta:m}){const y=this._map.cameraHelper;if(y.handleMapControlsRollPitchBearingZoom(n,a),e)return y.useGlobeControls?(this._terrainMovement||!d.drag&&!d.zoom||(this._terrainMovement=!0,this._map._elevationFreeze=!0),void y.handleMapControlsPan(n,a,c)):this._terrainMovement||!d.drag&&!d.zoom?void(d.drag&&this._terrainMovement&&m?a.setCenter(a.screenPointToLocation(a.centerPoint.sub(m))):y.handleMapControlsPan(n,a,c)):(this._terrainMovement=!0,this._map._elevationFreeze=!0,void y.handleMapControlsPan(n,a,c));y.handleMapControlsPan(n,a,c)}_fireEvents(e,a,n){const c=Ns(this._eventsInProgress),d=Ns(e),m={};for(const M in e){const{originalEvent:P}=e[M];this._eventsInProgress[M]||(m[`${M}start`]=P),this._eventsInProgress[M]=e[M]}!c&&d&&this._fireEvent("movestart",d.originalEvent);for(const M in m)this._fireEvent(M,m[M]);d&&this._fireEvent("move",d.originalEvent);for(const M in e){const{originalEvent:P}=e[M];this._fireEvent(M,P)}const y={};let x;for(const M in this._eventsInProgress){const{handlerName:P,originalEvent:A}=this._eventsInProgress[M];this._handlersById[P].isActive()||(delete this._eventsInProgress[M],x=a[P]||A,y[`${M}end`]=x)}for(const M in y)this._fireEvent(M,y[M]);const w=Ns(this._eventsInProgress),T=(c||d)&&!w;if(T&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const M=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&M.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(M)}if(n&&T){this._updatingCamera=!0;const M=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),P=A=>A!==0&&-this._bearingSnap<A&&A<this._bearingSnap;!M||!M.essential&&We.prefersReducedMotion?(this._map.fire(new h.l("moveend",{originalEvent:x})),P(this._map.getBearing())&&this._map.resetNorth()):(P(M.bearing||this._map.getBearing())&&(M.bearing=0),M.freezeElevation=!0,this._map.easeTo(M,{originalEvent:x})),this._updatingCamera=!1}}_fireEvent(e,a){this._map.fire(new h.l(e,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((e=>{delete this._frameId,this.handleEvent(new ur("renderFrame",{timeStamp:e})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Ft extends h.E{constructor(e,a,n){super(),this._renderFrameCallback=()=>{const c=Math.min((Zt()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this.cameraHelper=a,this.on("moveend",(()=>{delete this._requestedCameraState}))}migrateProjection(e,a){e.apply(this.transform),this.transform=e,this.cameraHelper=a}getCenter(){return new h.S(this.transform.center.lng,this.transform.center.lat)}setCenter(e,a){return this.jumpTo({center:e},a)}getCenterElevation(){return this.transform.elevation}setCenterElevation(e,a){return this.jumpTo({elevation:e},a),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(e){this._centerClampedToGround=e}panBy(e,a,n){return e=h.P.convert(e).mult(-1),this.panTo(this.transform.center,h.e({offset:e},a),n)}panTo(e,a,n){return this.easeTo(h.e({center:e},a),n)}getZoom(){return this.transform.zoom}setZoom(e,a){return this.jumpTo({zoom:e},a),this}zoomTo(e,a,n){return this.easeTo(h.e({zoom:e},a),n)}zoomIn(e,a){return this.zoomTo(this.getZoom()+1,e,a),this}zoomOut(e,a){return this.zoomTo(this.getZoom()-1,e,a),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(e,a){return e!=this.transform.fov&&(this.transform.setFov(e),this.fire(new h.l("movestart",a)).fire(new h.l("move",a)).fire(new h.l("moveend",a))),this}getBearing(){return this.transform.bearing}setBearing(e,a){return this.jumpTo({bearing:e},a),this}getPadding(){return this.transform.padding}setPadding(e,a){return this.jumpTo({padding:e},a),this}rotateTo(e,a,n){return this.easeTo(h.e({bearing:e},a),n)}resetNorth(e,a){return this.rotateTo(0,h.e({duration:1e3},e),a),this}resetNorthPitch(e,a){return this.easeTo(h.e({bearing:0,pitch:0,roll:0,duration:1e3},e),a),this}snapToNorth(e,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,a):this}getPitch(){return this.transform.pitch}setPitch(e,a){return this.jumpTo({pitch:e},a),this}getRoll(){return this.transform.roll}setRoll(e,a){return this.jumpTo({roll:e},a),this}cameraForBounds(e,a){e=fe.convert(e).adjustAntiMeridian();const n=a&&a.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,a)}_cameraForBoxAndBearing(e,a,n,c){const d={top:0,bottom:0,right:0,left:0};if(typeof(c=h.e({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const w=c.padding;c.padding={top:w,bottom:w,right:w,left:w}}const m=h.e(d,c.padding);c.padding=m;const y=this.transform,x=new fe(e,a);return this.cameraHelper.cameraForBoxAndBearing(c,m,x,n,y)}fitBounds(e,a,n){return this._fitInternal(this.cameraForBounds(e,a),a,n)}fitScreenCoordinates(e,a,n,c,d){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(h.P.convert(e)),this.transform.screenPointToLocation(h.P.convert(a)),n,c),c,d)}_fitInternal(e,a,n){return e?(delete(a=h.e(e,a)).padding,a.linear?this.easeTo(a,n):this.flyTo(a,n)):this}jumpTo(e,a){this.stop();const n=this._getTransformForUpdate();let c=!1,d=!1,m=!1;const y=n.zoom;this.cameraHelper.handleJumpToCenterZoom(n,e);const x=n.zoom!==y;return"elevation"in e&&n.elevation!==+e.elevation&&n.setElevation(+e.elevation),"bearing"in e&&n.bearing!==+e.bearing&&(c=!0,n.setBearing(+e.bearing)),"pitch"in e&&n.pitch!==+e.pitch&&(d=!0,n.setPitch(+e.pitch)),"roll"in e&&n.roll!==+e.roll&&(m=!0,n.setRoll(+e.roll)),e.padding==null||n.isPaddingEqual(e.padding)||n.setPadding(e.padding),this._applyUpdatedTransform(n),this.fire(new h.l("movestart",a)).fire(new h.l("move",a)),x&&this.fire(new h.l("zoomstart",a)).fire(new h.l("zoom",a)).fire(new h.l("zoomend",a)),c&&this.fire(new h.l("rotatestart",a)).fire(new h.l("rotate",a)).fire(new h.l("rotateend",a)),d&&this.fire(new h.l("pitchstart",a)).fire(new h.l("pitch",a)).fire(new h.l("pitchend",a)),m&&this.fire(new h.l("rollstart",a)).fire(new h.l("roll",a)).fire(new h.l("rollend",a)),this.fire(new h.l("moveend",a))}calculateCameraOptionsFromTo(e,a,n,c=0){const d=h.a1.fromLngLat(e,a),m=h.a1.fromLngLat(n,c),y=m.x-d.x,x=m.y-d.y,w=m.z-d.z,T=Math.hypot(y,x,w);if(T===0)throw new Error("Can't calculate camera options with same From and To");const M=Math.hypot(y,x),P=h.ak(this.transform.cameraToCenterDistance/T/this.transform.tileSize),A=180*Math.atan2(y,-x)/Math.PI;let D=180*Math.acos(M/T)/Math.PI;return D=w<0?90-D:90+D,{center:m.toLngLat(),elevation:c,zoom:P,pitch:D,bearing:A}}calculateCameraOptionsFromCameraLngLatAltRotation(e,a,n,c,d){const m=this.transform.calculateCenterFromCameraLngLatAlt(e,a,n,c);return{center:m.center,elevation:m.elevation,zoom:m.zoom,bearing:n,pitch:c,roll:d}}easeTo(e,a){this._stop(!1,e.easeId),((e=h.e({offset:[0,0],duration:500,easing:h.co},e)).animate===!1||!e.essential&&We.prefersReducedMotion)&&(e.duration=0);const n=this._getTransformForUpdate(),c=this.getBearing(),d=n.pitch,m=n.roll,y="bearing"in e?this._normalizeBearing(e.bearing,c):c,x="pitch"in e?+e.pitch:d,w="roll"in e?this._normalizeBearing(e.roll,m):m,T="padding"in e?e.padding:n.padding,M=h.P.convert(e.offset);let P,A;e.around&&(P=h.S.convert(e.around),A=n.locationToScreenPoint(P));const D={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},O=this.cameraHelper.handleEaseTo(n,{bearing:y,pitch:x,roll:w,padding:T,around:P,aroundPoint:A,offsetAsPoint:M,offset:e.offset,zoom:e.zoom,center:e.center});return this._rotating=this._rotating||c!==y,this._pitching=this._pitching||x!==d,this._rolling=this._rolling||w!==m,this._padding=!n.isPaddingEqual(T),this._zooming=this._zooming||O.isZooming,this._easeId=e.easeId,this._prepareEase(a,e.noMoveStart,D),this.terrain&&this._prepareElevation(O.elevationCenter),this._ease((j=>{O.easeFunc(j),this.terrain&&!e.freezeElevation&&this._updateElevation(j),this._applyUpdatedTransform(n),this._fireMoveEvents(a)}),(j=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a,j)}),e),this}_prepareEase(e,a,n={}){this._moving=!0,a||n.moving||this.fire(new h.l("movestart",e)),this._zooming&&!n.zooming&&this.fire(new h.l("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new h.l("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new h.l("pitchstart",e)),this._rolling&&!n.rolling&&this.fire(new h.l("rollstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this._elevationStart!==void 0&&this._elevationCenter!==void 0||this._prepareElevation(this.transform.center),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const a=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&a!==this._elevationTarget){const n=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(n-(a-(n*e+this._elevationStart))/(1-e)),this._elevationTarget=a}this.transform.setElevation(h.C.number(this._elevationStart,this._elevationTarget,e))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){if(!this.terrain&&e.elevation>=0&&e.pitch<=90)return{};const a=e.getCameraLngLat(),n=e.getCameraAltitude(),c=this.terrain?this.terrain.getElevationForLngLatZoom(a,e.zoom):0;if(n<c){const d=this.calculateCameraOptionsFromTo(a,c,e.center,e.elevation);return{pitch:d.pitch,zoom:d.zoom}}return{}}_applyUpdatedTransform(e){const a=[];if(a.push((c=>this._elevateCameraIfInsideTerrain(c))),this.transformCameraUpdate&&a.push((c=>this.transformCameraUpdate(c))),!a.length)return;const n=e.clone();for(const c of a){const d=n.clone(),{center:m,zoom:y,roll:x,pitch:w,bearing:T,elevation:M}=c(d);m&&d.setCenter(m),M!==void 0&&d.setElevation(M),y!==void 0&&d.setZoom(y),x!==void 0&&d.setRoll(x),w!==void 0&&d.setPitch(w),T!==void 0&&d.setBearing(T),n.apply(d)}this.transform.apply(n)}_fireMoveEvents(e){this.fire(new h.l("move",e)),this._zooming&&this.fire(new h.l("zoom",e)),this._rotating&&this.fire(new h.l("rotate",e)),this._pitching&&this.fire(new h.l("pitch",e)),this._rolling&&this.fire(new h.l("roll",e))}_afterEase(e,a){if(this._easeId&&a&&this._easeId===a)return;delete this._easeId;const n=this._zooming,c=this._rotating,d=this._pitching,m=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,n&&this.fire(new h.l("zoomend",e)),c&&this.fire(new h.l("rotateend",e)),d&&this.fire(new h.l("pitchend",e)),m&&this.fire(new h.l("rollend",e)),this.fire(new h.l("moveend",e))}flyTo(e,a){if(!e.essential&&We.prefersReducedMotion){const ct=h.Q(e,["center","zoom","bearing","pitch","roll","elevation","padding"]);return this.jumpTo(ct,a)}this.stop(),e=h.e({offset:[0,0],speed:1.2,curve:1.42,easing:h.co},e);const n=this._getTransformForUpdate(),c=n.bearing,d=n.pitch,m=n.roll,y=n.padding,x="bearing"in e?this._normalizeBearing(e.bearing,c):c,w="pitch"in e?+e.pitch:d,T="roll"in e?this._normalizeBearing(e.roll,m):m,M="padding"in e?e.padding:n.padding,P=h.P.convert(e.offset);let A=n.centerPoint.add(P);const D=n.screenPointToLocation(A),O=this.cameraHelper.handleFlyTo(n,{bearing:x,pitch:w,roll:T,padding:M,locationAtOffset:D,offsetAsPoint:P,center:e.center,minZoom:e.minZoom,zoom:e.zoom});let j=e.curve;const V=Math.max(n.width,n.height),$=V/O.scaleOfZoom,W=O.pixelPathLength;typeof O.scaleOfMinZoom=="number"&&(j=Math.sqrt(V/O.scaleOfMinZoom/W*2));const U=j*j;function H(ct){const xt=($*$-V*V+(ct?-1:1)*U*U*W*W)/(2*(ct?$:V)*U*W);return Math.log(Math.sqrt(xt*xt+1)-xt)}function Y(ct){return(Math.exp(ct)-Math.exp(-ct))/2}function Z(ct){return(Math.exp(ct)+Math.exp(-ct))/2}const J=H(!1);let lt=function(ct){return Z(J)/Z(J+j*ct)},ot=function(ct){return V*((Z(J)*(Y(xt=J+j*ct)/Z(xt))-Y(J))/U)/W;var xt},st=(H(!0)-J)/j;if(Math.abs(W)<2e-6||!isFinite(st)){if(Math.abs(V-$)<1e-6)return this.easeTo(e,a);const ct=$<V?-1:1;st=Math.abs(Math.log($/V))/j,ot=()=>0,lt=xt=>Math.exp(ct*j*xt)}return e.duration="duration"in e?+e.duration:1e3*st/("screenSpeed"in e?+e.screenSpeed/j:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=c!==x,this._pitching=w!==d,this._rolling=T!==m,this._padding=!n.isPaddingEqual(M),this._prepareEase(a,!1),this.terrain&&this._prepareElevation(O.targetCenter),this._ease((ct=>{const xt=ct*st,vt=1/lt(xt),mt=ot(xt);this._rotating&&n.setBearing(h.C.number(c,x,ct)),this._pitching&&n.setPitch(h.C.number(d,w,ct)),this._rolling&&n.setRoll(h.C.number(m,T,ct)),this._padding&&(n.interpolatePadding(y,M,ct),A=n.centerPoint.add(P)),O.easeFunc(ct,vt,mt,A),this.terrain&&!e.freezeElevation&&this._updateElevation(ct),this._applyUpdatedTransform(n),this._fireMoveEvents(a)}),(()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(a)}),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,a){var n;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,a)}return e||(n=this.handlers)===null||n===void 0||n.stop(!1),this}_ease(e,a,n){n.animate===!1||n.duration===0?(e(1),a()):(this._easeStart=Zt(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,a){e=h.aO(e,-180,180);const n=Math.abs(e-a);return Math.abs(e-360-a)<n&&(e-=360),Math.abs(e+360-a)<n&&(e+=360),e}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(h.S.convert(e),this.transform.tileZoom):null}}const ca={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Wn{constructor(e=ca){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=a=>{!a||a.sourceDataType!=="metadata"&&a.sourceDataType!=="visibility"&&a.dataType!=="style"&&a.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=ht.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ht.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ht.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ht.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,a){const n=this._map._getUIString(`AttributionControl.${a}`);e.title=n,e.setAttribute("aria-label",n)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((c=>typeof c!="string"?"":c))):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const a=this._map.style.sourceCaches;for(const c in a){const d=a[c];if(d.used||d.usedForTerrain){const m=d.getSource();m.attribution&&e.indexOf(m.attribution)<0&&e.push(m.attribution)}}e=e.filter((c=>String(c).trim())),e.sort(((c,d)=>c.length-d.length)),e=e.filter(((c,d)=>{for(let m=d+1;m<e.length;m++)if(e[m].indexOf(c)>=0)return!1;return!0}));const n=e.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,e.length?(this._innerContainer.innerHTML=ht.sanitize(n),this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Va{constructor(e={}){this._updateCompact=()=>{const a=this._container.children;if(a.length){const n=a[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&n.classList.add("maplibregl-compact"):n.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=ht.create("div","maplibregl-ctrl");const a=ht.create("a","maplibregl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://maplibre.org/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ht.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ti{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const a=++this._id;return this._queue.push({callback:e,id:a,cancelled:!1}),a}remove(e){const a=this._currentlyRunning,n=a?this._queue.concat(a):this._queue;for(const c of n)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const a=this._currentlyRunning=this._queue;this._queue=[];for(const n of a)if(!n.cancelled&&(n.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var xc=h.aJ([{name:"a_pos3d",type:"Int16",components:3}]);class Ji extends h.E{constructor(e){super(),this._lastTilesetChange=Zt(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=e._source.tileSize*2**this.deltaZoom,e.usedForTerrain=!0,e.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,a){this.sourceCache.update(e,a),this._renderableTilesKeys=[];const n={};for(const c of Dt(e,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:a,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))n[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.terrainRttPosMatrix32f=new Float64Array(16),h.bZ(c.terrainRttPosMatrix32f,0,h.$,h.$,0,0,1),this._tiles[c.key]=new k(c,this.tileSize),this._lastTilesetChange=Zt());for(const c in this._tiles)n[c]||delete this._tiles[c]}freeRtt(e){for(const a in this._tiles){const n=this._tiles[a];(!e||n.tileID.equals(e)||n.tileID.isChildOf(e)||e.isChildOf(n.tileID))&&(n.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((e=>this.getTileByID(e)))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e,a){return a?this._getTerrainCoordsForTileRanges(e,a):this._getTerrainCoordsForRegularTile(e)}_getTerrainCoordsForRegularTile(e){const a={};for(const n of this._renderableTilesKeys){const c=this._tiles[n].tileID,d=e.clone(),m=h.ba();if(c.canonical.equals(e.canonical))h.bZ(m,0,h.$,h.$,0,0,1);else if(c.canonical.isChildOf(e.canonical)){const y=c.canonical.z-e.canonical.z,x=c.canonical.x-(c.canonical.x>>y<<y),w=c.canonical.y-(c.canonical.y>>y<<y),T=h.$>>y;h.bZ(m,0,T,T,0,0,1),h.M(m,m,[-x*T,-w*T,0])}else{if(!e.canonical.isChildOf(c.canonical))continue;{const y=e.canonical.z-c.canonical.z,x=e.canonical.x-(e.canonical.x>>y<<y),w=e.canonical.y-(e.canonical.y>>y<<y),T=h.$>>y;h.bZ(m,0,h.$,h.$,0,0,1),h.M(m,m,[x*T,w*T,0]),h.N(m,m,[1/2**y,1/2**y,0])}}d.terrainRttPosMatrix32f=new Float32Array(m),a[n]=d}return a}_getTerrainCoordsForTileRanges(e,a){const n={};for(const c of this._renderableTilesKeys){const d=this._tiles[c].tileID;if(!this._isWithinTileRanges(d,a))continue;const m=e.clone(),y=h.ba();if(d.canonical.z===e.canonical.z){const x=e.canonical.x-d.canonical.x,w=e.canonical.y-d.canonical.y;h.bZ(y,0,h.$,h.$,0,0,1),h.M(y,y,[x*h.$,w*h.$,0])}else if(d.canonical.z>e.canonical.z){const x=d.canonical.z-e.canonical.z,w=d.canonical.x-(d.canonical.x>>x<<x),T=d.canonical.y-(d.canonical.y>>x<<x),M=e.canonical.x-(d.canonical.x>>x),P=e.canonical.y-(d.canonical.y>>x),A=h.$>>x;h.bZ(y,0,A,A,0,0,1),h.M(y,y,[-w*A+M*h.$,-T*A+P*h.$,0])}else{const x=e.canonical.z-d.canonical.z,w=e.canonical.x-(e.canonical.x>>x<<x),T=e.canonical.y-(e.canonical.y>>x<<x),M=(e.canonical.x>>x)-d.canonical.x,P=(e.canonical.y>>x)-d.canonical.y,A=h.$<<x;h.bZ(y,0,A,A,0,0,1),h.M(y,y,[w*h.$+M*A,T*h.$+P*A,0])}m.terrainRttPosMatrix32f=new Float32Array(y),n[c]=m}return n}getSourceTile(e,a){const n=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>n.maxzoom&&(c=n.maxzoom),c<n.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let d=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!d||!d.dem)&&a)for(;c>=n.minzoom&&(!d||!d.dem);)d=this.sourceCache.getTileByID(e.scaledTo(c--).key);return d}anyTilesAfterTime(e=Date.now()){return this._lastTilesetChange>=e}_isWithinTileRanges(e,a){return a[e.canonical.z]&&e.canonical.x>=a[e.canonical.z].minTileX&&e.canonical.x<=a[e.canonical.z].maxTileX&&e.canonical.y>=a[e.canonical.z].minTileY&&e.canonical.y<=a[e.canonical.z].maxTileY}}class vc{constructor(e,a,n){this._meshCache={},this.painter=e,this.sourceCache=new Ji(a),this.options=n,this.exaggeration=typeof n.exaggeration=="number"?n.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,a,n,c=h.$){var d;if(!(a>=0&&a<c&&n>=0&&n<c))return 0;const m=this.getTerrainData(e),y=(d=m.tile)===null||d===void 0?void 0:d.dem;if(!y)return 0;const x=h.cs([],[a/c*h.$,n/c*h.$],m.u_terrain_matrix),w=[x[0]*y.dim,x[1]*y.dim],T=Math.floor(w[0]),M=Math.floor(w[1]),P=w[0]-T,A=w[1]-M;return y.get(T,M)*(1-P)*(1-A)+y.get(T+1,M)*P*(1-A)+y.get(T,M+1)*(1-P)*A+y.get(T+1,M+1)*P*A}getElevationForLngLatZoom(e,a){if(!h.ct(a,e.wrap()))return 0;const{tileID:n,mercatorX:c,mercatorY:d}=this._getOverscaledTileIDFromLngLatZoom(e,a);return this.getElevation(n,c%h.$,d%h.$,h.$)}getElevation(e,a,n,c=h.$){return this.getDEMElevation(e,a,n,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,d=new h.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new h.T(c,d,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new h.T(c,new h.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=h.ai([])}const a=this.sourceCache.getSourceTile(e,!0);if(a&&a.dem&&(!a.demTexture||a.needsTerrainPrepare)){const c=this.painter.context;a.demTexture=this.painter.getTileTexture(a.dem.stride),a.demTexture?a.demTexture.update(a.dem.getPixels(),{premultiply:!1}):a.demTexture=new h.T(c,a.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),a.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),a.needsTerrainPrepare=!1}const n=a&&a+a.tileID.key+e.key;if(n&&!this._demMatrixCache[n]){const c=this.sourceCache.sourceCache._source.maxzoom;let d=e.canonical.z-a.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?d=e.canonical.z-c:h.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const m=e.canonical.x-(e.canonical.x>>d<<d),y=e.canonical.y-(e.canonical.y>>d<<d),x=h.cu(new Float64Array(16),[1/(h.$<<d),1/(h.$<<d),0]);h.M(x,x,[m*h.$,y*h.$,0]),this._demMatrixCache[e.key]={matrix:x,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:a&&a.dem&&a.dem.dim||1,u_terrain_matrix:n?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:a&&a.dem&&a.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(a&&a.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:a}}getFramebuffer(e){const a=this.painter,n=a.width/devicePixelRatio,c=a.height/devicePixelRatio;return!this._fbo||this._fbo.width===n&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new h.T(a.context,{width:n,height:c,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new h.T(a.context,{width:n,height:c,data:null},a.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(a.context.gl.NEAREST,a.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=a.context.createFramebuffer(n,c,!0,!1),this._fbo.depthAttachment.set(a.context.createRenderbuffer(a.context.gl.DEPTH_COMPONENT16,n,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const a=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let d=0,m=0;d<this._coordsTextureSize;d++)for(let y=0;y<this._coordsTextureSize;y++,m+=4)a[m+0]=255&y,a[m+1]=255&d,a[m+2]=y>>8<<4|d>>8,a[m+3]=0;const n=new h.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(a.buffer)),c=new h.T(e,n,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const a=new Uint8Array(4),n=this.painter.context,c=n.gl,d=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),m=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),y=Math.round(this.painter.height/devicePixelRatio);n.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(d,y-m-1,1,1,c.RGBA,c.UNSIGNED_BYTE,a),n.bindFramebuffer.set(null);const x=a[0]+(a[2]>>4<<8),w=a[1]+((15&a[2])<<8),T=this.coordsIndex[255-a[3]],M=T&&this.sourceCache.getTileByID(T);if(!M)return null;const P=this._coordsTextureSize,A=(1<<M.tileID.canonical.z)*P;return new h.a1((M.tileID.canonical.x*P+x)/A+M.tileID.wrap,(M.tileID.canonical.y*P+w)/A,this.getElevation(M.tileID,x,w,P))}depthAtPoint(e){const a=new Uint8Array(4),n=this.painter.context,c=n.gl;return n.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,a),n.bindFramebuffer.set(null),(a[0]/16777216+a[1]/65536+a[2]/256+a[3])/256}getTerrainMesh(e){var a;const n=((a=this.painter.style.projection)===null||a===void 0?void 0:a.transitionState)>0,c=n&&e.canonical.y===0,d=n&&e.canonical.y===(1<<e.canonical.z)-1,m=`m_${c?"n":""}_${d?"s":""}`;if(this._meshCache[m])return this._meshCache[m];const y=this.painter.context,x=new h.cv,w=new h.aN,T=this.meshSize,M=h.$/T,P=T*T;for(let Z=0;Z<=T;Z++)for(let J=0;J<=T;J++)x.emplaceBack(J*M,Z*M,0);for(let Z=0;Z<P;Z+=T+1)for(let J=0;J<T;J++)w.emplaceBack(J+Z,T+J+Z+1,T+J+Z+2),w.emplaceBack(J+Z,T+J+Z+2,J+Z+1);const A=x.length,D=A+(T+1),O=(T+1)*T,j=c?h.bh:0,V=c?0:1,$=d?h.bi:h.$,W=d?0:1;for(let Z=0;Z<=T;Z++)x.emplaceBack(Z*M,j,V);for(let Z=0;Z<=T;Z++)x.emplaceBack(Z*M,$,W);for(let Z=0;Z<T;Z++)w.emplaceBack(O+Z,D+Z,D+Z+1),w.emplaceBack(O+Z,D+Z+1,O+Z+1),w.emplaceBack(0+Z,A+Z+1,A+Z),w.emplaceBack(0+Z,0+Z+1,A+Z+1);const U=x.length,H=U+2*(T+1);for(const Z of[0,1])for(let J=0;J<=T;J++)for(const lt of[0,1])x.emplaceBack(Z*h.$,J*M,lt);for(let Z=0;Z<2*T;Z+=2)w.emplaceBack(U+Z,U+Z+1,U+Z+3),w.emplaceBack(U+Z,U+Z+3,U+Z+2),w.emplaceBack(H+Z,H+Z+3,H+Z+1),w.emplaceBack(H+Z,H+Z+2,H+Z+3);const Y=new Xi(y.createVertexBuffer(x,xc.members),y.createIndexBuffer(w),h.aM.simpleSegment(0,0,x.length,w.length));return this._meshCache[m]=Y,Y}getMeshFrameDelta(e){return 2*Math.PI*h.bu/Math.pow(2,Math.max(e,0))/5}getMinTileElevationForLngLatZoom(e,a){var n;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,a);return(n=this.getMinMaxElevation(c).minElevation)!==null&&n!==void 0?n:0}getMinMaxElevation(e){const a=this.getTerrainData(e).tile,n={minElevation:null,maxElevation:null};return a&&a.dem&&(n.minElevation=a.dem.min*this.exaggeration,n.maxElevation=a.dem.max*this.exaggeration),n}_getOverscaledTileIDFromLngLatZoom(e,a){const n=h.a1.fromLngLat(e.wrap()),c=(1<<a)*h.$,d=n.x*c,m=n.y*c,y=Math.floor(d/h.$),x=Math.floor(m/h.$);return{tileID:new h.Z(a,0,a,y,x),mercatorX:d,mercatorY:m}}}class uh{constructor(e,a,n){this._context=e,this._size=a,this._tileSize=n,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const a=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),n=new h.T(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return n.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),a.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),a.colorAttachment.set(n.texture),{id:e,fbo:a,texture:n,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((a=>e.id!==a)),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const a of this._recentlyUsed)if(!this._objects[a].inUse)return this._objects[a];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((e=>!e.inUse))===!1}}const ha={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0,"color-relief":!0};class dh{constructor(e,a){this.painter=e,this.terrain=a,this.pool=new uh(e.context,30,a.sourceCache.tileSize*a.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,a){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter((n=>!e._layers[n].isHidden(a))),this._coordsAscending={};for(const n in e.sourceCaches){this._coordsAscending[n]={};const c=e.sourceCaches[n].getVisibleCoordinates(),d=e.sourceCaches[n].getSource(),m=d instanceof br?d.terrainTileRanges:null;for(const y of c){const x=this.terrain.sourceCache.getTerrainCoords(y,m);for(const w in x)this._coordsAscending[n][w]||(this._coordsAscending[n][w]=[]),this._coordsAscending[n][w].push(x[w])}}this._coordsAscendingStr={};for(const n of e._order){const c=e._layers[n],d=c.source;if(ha[c.type]&&!this._coordsAscendingStr[d]){this._coordsAscendingStr[d]={};for(const m in this._coordsAscending[d])this._coordsAscendingStr[d][m]=this._coordsAscending[d][m].map((y=>y.key)).sort().join()}}for(const n of this._renderableTiles)for(const c in this._coordsAscendingStr){const d=this._coordsAscendingStr[c][n.tileID.key];d&&d!==n.rttCoords[c]&&(n.rtt=[])}}renderLayer(e,a){if(e.isHidden(this.painter.transform.zoom))return!1;const n=Object.assign(Object.assign({},a),{isRenderingToTexture:!0}),c=e.type,d=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(ha[c]&&(this._prevType&&ha[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(e.id),!m))return!0;if(ha[this._prevType]||ha[c]&&m){this._prevType=c;const y=this._stacks.length-1,x=this._stacks[y]||[];for(const w of this._renderableTiles){if(this.pool.isFull()&&(On(this.painter,this.terrain,this._rttTiles,n),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(w),w.rtt[y]){const M=this.pool.getObjectForId(w.rtt[y].id);if(M.stamp===w.rtt[y].stamp){this.pool.useObject(M);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),w.rtt[y]={id:T.id,stamp:T.stamp},d.context.bindFramebuffer.set(T.fbo.framebuffer),d.context.clear({color:h.bf.transparent,stencil:0}),d.currentStencilSource=void 0;for(let M=0;M<x.length;M++){const P=d.style._layers[x[M]],A=P.source?this._coordsAscending[P.source][w.tileID.key]:[w.tileID];d.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),d._renderTileClippingMasks(P,A,!0),d.renderLayer(d,d.style.sourceCaches[P.source],P,A,n),P.source&&(w.rttCoords[P.source]=this._coordsAscendingStr[P.source][w.tileID.key])}}return On(this.painter,this.terrain,this._rttTiles,n),this._rttTiles=[],this.pool.freeAllObjects(),ha[c]}return!1}}const Na={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Te=It,Ie={hash:!1,interactive:!0,bearingSnap:7,attributionControl:ca,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:h.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,transformConstrain:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},bc={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class Ua{constructor(e,a,n=!1){this.mousedown=d=>{this.startMove(d,ht.mousePos(this.element,d)),ht.addEventListener(window,"mousemove",this.mousemove),ht.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=d=>{this.move(d,ht.mousePos(this.element,d))},this.mouseup=d=>{this._rotatePitchHandler.dragEnd(d),this.offTemp()},this.touchstart=d=>{d.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ht.touchPos(this.element,d.targetTouches)[0],this.startMove(d,this._startPos),ht.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ht.addEventListener(window,"touchend",this.touchend))},this.touchmove=d=>{d.targetTouches.length!==1?this.reset():(this._lastPos=ht.touchPos(this.element,d.targetTouches)[0],this.move(d,this._lastPos))},this.touchend=d=>{d.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHandler.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=a;const c=new ja;this._rotatePitchHandler=new Mr({clickTolerance:3,move:(d,m)=>{const y=a.getBoundingClientRect(),x=new h.P((y.bottom-y.top)/2,(y.right-y.left)/2);return{bearingDelta:h.cn(new h.P(d.x,m.y),m,x),pitchDelta:n?-.5*(m.y-d.y):void 0}},moveStateManager:c,enable:!0,assignEvents:()=>{}}),this.map=e,ht.addEventListener(a,"mousedown",this.mousedown),ht.addEventListener(a,"touchstart",this.touchstart,{passive:!1}),ht.addEventListener(a,"touchcancel",this.reset)}startMove(e,a){this._rotatePitchHandler.dragStart(e,a),ht.disableDrag()}move(e,a){const n=this.map,{bearingDelta:c,pitchDelta:d}=this._rotatePitchHandler.dragMove(e,a)||{};c&&n.setBearing(n.getBearing()+c),d&&n.setPitch(n.getPitch()+d)}off(){const e=this.element;ht.removeEventListener(e,"mousedown",this.mousedown),ht.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),ht.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ht.removeEventListener(window,"touchend",this.touchend),ht.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){ht.enableDrag(),ht.removeEventListener(window,"mousemove",this.mousemove),ht.removeEventListener(window,"mouseup",this.mouseup),ht.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ht.removeEventListener(window,"touchend",this.touchend)}}let dr;function Us(u,e,a,n=!1){if(n||!a.getCoveringTilesDetailsProvider().allowWorldCopies())return u?.wrap();const c=new h.S(u.lng,u.lat);if(u=new h.S(u.lng,u.lat),e){const d=new h.S(u.lng-360,u.lat),m=new h.S(u.lng+360,u.lat),y=a.locationToScreenPoint(u).distSqr(e);a.locationToScreenPoint(d).distSqr(e)<y?u=d:a.locationToScreenPoint(m).distSqr(e)<y&&(u=m)}for(;Math.abs(u.lng-a.center.lng)>180;){const d=a.locationToScreenPoint(u);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;u.lng>a.center.lng?u.lng-=360:u.lng+=360}return u.lng!==c.lng&&a.isPointOnMapSurface(a.locationToScreenPoint(u))?u:c}const $a={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function $s(u,e,a){const n=u.classList;for(const c in $a)n.remove(`maplibregl-${a}-anchor-${c}`);n.add(`maplibregl-${a}-anchor-${e}`)}class vo extends h.E{constructor(e){if(super(),this._onKeyPress=a=>{const n=a.code,c=a.charCode||a.keyCode;n!=="Space"&&n!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=a=>{const n=a.originalEvent.target,c=this._element;this._popup&&(n===c||c.contains(n))&&this.togglePopup()},this._update=a=>{if(!this._map)return;const n=this._map.loaded()&&!this._map.isMoving();(a?.type==="terrain"||a?.type==="render"&&!n)&&this._map.once("render",this._update),this._lngLat=Us(this._lngLat,this._flatPos,this._map.transform),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let d="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?d="rotateX(0deg)":this._pitchAlignment==="map"&&(d=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||a&&a.type!=="moveend"||(this._pos=this._pos.round()),ht.setTransform(this._element,`${$a[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${d} ${c}`),We.frameAsync(new AbortController).then((()=>{this._updateOpacity(a&&a.type==="moveend")})).catch((()=>{}))},this._onMove=a=>{if(!this._isDragging){const n=this._clickTolerance||this._map._clickTolerance;this._isDragging=a.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=a.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new h.l("dragstart"))),this.fire(new h.l("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new h.l("dragend")),this._state="inactive"},this._addDragHandler=a=>{this._element.contains(a.originalEvent.target)&&(a.preventDefault(),this._positionDelta=a.point.sub(this._pos).add(this._offset),this._pointerdownPos=a.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=h.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=ht.create("div");const a=ht.createNS("http://www.w3.org/2000/svg","svg"),n=41,c=27;a.setAttributeNS(null,"display","block"),a.setAttributeNS(null,"height",`${n}px`),a.setAttributeNS(null,"width",`${c}px`),a.setAttributeNS(null,"viewBox",`0 0 ${c} ${n}`);const d=ht.createNS("http://www.w3.org/2000/svg","g");d.setAttributeNS(null,"stroke","none"),d.setAttributeNS(null,"stroke-width","1"),d.setAttributeNS(null,"fill","none"),d.setAttributeNS(null,"fill-rule","evenodd");const m=ht.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"fill-rule","nonzero");const y=ht.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(3.0, 29.0)"),y.setAttributeNS(null,"fill","#000000");const x=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const V of x){const $=ht.createNS("http://www.w3.org/2000/svg","ellipse");$.setAttributeNS(null,"opacity","0.04"),$.setAttributeNS(null,"cx","10.5"),$.setAttributeNS(null,"cy","5.80029008"),$.setAttributeNS(null,"rx",V.rx),$.setAttributeNS(null,"ry",V.ry),y.appendChild($)}const w=ht.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"fill",this._color);const T=ht.createNS("http://www.w3.org/2000/svg","path");T.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),w.appendChild(T);const M=ht.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"opacity","0.25"),M.setAttributeNS(null,"fill","#000000");const P=ht.createNS("http://www.w3.org/2000/svg","path");P.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),M.appendChild(P);const A=ht.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"transform","translate(6.0, 7.0)"),A.setAttributeNS(null,"fill","#FFFFFF");const D=ht.createNS("http://www.w3.org/2000/svg","g");D.setAttributeNS(null,"transform","translate(8.0, 8.0)");const O=ht.createNS("http://www.w3.org/2000/svg","circle");O.setAttributeNS(null,"fill","#000000"),O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"cx","5.5"),O.setAttributeNS(null,"cy","5.5"),O.setAttributeNS(null,"r","5.4999962");const j=ht.createNS("http://www.w3.org/2000/svg","circle");j.setAttributeNS(null,"fill","#FFFFFF"),j.setAttributeNS(null,"cx","5.5"),j.setAttributeNS(null,"cy","5.5"),j.setAttributeNS(null,"r","5.4999962"),D.appendChild(O),D.appendChild(j),m.appendChild(y),m.appendChild(w),m.appendChild(M),m.appendChild(A),m.appendChild(D),a.appendChild(m),a.setAttributeNS(null,"height",n*this._scale+"px"),a.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(a),this._offset=h.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(a=>{a.preventDefault()})),this._element.addEventListener("mousedown",(a=>{a.preventDefault()})),$s(this._element,this._anchor,"marker"),e&&e.className)for(const a of e.className.split(" "))this._element.classList.add(a);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),this._element.hasAttribute("role")||this._element.setAttribute("role","button"),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),e.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ht.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=h.S.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const a=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[a,-1*(38.1-13.5+a)],"bottom-right":[-a,-1*(38.1-13.5+a)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var a,n;const c=(a=this._map)===null||a===void 0?void 0:a.terrain,d=this._map.transform.isLocationOccluded(this._lngLat);if(!c||d){const A=d?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==A&&(this._element.style.opacity=A))}if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const m=this._map,y=m.terrain.depthAtPoint(this._pos),x=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,x)-y<.006)return void(this._element.style.opacity=this._opacity);const w=-this._offset.y/m.transform.pixelsPerMeter,T=Math.sin(m.getPitch()*Math.PI/180)*w,M=m.terrain.depthAtPoint(new h.P(this._pos.x,this._pos.y-this._offset.y)),P=m.transform.lngLatToCameraDepth(this._lngLat,x+T)-M>.006;!((n=this._popup)===null||n===void 0)&&n.isOpen()&&P&&this._popup.remove(),this._element.style.opacity=P?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=h.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,a){return(this._opacity===void 0||e===void 0&&a===void 0)&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),a!==void 0&&(this._opacityWhenCovered=a),this._map&&this._updateOpacity(!0),this}}const Hn={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let ua=0,bo=!1;const Xn={maxWidth:100,unit:"metric"};function Zs(u,e,a){const n=a&&a.maxWidth||100,c=u._container.clientHeight/2,d=u._container.clientWidth/2,m=u.unproject([d-n/2,c]),y=u.unproject([d+n/2,c]),x=Math.round(u.project(y).x-u.project(m).x),w=Math.min(n,x,u._container.clientWidth),T=m.distanceTo(y);if(a&&a.unit==="imperial"){const M=3.2808*T;M>5280?wo(e,w,M/5280,u._getUIString("ScaleControl.Miles")):wo(e,w,M,u._getUIString("ScaleControl.Feet"))}else a&&a.unit==="nautical"?wo(e,w,T/1852,u._getUIString("ScaleControl.NauticalMiles")):T>=1e3?wo(e,w,T/1e3,u._getUIString("ScaleControl.Kilometers")):wo(e,w,T,u._getUIString("ScaleControl.Meters"))}function wo(u,e,a,n){const c=(function(d){const m=Math.pow(10,`${Math.floor(d)}`.length-1);let y=d/m;return y=y>=10?10:y>=5?5:y>=3?3:y>=2?2:y>=1?1:(function(x){const w=Math.pow(10,Math.ceil(-Math.log(x)/Math.LN10));return Math.round(x*w)/w})(y),m*y})(a);u.style.width=e*(c/a)+"px",u.innerHTML=`${c}&nbsp;${n}`}const Kn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1,locationOccludedOpacity:void 0},Yn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Gs(u){if(u){if(typeof u=="number"){const e=Math.round(Math.abs(u)/Math.SQRT2);return{center:new h.P(0,0),top:new h.P(0,u),"top-left":new h.P(e,e),"top-right":new h.P(-e,e),bottom:new h.P(0,-u),"bottom-left":new h.P(e,-e),"bottom-right":new h.P(-e,-e),left:new h.P(u,0),right:new h.P(-u,0)}}if(u instanceof h.P||Array.isArray(u)){const e=h.P.convert(u);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:h.P.convert(u.center||[0,0]),top:h.P.convert(u.top||[0,0]),"top-left":h.P.convert(u["top-left"]||[0,0]),"top-right":h.P.convert(u["top-right"]||[0,0]),bottom:h.P.convert(u.bottom||[0,0]),"bottom-left":h.P.convert(u["bottom-left"]||[0,0]),"bottom-right":h.P.convert(u["bottom-right"]||[0,0]),left:h.P.convert(u.left||[0,0]),right:h.P.convert(u.right||[0,0])}}return Gs(new h.P(0,0))}const qs=It;z.AJAXError=h.cz,z.Event=h.l,z.Evented=h.E,z.LngLat=h.S,z.MercatorCoordinate=h.a1,z.Point=h.P,z.addProtocol=h.cA,z.config=h.a,z.removeProtocol=h.cB,z.AttributionControl=Wn,z.BoxZoomHandler=lc,z.CanvasSource=ar,z.CooperativeGesturesHandler=qn,z.DoubleClickZoomHandler=ce,z.DragPanHandler=Vs,z.DragRotateHandler=Zn,z.EdgeInsets=oi,z.FullscreenControl=class extends h.E{constructor(u={}){super(),this._onFullscreenChange=()=>{var e;let a=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=a?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)a=a.shadowRoot.fullscreenElement;a===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:h.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=ht.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ht.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const u=this._fullscreenButton=ht.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ht.create("span","maplibregl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new h.l("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new h.l("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},z.GeoJSONSource=Do,z.GeolocateControl=class extends h.E{constructor(u){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new h.l("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new h.l("geolocate",e)),this._finish()}},this._updateCamera=e=>{const a=new h.S(e.coords.longitude,e.coords.latitude),n=e.coords.accuracy,c=this._map.getBearing(),d=h.e({bearing:c},this.options.fitBoundsOptions),m=fe.fromLngLat(a,n);this._map.fitBounds(m,d,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const a=new h.S(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(a).addTo(this._map),this._userLocationDotMarker.setLngLat(a).addTo(this._map),this._accuracy=e.coords.accuracy,this._updateCircleRadiusIfNeeded()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onUpdate=()=>{this._updateCircleRadiusIfNeeded()},this._onError=e=>{if(this._map){if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&bo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new h.l("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this._geolocateButton=ht.create("button","maplibregl-ctrl-geolocate",this._container),ht.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){h.w("Geolocation support is not available so the GeolocateControl will be disabled.");const a=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}else{const a=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=a,this._geolocateButton.setAttribute("aria-label",a)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ht.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new vo({element:this._dotElement}),this._circleElement=ht.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vo({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onUpdate),this._map.on("move",this._onUpdate),this._map.on("rotate",this._onUpdate),this._map.on("pitch",this._onUpdate)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(a=>{const n=a?.[0]instanceof ResizeObserverEntry;a.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n||this._map.isZooming()||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new h.l("trackuserlocationend")),this.fire(new h.l("userlocationlostfocus")))}))}},this.options=h.e({},Hn,u)}onAdd(u){return this._map=u,this._container=ht.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return h._(this,arguments,void 0,(function*(e=!1){if(dr!==void 0&&!e)return dr;if(window.navigator.permissions===void 0)return dr=!!window.navigator.geolocation,dr;try{dr=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{dr=!!window.navigator.geolocation}return dr}))})().then((e=>this._finishSetupUI(e))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ht.remove(this._container),this._map.off("zoom",this._onUpdate),this._map.off("move",this._onUpdate),this._map.off("rotate",this._onUpdate),this._map.off("pitch",this._onUpdate),this._map=void 0,ua=0,bo=!1}_isOutOfMapMaxBounds(u){const e=this._map.getMaxBounds(),a=u.coords;return e&&(a.longitude<e.getWest()||a.longitude>e.getEast()||a.latitude<e.getSouth()||a.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":case"BACKGROUND_ERROR":case"OFF":case void 0:break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadiusIfNeeded(){const u=this._userLocationDotMarker.getLngLat();if(!(this.options.showUserLocation&&this.options.showAccuracyCircle&&this._accuracy&&u))return;const e=this._map.project(u),a=this._map.unproject([e.x+100,e.y]),n=u.distanceTo(a)/100,c=2*this._accuracy/n;this._circleElement.style.width=`${c.toFixed(2)}px`,this._circleElement.style.height=`${c.toFixed(2)}px`}trigger(){if(!this._setup)return h.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new h.l("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ua--,bo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new h.l("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new h.l("trackuserlocationstart")),this.fire(new h.l("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),ua++,ua>1?(u={maximumAge:6e5,timeout:0},bo=!0):(u=this.options.positionOptions,bo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,u)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},z.GlobeControl=class{constructor(){this._toggleProjection=()=>{var u;const e=(u=this._map.getProjection())===null||u===void 0?void 0:u.type;this._map.setProjection(e!=="mercator"&&e?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var u;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((u=this._map.getProjection())===null||u===void 0?void 0:u.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(u){return this._map=u,this._container=ht.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=ht.create("button","maplibregl-ctrl-globe",this._container),ht.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){ht.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},z.Hash=Vr,z.ImageSource=br,z.KeyboardHandler=_c,z.LngLatBounds=fe,z.LogoControl=Va,z.Map=class extends Ft{constructor(u){var e,a;h.cw.mark(h.cx.create);const n=Object.assign(Object.assign(Object.assign({},Ie),u),{canvasContextAttributes:Object.assign(Object.assign({},Ie.canvasContextAttributes),u.canvasContextAttributes)});if(n.minZoom!=null&&n.maxZoom!=null&&n.minZoom>n.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(n.minPitch!=null&&n.maxPitch!=null&&n.minPitch>n.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(n.minPitch!=null&&n.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(n.maxPitch!=null&&n.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const c=new si,d=new we;if(n.minZoom!==void 0&&c.setMinZoom(n.minZoom),n.maxZoom!==void 0&&c.setMaxZoom(n.maxZoom),n.minPitch!==void 0&&c.setMinPitch(n.minPitch),n.maxPitch!==void 0&&c.setMaxPitch(n.maxPitch),n.renderWorldCopies!==void 0&&c.setRenderWorldCopies(n.renderWorldCopies),n.transformConstrain!==null&&c.setConstrain(n.transformConstrain),super(c,d,{bearingSnap:n.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ti,this._controls=[],this._mapId=h.a7(),this._contextLost=y=>{y.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new h.l("webglcontextlost",{originalEvent:y}))},this._contextRestored=y=>{this._setupPainter(),this.resize(),this._update(),this.fire(new h.l("webglcontextrestored",{originalEvent:y}))},this._onMapScroll=y=>{if(y.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=n.interactive,this._maxTileCacheSize=n.maxTileCacheSize,this._maxTileCacheZoomLevels=n.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},n.canvasContextAttributes),this._trackResize=n.trackResize===!0,this._bearingSnap=n.bearingSnap,this._centerClampedToGround=n.centerClampedToGround,this._refreshExpiredTiles=n.refreshExpiredTiles===!0,this._fadeDuration=n.fadeDuration,this._crossSourceCollisions=n.crossSourceCollisions===!0,this._collectResourceTiming=n.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},Na),n.locale),this._clickTolerance=n.clickTolerance,this._overridePixelRatio=n.pixelRatio,this._maxCanvasSize=n.maxCanvasSize,this.transformCameraUpdate=n.transformCameraUpdate,this.transformConstrain=n.transformConstrain,this.cancelPendingTileRequestsWhileZooming=n.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=gi.addThrottleControl((()=>this.isMoving())),this._requestManager=new ya(n.transformRequest),typeof n.container=="string"){if(this._container=document.getElementById(n.container),!this._container)throw new Error(`Container '${n.container}' not found.`)}else{if(!(n.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=n.container}if(n.maxBounds&&this.setMaxBounds(n.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this.on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})),this.once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let y=!1;const x=Vn((w=>{this._trackResize&&!this._removed&&(this.resize(w),this.redraw())}),50);this._resizeObserver=new ResizeObserver((w=>{y?x(w):y=!0})),this._resizeObserver.observe(this._container)}this.handlers=new Rt(this,n),this._hash=n.hash&&new Vr(typeof n.hash=="string"&&n.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:n.center,elevation:n.elevation,zoom:n.zoom,bearing:n.bearing,pitch:n.pitch,roll:n.roll}),n.bounds&&(this.resize(),this.fitBounds(n.bounds,h.e({},n.fitBoundsOptions,{duration:0}))));const m=typeof n.style=="string"||((a=(e=n.style)===null||e===void 0?void 0:e.projection)===null||a===void 0?void 0:a.type)!=="globe";this.resize(null,m),this._localIdeographFontFamily=n.localIdeographFontFamily,this._validateStyle=n.validateStyle,n.style&&this.setStyle(n.style,{localIdeographFontFamily:n.localIdeographFontFamily}),n.attributionControl&&this.addControl(new Wn(typeof n.attributionControl=="boolean"?void 0:n.attributionControl)),n.maplibreLogo&&this.addControl(new Va,n.logoPosition),this.on("style.load",(()=>{if(m||this._resizeTransform(),this.transform.unmodified){const y=h.Q(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(y)}})),this.on("data",(y=>{this._update(y.dataType==="style"),this.fire(new h.l(`${y.dataType}data`,y))})),this.on("dataloading",(y=>{this.fire(new h.l(`${y.dataType}dataloading`,y))})),this.on("dataabort",(y=>{this.fire(new h.l("sourcedataabort",y))}))}_getMapId(){return this._mapId}setGlobalStateProperty(u,e){return this.style.setGlobalStateProperty(u,e),this._update(!0)}getGlobalState(){return this.style.getGlobalState()}addControl(u,e){if(e===void 0&&(e=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new h.k(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=u.onAdd(this);this._controls.push(u);const n=this._controlPositions[e];return e.indexOf("bottom")!==-1?n.insertBefore(a,n.firstChild):n.appendChild(a),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new h.k(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(u);return e>-1&&this._controls.splice(e,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}coveringTiles(u){return Dt(this.transform,u)}calculateCameraOptionsFromTo(u,e,a,n){return n==null&&this.terrain&&(n=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(u,e,a,n)}resize(u,e=!0){const[a,n]=this._containerDimensions(),c=this._getClampedPixelRatio(a,n);if(this._resizeCanvas(a,n,c),this.painter.resize(a,n,c),this.painter.overLimit()){const m=this.painter.context.gl;this._maxCanvasSize=[m.drawingBufferWidth,m.drawingBufferHeight];const y=this._getClampedPixelRatio(a,n);this._resizeCanvas(a,n,y),this.painter.resize(a,n,y)}this._resizeTransform(e);const d=!this._moving;return d&&(this.stop(),this.fire(new h.l("movestart",u)).fire(new h.l("move",u))),this.fire(new h.l("resize",u)),d&&this.fire(new h.l("moveend",u)),this}_resizeTransform(u=!0){var e;const[a,n]=this._containerDimensions();this.transform.resize(a,n,u),(e=this._requestedCameraState)===null||e===void 0||e.resize(a,n,u)}_getClampedPixelRatio(u,e){const{0:a,1:n}=this._maxCanvasSize,c=this.getPixelRatio(),d=u*c,m=e*c;return Math.min(d>a?a/d:1,m>n?n/m:1)*c}getPixelRatio(){var u;return(u=this._overridePixelRatio)!==null&&u!==void 0?u:devicePixelRatio}setPixelRatio(u){this._overridePixelRatio=u,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(u){return this.transform.setMaxBounds(fe.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.setMinZoom(u),this._update(),this.getZoom()<u&&this.setZoom(u),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.setMaxZoom(u),this._update(),this.getZoom()>u&&this.setZoom(u),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.setMinPitch(u),this._update(),this.getPitch()<u&&this.setPitch(u),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(u>=this.transform.minPitch)return this.transform.setMaxPitch(u),this._update(),this.getPitch()>u&&this.setPitch(u),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.setRenderWorldCopies(u),this._update()}setTransformConstrain(u){return this.transform.setConstrain(u),this._update()}project(u){return this.transform.locationToScreenPoint(h.S.convert(u),this.style&&this.terrain)}unproject(u){return this.transform.screenPointToLocation(h.P.convert(u),this.terrain)}isMoving(){var u;return this._moving||((u=this.handlers)===null||u===void 0?void 0:u.isMoving())}isZooming(){var u;return this._zooming||((u=this.handlers)===null||u===void 0?void 0:u.isZooming())}isRotating(){var u;return this._rotating||((u=this.handlers)===null||u===void 0?void 0:u.isRotating())}_createDelegatedListener(u,e,a){if(u==="mouseenter"||u==="mouseover"){let n=!1;return{layers:e,listener:a,delegates:{mousemove:c=>{const d=e.filter((y=>this.getLayer(y))),m=d.length!==0?this.queryRenderedFeatures(c.point,{layers:d}):[];m.length?n||(n=!0,a.call(this,new Ai(u,this,c.originalEvent,{features:m}))):n=!1},mouseout:()=>{n=!1}}}}if(u==="mouseleave"||u==="mouseout"){let n=!1;return{layers:e,listener:a,delegates:{mousemove:c=>{const d=e.filter((m=>this.getLayer(m)));(d.length!==0?this.queryRenderedFeatures(c.point,{layers:d}):[]).length?n=!0:n&&(n=!1,a.call(this,new Ai(u,this,c.originalEvent)))},mouseout:c=>{n&&(n=!1,a.call(this,new Ai(u,this,c.originalEvent)))}}}}{const n=c=>{const d=e.filter((y=>this.getLayer(y))),m=d.length!==0?this.queryRenderedFeatures(c.point,{layers:d}):[];m.length&&(c.features=m,a.call(this,c),delete c.features)};return{layers:e,listener:a,delegates:{[u]:n}}}}_saveDelegatedListener(u,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(e)}_removeDelegatedListener(u,e,a){if(!this._delegatedListeners||!this._delegatedListeners[u])return;const n=this._delegatedListeners[u];for(let c=0;c<n.length;c++){const d=n[c];if(d.listener===a&&d.layers.length===e.length&&d.layers.every((m=>e.includes(m)))){for(const m in d.delegates)this.off(m,d.delegates[m]);return void n.splice(c,1)}}}on(u,e,a){if(a===void 0)return super.on(u,e);const n=typeof e=="string"?[e]:e,c=this._createDelegatedListener(u,n,a);this._saveDelegatedListener(u,c);for(const d in c.delegates)this.on(d,c.delegates[d]);return{unsubscribe:()=>{this._removeDelegatedListener(u,n,a)}}}once(u,e,a){if(a===void 0)return super.once(u,e);const n=typeof e=="string"?[e]:e,c=this._createDelegatedListener(u,n,a);for(const d in c.delegates){const m=c.delegates[d];c.delegates[d]=(...y)=>{this._removeDelegatedListener(u,n,a),m(...y)}}this._saveDelegatedListener(u,c);for(const d in c.delegates)this.once(d,c.delegates[d]);return this}off(u,e,a){return a===void 0?super.off(u,e):(this._removeDelegatedListener(u,typeof e=="string"?[e]:e,a),this)}queryRenderedFeatures(u,e){if(!this.style)return[];let a;const n=u instanceof h.P||Array.isArray(u),c=n?u:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(n?{}:u)||{},c instanceof h.P||typeof c[0]=="number")a=[h.P.convert(c)];else{const d=h.P.convert(c[0]),m=h.P.convert(c[1]);a=[d,new h.P(m.x,d.y),m,new h.P(d.x,m.y),d]}return this.style.queryRenderedFeatures(a,e,this.transform)}querySourceFeatures(u,e){return this.style.querySourceFeatures(u,e)}setStyle(u,e){return(e=h.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&u?(this._diffStyle(u,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(u,e))}setTransformRequest(u){return this._requestManager.setTransformRequest(u),this}_getUIString(u){const e=this._locale[u];if(e==null)throw new Error(`Missing UI string '${u}'`);return e}_updateStyle(u,e){var a,n;if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(u,e)));const c=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!u)),u?(this.style=new Go(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u,e,c):this.style.loadJSON(u,e,c),this):((n=(a=this.style)===null||a===void 0?void 0:a.projection)===null||n===void 0||n.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Go(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,e){if(typeof u=="string"){const a=this._requestManager.transformRequest(u,"Style");h.j(a,new AbortController).then((n=>{this._updateDiff(n.data,e)})).catch((n=>{n&&this.fire(new h.k(n))}))}else typeof u=="object"&&this._updateDiff(u,e)}_updateDiff(u,e){try{this.style.setState(u,e)&&this._update(!0)}catch(a){h.w(`Unable to perform style diff: ${a.message||a.error||a}.  Rebuilding the style from scratch.`),this._updateStyle(u,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():h.w("There is no style added to the map.")}addSource(u,e){return this._lazyInitEmptyStyle(),this.style.addSource(u,e),this._update(!0)}isSourceLoaded(u){const e=this.style&&this.style.sourceCaches[u];if(e!==void 0)return e.loaded();this.fire(new h.k(new Error(`There is no source with ID '${u}'`)))}setTerrain(u){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),u){const e=this.style.sourceCaches[u.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${u.source}`);this.terrain===null&&e.reload();for(const a in this.style._layers){const n=this.style._layers[a];n.type==="hillshade"&&n.source===u.source&&h.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality."),n.type==="color-relief"&&n.source===u.source&&h.w("You are using the same source for a color-relief layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new vc(this.painter,e,u),this.painter.renderToTexture=new dh(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=a=>{var n;a.dataType==="style"?this.terrain.sourceCache.freeRtt():a.dataType==="source"&&a.tile&&(a.sourceId!==u.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),((n=a.source)===null||n===void 0?void 0:n.type)==="image"?this.terrain.sourceCache.freeRtt():this.terrain.sourceCache.freeRtt(a.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new h.l("terrain",{terrain:u})),this}getTerrain(){var u,e;return(e=(u=this.terrain)===null||u===void 0?void 0:u.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const u=this.style&&this.style.sourceCaches;for(const e in u){const a=u[e]._tiles;for(const n in a){const c=a[n];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(u){return this.style.removeSource(u),this._update(!0)}getSource(u){return this.style.getSource(u)}setSourceTileLodParams(u,e,a){if(a){const n=this.getSource(a);if(!n)throw new Error(`There is no source with ID "${a}", cannot set LOD parameters`);n.calculateTileZoom=rt(Math.max(1,u),Math.max(1,e))}else for(const n in this.style.sourceCaches)this.style.sourceCaches[n].getSource().calculateTileZoom=rt(Math.max(1,u),Math.max(1,e));return this._update(!0),this}refreshTiles(u,e){const a=this.style.sourceCaches[u];if(!a)throw new Error(`There is no source cache with ID "${u}", cannot refresh tile`);e===void 0?a.reload(!0):a.refreshTiles(e.map((n=>new h.a4(n.z,n.x,n.y))))}addImage(u,e,a={}){const{pixelRatio:n=1,sdf:c=!1,stretchX:d,stretchY:m,content:y,textFitWidth:x,textFitHeight:w}=a;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||h.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:T,height:M,data:P}=e,A=e;return this.style.addImage(u,{data:new h.R({width:T,height:M},new Uint8Array(P)),pixelRatio:n,stretchX:d,stretchY:m,content:y,textFitWidth:x,textFitHeight:w,sdf:c,version:0,userImage:A}),A.onAdd&&A.onAdd(this,u),this}}{const{width:T,height:M,data:P}=We.getImageData(e);this.style.addImage(u,{data:new h.R({width:T,height:M},P),pixelRatio:n,stretchX:d,stretchY:m,content:y,textFitWidth:x,textFitHeight:w,sdf:c,version:0})}}updateImage(u,e){const a=this.style.getImage(u);if(!a)return this.fire(new h.k(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const n=e instanceof HTMLImageElement||h.b(e)?We.getImageData(e):e,{width:c,height:d,data:m}=n;if(c===void 0||d===void 0)return this.fire(new h.k(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==a.data.width||d!==a.data.height)return this.fire(new h.k(new Error("The width and height of the updated image must be that same as the previous version of the image")));const y=!(e instanceof HTMLImageElement||h.b(e));return a.data.replace(m,y),this.style.updateImage(u,a),this}getImage(u){return this.style.getImage(u)}hasImage(u){return u?!!this.style.getImage(u):(this.fire(new h.k(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u){return gi.getImage(this._requestManager.transformRequest(u,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(u,e){return this._lazyInitEmptyStyle(),this.style.addLayer(u,e),this._update(!0)}moveLayer(u,e){return this.style.moveLayer(u,e),this._update(!0)}removeLayer(u){return this.style.removeLayer(u),this._update(!0)}getLayer(u){return this.style.getLayer(u)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(u,e,a){return this.style.setLayerZoomRange(u,e,a),this._update(!0)}setFilter(u,e,a={}){return this.style.setFilter(u,e,a),this._update(!0)}getFilter(u){return this.style.getFilter(u)}setPaintProperty(u,e,a,n={}){return this.style.setPaintProperty(u,e,a,n),this._update(!0)}getPaintProperty(u,e){return this.style.getPaintProperty(u,e)}setLayoutProperty(u,e,a,n={}){return this.style.setLayoutProperty(u,e,a,n),this._update(!0)}getLayoutProperty(u,e){return this.style.getLayoutProperty(u,e)}setGlyphs(u,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(u,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(u,e,a={}){return this._lazyInitEmptyStyle(),this.style.addSprite(u,e,a,(n=>{n||this._update(!0)})),this}removeSprite(u){return this._lazyInitEmptyStyle(),this.style.removeSprite(u),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(u,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(u,e,(a=>{a||this._update(!0)})),this}setLight(u,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(u,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(u,e={}){return this._lazyInitEmptyStyle(),this.style.setSky(u,e),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(u,e){return this.style.setFeatureState(u,e),this._update()}removeFeatureState(u,e){return this.style.removeFeatureState(u,e),this._update()}getFeatureState(u){return this.style.getFeatureState(u)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let u=0,e=0;return this._container&&(u=this._container.clientWidth||400,e=this._container.clientHeight||300),[u,e]}_setupContainer(){const u=this._container;u.classList.add("maplibregl-map");const e=this._canvasContainer=ht.create("div","maplibregl-canvas-container",u);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=ht.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const a=this._containerDimensions(),n=this._getClampedPixelRatio(a[0],a[1]);this._resizeCanvas(a[0],a[1],n);const c=this._controlContainer=ht.create("div","maplibregl-control-container",u),d=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((m=>{d[m]=ht.create("div",`maplibregl-ctrl-${m} `,c)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,e,a){this._canvas.width=Math.floor(a*u),this._canvas.height=Math.floor(a*e),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const u=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let e=null;this._canvas.addEventListener("webglcontextcreationerror",(n=>{e={requestedAttributes:u},n&&(e.statusMessage=n.statusMessage,e.type=n.type)}),{once:!0});let a=null;if(a=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,u):this._canvas.getContext("webgl2",u)||this._canvas.getContext("webgl",u),!a){const n="Failed to initialize WebGL";throw e?(e.message=n,new Error(JSON.stringify(e))):new Error(n)}this.painter=new tc(a,this.transform),zo.testSupport(a)}migrateProjection(u,e){super.migrateProjection(u,e),this.painter.transform=u,this.fire(new h.l("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_render(u){var e,a,n,c,d;const m=this._idleTriggered?this._fadeDuration:0,y=((e=this.style.projection)===null||e===void 0?void 0:e.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(u),this._removed)return;let x=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,P=Zt();this.style.zoomHistory.update(M,P);const A=new h.F(M,{now:P,fadeDuration:m,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),D=A.crossFadingFactor();D===1&&D===this._crossFadingFactor||(x=!0,this._crossFadingFactor=D),this.style.update(A)}const w=((a=this.style.projection)===null||a===void 0?void 0:a.transitionState)>0!==y;(n=this.style.projection)===null||n===void 0||n.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((c=this.style.projection)===null||c===void 0?void 0:c.transitionState,(d=this.style.projection)===null||d===void 0?void 0:d.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||w)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,m,this._crossSourceCollisions,w),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:m,showPadding:this.showPadding}),this.fire(new h.l("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,h.cw.mark(h.cx.load),this.fire(new h.l("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const T=this._sourcesDirty||this._styleDirty||this._placementDirty;return T||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new h.l("idle")),!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,h.cw.mark(h.cx.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var u;this._hash&&this._hash.remove();for(const a of this._controls)a.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),gi.removeThrottleControl(this._imageQueueHandle),(u=this._resizeObserver)===null||u===void 0||u.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ht.remove(this._canvasContainer),ht.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),h.cw.clearMetrics(),this._removed=!0,this.fire(new h.l("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,We.frame(this._frameRequest,(u=>{h.cw.frame(u),this._frameRequest=null;try{this._render(u)}catch(e){if(!h.cy(e)&&!(function(a){return a.message===Wl})(e))throw e}}),(()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get version(){return Te}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(u){return this._lazyInitEmptyStyle(),this.style.setProjection(u),this._update(!0)}},z.MapMouseEvent=Ai,z.MapTouchEvent=pi,z.MapWheelEvent=qi,z.Marker=vo,z.NavigationControl=class{constructor(u){this._updateZoomButtons=()=>{const e=this._map.getZoom(),a=e===this._map.getMaxZoom(),n=e===this._map.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(e,a)=>{const n=this._map._getUIString(`NavigationControl.${a}`);e.title=n,e.setAttribute("aria-label",n)},this.options=h.e({},bc,u),this._container=ht.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(e=>e.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(e=>this._map.zoomIn({},{originalEvent:e}))),ht.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(e=>this._map.zoomOut({},{originalEvent:e}))),ht.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})})),this._compassIcon=ht.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ua(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ht.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(u,e){const a=ht.create("button",u,this._container);return a.type="button",a.addEventListener("click",e),a}},z.Popup=class extends h.E{constructor(u){super(),this._updateOpacity=()=>{this.options.locationOccludedOpacity!==void 0&&(this._container.style.opacity=this._map.transform.isLocationOccluded(this.getLngLat())?`${this.options.locationOccludedOpacity}`:"")},this.remove=()=>(this._content&&ht.remove(this._content),this._container&&(ht.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new h.l("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ht.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ht.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const m of this.options.className.split(" "))this._container.classList.add(m);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=Us(this._lngLat,this._flatPos,this._map.transform,this._trackPointer),this._trackPointer&&!e)return;const a=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationToScreenPoint(this._lngLat));let n=this.options.anchor;const c=Gs(this.options.offset);if(!n){const m=this._container.offsetWidth,y=this._container.offsetHeight;let x;x=a.y+c.bottom.y<y?["top"]:a.y>this._map.transform.height-y?["bottom"]:[],a.x<m/2?x.push("left"):a.x>this._map.transform.width-m/2&&x.push("right"),n=x.length===0?"bottom":x.join("-")}let d=a.add(c[n]);this.options.subpixelPositioning||(d=d.round()),ht.setTransform(this._container,`${$a[n]} translate(${d.x}px,${d.y}px)`),$s(this._container,n,"popup"),this._updateOpacity()},this._onClose=()=>{this.remove()},this.options=h.e(Object.create(Kn),u)}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new h.l("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(u){return this._lngLat=h.S.convert(u),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const e=document.createDocumentFragment(),a=document.createElement("body");let n;for(a.innerHTML=u;n=a.firstChild,n;)e.appendChild(n);return this.setDOMContent(e)}getMaxWidth(){var u;return(u=this._container)===null||u===void 0?void 0:u.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ht.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(u),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(u){return this._container&&this._container.classList.add(u),this}removeClassName(u){return this._container&&this._container.classList.remove(u),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){if(this._container)return this._container.classList.toggle(u)}setSubpixelPositioning(u){this.options.subpixelPositioning=u}_createCloseButton(){this.options.closeButton&&(this._closeButton=ht.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Yn);u&&u.focus()}},z.RasterDEMTileSource=vr,z.RasterTileSource=Lr,z.ScaleControl=class{constructor(u){this._onMove=()=>{Zs(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,Zs(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Xn),u)}getDefaultPosition(){return"bottom-left"}onAdd(u){return this._map=u,this._container=ht.create("div","maplibregl-ctrl maplibregl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ht.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},z.ScrollZoomHandler=Cr,z.Style=Go,z.TerrainControl=class{constructor(u){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=u}onAdd(u){return this._map=u,this._container=ht.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ht.create("button","maplibregl-ctrl-terrain",this._container),ht.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ht.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},z.TwoFingersTouchPitchHandler=Os,z.TwoFingersTouchRotateHandler=fc,z.TwoFingersTouchZoomHandler=Fs,z.TwoFingersTouchZoomRotateHandler=Gn,z.VectorTileSource=oo,z.VideoSource=Fr,z.addSourceType=(u,e)=>h._(void 0,void 0,void 0,(function*(){if(Fo(u))throw new Error(`A source type called "${u}" already exists.`);((a,n)=>{Lo[a]=n})(u,e)})),z.clearPrewarmedResources=function(){const u=yr;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(gr),yr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},z.createTileMesh=Aa,z.getMaxParallelImageRequests=function(){return h.a.MAX_PARALLEL_IMAGE_REQUESTS},z.getRTLTextPluginStatus=function(){return wr().getRTLTextPluginStatus()},z.getVersion=function(){return qs},z.getWorkerCount=function(){return Hi.workerCount},z.getWorkerUrl=function(){return h.a.WORKER_URL},z.importScriptInWorkers=function(u){return Ni().broadcast("IS",u)},z.isTimeFrozen=function(){return mr.isFrozen()},z.prewarm=function(){io().acquire(gr)},z.restoreNow=function(){mr.restoreNow()},z.setMaxParallelImageRequests=function(u){h.a.MAX_PARALLEL_IMAGE_REQUESTS=u},z.setNow=function(u){mr.setNow(u)},z.setRTLTextPlugin=function(u,e){return wr().setRTLTextPlugin(u,e)},z.setWorkerCount=function(u){Hi.workerCount=u},z.setWorkerUrl=function(u){h.a.WORKER_URL=u}}));var ii=te;return ii}))})(Qh)),Qh.exports}var Vd=Uf();const pm=Vf(Vd),$f={name:"CarIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Zf=["aria-hidden","aria-label"],Gf=["fill","width","height"],qf={d:"M5,11L6.5,6.5H17.5L19,11M17.5,16A1.5,1.5 0 0,1 16,14.5A1.5,1.5 0 0,1 17.5,13A1.5,1.5 0 0,1 19,14.5A1.5,1.5 0 0,1 17.5,16M6.5,16A1.5,1.5 0 0,1 5,14.5A1.5,1.5 0 0,1 6.5,13A1.5,1.5 0 0,1 8,14.5A1.5,1.5 0 0,1 6.5,16M18.92,6C18.72,5.42 18.16,5 17.5,5H6.5C5.84,5 5.28,5.42 5.08,6L3,12V20A1,1 0 0,0 4,21H5A1,1 0 0,0 6,20V19H18V20A1,1 0 0,0 19,21H20A1,1 0 0,0 21,20V12L18.92,6Z"},Wf={key:0};function Hf(se,Mi,te,Ii,Ei,ii){return Ao(),Co("span",ru(se.$attrs,{"aria-hidden":te.title?null:"true","aria-label":te.title,class:"material-design-icon car-icon",role:"img",onClick:Mi[0]||(Mi[0]=z=>se.$emit("click",z))}),[(Ao(),Co("svg",{fill:te.fillColor,class:"material-design-icon__svg",width:te.size,height:te.size,viewBox:"0 0 24 24"},[tu("path",qf,[te.title?(Ao(),Co("title",Wf,iu(te.title),1)):eu("",!0)])],8,Gf))],16,Zf)}const Xf=Jh($f,[["render",Hf]]),Kf={name:"WalkIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},Yf=["aria-hidden","aria-label"],Qf=["fill","width","height"],Jf={d:"M14.12,10H19V8.2H15.38L13.38,4.87C13.08,4.37 12.54,4.03 11.92,4.03C11.74,4.03 11.58,4.06 11.42,4.11L6,5.8V11H7.8V7.33L9.91,6.67L6,22H7.8L10.67,13.89L13,17V22H14.8V15.59L12.31,11.05L13.04,8.18M14,3.8C15,3.8 15.8,3 15.8,2C15.8,1 15,0.2 14,0.2C13,0.2 12.2,1 12.2,2C12.2,3 13,3.8 14,3.8Z"},tm={key:0};function em(se,Mi,te,Ii,Ei,ii){return Ao(),Co("span",ru(se.$attrs,{"aria-hidden":te.title?null:"true","aria-label":te.title,class:"material-design-icon walk-icon",role:"img",onClick:Mi[0]||(Mi[0]=z=>se.$emit("click",z))}),[(Ao(),Co("svg",{fill:te.fillColor,class:"material-design-icon__svg",width:te.size,height:te.size,viewBox:"0 0 24 24"},[tu("path",Jf,[te.title?(Ao(),Co("title",tm,iu(te.title),1)):eu("",!0)])],8,Qf))],16,Yf)}const im=Jh(Kf,[["render",em]]),rm={name:"BicycleIcon",emits:["click"],props:{title:{type:String},fillColor:{type:String,default:"currentColor"},size:{type:Number,default:24}}},om=["aria-hidden","aria-label"],am=["fill","width","height"],sm={d:"M19 10C18.44 10 17.91 10.11 17.41 10.28L14.46 4.5H11V6H13.54L14.42 7.72L12 13.13L10.23 8.95C10.5 8.85 10.74 8.58 10.74 8.25C10.74 7.84 10.41 7.5 10 7.5H8C7.58 7.5 7.24 7.84 7.24 8.25S7.58 9 8 9H8.61L10.86 14.25H9.92C9.56 11.85 7.5 10 5 10C2.24 10 0 12.24 0 15S2.24 20 5 20C7.5 20 9.56 18.15 9.92 15.75H12.5L15.29 9.43L16.08 10.96C14.82 11.87 14 13.34 14 15C14 17.76 16.24 20 19 20S24 17.76 24 15 21.76 10 19 10M5 18.5C3.07 18.5 1.5 16.93 1.5 15S3.07 11.5 5 11.5C6.67 11.5 8.07 12.68 8.41 14.25H4V15.75H8.41C8.07 17.32 6.67 18.5 5 18.5M19 18.5C17.07 18.5 15.5 16.93 15.5 15C15.5 13.92 16 12.97 16.77 12.33L18.57 15.85L19.89 15.13L18.1 11.63C18.39 11.56 18.69 11.5 19 11.5C20.93 11.5 22.5 13.07 22.5 15S20.93 18.5 19 18.5Z"},nm={key:0};function lm(se,Mi,te,Ii,Ei,ii){return Ao(),Co("span",ru(se.$attrs,{"aria-hidden":te.title?null:"true","aria-label":te.title,class:"material-design-icon bicycle-icon",role:"img",onClick:Mi[0]||(Mi[0]=z=>se.$emit("click",z))}),[(Ao(),Co("svg",{fill:te.fillColor,class:"material-design-icon__svg",width:te.size,height:te.size,viewBox:"0 0 24 24"},[tu("path",sm,[te.title?(Ao(),Co("title",nm,iu(te.title),1)):eu("",!0)])],8,am))],16,om)}const cm=Jh(rm,[["render",lm]]),fm={marker:"mapIcons/marker.svg",marker_red:"mapIcons/marker-red.svg",marker_green:"mapIcons/marker-green.svg"},Od={car:{id:"routed-car",label:t("integration_openstreetmap","By car"),srv:0,ghpProfile:"car",osmandProfile:"car",icon:Xf},bike:{id:"routed-bike",label:t("integration_openstreetmap","By bike"),srv:1,ghpProfile:"bike",osmandProfile:"bicycle",icon:cm},foot:{id:"routed-foot",label:t("integration_openstreetmap","By foot"),srv:2,ghpProfile:"foot",osmandProfile:"pedestrian",icon:im}},ml={osrm_osm_de:{id:"osrm_osm_de",label:"https://routing.openstreetmap.de"},osrm_org:{id:"osrm_org",label:"https://map.project-osrm.org"},graphhopper_com:{id:"graphhopper_com",label:"https://graphhopper.com/maps"},osmand_net:{id:"osmand_net",label:"https://osmand.net/map/navigate"}};function mm(se,Mi=Od.car,te=ml.osrm_org.id,Ii=!1,Ei=!0,ii="street"){if(se===null||se.length<2)return null;const z=Mi??Od.car;let h;const It=[],pe=[];if(te===null||te===ml.osrm_org.id)h="https://map.project-osrm.org/",pe.push(...se.map(he=>`loc=${he[1]}%2C${he[0]}`)),pe.push("srv="+z.srv);else if(te===ml.osrm_osm_de.id)h="https://routing.openstreetmap.de/",pe.push(...se.map(he=>`loc=${he[1]}%2C${he[0]}`)),pe.push("srv="+z.srv);else if(te===ml.graphhopper_com.id)h="https://graphhopper.com/maps/",pe.push(...se.map(he=>`point=${he[1]}%2C${he[0]}`)),pe.push("profile="+z.ghpProfile);else if(te===ml.osmand_net.id){h="https://osmand.net/map/navigate/";const he=se[0],ki=se[se.length-1];if(pe.push(`start=${he[1]},${he[0]}`),pe.push(`end=${ki[1]},${ki[0]}`),se.length>2){const Zt=se.slice(1,se.length-1);pe.push("via="+Zt.map(ht=>`${ht[1]},${ht[0]}`).join(";"))}pe.push("profile="+z.osmandProfile);const We=se.map(Zt=>Zt[1]).reduce((Zt,ht)=>Zt+ht,0)/se.length,mr=se.map(Zt=>Zt[0]).reduce((Zt,ht)=>Zt+ht,0)/se.length;It.push(`14/${We}/${mr}`)}return Ii&&It.push("terrain"),Ei&&It.push("globe"),ii!=="streets"&&It.push("style="+encodeURIComponent(ii)),pe.length>0&&(h+="?"+pe.join("&")),It.length>0&&(h+="#"+It.join("&")),h}function _m(se,Mi,te){const Ii=document.createElement("div"),Ei=new Vd.Map({container:Ii,zoom:te}),ii=600,z=350,h=ii/2,It=z/2,pe=Ei.project([Mi,se]),he=Ei.unproject([pe.x-h,pe.y+It]),ki=Ei.unproject([pe.x+h,pe.y-It]);return Ei.remove(),[he.lat,ki.lat,he.lng,ki.lng]}async function gm(se){const Mi=[];try{const te={params:{q:se.query,rformat:"geojson",polygon_geojson:1,addressdetails:1,limit:se.limit}},Ii=Of("/apps/integration_openstreetmap/search"),Ei=(await jf.get(Ii,te)).data.ocs.data;for(const ii of Ei.features){const z=[ii.bbox[0]+(ii.bbox[2]-ii.bbox[0])/2,ii.bbox[1]+(ii.bbox[3]-ii.bbox[1])/2],h={type:"Feature",geometry:{type:"Point",coordinates:z},place_name:ii.properties.display_name,properties:ii.properties,text:ii.properties.display_name,place_type:["place"],center:z};Mi.push(h)}}catch(te){console.error(`Failed to forwardGeocode with error: ${te}`)}return{features:Mi}}export{mm as a,Od as b,fm as c,gm as d,pm as e,_m as g,Vd as m,ml as r};
//# sourceMappingURL=mapUtils-m7e-c8Iy.chunk.mjs.map
